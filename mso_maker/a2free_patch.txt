diff -rupN BASE_MISSION/CA/Data/ParticleEffects/SCRIPTS/muzzle/rifle.sqf BASE_A2Free/CA/Data/ParticleEffects/SCRIPTS/muzzle/rifle.sqf
--- BASE_MISSION/CA/Data/ParticleEffects/SCRIPTS/muzzle/rifle.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/CA/Data/ParticleEffects/SCRIPTS/muzzle/rifle.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,23 @@
+private ["_sh","_p","_tr1","_tr2","_vec","_i","_int"];
+
+_sh = nearestobject [_this select 0, _this select 4];
+
+_p = getpos _sh;
+_vec = vectordir _sh;
+_int=((speed _sh)/3240)*(0.7 + random 0.6);
+_life=_int*(0.5 + random 0.2);
+if (_life==0) exitwith {};
+drop [["\ca\Data\ParticleEffects\Universal\Universal",16,12,8],
+"", "Billboard", 1, _life, [0, 0, 0], [0, (2 + random 1.5)*_int, 0], 0, 0.104, 0.08,
+0.2,[0.1, 1*_int,1.6*_int,_int*2], [[0.9, 0.9, 0.9, 0.1 + random 0.07],[1, 1, 1, 0]],
+ [1/_life], 1, 0, "", "", _sh,random 360];
+ if (_int>1) then {_int=1};
+if ((abs(_p select 2) < _int) and !(surfaceiswater _p)) then
+			{
+			_tr1= (_int - abs(_p select 2))/1.3;
+
+			drop [["\ca\Data\ParticleEffects\Universal\Universal.p3d", 16, 12, 13, 0], "", "Billboard", 1, 0.9 + random 0.3,
+			[_p select 0, _p select 1, 0.07], [((_vec select 0) -0.4 +(random 0.8))*1.3, ((_vec select 1) -0.4 +(random 0.8))*1.3, 0], 0,
+			0.104, 0.08, 0.2, [(0.2 + random 0.2)*_int,(1.3 +random 0.6)*_int],[[0.6, 0.5, 0.4, _tr1],[0.6, 0.5, 0.4, 0]],
+			[1000], 1, 0, "", "", ""];
+			}
\ No newline at end of file
diff -rupN BASE_MISSION/CA/Data/ParticleEffects/SCRIPTS/muzzle/rocket.sqf BASE_A2Free/CA/Data/ParticleEffects/SCRIPTS/muzzle/rocket.sqf
--- BASE_MISSION/CA/Data/ParticleEffects/SCRIPTS/muzzle/rocket.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/CA/Data/ParticleEffects/SCRIPTS/muzzle/rocket.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,42 @@
+private ["_sh","_p","_tr1","_tr2","_vec","_col","_i","_no"];
+
+_sh = nearestobject [_this select 0, _this select 4];
+
+_p = getpos _sh;
+
+
+
+	drop [["\ca\Data\ParticleEffects\Universal\Universal",16,2,32], "", "Billboard", 1,(0.1 + random 0.1),
+	[0, -1.3,0],
+	[0, -2, 0], 0, 10, 7.9, 0.075, [1,3],
+	[[1, 1, 1, -2], [1, 1, 1, -2],
+	[1, 1, 1, -1], [1, 0.5, 1, -0]],
+	[5], 1, 0, "", "", _sh];
+
+	_col = [[0.7,0.7,0.7,0],[0.7,0.7,0.7,0.8],[0.7,0.7,0.7,0.6],[0.8,0.8,0.8,0.4],[0.9,0.9,0.9,0.2], [1,1,1,0]];
+_i=1;
+_no=6+random 3;
+while {_i<_no}
+do
+	{
+	drop [["\ca\Data\ParticleEffects\Universal\Universal", 16, 7, 48], "", "Billboard", 1, 2.5, [0, - 1.3, 0],
+	[-0.5+random 1,-1.5*_i + random 1,-0.5+random 1], 1, 1, 0.80, 0.4, [1,(2.3*_i)+random 0.5],_col,[2,0.7,0.5],0.1,0.1,"","",_sh];
+	_i=_i+1;
+	};
+
+if ((abs(_p select 2) < 2) and !(surfaceiswater _p)) then 			{
+			_vec = vectordir _sh;
+			_no= 20 + random 7;
+			_i=0;
+			while {_i<_no} do
+				{
+				drop [["\ca\Data\ParticleEffects\Universal\Universal.p3d", 16, 12, 13, 0], "", "Billboard", 1, 7,
+				[_p select 0, _p select 1, 0], [-((_vec select 0) -0.5 +(random 1))*4,
+				-((_vec select 1) -0.5 +(random 1))*4, 0.3 + random 0.3],
+				0, 0.104, 0.08, 0.04, [2,4], [[0.6, 0.5, 0.4, 0],[0.6, 0.5, 0.4, 0.4], [0.6, 0.5, 0.4, 0.2],
+				[0.6, 0.5, 0.4, 0]], [1000], 1, 0, "", "", ""];
+				_i=_i + 1;
+				};
+			};
+
+//(_this + [_sh]) spawn BIS_Effects_RocketTrail;
\ No newline at end of file
diff -rupN BASE_MISSION/CA/modules/Functions/variables/fn_undefCheck.sqf BASE_A2Free/CA/modules/Functions/variables/fn_undefCheck.sqf
--- BASE_MISSION/CA/modules/Functions/variables/fn_undefCheck.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/CA/modules/Functions/variables/fn_undefCheck.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,2 @@
+diag_log "Dummy file called, please fix!";
+false;
diff -rupN BASE_MISSION/CBA_init.sqf BASE_A2Free/CBA_init.sqf
--- BASE_MISSION/CBA_init.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/CBA_init.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,16 @@
+call compile preProcessFileLineNumbers "x\cba\addons\extended_eventhandlers_InitXEH.sqf";
+call compile preProcessFileLineNumbers "x\cba\addons\common_XEH_preInit.sqf";
+call compile preProcessFileLineNumbers "x\cba\addons\events_XEH_preInit.sqf";
+if (!isDedicated) then {call compile preProcessFileLineNumbers "x\cba\addons\events_XEH_preClientInit.sqf"};
+if (!isDedicated) then {call compile preProcessFileLineNumbers "x\cba\addons\common_XEH_preClientInit.sqf"};
+if (!isDedicated) then {call compile preProcessFileLineNumbers "x\cba\addons\help_XEH_preClientInit.sqf"};
+if (!isDedicated) then {call compile preProcessFileLineNumbers "x\cba\addons\ui_XEH_preClientInit.sqf"};
+call compile preProcessFileLineNumbers "x\cba\addons\common_XEH_postInit.sqf";
+call compile preProcessFileLineNumbers "x\cba\addons\diagnostic_XEH_preInit.sqf";
+call compile preProcessFileLineNumbers "x\cba\addons\network_XEH_preInit.sqf";
+call compile preProcessFileLineNumbers "x\cba\addons\versioning_XEH_preInit.sqf";
+call compile preProcessFileLineNumbers "x\cba\addons\versioning_XEH_postInit.sqf";
+if (!isDedicated) then {call compile preProcessFileLineNumbers "x\cba\addons\help_XEH_postClientInit.sqf"};
+if (isServer) then {call compile preProcessFileLineNumbers "x\cba\addons\versioning_XEH_postInitServer.sqf"};
+if (!isDedicated) then {call compile preProcessFileLineNumbers "x\cba\addons\versioning_XEH_postInitClient.sqf"};
+call compile preProcessFileLineNumbers "x\cba\addons\vectors_XEH_preInit.sqf";
\ No newline at end of file
diff -rupN BASE_MISSION/XEH_preinit.sqf BASE_A2Free/XEH_preinit.sqf
--- BASE_MISSION/XEH_preinit.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/XEH_preinit.sqf	Thu Jan  1 10:00:00 1970
@@ -1,4 +0,0 @@
-// Check for ACRE, enable sync
-if (isClass(configFile>>"CfgPatches">>"acre_main")) then {
-	acre_sys_core_sync_enabled = true;
-};
\ No newline at end of file
diff -rupN BASE_MISSION/ambience/modules/crb_civilians/Main.sqf BASE_A2Free/ambience/modules/crb_civilians/Main.sqf
--- BASE_MISSION/ambience/modules/crb_civilians/Main.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/ambience/modules/crb_civilians/Main.sqf	Wed Jan  4 23:08:04 2012
@@ -1,3 +1,6 @@
+#define A2FREE
+
+
 if(isServer) then {
         private["_debug","_logicCiv","_logicVeh","_logicAni"];
         
@@ -22,8 +25,11 @@ if(isServer) then {
                         _logicCiv setvariable ["debug", true];
                 };
                 BIS_alice_mainscope setVariable ["townlist",(BIS_functions_mainscope getVariable "locations")];
-                //_ok = [_logicCiv] execVM "ca\modules\alice\data\scripts\main.sqf";
+#ifdef A2FREE
+		_ok = [_logicCiv] execVM "ca\modules\alice\data\scripts\main.sqf";
+#else
                 _ok = [_logicCiv] execVM "ca\modules_e\alice2\data\scripts\main.sqf";
+#endif
 	        [] call compile preprocessfilelinenumbers "ambience\modules\crb_civilians\crB_AmbCivSetup.sqf";
         };
         
diff -rupN BASE_MISSION/ambience/modules/crb_civilians/crB_AmbCivSetup.sqf BASE_A2Free/ambience/modules/crb_civilians/crB_AmbCivSetup.sqf
--- BASE_MISSION/ambience/modules/crb_civilians/crB_AmbCivSetup.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/ambience/modules/crb_civilians/crB_AmbCivSetup.sqf	Wed Jan  4 23:08:04 2012
@@ -1,3 +1,5 @@
+#define A2FREE
+
 //////////////////////////////////////////////////////////////////
 // Function file for Armed Assault
 // Created by: (AEF)Wolffy.au [CTB]
@@ -11,6 +13,7 @@ if(!isServer) exitWith{};
 waitUntil{!isNil "BIS_fnc_init"};
 waitUntil{!isNil "BIS_alice_mainscope"};
 
+#ifndef A2FREE
 // Override default BIS_ALICE2_fnc_civilianSet function with MIP patch
 // - Fixed issues with units spawning on roofs in Chernarus
 // - Fixed some typos
@@ -18,6 +21,7 @@ waitUntil{!isNil "BIS_alice_mainscope"};
 // - Reduced default AI skill for less CPU
 // - Changed unit speed to LIMITED
 BIS_ALICE2_fnc_civilianSet = compile preprocessFileLineNumbers "ca\modules_e\alice2\data\scripts\fn_civilianSet.sqf";
+#endif
 
 // See http://community.bistudio.com/wiki/Ambient_Civilians
 //BIS_alice_mainscope setVariable ["debug", true];
@@ -43,13 +47,17 @@ switch toLower(worldName) do {		
                 BIS_alice_mainscope setvariable ["spawnDistance",700];                
                 BIS_alice_mainscope setVariable ["townsFaction",["CIV","CIV_RU"]];                
 		BIS_alice_mainscope setVariable ["civilianCount","round (2 * (sqrt %1))"]; 
+#ifndef A2FREE
                 [] call compile preprocessFileLineNumbers "ambience\modules\crb_civilians\ALICE2_houseEffects.sqf";        
+#endif
         };        
         case "eden": {                
                 BIS_alice_mainscope setvariable ["trafficDistance",700];                
                 BIS_alice_mainscope setvariable ["spawnDistance",350];                
                 BIS_alice_mainscope setVariable ["townsFaction",["cwr2_civ","CIV_RU"]];                
+#ifndef A2FREE
                 [] call compile preprocessFileLineNumbers "ambience\modules\crb_civilians\ALICE2_houseEffects.sqf";  
+#endif
         };
         case "fallujah": {                
                 BIS_alice_mainscope setvariable ["trafficDistance",600];      
@@ -60,7 +68,9 @@ switch toLower(worldName) do {		
                 BIS_alice_mainscope setvariable ["trafficDistance",1000];             
                 BIS_alice_mainscope setvariable ["spawnDistance",700];            
                 BIS_alice_mainscope setVariable ["civilianCount","round (5 * (sqrt %1))"];   
+#ifndef A2FREE
                 [] call compile preprocessFileLineNumbers "ambience\modules\crb_civilians\ALICE2_houseEffects.sqf";  
+#endif
         };       
         case "takistan": {   
                 BIS_alice_mainscope setvariable ["trafficDistance",1000];      
@@ -78,7 +88,9 @@ switch toLower(worldName) do {		
                 BIS_alice_mainscope setvariable ["trafficDistance",650];      
                 BIS_alice_mainscope setvariable ["spawnDistance",500];       
                 BIS_alice_mainscope setVariable ["townsFaction",["CIV","CIV_RU"]];  
+#ifndef A2FREE
                 [] call compile preprocessFileLineNumbers "ambience\modules\crb_civilians\ALICE2_houseEffects.sqf";  
+#endif
         };
         case "zargabad": { 
                 BIS_alice_mainscope setvariable ["trafficDistance",750];      
@@ -133,10 +145,12 @@ BIS_alice_mainscope setvariable ["threat
                                 _this addMagazine "8Rnd_9x18_Makarov";
                                 _this addMagazine "8Rnd_9x18_Makarov";
                                 _this addWeapon "Makarov";
+#ifndef A2FREE
                         } else {
                                 _this addMagazine "6Rnd_45ACP";
                                 _this addMagazine "6Rnd_45ACP";
                                 _this addWeapon "revolver_EP1";
+#endif
                         };
                 };
         }
diff -rupN BASE_MISSION/ambience/modules/crb_shepherds/main.sqf BASE_A2Free/ambience/modules/crb_shepherds/main.sqf
--- BASE_MISSION/ambience/modules/crb_shepherds/main.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/ambience/modules/crb_shepherds/main.sqf	Wed Jan  4 23:08:04 2012
@@ -1,4 +1,5 @@
 #include <crbprofiler.hpp>
+#define A2FREE
 
 private ["_types","_name","_pos","_shepherds"];
 if (!isServer) exitWith{};
@@ -84,8 +85,10 @@ CRB_fnc_createShepherd = {
         _shepherd setVariable ["attacking", false];
         
         if(isDedicated) then {
+#ifndef A2FREE
                 _shepherd addMPEventHandler ["MPKilled",{[([position (_this select 0), group (_this select 0)] call CRB_fnc_createShepherd)] call CRB_fnc_armShepherd;}];
         } else {
+#endif
                 _shepherd addEventHandler ["Killed",{[([position (_this select 0), group (_this select 0)] call CRB_fnc_createShepherd)] call CRB_fnc_armShepherd;}];
         };
         
@@ -176,8 +179,10 @@ CRB_fnc_createDogs = {
                 _dog setSkill (random 0.5);
                 _dog allowFleeing 0;
                 if(isDedicated) then {
+#ifndef A2FREE
                         _dog addMPEventHandler ["MPKilled",{_this spawn CRB_fnc_shepherdAttack;}];
                 } else {
+#endif
                         _dog addEventHandler ["Killed",{_this spawn CRB_fnc_shepherdAttack;}];
                 };
                 _dogs set [count _dogs, _dog];
@@ -226,8 +231,10 @@ CRB_fnc_createHerd = {
                 _h allowFleeing 1;
                 _h setBehaviour "SAFE";
                 if(isDedicated) then {
+#ifndef A2FREE
                         _h addMPEventHandler ["MPKilled",{_this spawn CRB_fnc_shepherdAttack;}];
                 } else {
+#endif
                         _h addEventHandler ["Killed",{_this spawn CRB_fnc_shepherdAttack;}];
                 };
                 _herd set [count _herd, _h];
diff -rupN BASE_MISSION/ambience/modules/tup_seatraffic/main.sqf BASE_A2Free/ambience/modules/tup_seatraffic/main.sqf
--- BASE_MISSION/ambience/modules/tup_seatraffic/main.sqf	Mon Jan  2 21:54:15 2012
+++ BASE_A2Free/ambience/modules/tup_seatraffic/main.sqf	Wed Jan  4 23:08:04 2012
@@ -107,9 +107,10 @@ if (((random 1 < 0.5) && (tup_seatraffic
 
 
 // Spawn a process for each destination
+_i = 0;
 {
         
-        [_forEachIndex, _x, _seadest, _mapsize] spawn {
+        [_i, _x, _seadest, _mapsize] spawn {
                 private ["_timeout","_destpos","_j","_spawnpos","_seadest","_currentseadest","_mapsize","_maxdist","_shipClass","_seaportside","_factions","_ship","_front","_vehiclelist","_shipVehicle","_shipCrew","_grp","_wp","_center","_p1","_p2"];
                 _j = _this select 0;
                 _currentseadest = _this select 1;
@@ -245,4 +246,5 @@ if (((random 1 < 0.5) && (tup_seatraffic
                         //sleep _sleep;                                
                 };
         };
+	_i = _i + 1;
 } forEach _seadest;
diff -rupN BASE_MISSION/core/functions/common/fn_addLoopHandler.sqf BASE_A2Free/core/functions/common/fn_addLoopHandler.sqf
--- BASE_MISSION/core/functions/common/fn_addLoopHandler.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/core/functions/common/fn_addLoopHandler.sqf	Wed Jan  4 23:08:04 2012
@@ -1,15 +1,17 @@
 // Thanks to Nou for this code
-private ["_id","_forEachIndex","_return"];
+private ["_id","_return","_i"];
 _return = -1;
 if(MSO_useCBA) then {
         player sideChat format["cba"];
         _this call cba_fnc_addPerFrameHandler;
 } else {
         _id = -1;
+	_i = 0;
         {
                 if((count _x) == 0) exitWith {
-                        _id = _forEachIndex;
+                        _id = _i;
                 };
+		_i = _i + 1;
         } forEach MSO_Loop_Funcs;
         if(_id == -1) then {
                 _id = (count MSO_Loop_Funcs);
diff -rupN BASE_MISSION/core/init.sqf BASE_A2Free/core/init.sqf
--- BASE_MISSION/core/init.sqf	Tue Jan  3 22:34:53 2012
+++ BASE_A2Free/core/init.sqf	Wed Jan  4 23:08:04 2012
@@ -20,16 +20,18 @@ MSO_useCBA = false;
                         waitUntil { player == player && alive player };
                 };
                 waitUntil {
-		        private ["_f","_delta"];
+		        private ["_f","_delta","_i"];
+			_i = 0;
                         {
                                 if((count _x) > 0) then {
                                         _f = _x select 0;
                                         _delta = _x select 1;
                                         if(diag_tickTime >= _delta) then {
-                                                [(_f select 2), _forEachIndex] call (_f select 0);
+                                                [(_f select 2), _i] call (_f select 0);
                                                 _x set[1, diag_tickTime + (_f select 1)];
                                         };
                                 };
+				_i = _i + 1;
                         } forEach MSO_Loop_Funcs;
                         false;
                 };
diff -rupN BASE_MISSION/core/modules/Spyder_ONU/main.sqf BASE_A2Free/core/modules/Spyder_ONU/main.sqf
--- BASE_MISSION/core/modules/Spyder_ONU/main.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/core/modules/Spyder_ONU/main.sqf	Wed Jan  4 23:08:04 2012
@@ -1,3 +1,6 @@
+
+#define A2FREE
+
 /***************************************************************************
 OBJECT NETWORK UPDATE
 CREATED BY SPYDER
@@ -6,6 +9,7 @@ SPYDER001@COMCAST.NET
 _null = [] execVM "SPY\SPY_objectNetUpdate.sqf";
 ****************************************************************************/
 
+#ifndef A2FREE
 if(!isDedicated) exitWith{};
 
 [] spawn {
@@ -34,4 +38,4 @@ if(!isDedicated) exitWith{};
 		sleep 120;
         };
 };
-
+#endif
\ No newline at end of file
diff -rupN BASE_MISSION/core/modules/rmm_nomad/main.sqf BASE_A2Free/core/modules/rmm_nomad/main.sqf
--- BASE_MISSION/core/modules/rmm_nomad/main.sqf	Tue Jan  3 23:33:57 2012
+++ BASE_A2Free/core/modules/rmm_nomad/main.sqf	Wed Jan  4 23:15:33 2012
@@ -1,5 +1,6 @@
 //#squint filter Code-block is never called
 //#squint filter Expected ; or operator but got ,
+#define A2FREE
 
 private ["_g_nomad","_s_nomad"];
 if (isdedicated) exitwith {};
@@ -16,9 +17,11 @@ _g_nomad = [
         {playerSide;},
         {magazines player;},
         {weapons player;},
+#ifndef A2FREE
         {typeof (unitbackpack player);},
         {getmagazinecargo (unitbackpack player);},
         {getweaponcargo (unitbackpack player);},
+#endif
         {getposATL player;},
         {damage player;},
         {rating player;},
@@ -58,6 +61,7 @@ _s_nomad = [
                 {player addweapon _x;} foreach _this;
                 player selectweapon (primaryweapon player);
         },
+#ifndef A2FREE
         {
                 if (_this != "") then {
                         player addbackpack _this;
@@ -75,6 +79,7 @@ _s_nomad = [
                         (unitbackpack player) addweaponcargo [(_this select 0) select _i,(_this select 1) select _i];
                 };
         },
+#endif
         {player setposATL _this;},
         {player setdamage _this;},
         {player addrating (-(rating player) + _this);},
@@ -120,7 +125,7 @@ _s_nomad = [
         }
 ];
 
-
+#ifndef A2FREE
 if (isClass(configFile>>"CfgPatches">>"ace_main")) then { 
         _g_nomad = _g_nomad + [
                 #include <mods\ace_sys_ruck_g.hpp>
@@ -140,5 +145,6 @@ if (isClass(configFile>>"CfgPatches">>"a
                 {} 
         ];                
 };
+#endif
 
 [_g_nomad, _s_nomad] execfsm "core\modules\rmm_nomad\nomad.fsm";
diff -rupN BASE_MISSION/core/scripts/init_player.sqf BASE_A2Free/core/scripts/init_player.sqf
--- BASE_MISSION/core/scripts/init_player.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/core/scripts/init_player.sqf	Wed Jan  4 23:08:04 2012
@@ -1,3 +1,5 @@
+#define A2FREE
+
 if (isDedicated) exitWith{};
 waituntil {not isnull player};
 
@@ -21,12 +23,15 @@ player addeventhandler ["respawn", {
         if !(isClass(configFile>>"CfgPatches">>"ace_main")) then {
                 {_unit removeweapon _x;} foreach ((weapons _unit) + (items _unit));
                 {_unit removemagazine _x;} foreach (magazines _unit);
+#ifndef A2FREE
                 removebackpack _unit;
+#endif
                 
                 {_unit addmagazine _x;} foreach (magazines _corpse);
                 {_unit addweapon _x;} foreach ((weapons _corpse) + (items _corpse));
                 _unit selectweapon (primaryweapon _unit);
                 
+#ifndef A2FREE
                 _bp = typeof (unitbackpack _corpse);
                 if (_bp != "") then {
                         _bpm = getmagazinecargo (unitbackpack _corpse);
@@ -43,10 +48,13 @@ player addeventhandler ["respawn", {
                                 (unitbackpack _unit) addweaponcargo [(_bpw select 0) select _i,(_bpw select 1) select _i];
                         };
                 };
+#endif
                 
         };
 
         removeallweapons _corpse;
         removeallitems _corpse;
+#ifndef A2FREE
         removebackpack _corpse;
+#endif
 }];
diff -rupN BASE_MISSION/core/scripts/intro.sqf BASE_A2Free/core/scripts/intro.sqf
--- BASE_MISSION/core/scripts/intro.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/core/scripts/intro.sqf	Wed Jan  4 23:08:04 2012
@@ -1,3 +1,4 @@
+#define A2FREE
 if(isDedicated) exitWith{};
 sleep 1;
 hint parsetext "<t size=2 align=left>MSO (FAQ)</t><t align=left><br/>
@@ -6,6 +7,9 @@ You have limited number of lives; after 
 <t size=2 align=left>What Now?</t><br/>Check your tasks and the notes section for after action reports, upcoming missions and recon information.<br/><br/>
 <t size=2 align=left>Who with?</t><br/>Join our teamspeak 3 channel (ts.ausarma.org) to meet up with others on the map, or use the ingame VOIP. If you have skype, send your account name to an AAF/AEF CTB member and you will be added to the MSO conversation.</t>";
 sleep 10;
-["Multi-Session","Operation"] call BIS_fnc_infoText;
-["by the MSO", "Development Team"] call BIS_fnc_infoText;
-
+#ifndef A2FREE
+	["Multi-Session","Operation"] call BIS_fnc_infoText;
+	["by the MSO", "Development Team"] call BIS_fnc_infoText;
+#else
+	titleText ["Multi-Session Operation\n\nby the MSO Development Team", "PLAIN DOWN"];
+#endif
diff -rupN BASE_MISSION/enemy/modules/WICT_enemypop/main.sqf BASE_A2Free/enemy/modules/WICT_enemypop/main.sqf
--- BASE_MISSION/enemy/modules/WICT_enemypop/main.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/enemy/modules/WICT_enemypop/main.sqf	Wed Jan  4 23:08:04 2012
@@ -14,7 +14,7 @@ if(!isServer) exitWith{};
 
 WICT_PATH = "enemy\modules\WICT_enemypop\";
 
-private ["_debug","_d","_camp","_flag","_WICTM","_WICTMN","_group","_pos2"];
+private ["_debug","_d","_camp","_flag","_WICTM","_WICTMN","_group","_pos2","_i"];
 _debug = false;
 
 if(isNil "wict_ep_intensity")then{wict_ep_intensity = 1;};
@@ -87,6 +87,7 @@ fPlayersInside = {
 
 if(isNil "wict_baselocations")then{wict_baselocations = 0};
 
+_i = 0;
 {
         private ["_group","_pos","_type"];
         _group = grpNull;
@@ -94,7 +95,7 @@ if(isNil "wict_baselocations")then{wict_
         _pos = [];
 	_skip = false;
 
-	if (_forEachIndex % wict_ep_intensity < 1) then {
+	if (_i % wict_ep_intensity < 1) then {
 		_skip = true;
 	};
 	
@@ -492,6 +493,7 @@ if(isNil "wict_baselocations")then{wict_
                         _m = [_t, _pos, "Icon", [1,1], "TYPE:", "Dot", "TEXT:", _type, "GLOBAL", "PERSIST"] call CBA_fnc_createMarker;
                 };
         };
+	_i = _i + 1;
 } foreach CRB_LOCS;
 
 [0,[],{[] call compile preprocessFileLineNumbers "enemy\modules\WICT_enemypop\init.sqf";}] call mso_core_fnc_ExMP;
diff -rupN BASE_MISSION/init-custom.sqf BASE_A2Free/init-custom.sqf
--- BASE_MISSION/init-custom.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/init-custom.sqf	Wed Jan  4 23:08:04 2012
@@ -1,37 +1,2 @@
-// Custom improvements that you may wish to implement
-
-// ACE configuration
-if (isClass(configFile>>"CfgPatches">>"ace_main")) then {
-	enableEngineArtillery false;  //disable BI arty comp
-	Ace_sys_wounds_no_medical_gear = true;  //disable ACE adding medical items
-	ace_sys_wounds_noai = true;  //disable wounds for AI for performance
-	ace_sys_eject_fnc_weaponcheck = {};  //disable aircraft weapon removal
-};
-
-// ACRE Config and sync
-if (isClass(configFile>>"CfgPatches">>"acre_main")) then {
-
-//	[0] call acre_api_fnc_setLossModelScale;  // Description: Specify any value between 1.0 and 0. Setting it to 0 means the loss model is disabled, 1 is default.
-
-	runOnPlayers = {
-		[] spawn
-		{
-			waitUntil {!isNil "mso_interaction_key"};
-			["player", [mso_interaction_key], 4, ["scripts\callAcreSync.sqf", "main"]] call CBA_ui_fnc_add;
-		};
-	};
-
-	if (!isDedicated) then {
-		if (!isNull player) then  // non JIP
-		{
-			call runOnPlayers;
-		}
-		else 
-		{
-			[] spawn {
-				waitUntil {!isNull player};
-				call runOnPlayers;
-			};
-		};
-	};
-};
\ No newline at end of file
+BIS_Effects_Rifle=compile preprocessFileLineNumbers "ca\Data\ParticleEffects\SCRIPTS\muzzle\rifle.sqf";
+BIS_Effects_Rocket=compile preprocessFileLineNumbers "ca\Data\ParticleEffects\SCRIPTS\muzzle\rocket.sqf";
\ No newline at end of file
diff -rupN BASE_MISSION/init.sqf BASE_A2Free/init.sqf
--- BASE_MISSION/init.sqf	Mon Jan  2 21:53:46 2012
+++ BASE_A2Free/init.sqf	Wed Jan  4 23:08:04 2012
@@ -1,3 +1,7 @@
+
+// A2Free CBA Integration
+#include "CBA_init.sqf"
+
 #ifndef execNow
 #define execNow call compile preprocessfilelinenumbers
 #endif
diff -rupN BASE_MISSION/support/scripts/resupply.sqf BASE_A2Free/support/scripts/resupply.sqf
--- BASE_MISSION/support/scripts/resupply.sqf	Mon Jan  2 21:53:47 2012
+++ BASE_A2Free/support/scripts/resupply.sqf	Wed Jan  4 23:08:04 2012
@@ -1,3 +1,5 @@
+﻿#define A2FREE
+
 /*  
 =========================================================
 Based on Simple Vehicle Respawn Script v1.6
@@ -31,8 +33,11 @@ if (_delay < 0) then {_delay = 0};
 _dir = getDir _unit;
 _position = getPosASL _unit;
 _type = typeOf _unit;
+
+#ifndef A2FREE
 _weapons = getWeaponCargo _unit;
 _mags = getMagazineCargo _unit;
+#endif
 
 // Start monitoring the vehicle
 while {_run} do {	
@@ -45,6 +50,8 @@ while {_run} do {	
 					_unit setVehicleVarName _unitname;
 			};
 		};
+
+#ifndef A2FREE
         clearWeaponCargo _unit;
         clearMagazineCargo _unit;
         
@@ -57,4 +64,5 @@ while {_run} do {	
         for "_i" from 0 to _max do {
                 _unit addMagazineCargo [(_mags select 0) select _i, (_mags select 1) select _i];
         };        
+#endif
 };
diff -rupN BASE_MISSION/support/scripts/vehicle.sqf BASE_A2Free/support/scripts/vehicle.sqf
--- BASE_MISSION/support/scripts/vehicle.sqf	Mon Jan  2 21:53:47 2012
+++ BASE_A2Free/support/scripts/vehicle.sqf	Wed Jan  4 23:08:04 2012
@@ -1,3 +1,5 @@
+﻿#define A2FREE
+
 /*  
 =========================================================
 Simple Vehicle Respawn Script v1.6
@@ -88,8 +90,10 @@ _type = typeOf _unit;
 _dead = false;
 _nodelay = false;
 
+#ifndef A2FREE
 _weapons = getWeaponCargo _unit;
 _mags = getMagazineCargo _unit;
+#endif
 
 // Start monitoring the vehicle
 while {_run} do 
@@ -121,6 +125,7 @@ while {_run} do 
                 _unit setPosASL _position;
                 _unit setDir _dir;
                 
+#ifndef A2FREE
                 clearWeaponCargo _unit;
                 clearMagazineCargo _unit;
                 
@@ -133,6 +138,7 @@ while {_run} do 
                 for "_i" from 0 to _max do {
                         _unit addMagazineCargo [(_mags select 0) select _i, (_mags select 1) select _i];
                 };
+#endif
                 
                 if (_haveinit) then 
                 {_unit setVehicleInit format ["%1;", _unitinit];
diff -rupN BASE_MISSION/x/cba/addons/CfgFunctions.hpp BASE_A2Free/x/cba/addons/CfgFunctions.hpp
--- BASE_MISSION/x/cba/addons/CfgFunctions.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/CfgFunctions.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,889 @@
+
+	class CBA
+	{
+		class Misc
+		{
+			// CBA_fnc_actionArgument
+			class actionArgument
+			{
+				description = "Used to call the code parsed in the addaction argument.";
+				file = "x\cba\addons\common_fnc_actionArgument.sqf";
+			};
+			// CBA_fnc_addMagazine
+			class addMagazine
+			{
+				description = "Add magazine to a vehicle/unit.";
+				file = "x\cba\addons\common_fnc_addMagazine.sqf";
+			};
+			// CBA_fnc_addMagazineCargo
+			class addMagazineCargo
+			{
+				description = "Add magazine(s) to a vehicle's cargo.";
+				file = "x\cba\addons\common_fnc_addMagazineCargo.sqf";
+			};
+			// CBA_fnc_addMagazineVerified
+			class addMagazineVerified
+			{
+				description = "Add magazines to the player, but verify that it was successful and doesn't over-burden the recipient. The function will fill all available inventory slots with the requested magazine type.";
+				file = "x\cba\addons\common_fnc_addMagazineVerified.sqf";
+			};
+			// CBA_fnc_addPerFrameHandler
+			class addPerFrameHandler
+			{
+				description = "Add a handler that will execute every frame, or every x number of seconds";
+				file = "x\cba\addons\common_fnc_addPerFrameHandler.sqf";
+			};
+			// CBA_fnc_addPlayerAction
+			class addPlayerAction
+			{
+				description = "Adds persistent action to player (which will also be available in vehicles and after respawn or teamswitch).";
+				file = "x\cba\addons\common_fnc_addPlayerAction.sqf";
+			};
+			// CBA_fnc_addWeapon
+			class addWeapon
+			{
+				description = "Add a weapon to a unit.";
+				file = "x\cba\addons\common_fnc_addWeapon.sqf";
+			};
+			// CBA_fnc_addWeaponCargo
+			class addWeaponCargo
+			{
+				description = "Add weapon(s) to vehicle cargo.";
+				file = "x\cba\addons\common_fnc_addWeaponCargo.sqf";
+			};
+			// CBA_fnc_createCenter
+			class createCenter
+			{
+				description = "Selects center if it already exists, creates it if it doesn't yet.";
+				file = "x\cba\addons\common_fnc_createCenter.sqf";
+			};
+			// CBA_fnc_createMarker
+			class createMarker
+			{
+				description = "Creates a marker all at once.";
+				file = "x\cba\addons\common_fnc_createMarker.sqf";
+			};
+			// CBA_fnc_createTrigger
+			class createTrigger
+			{
+				description = "Create a trigger all at once.";
+				file = "x\cba\addons\common_fnc_createTrigger.sqf";
+			};
+			// CBA_fnc_defaultParam
+			class defaultParam
+			{
+				description = "Gets a value from parameters list (usually _this) with a default.";
+				file = "x\cba\addons\common_fnc_defaultParam.sqf";
+			};
+			// CBA_fnc_deleteEntity
+			class deleteEntity
+			{
+				description = "A function used to delete entities Parameters: Array, Object, Group or Marker Example: [car1,car2,car3] call CBA_fnc_deleteEntity Returns: Nothing Author: Rommel";
+				file = "x\cba\addons\common_fnc_deleteEntity.sqf";
+			};
+			// CBA_fnc_determineMuzzles
+			class determineMuzzles
+			{
+				description = "Gets the list of possible muzzles for a weapon.";
+				file = "x\cba\addons\common_fnc_determineMuzzles.sqf";
+			};
+			// CBA_fnc_dropMagazine
+			class dropMagazine
+			{
+				description = "Drop a magazine.";
+				file = "x\cba\addons\common_fnc_dropMagazine.sqf";
+			};
+			// CBA_fnc_dropWeapon
+			class dropWeapon
+			{
+				description = "Drops a weapon.";
+				file = "x\cba\addons\common_fnc_dropWeapon.sqf";
+			};
+			// CBA_fnc_findEntity
+			class findEntity
+			{
+				description = "A function used to find out the first entity of parsed type in a nearEntitys call Parameters: - Type (Classname, Object) - Position (XYZ, Object, Location or Group) Optional: - Radius (Scalar) Example: _veh = [""LaserTarget"", player] call CBA_fnc_findEntity Returns: First entity; nil return if nothing Author: Rommel";
+				file = "x\cba\addons\common_fnc_findEntity.sqf";
+			};
+			// CBA_fnc_getAlive
+			class getAlive
+			{
+				description = "A function used to find out who is alive in an array or a group. Parameters: Array, Group or Unit Example: _alive = (Units player) call CBA_fnc_getAlive Returns: Array Author: Rommel";
+				file = "x\cba\addons\common_fnc_getAlive.sqf";
+			};
+			// CBA_fnc_getAnimType
+			class getAnimType
+			{
+				description = "Used to determine which weapon unit is currently holding and return proper animation type.";
+				file = "x\cba\addons\common_fnc_getAnimType.sqf";
+			};
+			// CBA_fnc_getArg
+			class getArg
+			{
+				description = "Get default named argument from list.";
+				file = "x\cba\addons\common_fnc_getArg.sqf";
+			};
+			// CBA_fnc_getAspectRatio
+			class getAspectRatio
+			{
+				description = "Used to determine the Aspect ratio of the screen.";
+				file = "x\cba\addons\common_fnc_getAspectRatio.sqf";
+			};
+			// CBA_fnc_getConfigEntry
+			class getConfigEntry
+			{
+				description = "Gets a configuration entry.";
+				file = "x\cba\addons\common_fnc_getConfigEntry.sqf";
+			};
+			// CBA_fnc_getDistance
+			class getDistance
+			{
+				description = "A function used to find out the distance between two positions. Parameters: Array containing two of [Marker, Object, Location, Group or Position] Example: _distance = [Player, [0,0,0]] call CBA_fnc_getDistance Returns: Number - Distance in meters Author: Rommel";
+				file = "x\cba\addons\common_fnc_getDistance.sqf";
+			};
+			// CBA_fnc_getFirer
+			class getFirer
+			{
+				description = "A function used to find out which unit exactly fired (Replacement for gunner, on multi-turret vehicles). Parameters: Vehicle that fired Weapon that was used Example: _unit = player call CBA_fnc_getFirer Returns: Unit Turretpath Author: Rocko";
+				file = "x\cba\addons\common_fnc_getFirer.sqf";
+			};
+			// CBA_fnc_getFov
+			class getFov
+			{
+				description = "Get current camera's field of view in radians and zoom. Fov is calculated in the same format as it is set up in configs and used by camSetFov and alike. Precision is about 95%.";
+				file = "x\cba\addons\common_fnc_getFov.sqf";
+			};
+			// CBA_fnc_getGroup
+			class getGroup
+			{
+				description = "A function used to find out the group of an object. Parameters: Group or Unit Example: _group = player call CBA_fnc_getGroup Returns: Group Author: Rommel";
+				file = "x\cba\addons\common_fnc_getGroup.sqf";
+			};
+			// CBA_fnc_getGroupIndex
+			class getGroupIndex
+			{
+				description = "Finds out the actual ID number of a person within his group as assigned by the game and used in the squad leader's command menu, not just the order within the units of his group (this order can change due to players joining and leaving the game, deaths or promotions).";
+				file = "x\cba\addons\common_fnc_getGroupIndex.sqf";
+			};
+			// CBA_fnc_getNearest
+			class getNearest
+			{
+				description = "A function used to find out the nearest entity parsed in an array to a position. Compares the distance between entity's in the parsed array. Parameters: _position - Marker, Object, Location, Group or Position _array - Array of [Marker, Object, Location, Group and or Positions] _radius - Maximum distance from _position _code - Condition to meet (Code) Example: _nearestVeh = [player, vehicles] call CBA_fnc_getNearest _nearestGroups = [[0,0,0], allGroups, 50, {count (units _x) > 1}] call CBA_fnc_getNearest Returns: Nearest given entity or List of entities within given distance Author: Rommel";
+				file = "x\cba\addons\common_fnc_getNearest.sqf";
+			};
+			// CBA_fnc_getNearestBuilding
+			class getNearestBuilding
+			{
+				description = "A function used to find out the nearest building and appropriate building positions available. Parameters: Object Example: _array = player call CBA_fnc_getNearestBuilding Returns: Array with [building object, building positions (count)] Author: Rommel ---------------------------------------------------------------------------- */";
+				file = "x\cba\addons\common_fnc_getNearestBuilding.sqf";
+			};
+			// CBA_fnc_getPistol
+			class getPistol
+			{
+				description = "Returns name of pistol in unit's inventory, if any.";
+				file = "x\cba\addons\common_fnc_getPistol.sqf";
+			};
+			// CBA_fnc_getPos
+			class getPos
+			{
+				description = "A function used to get the position of an entity. Parameters: Marker, Object, Location, Group or Position Example: _position = (group player) call CBA_fnc_getPos Returns: Position (AGL) - [X,Y,Z] Author: Rommel";
+				file = "x\cba\addons\common_fnc_getPos.sqf";
+			};
+			// CBA_fnc_getSharedGroup
+			class getSharedGroup
+			{
+				description = "Returns existing group on side, or newly created group when not existent.";
+				file = "x\cba\addons\common_fnc_getSharedGroup.sqf";
+			};
+			// CBA_fnc_getTerrainProfile
+			class getTerrainProfile
+			{
+				description = "A function used to find the terrain profile between two positions";
+				file = "x\cba\addons\common_fnc_getTerrainProfile.sqf";
+			};
+			// CBA_fnc_getTurret
+			class getTurret
+			{
+				description = "A function used to find out which config turret is turretpath. Parameters: Vehicle Turretpath Example: _config = [vehicle player, [0]] call CBA_fnc_getTurret Returns: Turret Config entry Author: Sickboy";
+				file = "x\cba\addons\common_fnc_getTurret.sqf";
+			};
+			// CBA_fnc_getUISize
+			class getUISize
+			{
+				description = "Used to determine the UI size of the screen.";
+				file = "x\cba\addons\common_fnc_getUISize.sqf";
+			};
+			// CBA_fnc_getUnitAnim
+			class getUnitAnim
+			{
+				description = "Get information about a unit's stance and speed.";
+				file = "x\cba\addons\common_fnc_getUnitAnim.sqf";
+			};
+			// CBA_fnc_getUnitDeathAnim
+			class getUnitDeathAnim
+			{
+				description = "Get death animation for a unit.";
+				file = "x\cba\addons\common_fnc_getUnitDeathAnim.sqf";
+			};
+			// CBA_fnc_getVolume
+			class getVolume
+			{
+				description = "Return the volume of an object based on the object's model's bounding box.";
+				file = "x\cba\addons\common_fnc_getVolume.sqf";
+			};
+			// CBA_fnc_headDir
+			class headDir
+			{
+				description = "Get the direction of a unit's head.";
+				file = "x\cba\addons\common_fnc_headDir.sqf";
+			};
+			// CBA_fnc_inArea
+			class inArea
+			{
+				description = "A function used to determine if a position is within a zone.";
+				file = "x\cba\addons\common_fnc_inArea.sqf";
+			};
+			// CBA_fnc_inheritsFrom
+			class inheritsFrom
+			{
+				description = "Checks whether a config entry inherits, directly or indirectly, from another one.";
+				file = "x\cba\addons\common_fnc_inheritsFrom.sqf";
+			};
+			// CBA_fnc_isAlive
+			class isAlive
+			{
+				description = "A function used to find out if the group or object is alive. Parameters: Array, Group or Unit Example: _alive = (Units player) call CBA_fnc_getAlive Returns: Boolean Author: Rommel";
+				file = "x\cba\addons\common_fnc_isAlive.sqf";
+			};
+			// CBA_fnc_isTurnedOut
+			class isTurnedOut
+			{
+				description = "Checks whether a unit is turned out in a vehicle or not.";
+				file = "x\cba\addons\common_fnc_isTurnedOut.sqf";
+			};
+			// CBA_fnc_isUnitGetOutAnim
+			class isUnitGetOutAnim
+			{
+				description = "Checks whether a unit is turned out in a vehicle or not.";
+				file = "x\cba\addons\common_fnc_isUnitGetOutAnim.sqf";
+			};
+			// CBA_fnc_mapDirTo
+			class mapDirTo
+			{
+				description = "Gets the direction between two map grid references.";
+				file = "x\cba\addons\common_fnc_mapDirTo.sqf";
+			};
+			// CBA_fnc_mapGridToPos
+			class mapGridToPos
+			{
+				description = "Converts a 2, 4, 6, 8, or 10 digit grid reference into a Position.";
+				file = "x\cba\addons\common_fnc_mapGridToPos.sqf";
+			};
+			// CBA_fnc_mapRelPos
+			class mapRelPos
+			{
+				description = "Find a position relative to a known position on the map. Passing strings in for the Northing and Easting is the preferred way.";
+				file = "x\cba\addons\common_fnc_mapRelPos.sqf";
+			};
+			// CBA_fnc_modelHeadDir
+			class modelHeadDir
+			{
+				description = "Get the direction of any unit's head.";
+				file = "x\cba\addons\common_fnc_modelHeadDir.sqf";
+			};
+			// CBA_fnc_nearPlayer
+			class nearPlayer
+			{
+				description = "Check whether these are any players within a certain distance of a unit.";
+				file = "x\cba\addons\common_fnc_nearPlayer.sqf";
+			};
+			// CBA_fnc_northingReversed
+			class northingReversed
+			{
+				description = "Checks if the maps northing is reversed (like Chernarus & Utes, or any map pre-OA)";
+				file = "x\cba\addons\common_fnc_northingReversed.sqf";
+			};
+			// CBA_fnc_objectRandom
+			class objectRandom
+			{
+				description = "Creates a ""random"" number 0-9 based on an object's velocity";
+				file = "x\cba\addons\common_fnc_objectRandom.sqf";
+			};
+			// CBA_fnc_parseYAML
+			class parseYAML
+			{
+				description = "Parses a YAML file into a nested array/Hash structure.";
+				file = "x\cba\addons\common_fnc_parseYAML.sqf";
+			};
+			// CBA_fnc_players
+			class players
+			{
+				description = "Get a list of current player objects.";
+				file = "x\cba\addons\common_fnc_players.sqf";
+			};
+			// CBA_fnc_randPos
+			class randPos
+			{
+				description = "A function used to randomize a position around a given center Parameters: Marker, Object, Location, Group or Position, Radius Example: _position =  [position, radius] call CBA_fnc_randPos Returns: Position - [X,Y,Z] Author: Rommel";
+				file = "x\cba\addons\common_fnc_randPos.sqf";
+			};
+			// CBA_fnc_realHeight
+			class realHeight
+			{
+				description = "Real z coordinate of an object, for placing stuff on roofs, etc.";
+				file = "x\cba\addons\common_fnc_realHeight.sqf";
+			};
+			// CBA_fnc_removeMagazine
+			class removeMagazine
+			{
+				description = "Remove a magazine.";
+				file = "x\cba\addons\common_fnc_removeMagazine.sqf";
+			};
+			// CBA_fnc_removePerFrameHandler
+			class removePerFrameHandler
+			{
+				description = "Remove a handler that you have added using CBA_fnc_addPerFrameHandler";
+				file = "x\cba\addons\common_fnc_removePerFrameHandler.sqf";
+			};
+			// CBA_fnc_removePlayerAction
+			class removePlayerAction
+			{
+				description = "Removes player action previously added with <CBA_fnc_addPlayerAction>.";
+				file = "x\cba\addons\common_fnc_removePlayerAction.sqf";
+			};
+			// CBA_fnc_removeWeapon
+			class removeWeapon
+			{
+				description = "Remove a weapon.";
+				file = "x\cba\addons\common_fnc_removeWeapon.sqf";
+			};
+			// CBA_fnc_selectWeapon
+			class selectWeapon
+			{
+				description = "Selects weapon, if the player has the weapon, including correctly selecting a muzzle, if any.";
+				file = "x\cba\addons\common_fnc_selectWeapon.sqf";
+			};
+			// CBA_fnc_setHeight
+			class setHeight
+			{
+				description = "A function used to set the height of an object Parameters: _object - Object or Location _height - Height in metres _type - Optional parameter, 0 is getpos, 1 is getpos ASL, 2 is getposATL (Default: 1) Example: [this, 10] call CBA_fnc_setHeight Returns: Nothing Author: Rommel";
+				file = "x\cba\addons\common_fnc_setHeight.sqf";
+			};
+			// CBA_fnc_setPos
+			class setPos
+			{
+				description = "A function used to set the position of an entity. Parameters: Marker, Object, Location, Group or Position Example: [player, ""respawn_west""] call CBA_fnc_setPos Returns: Nil Author: Rommel";
+				file = "x\cba\addons\common_fnc_setPos.sqf";
+			};
+			// CBA_fnc_switchPlayer
+			class switchPlayer
+			{
+				description = "Switch player to another unit.";
+				file = "x\cba\addons\common_fnc_switchPlayer.sqf";
+			};
+			// CBA_fnc_systemChat
+			class systemChat
+			{
+				description = "Display a message in the global chat channel.";
+				file = "x\cba\addons\common_fnc_systemChat.sqf";
+			};
+		};
+		class Ai
+		{
+			// CBA_fnc_addWaypoint
+			class addWaypoint
+			{
+				description = "A function used to add a waypoint to a group. Parameters: - Group (Group or Object) - Position (XYZ, Object, Location or Group) Optional: - Radius (Scalar) - Waypoint Type (String) - Behaviour (String) - Combat Mode (String) - Speed Mode (String) - Formation (String) - Code To Execute at Each Waypoint (String) - TimeOut at each Waypoint (Array [Min, Med, Max]) - Waypoint Completion Radius (Scalar) Example: [this, this, 300, ""MOVE"", ""AWARE"", ""YELLOW"", ""FULL"", ""STAG COLUMN"", ""this spawn CBA_fnc_searchNearby"", [3,6,9]] Returns: Waypoint Author: Rommel";
+				file = "x\cba\addons\ai_fnc_addWaypoint.sqf";
+			};
+			// CBA_fnc_searchNearby
+			class searchNearby
+			{
+				description = "A function for a group to search a nearby building. Parameters: Group (Group or Object) Example: [group player] spawn CBA_fnc_searchNearby Returns: Nil Author: Rommel";
+				file = "x\cba\addons\ai_fnc_searchNearby.sqf";
+			};
+			// CBA_fnc_taskAttack
+			class taskAttack
+			{
+				description = "A function for a group to attack a parsed location. Parameters: - Group (Group or Object) - Position (XYZ, Object, Location or Group) Optional: - Search Radius (Scalar) Example: [group player, getpos (player findNearestEnemy player), 100] call CBA_fnc_taskAttack Returns: Nil Author: Rommel";
+				file = "x\cba\addons\ai_fnc_taskAttack.sqf";
+			};
+			// CBA_fnc_taskDefend
+			class taskDefend
+			{
+				description = "A function for a group to defend a parsed location. Groups will mount nearby static machine guns, and bunker in nearby buildings. They may also patrol the radius unless otherwise specified. Parameters: - Group (Group or Object) Optional: - Position (XYZ, Object, Location or Group) - Defend Radius (Scalar) - Building Size Threshold (Integer, default 2) - Can patrol (boolean) Example: [this] call CBA_fnc_taskDefend Returns: Nil Author: Rommel";
+				file = "x\cba\addons\ai_fnc_taskDefend.sqf";
+			};
+			// CBA_fnc_taskPatrol
+			class taskPatrol
+			{
+				description = "A function for a group to randomly patrol a parsed radius and location. Parameters: - Group (Group or Object) Optional: - Position (XYZ, Object, Location or Group) - Radius (Scalar) - Waypoint Count (Scalar) - Waypoint Type (String) - Behaviour (String) - Combat Mode (String) - Speed Mode (String) - Formation (String) - Code To Execute at Each Waypoint (String) - TimeOut at each Waypoint (Array [Min, Med, Max]) Example: [this, getmarkerpos ""objective1""] call CBA_fnc_taskPatrol [this, this, 300, 7, ""MOVE"", ""AWARE"", ""YELLOW"", ""FULL"", ""STAG COLUMN"", ""this spawn CBA_fnc_searchNearby"", [3,6,9]] call CBA_fnc_taskPatrol;";
+				file = "x\cba\addons\ai_fnc_taskPatrol.sqf";
+			};
+		};
+		class Arrays
+		{
+			// CBA_fnc_filter
+			class filter
+			{
+				description = "Filter each element of an array via a function.";
+				file = "x\cba\addons\arrays_fnc_filter.sqf";
+			};
+			// CBA_fnc_getArrayDiff
+			class getArrayDiff
+			{
+				description = "A function used to return the differences between two arrays. Parameters: Two Arrays of strings (must not contain scalars) Example: _distance = [[0,0,1], [0,0,0]] call CBA_fnc_getArrayDiff Returns: Array Differences (for above example, return is [[1],[0]]) Author: Rommel";
+				file = "x\cba\addons\arrays_fnc_getArrayDiff.sqf";
+			};
+			// CBA_fnc_getArrayElements
+			class getArrayElements
+			{
+				description = "A function used to return the element counts in an array. Parameters: Array Example: _types = [0,0,1,1,1,1] call CBA_fnc_getArrayElements Returns: Array element counts (for above example, return would be [0,2,1,4]) Author: Rommel && sbsmac";
+				file = "x\cba\addons\arrays_fnc_getArrayElements.sqf";
+			};
+			// CBA_fnc_inject
+			class inject
+			{
+				description = "Accumulates a value by passing elements of an array ""through"" a function.";
+				file = "x\cba\addons\arrays_fnc_inject.sqf";
+			};
+			// CBA_fnc_join
+			class join
+			{
+				description = "Joins an array of values into a single string, joining each fragment around a separator string. Inverse of <CBA_fnc_split>.";
+				file = "x\cba\addons\arrays_fnc_join.sqf";
+			};
+			// CBA_fnc_shuffle
+			class shuffle
+			{
+				description = "Shuffles an array's contents into random order, returning a new array.";
+				file = "x\cba\addons\arrays_fnc_shuffle.sqf";
+			};
+			// CBA_fnc_sortNestedArray
+			class sortNestedArray
+			{
+				description = "Used to sort a nested array from lowest to highest using quick sort based on the specified column, which must have numerical data. Parameters: _array: array - Nested array to be sorted _index: integer - sub array item index to be sorted on Example: _array = [_array,1] call CBA_fnc_sortNestedArray Returns: Passed in array Author: Standard algorithm";
+				file = "x\cba\addons\arrays_fnc_sortNestedArray.sqf";
+			};
+		};
+		class Events
+		{
+			// CBA_fnc_addDisplayHandler
+			class addDisplayHandler
+			{
+				description = "Adds an action to a displayHandler";
+				file = "x\cba\addons\events_fnc_addDisplayHandler.sqf";
+			};
+			// CBA_fnc_addEventHandler
+			class addEventHandler
+			{
+				description = "Registers an event handler for a specific CBA event.";
+				file = "x\cba\addons\events_fnc_addEventHandler.sqf";
+			};
+			// CBA_fnc_addKeyHandler
+			class addKeyHandler
+			{
+				description = "Adds an action to a keyhandler";
+				file = "x\cba\addons\events_fnc_addKeyHandler.sqf";
+			};
+			// CBA_fnc_addKeyHandlerFromConfig
+			class addKeyHandlerFromConfig
+			{
+				description = "Adds an action to a keyhandler, read from config";
+				file = "x\cba\addons\events_fnc_addKeyHandlerFromConfig.sqf";
+			};
+			// CBA_fnc_addLocalEventHandler
+			class addLocalEventHandler
+			{
+				description = "Registers an event handler for a specific CBA event which only runs where the first parameter (object) is local.";
+				file = "x\cba\addons\events_fnc_addLocalEventHandler.sqf";
+			};
+			// CBA_fnc_changeKeyHandler
+			class changeKeyHandler
+			{
+				description = "Changes an action to a keyhandler";
+				file = "x\cba\addons\events_fnc_changeKeyHandler.sqf";
+			};
+			// CBA_fnc_globalEvent
+			class globalEvent
+			{
+				description = "Raises a CBA event on all machines, including the local one.";
+				file = "x\cba\addons\events_fnc_globalEvent.sqf";
+			};
+			// CBA_fnc_localEvent
+			class localEvent
+			{
+				description = "Raises a CBA event only on the local machine.";
+				file = "x\cba\addons\events_fnc_localEvent.sqf";
+			};
+			// CBA_fnc_readKeyFromConfig
+			class readKeyFromConfig
+			{
+				description = "Reads key setting from config";
+				file = "x\cba\addons\events_fnc_readKeyFromConfig.sqf";
+			};
+			// CBA_fnc_remoteEvent
+			class remoteEvent
+			{
+				description = "Raises a CBA event on all machines EXCEPT the local one.";
+				file = "x\cba\addons\events_fnc_remoteEvent.sqf";
+			};
+			// CBA_fnc_remoteLocalEvent
+			class remoteLocalEvent
+			{
+				description = "Raises a CBA event only on the machine where parameter one is local.";
+				file = "x\cba\addons\events_fnc_remoteLocalEvent.sqf";
+			};
+			// CBA_fnc_removeDisplayHandler
+			class removeDisplayHandler
+			{
+				description = "Removes an action to a displayHandler";
+				file = "x\cba\addons\events_fnc_removeDisplayHandler.sqf";
+			};
+			// CBA_fnc_removeEventHandler
+			class removeEventHandler
+			{
+				description = "Removes an event handler previously registered with CBA_fnc_addEventHandler.";
+				file = "x\cba\addons\events_fnc_removeEventHandler.sqf";
+			};
+			// CBA_fnc_removeKeyHandler
+			class removeKeyHandler
+			{
+				description = "Removes an action to a keyhandler";
+				file = "x\cba\addons\events_fnc_removeKeyHandler.sqf";
+			};
+			// CBA_fnc_removeLocalEventHandler
+			class removeLocalEventHandler
+			{
+				description = "Removes an event handler previously registered with CBA_fnc_addLocalEventHandler.";
+				file = "x\cba\addons\events_fnc_removeLocalEventHandler.sqf";
+			};
+			// CBA_fnc_whereLocalEvent
+			class whereLocalEvent
+			{
+				description = "Raises a CBA event only on the machine where parameter one is local.";
+				file = "x\cba\addons\events_fnc_whereLocalEvent.sqf";
+			};
+		};
+		class Diagnostic
+		{
+			// CBA_fnc_benchmarkFunction
+			class benchmarkFunction
+			{
+				description = "Benchmarks a function to see how long it will take to execute.";
+				file = "x\cba\addons\diagnostic_fnc_benchmarkFunction.sqf";
+			};
+			// CBA_fnc_debug
+			class debug
+			{
+				description = "General Purpose Debug Message Writer";
+				file = "x\cba\addons\diagnostic_fnc_debug.sqf";
+			};
+			// CBA_fnc_error
+			class error
+			{
+				description = "Logs an error message to the RPT log.";
+				file = "x\cba\addons\diagnostic_fnc_error.sqf";
+			};
+			// CBA_fnc_log
+			class log
+			{
+				description = "Logs a message to the RPT log.";
+				file = "x\cba\addons\diagnostic_fnc_log.sqf";
+			};
+			// CBA_fnc_peek
+			class peek
+			{
+				description = "Peek at variable on the server To receive the variable content back, you will have to [""cba_diagnostics_receive_peak"", {_this call myFunction}] call CBA_fnc_addEventHandler;";
+				file = "x\cba\addons\diagnostic_fnc_peek.sqf";
+			};
+			// CBA_fnc_test
+			class test
+			{
+				description = "Runs unit tests for an addon or component.";
+				file = "x\cba\addons\diagnostic_fnc_test.sqf";
+			};
+		};
+		class Hashes
+		{
+			// CBA_fnc_hashCreate
+			class hashCreate
+			{
+				description = "Check if a Hash has a value defined for a key.";
+				file = "x\cba\addons\hashes_fnc_hashCreate.sqf";
+			};
+			// CBA_fnc_hashEachPair
+			class hashEachPair
+			{
+				description = "Iterate through all keys and values in a Hash.";
+				file = "x\cba\addons\hashes_fnc_hashEachPair.sqf";
+			};
+			// CBA_fnc_hashGet
+			class hashGet
+			{
+				description = "Gets a value for a given key from a Hash.";
+				file = "x\cba\addons\hashes_fnc_hashGet.sqf";
+			};
+			// CBA_fnc_hashHasKey
+			class hashHasKey
+			{
+				description = "Check if a Hash has a value defined for a key.";
+				file = "x\cba\addons\hashes_fnc_hashHasKey.sqf";
+			};
+			// CBA_fnc_hashRem
+			class hashRem
+			{
+				description = "Removes given key from given Hash.";
+				file = "x\cba\addons\hashes_fnc_hashRem.sqf";
+			};
+			// CBA_fnc_hashSet
+			class hashSet
+			{
+				description = "Sets a value for a given key in a Hash.";
+				file = "x\cba\addons\hashes_fnc_hashSet.sqf";
+			};
+			// CBA_fnc_isHash
+			class isHash
+			{
+				description = "Check if a value is a Hash data structure.";
+				file = "x\cba\addons\hashes_fnc_isHash.sqf";
+			};
+		};
+		class Network
+		{
+			// CBA_fnc_getMarkerPersistent
+			class getMarkerPersistent
+			{
+				description = "Checks if a global marker is persistent for JIP players.";
+				file = "x\cba\addons\network_fnc_getMarkerPersistent.sqf";
+			};
+			// CBA_fnc_globalExecute
+			class globalExecute
+			{
+				description = "Executes code on given destinations";
+				file = "x\cba\addons\network_fnc_globalExecute.sqf";
+			};
+			// CBA_fnc_globalSay
+			class globalSay
+			{
+				description = "Says sound on all client computer";
+				file = "x\cba\addons\network_fnc_globalSay.sqf";
+			};
+			// CBA_fnc_globalSay3d
+			class globalSay3d
+			{
+				description = "Says sound on all client computer in 3d";
+				file = "x\cba\addons\network_fnc_globalSay3d.sqf";
+			};
+			// CBA_fnc_publicVariable
+			class publicVariable
+			{
+				description = "CBA_fnc_publicVariable does only broadcast the new value if it doesn't exist in missionNamespace or the new value is different to the one in missionNamespace. Checks also for different types. Nil as value gets always broadcasted.";
+				file = "x\cba\addons\network_fnc_publicVariable.sqf";
+			};
+			// CBA_fnc_setMarkerPersistent
+			class setMarkerPersistent
+			{
+				description = "Sets or unsets JIP persistency on a global marker.";
+				file = "x\cba\addons\network_fnc_setMarkerPersistent.sqf";
+			};
+			// CBA_fnc_setVarNet
+			class setVarNet
+			{
+				description = "Same as setVariable [""name"",var, true] but only broadcasts when the value of var is different to the one which is already saved in the variable space. Checks also for different types. Nil as value gets always broadcasted.";
+				file = "x\cba\addons\network_fnc_setVarNet.sqf";
+			};
+		};
+		class Strings
+		{
+			// CBA_fnc_capitalize
+			class capitalize
+			{
+				description = "Upper case the first letter of the string, lower case the rest.";
+				file = "x\cba\addons\strings_fnc_capitalize.sqf";
+			};
+			// CBA_fnc_find
+			class find
+			{
+				description = "Finds a string within another string.";
+				file = "x\cba\addons\strings_fnc_find.sqf";
+			};
+			// CBA_fnc_formatElapsedTime
+			class formatElapsedTime
+			{
+				description = "Formats time in seconds according to a format. Intended to show time elapsed, rather than time-of-day.";
+				file = "x\cba\addons\strings_fnc_formatElapsedTime.sqf";
+			};
+			// CBA_fnc_formatNumber
+			class formatNumber
+			{
+				description = "Formats a number to a minimum integer width and to a specific number of decimal places (including padding with 0s and correct rounding). Numbers are always displayed fully, never being condensed using an exponent (e.g. the number 1.234e9 would be given as ""1234000000"").";
+				file = "x\cba\addons\strings_fnc_formatNumber.sqf";
+			};
+			// CBA_fnc_leftTrim
+			class leftTrim
+			{
+				description = "Trims white-space (space, tab, newline) from the left end of a string.";
+				file = "x\cba\addons\strings_fnc_leftTrim.sqf";
+			};
+			// CBA_fnc_replace
+			class replace
+			{
+				description = "Replaces substrings within a string. Case-dependent.";
+				file = "x\cba\addons\strings_fnc_replace.sqf";
+			};
+			// CBA_fnc_rightTrim
+			class rightTrim
+			{
+				description = "Trims white-space (space, tab, newline) from the right end of a string.";
+				file = "x\cba\addons\strings_fnc_rightTrim.sqf";
+			};
+			// CBA_fnc_split
+			class split
+			{
+				description = "Splits a string into substrings using a separator. Inverse of <CBA_fnc_join>.";
+				file = "x\cba\addons\strings_fnc_split.sqf";
+			};
+			// CBA_fnc_strLen
+			class strLen
+			{
+				description = "Counts the number of characters in a string.";
+				file = "x\cba\addons\strings_fnc_strLen.sqf";
+			};
+			// CBA_fnc_trim
+			class trim
+			{
+				description = "Trims white-space (space, tab, newline) from the both ends of a string.";
+				file = "x\cba\addons\strings_fnc_trim.sqf";
+			};
+		};
+		class UI {
+			class flexiMenu_Add {
+				description = "Add a type-based menu source. Result: TBA (WIP)";
+				file = "x\cba\addons\ui_flexiMenu_fnc_add.sqf";
+			};
+			class flexiMenu_Remove {
+				description = "Remove a type-based menu source. Result: TBA (WIP)";
+				file = "x\cba\addons\ui_flexiMenu_fnc_remove.sqf";
+			};
+			class flexiMenu_setObjectMenuSource {
+				description = "Set an object's menu source (variable). Result: TBA (WIP)";
+				file = "x\cba\addons\ui_flexiMenu_fnc_setObjectMenuSource.sqf";
+			};
+		};
+		class Vectors
+		{
+			// CBA_fnc_polar2vect
+			class polar2vect
+			{
+				description = "Creates a vector based on a inputted magnitude, direction and elevation";
+				file = "x\cba\addons\vectors_fnc_polar2vect.sqf";
+			};
+			// CBA_fnc_scaleVect
+			class scaleVect
+			{
+				description = "scales a specified vector by a specified factor.";
+				file = "x\cba\addons\vectors_fnc_scaleVect.sqf";
+			};
+			// CBA_fnc_scaleVectTo
+			class scaleVectTo
+			{
+				description = "scales a vector so that its new Magnitude is equivalent to a specified value.";
+				file = "x\cba\addons\vectors_fnc_scaleVectTo.sqf";
+			};
+			// CBA_fnc_simplifyAngle
+			class simplifyAngle
+			{
+				description = "Returns an equivalent angle to the specified angle in the range 0 to 360. This allows adjustment from negative angles and angles equal or greater to 360. If the inputted angle is in the range 0 - 360, it will be returned unchanged.";
+				file = "x\cba\addons\vectors_fnc_simplifyAngle.sqf";
+			};
+			// CBA_fnc_simplifyAngle180
+			class simplifyAngle180
+			{
+				description = "Returns an equivalent angle to the specified angle in the range -180 to 180. If the inputted angle is in the range -180 to 180, it will be returned unchanged.";
+				file = "x\cba\addons\vectors_fnc_simplifyAngle180.sqf";
+			};
+			// CBA_fnc_vect2polar
+			class vect2polar
+			{
+				description = "Parameters:";
+				file = "x\cba\addons\vectors_fnc_vect2polar.sqf";
+			};
+			// CBA_fnc_vectAdd
+			class vectAdd
+			{
+				description = "Returns the sum of two vectors.  Vectors can be 2D or 3D";
+				file = "x\cba\addons\vectors_fnc_vectAdd.sqf";
+			};
+			// CBA_fnc_vectCross
+			class vectCross
+			{
+				description = "Returns the cross product vector of two vectors.  Vectors must both be three dimensional.";
+				file = "x\cba\addons\vectors_fnc_vectCross.sqf";
+			};
+			// CBA_fnc_vectCross2D
+			class vectCross2D
+			{
+				description = "Returns the cross product vector of two 2D vectors. The result is an integer value (positive or negative), representing the magnitude of the height component.";
+				file = "x\cba\addons\vectors_fnc_vectCross2D.sqf";
+			};
+			// CBA_fnc_vectDir
+			class vectDir
+			{
+				description = "Returns the angle of a vector with the given i and k coordinates in the range 0 to 360.";
+				file = "x\cba\addons\vectors_fnc_vectDir.sqf";
+			};
+			// CBA_fnc_vectDot
+			class vectDot
+			{
+				description = "Returns the dot product of two vectors.  Vectors can be either two or three dimesions, but they must be the same dimension.";
+				file = "x\cba\addons\vectors_fnc_vectDot.sqf";
+			};
+			// CBA_fnc_vectElev
+			class vectElev
+			{
+				description = "Returns the angle of elevation of a 3D vector with the given i, j and k coordinates in the range -90 to 90.";
+				file = "x\cba\addons\vectors_fnc_vectElev.sqf";
+			};
+			// CBA_fnc_vectMagn
+			class vectMagn
+			{
+				description = "Returns the magnitude of a 3D vector with the given i, j and k coordinates.";
+				file = "x\cba\addons\vectors_fnc_vectMagn.sqf";
+			};
+			// CBA_fnc_vectMagn2D
+			class vectMagn2D
+			{
+				description = "Returns the magnitude of a vector with the given i and k coordinates or the magnitude of the i and k components of a 3D vector.";
+				file = "x\cba\addons\vectors_fnc_vectMagn2D.sqf";
+			};
+			// CBA_fnc_vectRotate2D
+			class vectRotate2D
+			{
+				description = "Rotates a 2D vector around a given center, for rotating of a vector from its origin, use BIS_fnc_rotateVector2D";
+				file = "x\cba\addons\vectors_fnc_vectRotate2D.sqf";
+			};
+			// CBA_fnc_vectSubtract
+			class vectSubtract
+			{
+				description = "Returns the difference of two vectors.  Vectors can be 2D or 3D.";
+				file = "x\cba\addons\vectors_fnc_vectSubtract.sqf";
+			};
+		};
+	};
+	// Need to be manually maintained
+	// Missing BIS functions
+	class BIS {
+		class variables {
+			class undefCheck {
+				file = "x\cba\addons\dummy.sqf";
+			};
+		};
+	};
+	class BIS_PMC {
+		class PMC_Campaign {
+			class initIdentity {
+				file = "x\cba\addons\dummy.sqf";
+			};
+		};
+	};
diff -rupN BASE_MISSION/x/cba/addons/CfgPerFrame.hpp BASE_A2Free/x/cba/addons/CfgPerFrame.hpp
--- BASE_MISSION/x/cba/addons/CfgPerFrame.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/CfgPerFrame.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,411 @@
+// Control types
+#define CT_STATIC           0
+#define CT_BUTTON           1
+#define CT_EDIT             2
+#define CT_SLIDER           3
+#define CT_COMBO            4
+#define CT_LISTBOX          5
+#define CT_TOOLBOX          6
+#define CT_CHECKBOXES       7
+#define CT_PROGRESS         8
+#define CT_HTML             9
+#define CT_STATIC_SKEW      10
+#define CT_ACTIVETEXT       11
+#define CT_TREE             12
+#define CT_STRUCTURED_TEXT  13
+#define CT_CONTEXT_MENU     14
+#define CT_CONTROLS_GROUP   15
+#define CT_SHORTCUT_BUTTON  16 // Arma 2 - textured button
+
+#define CT_XKEYDESC         40
+#define CT_XBUTTON          41
+#define CT_XLISTBOX         42
+#define CT_XSLIDER          43
+#define CT_XCOMBO           44
+#define CT_ANIMATED_TEXTURE 45
+#define CT_OBJECT           80
+#define CT_OBJECT_ZOOM      81
+#define CT_OBJECT_CONTAINER 82
+#define CT_OBJECT_CONT_ANIM 83
+#define CT_LINEBREAK        98
+#define CT_USER             99
+#define CT_MAP              100
+#define CT_MAP_MAIN         101
+#define CT_List_N_Box       102 // Arma 2 - N columns list box
+
+
+// Static styles
+#define ST_POS            0x0F
+#define ST_HPOS           0x03
+#define ST_VPOS           0x0C
+#define ST_LEFT           0x00
+#define ST_RIGHT          0x01
+#define ST_CENTER         0x02
+#define ST_DOWN           0x04
+#define ST_UP             0x08
+#define ST_VCENTER        0x0c
+
+#define ST_TYPE           0xF0
+#define ST_SINGLE         0
+#define ST_MULTI          16
+#define ST_TITLE_BAR      32
+#define ST_PICTURE        48
+#define ST_FRAME          64
+#define ST_BACKGROUND     80
+#define ST_GROUP_BOX      96
+#define ST_GROUP_BOX2     112
+#define ST_HUD_BACKGROUND 128
+#define ST_TILE_PICTURE   144
+#define ST_WITH_RECT      160
+#define ST_LINE           176
+
+#define ST_SHADOW         0x100
+#define ST_NO_RECT        0x200
+#define ST_KEEP_ASPECT_RATIO  0x800
+
+#define ST_TITLE          ST_TITLE_BAR + ST_CENTER
+
+// Slider styles
+#define SL_DIR            0x400
+#define SL_VERT           0
+#define SL_HORZ           0x400
+
+#define SL_TEXTURES       0x10
+
+// Listbox styles
+#define LB_TEXTURES       0x10
+#define LB_MULTI          0x20
+
+#define FontM             "Bitstream"
+#define DEFAULTFONT       FontM
+
+#define true              1
+#define false             0
+
+class CBA_Dummy_Map {
+	idc = -1;
+
+	type=100;
+	style=48;
+
+	x = 0;
+	y = 0;
+	w = 1;
+	h = 1;
+
+	colorBackground[] = {1.00, 1.00, 1.00, 0};
+	colorText[] = {0.00, 0.00, 0.00, 0};
+	colorSea[] = {0.56, 0.80, 0.98, 0};
+	colorForest[] = {0.60, 0.80, 0.20, 0};
+	colorRocks[] = {0.50, 0.50, 0.50, 0};
+	colorCountlines[] = {0.65, 0.45, 0.27, 0};
+	colorMainCountlines[] = {0.65, 0.45, 0.27, 0};
+	colorCountlinesWater[] = {0.00, 0.53, 1.00, 0};
+	colorMainCountlinesWater[] = {0.00, 0.53, 1.00, 0};
+	colorForestBorder[] = {0.40, 0.80, 0.00, 0};
+	colorRocksBorder[] = {0.50, 0.50, 0.50, 0};
+	colorPowerLines[] = {0.00, 0.00, 0.00, 0};
+	colorNames[] = {0.00, 0.00, 0.00, 0};
+	colorInactive[] = {1.00, 1.00, 1.00, 0};
+	colorLevels[] = {0.00, 0.00, 0.00, 0};
+	colorRailWay[] = {0.00, 0.00, 0.00, 0};
+	colorOutside[] = {0.56, 0.80, 0.98, 0};
+
+	font = "TahomaB";
+	sizeEx = 0.00;
+
+	stickX[] = {0.0, {"Gamma", 1.00, 1.50} };
+	stickY[] = {0.0, {"Gamma", 1.00, 1.50} };
+	ptsPerSquareSea = 0;
+	ptsPerSquareTxt = 0;
+	ptsPerSquareCLn = 0;
+	ptsPerSquareExp = 0;
+	ptsPerSquareCost = 0;
+	ptsPerSquareFor = "0f";
+	ptsPerSquareForEdge = "0f";
+	ptsPerSquareRoad = 0;
+	ptsPerSquareObj = 0;
+
+	fontLabel = "Zeppelin32";
+	sizeExLabel = 0.0;
+	fontGrid = "Zeppelin32";
+	sizeExGrid = 0.0;
+	fontUnits = "Zeppelin32";
+	sizeExUnits = 0.0;
+	fontNames = "Zeppelin32";
+	sizeExNames = 0.0;
+	fontInfo = "Zeppelin32";
+	sizeExInfo = 0.0;
+	fontLevel = "Zeppelin32";
+	sizeExLevel = 0.0;
+    scaleMax = 1;
+    scaleMin = 0.125;
+	text = "";
+
+	maxSatelliteAlpha = 0;	 // Alpha to 0 by default
+	alphaFadeStartScale = 1.0;
+	alphaFadeEndScale = 1.1;   // Prevent div/0
+
+	showCountourInterval=1;
+	scaleDefault = 2;
+
+    class Task {
+        icon = "\ca\ui\data\ui_taskstate_current_CA.paa";
+        color[] = {1, 0.537000, 0, 0};
+        size = 27;
+        importance = 1;
+        coefMin = 1;
+        coefMax = 1;
+        iconCreated = "";
+        iconCanceled = "";
+        iconDone = "";
+        iconFailed = "";
+        colorCreated[] = {1, 1, 1, 0};
+        colorCanceled[] = {1, 1, 1, 0};
+        colorDone[] = {1, 1, 1, 0};
+        colorFailed[] = {1, 1, 1, 0};
+    };
+
+    class CustomMark {
+        icon = "\ca\ui\data\map_waypoint_ca.paa";
+        color[] = {0.647100, 0.670600, 0.623500, 0};
+        size = 18;
+        importance = 1;
+        coefMin = 1;
+        coefMax = 1;
+    };
+
+    class Legend {
+        x = "SafeZoneX";
+        y = "SafeZoneY";
+        w = 0.340000;
+        h = 0.152000;
+        font = "Zeppelin32";
+        sizeEx = 0.039210;
+        colorBackground[] = {0.906000, 0.901000, 0.880000, 0};
+        color[] = {0, 0, 0, 0};
+    };
+
+    class Bunker {
+        icon = "\ca\ui\data\map_bunker_ca.paa";
+        color[] = {0.550000, 0.640000, 0.430000, 0};
+        size = 14;
+        importance = "1.5 * 14 * 0.05";
+        coefMin = 0.250000;
+        coefMax = 4;
+    };
+
+    class Bush {
+        icon = "\ca\ui\data\map_bush_ca.paa";
+        color[] = {0.450000, 0.640000, 0.330000, 0.0};
+        size = 14;
+        importance = "0.2 * 14 * 0.05";
+        coefMin = 0.250000;
+        coefMax = 4;
+    };
+
+    class BusStop {
+        icon = "\ca\ui\data\map_busstop_ca.paa";
+        color[] = {0.150000, 0.260000, 0.870000, 0};
+        size = 12;
+        importance = "1 * 10 * 0.05";
+        coefMin = 0.250000;
+        coefMax = 4;
+    };
+
+    class Command {
+        icon = "\ca\ui\data\map_waypoint_ca.paa";
+        color[] = {0, 0.900000, 0, 0};
+        size = 18;
+        importance = 1;
+        coefMin = 1;
+        coefMax = 1;
+    };
+
+    class Cross {
+        icon = "\ca\ui\data\map_cross_ca.paa";
+        size = 16;
+        color[] = {0, 0.900000, 0, 0};
+        importance = "0.7 * 16 * 0.05";
+        coefMin = 0.250000;
+        coefMax = 4;
+    };
+
+    class Fortress {
+        icon = "\ca\ui\data\map_bunker_ca.paa";
+        size = 16;
+        color[] = {0, 0.900000, 0, 0};
+        importance = "2 * 16 * 0.05";
+        coefMin = 0.250000;
+        coefMax = 4;
+    };
+
+    class Fuelstation {
+        icon = "\ca\ui\data\map_fuelstation_ca.paa";
+        size = 16;
+        color[] = {0, 0.900000, 0, 0};
+        importance = "2 * 16 * 0.05";
+        coefMin = 0.750000;
+        coefMax = 4;
+    };
+
+    class Fountain {
+        icon = "\ca\ui\data\map_fountain_ca.paa";
+        color[] = {0.200000, 0.450000, 0.700000, 0};
+        size = 11;
+        importance = "1 * 12 * 0.05";
+        coefMin = 0.250000;
+        coefMax = 4;
+    };
+
+    class Hospital {
+        icon = "\ca\ui\data\map_hospital_ca.paa";
+        color[] = {0.780000, 0, 0.050000, 0};
+        size = 16;
+        importance = "2 * 16 * 0.05";
+        coefMin = 0.500000;
+        coefMax = 4;
+    };
+
+    class Chapel {
+        icon = "\ca\ui\data\map_chapel_ca.paa";
+        color[] = {0.550000, 0.640000, 0.430000, 0};
+        size = 16;
+        importance = "1 * 16 * 0.05";
+        coefMin = 0.900000;
+        coefMax = 4;
+    };
+
+    class Church {
+        icon = "\ca\ui\data\map_church_ca.paa";
+        size = 16;
+        color[] = {0, 0.900000, 0, 0};
+        importance = "2 * 16 * 0.05";
+        coefMin = 0.900000;
+        coefMax = 4;
+    };
+
+    class Lighthouse {
+        icon = "\ca\ui\data\map_lighthouse_ca.paa";
+        size = 14;
+        color[] = {0, 0.900000, 0, 0};
+        importance = "3 * 16 * 0.05";
+        coefMin = 0.900000;
+        coefMax = 4;
+    };
+
+    class Quay {
+        icon = "\ca\ui\data\map_quay_ca.paa";
+        size = 16;
+        color[] = {0, 0.900000, 0, 0};
+        importance = "2 * 16 * 0.05";
+        coefMin = 0.500000;
+        coefMax = 4;
+    };
+
+    class Rock {
+        icon = "\ca\ui\data\map_rock_ca.paa";
+        color[] = {0.100000, 0.100000, 0.100000, 0.0};
+        size = 12;
+        importance = "0.5 * 12 * 0.05";
+        coefMin = 0.250000;
+        coefMax = 4;
+    };
+
+    class Ruin {
+        icon = "\ca\ui\data\map_ruin_ca.paa";
+        size = 16;
+        color[] = {0, 0.900000, 0, 0};
+        importance = "1.2 * 16 * 0.05";
+        coefMin = 1;
+        coefMax = 4;
+    };
+
+    class SmallTree {
+        icon = "\ca\ui\data\map_smalltree_ca.paa";
+        color[] = {0.450000, 0.640000, 0.330000, 0.0};
+        size = 12;
+        importance = "0.6 * 12 * 0.05";
+        coefMin = 0.250000;
+        coefMax = 4;
+    };
+
+    class Stack {
+        icon = "\ca\ui\data\map_stack_ca.paa";
+        size = 20;
+        color[] = {0, 0.900000, 0, 0};
+        importance = "2 * 16 * 0.05";
+        coefMin = 0.900000;
+        coefMax = 4;
+    };
+
+    class Tree {
+        icon = "\ca\ui\data\map_tree_ca.paa";
+        color[] = {0.450000, 0.640000, 0.330000, 0.0};
+        size = 12;
+        importance = "0.9 * 16 * 0.05";
+        coefMin = 0.250000;
+        coefMax = 4;
+    };
+
+    class Tourism {
+        icon = "\ca\ui\data\map_tourism_ca.paa";
+        color[] = {0.780000, 0, 0.050000, 0};
+        size = 16;
+        importance = "1 * 16 * 0.05";
+        coefMin = 0.700000;
+        coefMax = 4;
+    };
+
+    class Transmitter {
+        icon = "\ca\ui\data\map_transmitter_ca.paa";
+        color[] = {0, 0.900000, 0, 0};
+        size = 20;
+        importance = "2 * 16 * 0.05";
+        coefMin = 0.900000;
+        coefMax = 4;
+    };
+
+    class ViewTower {
+        icon = "\ca\ui\data\map_viewtower_ca.paa";
+        color[] = {0, 0.900000, 0, 0};
+        size = 16;
+        importance = "2.5 * 16 * 0.05";
+        coefMin = 0.500000;
+        coefMax = 4;
+    };
+
+    class Watertower {
+        icon = "\ca\ui\data\map_watertower_ca.paa";
+        color[] = {0.200000, 0.450000, 0.700000, 0};
+        size = 20;
+        importance = "1.2 * 16 * 0.05";
+        coefMin = 0.900000;
+        coefMax = 4;
+    };
+
+    class Waypoint {
+        icon = "\ca\ui\data\map_waypoint_ca.paa";
+        color[] = {0, 0.350000, 0.700000, 0};
+        size = 16;
+        importance = "2.5 * 16 * 0.05";
+        coefMin = 0.500000;
+        coefMax = 4;
+    };
+
+    class WaypointCompleted {
+        icon = "\ca\ui\data\map_waypoint_completed_ca.paa";
+        color[] = {0, 0.350000, 0.700000, 0};
+        size = 16;
+        importance = "2.5 * 16 * 0.05";
+        coefMin = 0.500000;
+        coefMax = 4;
+    };
+
+    class ActiveMarker {
+        color[] = {0.300000, 0.100000, 0.900000, 0};
+        size = 50;
+    };
+};
+
+
diff -rupN BASE_MISSION/x/cba/addons/CfgRscTitles.hpp BASE_A2Free/x/cba/addons/CfgRscTitles.hpp
--- BASE_MISSION/x/cba/addons/CfgRscTitles.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/CfgRscTitles.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,28 @@
+	class CBA_FrameHandlerTitle {
+		idd = 40121;
+		movingEnable = 1;
+        enableSimulation = 1;
+        enableDisplay = 1;
+
+        onLoad = QUOTE(_this call CBA_common_fnc_perFrameEngine);
+
+        duration = 99999999999999999;
+        fadein  = 0;
+        fadeout = 0;
+		name = "CBA_FrameHandlerTitle";
+		class controlsBackground {
+			class dummy_map : CBA_Dummy_Map {
+				idc = 40122;
+				x = 0;
+				y = 0;
+				w = 0;
+				h = 0;
+			};
+		};
+		class objects {
+
+		};
+		class controls {
+
+		};
+	};
diff -rupN BASE_MISSION/x/cba/addons/DIKASCIIMap.hpp BASE_A2Free/x/cba/addons/DIKASCIIMap.hpp
--- BASE_MISSION/x/cba/addons/DIKASCIIMap.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/DIKASCIIMap.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,40 @@
+//#include "\ca\editor\Data\Scripts\dikCodes.h"
+
+#define ICE_DIKASCIIMap [\
+  [65, DIK_A],\
+  [66, DIK_B],\
+  [67, DIK_C],\
+  [68, DIK_D],\
+  [69, DIK_E],\
+  [70, DIK_F],\
+  [71, DIK_G],\
+  [72, DIK_H],\
+  [73, DIK_I],\
+  [74, DIK_J],\
+  [75, DIK_K],\
+  [76, DIK_L],\
+  [77, DIK_M],\
+  [78, DIK_N],\
+  [79, DIK_O],\
+  [80, DIK_P],\
+  [81, DIK_Q],\
+  [82, DIK_R],\
+  [83, DIK_S],\
+  [84, DIK_T],\
+  [85, DIK_U],\
+  [86, DIK_V],\
+  [87, DIK_W],\
+  [88, DIK_X],\
+  [89, DIK_Y],\
+  [90, DIK_Z],\
+  [48, DIK_0],\
+  [49, DIK_1],\
+  [50, DIK_2],\
+  [51, DIK_3],\
+  [52, DIK_4],\
+  [53, DIK_5],\
+  [54, DIK_6],\
+  [55, DIK_7],\
+  [56, DIK_8],\
+  [57, DIK_9]\
+  ]
diff -rupN BASE_MISSION/x/cba/addons/ai_fnc_addWaypoint.sqf BASE_A2Free/x/cba/addons/ai_fnc_addWaypoint.sqf
--- BASE_MISSION/x/cba/addons/ai_fnc_addWaypoint.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ai_fnc_addWaypoint.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,56 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addWaypoint
+
+Description:
+	A function used to add a waypoint to a group.
+Parameters:
+	- Group (Group or Object)
+	- Position (XYZ, Object, Location or Group)
+	Optional:
+	- Radius (Scalar)
+	- Waypoint Type (String)
+	- Behaviour (String)
+	- Combat Mode (String)
+	- Speed Mode (String)
+	- Formation (String)
+	- Code To Execute at Each Waypoint (String)
+	- TimeOut at each Waypoint (Array [Min, Med, Max])
+	- Waypoint Completion Radius (Scalar)
+Example:
+	[this, this, 300, "MOVE", "AWARE", "YELLOW", "FULL", "STAG COLUMN", "this spawn CBA_fnc_searchNearby", [3,6,9]]
+Returns:
+	Waypoint
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+private ["_group","_position","_radius"];
+_group = (_this select 0) call CBA_fnc_getgroup;
+_position = (_this select 1) call CBA_fnc_getpos;
+_radius = if (count _this > 2) then {_this select 2} else {0};
+
+private ["_count", "_waypoint"];
+_count = count _this;
+_waypoint = _group addWaypoint [_position, _radius];
+
+if (_count < 4) exitWith {_waypoint};
+_waypoint setWaypointType (_this select 3);
+if (_count < 5) exitWith {_waypoint};
+_waypoint setWaypointBehaviour (_this select 4);
+if (_count < 6) exitWith {_waypoint};
+_waypoint setWaypointCombatMode (_this select 5);
+if (_count < 7) exitWith {_waypoint};
+_waypoint setWaypointSpeed (_this select 6);
+if (_count < 8) exitWith {_waypoint};
+_waypoint setWaypointFormation (_this select 7);
+if (_count < 9) exitWith {_waypoint};
+_waypoint setWaypointStatements ["TRUE", (_this select 8)];
+if (_count < 10) exitWith {_waypoint};
+_waypoint setWaypointTimeout (_this select 9);
+if (_count < 11) exitWith {_waypoint};
+_waypoint setWaypointHousePosition (_this select 10);
+if (_count < 12) exitWith {_waypoint};
+_waypoint setWaypointCompletionRadius (_this select 11);
+
+_waypoint;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/ai_fnc_searchNearby.sqf BASE_A2Free/x/cba/addons/ai_fnc_searchNearby.sqf
--- BASE_MISSION/x/cba/addons/ai_fnc_searchNearby.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ai_fnc_searchNearby.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,61 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_searchNearby
+
+Description:
+	A function for a group to search a nearby building.
+Parameters:
+	Group (Group or Object)
+Example:
+	[group player] spawn CBA_fnc_searchNearby
+Returns:
+	Nil
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+private ["_group"];
+_group = (_this select 0) call CBA_fnc_getgroup;
+_group lockwp true;
+private ["_leader","_behaviour"];
+_leader = leader _group;
+_behaviour = behaviour _leader;
+_group setbehaviour "combat";
+
+private ["_array", "_building", "_indices"];
+_array = _leader call CBA_fnc_getnearestbuilding;
+_building = _array select 0;
+_indices = _array select 1;
+_group setformdir ([_leader, _building] call bis_fnc_dirto);
+
+if (_leader distance _building > 500) exitwith {_group lockwp false};
+
+private ["_count","_units"];
+_units = units _group;
+_count = (count _units) - 1;
+
+while {_indices > 0 && _count > 0} do {
+	sleep 10;
+	while {_indices > 0 && _count > 0} do {
+		private "_unit";
+		_unit = _units select _count;
+		if (unitready _unit) then {
+			_unit commandmove (_building buildingpos _indices);
+			// disabled the following code... why spawn for a waitUntil ? Xeno
+			/*_unit spawn {
+				sleep 5;
+				waituntil {unitready _this};
+			};*/
+			_indices = _indices - 1;
+		};
+		_count = _count - 1;
+	};
+	_units = units _group;
+	_count = (count _units) - 1;
+};
+waituntil {sleep 3;	{unitready _x} count _units >= count (units _group) - 1};
+{
+	_x dofollow _leader;
+} foreach _units;
+_group setbehaviour _behaviour;
+_group lockwp false;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/ai_fnc_taskAttack.sqf BASE_A2Free/x/cba/addons/ai_fnc_taskAttack.sqf
--- BASE_MISSION/x/cba/addons/ai_fnc_taskAttack.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ai_fnc_taskAttack.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,27 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_taskAttack
+
+Description:
+	A function for a group to attack a parsed location.
+Parameters:
+	- Group (Group or Object)
+	- Position (XYZ, Object, Location or Group)
+	Optional:
+	- Search Radius (Scalar)
+Example:
+	[group player, getpos (player findNearestEnemy player), 100] call CBA_fnc_taskAttack
+Returns:
+	Nil
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+#include "ai_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_2(_group,_position);
+DEFAULT_PARAM(2,_radius,0);
+
+[_group, _position, _radius, "SAD", "COMBAT", "RED"] call CBA_fnc_addWaypoint;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/ai_fnc_taskDefend.sqf BASE_A2Free/x/cba/addons/ai_fnc_taskDefend.sqf
--- BASE_MISSION/x/cba/addons/ai_fnc_taskDefend.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ai_fnc_taskDefend.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,90 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_taskDefend
+
+Description:
+	A function for a group to defend a parsed location. Groups will mount nearby static machine guns, and bunker in nearby buildings. They may also patrol the radius unless otherwise specified.
+Parameters:
+	- Group (Group or Object)
+	Optional:
+	- Position (XYZ, Object, Location or Group)
+	- Defend Radius (Scalar)
+	- Building Size Threshold (Integer, default 2)
+	- Can patrol (boolean)
+Example:
+	[this] call CBA_fnc_taskDefend
+Returns:
+	Nil
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+private ["_group","_position","_radius","_threshold"];
+_group = (_this select 0) call CBA_fnc_getgroup;
+_position = (if (count _this > 1) then {_this select 1} else {_group}) call CBA_fnc_getpos;
+_radius = if (count _this > 2) then {_this select 2} else {50};
+_threshold = if (count _this > 3) then {_this select 3} else {2};
+
+_group enableattack false;
+
+private ["_count", "_list", "_list2", "_units", "_i"];
+_statics = [_position, vehicles, _radius, {(_x iskindof "StaticWeapon") && (_x emptypositions "Gunner" > 0)}] call CBA_fnc_getnearest;
+_buildings = _position nearObjects ["building",_radius];
+_units = units _group;
+_count = count _units;
+
+{
+	if (str(_x buildingpos _threshold) == "[0,0,0]") then {_buildings = _buildings - [_x]};
+} foreach _buildings;
+_i = 0;
+{
+	_count = (count _statics) - 1;
+	if (random 1 < 0.31 && _count > -1) then {
+		_x assignasgunner (_statics select _count);
+		_statics resize _count;
+		[_x] ordergetin true;
+		_i = _i + 1;
+	} else {
+		if (random 1 < 0.93 && count _buildings > 0) then {
+			private ["_building","_p","_array"];
+			_building = _buildings call BIS_fnc_selectRandom;
+			_array = _building getvariable "CBA_taskDefend_positions";
+			if (isnil "_array") then {
+				private "_k"; _k = 0;
+				_building setvariable ["CBA_taskDefend_positions",[]];
+				while {str(_building buildingpos _k) != "[0,0,0]"} do {
+					_building setvariable ["CBA_taskDefend_positions",(_building getvariable "CBA_taskDefend_positions") + [_k]];
+					_k = _k + 1;
+				};
+				_array = _building getvariable "CBA_taskDefend_positions";
+			};
+			if (count _array > 0) then {
+				_p = (_building getvariable "CBA_taskDefend_positions") call BIS_fnc_selectRandom;
+				_array = _array - [_p];
+				if (count _array == 0) then {
+					_buildings = _buildings - [_building];
+					_building setvariable ["CBA_taskDefend_positions",nil];
+				};
+				_building setvariable ["CBA_taskDefend_positions",_array];
+				[_x,_building buildingpos _p] spawn {
+					if (surfaceIsWater (_this select 1)) exitwith {};
+					(_this select 0) domove (_this select 1);
+					sleep 5;
+					waituntil {unitready (_this select 0)};
+					(_this select 0) disableai "move";
+					dostop _this;
+					waituntil {not (unitready (_this select 0))};
+					(_this select 0) enableai "move";
+				};
+				_i = _i + 1;
+			};
+		};
+	};
+} foreach _units;
+{
+	_x setvariable ["CBA_taskDefend_positions",nil];
+} foreach _buildings;
+if (count _this > 4) then {if !(_this select 4) then {_i = _count}};
+if (_i < _count * 0.5) then {
+	[_group, _position, _radius, 5, "sad", "safe", "red", "limited"] call CBA_fnc_taskpatrol;
+};
diff -rupN BASE_MISSION/x/cba/addons/ai_fnc_taskPatrol.sqf BASE_A2Free/x/cba/addons/ai_fnc_taskPatrol.sqf
--- BASE_MISSION/x/cba/addons/ai_fnc_taskPatrol.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ai_fnc_taskPatrol.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,53 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_taskPatrol
+
+Description:
+	A function for a group to randomly patrol a parsed radius and location.
+Parameters:
+	- Group (Group or Object)
+	Optional:
+	- Position (XYZ, Object, Location or Group)
+	- Radius (Scalar)
+	- Waypoint Count (Scalar)
+	- Waypoint Type (String)
+	- Behaviour (String)
+	- Combat Mode (String)
+	- Speed Mode (String)
+	- Formation (String)
+	- Code To Execute at Each Waypoint (String)
+	- TimeOut at each Waypoint (Array [Min, Med, Max])
+Example:
+    [this, getmarkerpos "objective1"] call CBA_fnc_taskPatrol
+    [this, this, 300, 7, "MOVE", "AWARE", "YELLOW", "FULL", "STAG COLUMN", "this spawn CBA_fnc_searchNearby", [3,6,9]] call CBA_fnc_taskPatrol;
+
+Returns:
+	Nil
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+#include "ai_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define NULL	"$null$"
+
+PARAMS_1(_group);
+DEFAULT_PARAM(1,_position,_group);
+DEFAULT_PARAM(2,_radius,100);
+DEFAULT_PARAM(3,_count,3);
+
+_this =+ _this;
+if (count _this > 3) then {
+    _this set [3, NULL];
+    _this = _this - [NULL];
+};
+for "_x" from 0 to _count do {
+    _this call CBA_fnc_addWaypoint;
+};
+_this2 =+ _this;
+_this2 set [3, "CYCLE"];
+_this2 call CBA_fnc_addWaypoint;
+
+deleteWaypoint ((waypoints _group) select 0);
diff -rupN BASE_MISSION/x/cba/addons/ai_script_component.hpp BASE_A2Free/x/cba/addons/ai_script_component.hpp
--- BASE_MISSION/x/cba/addons/ai_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ai_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,12 @@
+#define COMPONENT ai
+#include "script_mod.hpp"
+
+#ifdef DEBUG_ENABLED_AI
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_AI
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_AI
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/arrays_fnc_filter.sqf BASE_A2Free/x/cba/addons/arrays_fnc_filter.sqf
--- BASE_MISSION/x/cba/addons/arrays_fnc_filter.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_fnc_filter.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,63 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_filter
+
+Description:
+	Filter each element of an array via a function.
+
+	Data passed to the function on each iteration,
+	* _x - Element of _array.
+
+Parameters:
+	_array - Array of key-value pairs to create Hash from [Array, defaults to []]
+	_filter - Function to filter each element [Function]
+	_inPlace - True to alter the array itself, rather than create a new one [Boolean, defaults to false]
+
+Returns:
+	Filtered array [Array]
+
+Examples:
+	(begin example)
+		// Filter to create a new array.
+		_original = [1, 2, 3];
+		_filtered = [_original, { _x + 1 }] call CBA_fnc_filter;
+		// _original ==> [1, 2, 3]
+		// _filtered ==> [2, 3, 4]
+
+		// Filter original array in place.
+		_original = [1, 2, 3];
+		[_original, { _x * 10 }, true] call CBA_fnc_filter;
+		// _original ==> [10, 20, 30]
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(filter);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_2(_array,_filter);
+DEFAULT_PARAM(2,_inPlace,false);
+
+private ["_arrayOut", "_x"];
+
+if _inPlace then
+{
+	_arrayOut = _array;
+} else {
+	_arrayOut = [];
+	_arrayOut resize (count _array);
+};
+
+for "_i" from 0 to ((count _array) - 1) do
+{
+	_x = _array select _i;
+	_arrayOut set [_i, call _filter];
+};
+
+_arrayOut;
diff -rupN BASE_MISSION/x/cba/addons/arrays_fnc_getArrayDiff.sqf BASE_A2Free/x/cba/addons/arrays_fnc_getArrayDiff.sqf
--- BASE_MISSION/x/cba/addons/arrays_fnc_getArrayDiff.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_fnc_getArrayDiff.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,79 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getArrayDiff
+
+Description:
+	A function used to return the differences between two arrays.
+Parameters:
+	Two Arrays of strings (must not contain scalars)
+Example:
+	_distance = [[0,0,1], [0,0,0]] call CBA_fnc_getArrayDiff
+Returns:
+	Array Differences (for above example, return is [[1],[0]])
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define NULL "$null$"
+
+PARAMS_2(_arrayA,_arrayB);
+
+private ["_elmsA", "_elmsB", "_return", "_item", "_idx", "_cA", "_cB", "_case", "_cT"];
+
+// Simplify the arrays to save on processing power
+_elmsA = _arrayA call CBA_fnc_getArrayElements;
+_elmsB = _arrayB call CBA_fnc_getArrayElements;
+_return = [[], []];
+
+for "_i" from 1 to (count _elmsA) step 2 do {
+	// Pick the first item
+	_item = _elmsA select 0;
+	_idx = _elmsB find _item; // O(n^2), TODO: Find a way to differentiate counts
+	_cA = _elmsA select 1;
+	if (_idx > -1) then {
+		// Differential code
+		_cB = _elmsB select (_idx + 1);
+
+		_case = -1;
+		_cT = _cA - _cB;
+		if (_cT < 0) then {
+			_case = 1; //Missing from B
+			_cT = abs(_cT);
+		} else {
+			if (_cT > 0) then {
+				_case = 0; //Missing from A
+			};
+		};
+		// We have the difference, now put it in the right array
+		for "_j" from 1 to _cT do {
+			(_return select _case) set [count (_return select _case), _item]; // Fills array
+		};
+		// Remove the item from B, it was in both arrays
+		_elmsB set [_idx, NULL];
+		_elmsB set [_idx + 1, NULL];
+		_elmsB = _elmsB - [NULL];
+	} else {
+		// Missing from B
+		for "_j" from 0 to _cA do {
+			(_return select 0) set [count (_return select 0), _item]; // Fills array
+		};
+	};
+	// Remove the item from A
+	_elmsA set [0, NULL];
+	_elmsA set [1, NULL];
+	_elmsA = _elmsA - [NULL];
+};
+// Now add all those missing from A
+for "_i" from 0 to (count _elmsB - 1) step 2 do {
+	_item = _elmsB select _i;
+	_cB = _elmsB select (_i + 1);
+	for "_j" from 0 to (_cB - 1) do {
+		(_return select 1) set [count (_return select 1), _item]; // Fills array
+	};
+};
+// Now we're done, return the work done
+_return
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/arrays_fnc_getArrayElements.sqf BASE_A2Free/x/cba/addons/arrays_fnc_getArrayElements.sqf
--- BASE_MISSION/x/cba/addons/arrays_fnc_getArrayElements.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_fnc_getArrayElements.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,29 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getArrayElements
+
+Description:
+	A function used to return the element counts in an array.
+Parameters:
+	Array
+Example:
+	_types = [0,0,1,1,1,1] call CBA_fnc_getArrayElements
+Returns:
+	Array element counts (for above example, return would be [0,2,1,4])
+Author:
+	Rommel && sbsmac
+
+---------------------------------------------------------------------------- */
+
+private ["_array", "_return", "_countA", "_var", "_countB"];
+
+_array =+ _this;
+_return = [];
+_countA = count _array;
+while {_countA > 0} do {
+     _var = _array select 0;
+     _array = _array - [_var];
+     _countB = count _array;
+     _return = _return + [_var, _countA - _countB];
+     _countA = _countB;
+};
+_return
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/arrays_fnc_inject.sqf BASE_A2Free/x/cba/addons/arrays_fnc_inject.sqf
--- BASE_MISSION/x/cba/addons/arrays_fnc_inject.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_fnc_inject.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,63 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_inject
+
+Description:
+	Accumulates a value by passing elements of an array "through" a function.
+
+	Data passed to the function on each iteration,
+	* _accumulator - Value passed from last iteration, set to _initial for the
+		first iteration.
+	* _x - Element of _array.
+
+Parameters:
+	_array - Array of key-value pairs to create Hash from [Array]
+	_initial - Initial value to pass into the function as _accumulator [Any]
+	_function - Code to pass values to [Function]
+
+Returns:
+	Accumlated value [Any]
+
+Examples:
+	(begin example)
+		_result = [[1, 2, 3], "", { _accumulator + (str _x) }] call CBA_fnc_inject;
+		// _result ==> "123"
+
+		_result = [[1, 2, 3], " frogs", { (str _x) + _accumulator }] call CBA_fnc_inject;
+		// _result ==> "321 frogs"
+
+		_result = [[1, 2, 3], 0, { _accumulator + _x }] call CBA_fnc_inject;
+		// _result ==> 6
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(inject);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_3(_array,_initial,_function);
+
+private "_accumulator";
+
+if (not isNil "_initial") then
+{
+	_accumulator = _initial;
+};
+
+{
+	_accumulator = call _function;
+} forEach _array;
+
+// Return.
+if (isNil "_accumulator") then
+{
+	nil;
+} else {
+	_accumulator;
+};
diff -rupN BASE_MISSION/x/cba/addons/arrays_fnc_join.sqf BASE_A2Free/x/cba/addons/arrays_fnc_join.sqf
--- BASE_MISSION/x/cba/addons/arrays_fnc_join.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_fnc_join.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,57 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_join
+
+Description:
+	Joins an array of values into a single string, joining each fragment around
+	a separator string. Inverse of <CBA_fnc_split>.
+
+Parameters:
+	_array - Array to join together as a string [Array]
+	_separator - String to put between each element of _array
+		[String, defaults to ""]
+
+Returns:
+	The joined string [String]
+
+Example:
+	(begin example)
+		_result = [["FISH", "Cheese", "frog.sqf"], "\"] call CBA_fnc_join;
+		// _result ==> "FISH\Cheese\frog.sqf"
+
+		_result = [[3, 2, 1, "blast-off!"], "..."] call CBA_fnc_join;
+		// _result ==> "3...2...1...blast-off!"
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(join);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_1(_array);
+DEFAULT_PARAM(1,_separator,"");
+
+private ["_joined", "_element"];
+
+if ((count _array) > 0) then
+{
+	_element = _array select 0;
+	_joined = if (IS_STRING(_element)) then { _element } else { str _element };
+
+	for "_i" from 1 to ((count _array) - 1) do
+	{
+		_element = _array select _i;
+		_element = if (IS_STRING(_element)) then { _element } else { str _element };
+		_joined = _joined + _separator + _element;
+	};
+} else {
+	_joined = "";
+};
+
+_joined; // Return.
diff -rupN BASE_MISSION/x/cba/addons/arrays_fnc_shuffle.sqf BASE_A2Free/x/cba/addons/arrays_fnc_shuffle.sqf
--- BASE_MISSION/x/cba/addons/arrays_fnc_shuffle.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_fnc_shuffle.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,56 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_shuffle
+
+Description:
+	Shuffles an array's contents into random order, returning a new array.
+
+Parameters:
+	_array - Array of values to shuffle [Array, containing anything except nil]
+
+Returns:
+	New array containing shuffled values from original array [Array]
+
+Example:
+	(begin example)
+		_result = [[1, 2, 3, 4, 5]] call CBA_fnc_shuffle;
+		// _result could be [4, 2, 5, 1, 3]
+	(end)
+
+TODO:
+	Allow shuffling of elements in-place, using the original array.
+
+Author:
+	toadlife (version 1.01) http://toadlife.net
+	(rewritten by Spooner)
+---------------------------------------------------------------------------- */
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(shuffle);
+
+private ["_shuffledArray", "_tempArray", "_indexToRemove"];
+_shuffledArray = [];
+
+// Support the deprecated parameter style: [1, 2, 3, 4, 5] call CBA_fnc_shuffle.
+_tempArray = if ((count _this) != 1) then
+{
+	WARNING("CBA_fnc_shuffle requires an array as first parameter, not just a direct array: " + str _this);
+	[] + _this;
+}
+else{if (IS_ARRAY(_this select 0)) then
+{
+	[] + (_this select 0); // Correct params passed.
+} else {
+	WARNING("CBA_fnc_shuffle requires an array as first parameter, not just a direct array: " + str _this);
+	[] + _this;
+}; };
+
+for "_size" from (count _tempArray) to 1 step -1 do
+{
+	_indexToRemove = floor random _size;
+	PUSH(_shuffledArray,_tempArray select _indexToRemove);
+	_tempArray = [_tempArray, _indexToRemove] call BIS_fnc_removeIndex;
+};
+
+_shuffledArray
diff -rupN BASE_MISSION/x/cba/addons/arrays_fnc_sortNestedArray.sqf BASE_A2Free/x/cba/addons/arrays_fnc_sortNestedArray.sqf
--- BASE_MISSION/x/cba/addons/arrays_fnc_sortNestedArray.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_fnc_sortNestedArray.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,72 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_sortNestedArray
+
+Description:
+	Used to sort a nested array from lowest to highest using quick sort based on the specified column, which must have numerical data.
+Parameters:
+	_array: array - Nested array to be sorted
+	_index: integer - sub array item index to be sorted on
+Example:
+	_array = [_array,1] call CBA_fnc_sortNestedArray
+Returns:
+	Passed in array
+Author:
+	Standard algorithm
+
+---------------------------------------------------------------------------- */
+
+scriptName "CBA_fnc_sortNestedArray";
+/*
+	Modified BIS function to sort nested arrays.
+	Added 2nd parameter to indicate which column (index in nested array) to sort on.
+	Sorts an array of numbers from lowest (left) to highest (right).
+	The passed array is modified by reference.
+	This function uses the quick sort algorithm.
+*/
+
+//set up a function for recursion
+private "_sort";
+_sort =
+{
+	private ["_h","_i","_j","_a","_lo","_hi","_x","_id"];
+
+	_a = _this select 0; //array to be sorted
+	_id = _this select 1; //array item index to be compared
+	_lo = _this select 2; //lower index to sort from
+	_hi = _this select 3; //upper index to sort to
+
+	_h = nil;            //used to make a do-while loop below
+	_i = _lo;
+	_j = _hi;
+	if (count _a == 0) exitWith {};
+	_x = (_a select ((_lo+_hi)/2)) select _id;
+
+	//  partition
+	while {isnil "_h" || _i <= _j} do
+	{
+		//find first and last elements within bound that are greater / lower than _x
+		while {(_a select _i) select _id < _x} do {_i=_i+1};
+		while {(_a select _j) select _id > _x} do {_j=_j-1};
+
+		if (_i<=_j) then
+		{
+			//swap elements _i and _j
+			_h = _a select _i;
+			_a set [_i, _a select _j];
+			_a set [_j, _h];
+
+			_i=_i+1;
+			_j=_j-1;
+		};
+	};
+
+	// recursion
+	if (_lo<_j) then {[_a, _id, _lo, _j] call _sort};
+	if (_i<_hi) then {[_a, _id, _i, _hi] call _sort};
+};
+
+// and start it off
+[_this select 0, _this select 1, 0, 0 max ((count (_this select 0))-1)] call _sort;
+
+// array is already modified by reference, but return the modified array anyway
+_this select 0
diff -rupN BASE_MISSION/x/cba/addons/arrays_script_component.hpp BASE_A2Free/x/cba/addons/arrays_script_component.hpp
--- BASE_MISSION/x/cba/addons/arrays_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,13 @@
+#define COMPONENT arrays
+#include "script_mod.hpp"
+
+
+#ifdef DEBUG_ENABLED_ARRAYS
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_ARRAYS
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_ARRAYS
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/arrays_test.sqf BASE_A2Free/x/cba/addons/arrays_test.sqf
--- BASE_MISSION/x/cba/addons/arrays_test.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_test.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,22 @@
+// -----------------------------------------------------------------------------
+// Automatically generated by 'functions_config.rb'
+// DO NOT MANUALLY EDIT THIS FILE!
+// -----------------------------------------------------------------------------
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define TESTS ["filter", "inject", "join", "shuffle"]
+
+SCRIPT(test-arrays);
+
+// ----------------------------------------------------------------------------
+
+LOG("=== Testing Arrays ===");
+
+{
+	call compile preprocessFileLineNumbers format ["\x\cba\addons\arrays\test_%1.sqf", _x];
+} forEach TESTS;
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/arrays_test_filter.sqf BASE_A2Free/x/cba/addons/arrays_test_filter.sqf
--- BASE_MISSION/x/cba/addons/arrays_test_filter.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_test_filter.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,55 @@
+// ----------------------------------------------------------------------------
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_filter);
+
+// ----------------------------------------------------------------------------
+
+private ["_original", "_expected", "_result", "_fn"];
+
+_fn = "CBA_fnc_filter";
+ASSERT_DEFINED(_fn,"");
+
+LOG("Testing " + _fn);
+
+// Filter to new array.
+_original = [];
+_result = [[], { _x * 10 }] call CBA_fnc_filter;
+_expected = [];
+ASSERT_OP(str _result,==,str _expected,_fn);
+ASSERT_OP(str _original,==,str _expected,_fn);
+
+_original = [1, 2, 3];
+_result = [_original, { _x + 1 }] call CBA_fnc_filter;
+_expected = [2, 3, 4];
+ASSERT_OP(str _result,==,str _expected,_fn);
+ASSERT_OP(str _original,!=,str _expected,_fn);
+
+_original = [1, 2, 3];
+_result = [_original, { _x }, false] call CBA_fnc_filter;
+_expected = [1, 2, 3];
+ASSERT_OP(str _result,==,str _expected,_fn);
+
+// Filter in place.
+_original = [];
+_result = [_original, { _x * 10 }, true] call CBA_fnc_filter;
+_expected = [];
+ASSERT_OP(str _original,==,str _expected,_fn);
+ASSERT_OP(str _result,==,str _expected,_fn);
+
+_original = [1, 2, 3];
+_result = [_original, { _x + 1 }, true] call CBA_fnc_filter;
+_expected = [2, 3, 4];
+ASSERT_OP(str _original,==,str _expected,_fn);
+ASSERT_OP(str _result,==,str _expected,_fn);
+
+_original = [1, 2, 3];
+_result = [_original, { _x }, true] call CBA_fnc_filter;
+_expected = [1, 2, 3];
+ASSERT_OP(str _original,==,str _expected,_fn);
+ASSERT_OP(str _result,==,str _expected,_fn);
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/arrays_test_inject.sqf BASE_A2Free/x/cba/addons/arrays_test_inject.sqf
--- BASE_MISSION/x/cba/addons/arrays_test_inject.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_test_inject.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,34 @@
+// ----------------------------------------------------------------------------
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_inject);
+
+// ----------------------------------------------------------------------------
+
+private ["_expected", "_result", "_fn"];
+
+_fn = "CBA_fnc_inject";
+ASSERT_DEFINED(_fn,"");
+
+LOG("Testing " + _fn);
+
+_result = [[], "", { _accumulator + (str _x) }] call CBA_fnc_inject;
+_expected = "";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = [[1, 2, 3], "", { _accumulator + (str _x) }] call CBA_fnc_inject;
+_expected = "123";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = [[1, 2, 3], " frogs", { (str _x) + _accumulator }] call CBA_fnc_inject;
+_expected = "321 frogs";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = [[1, 2, 3], 0, { _accumulator + _x }] call CBA_fnc_inject;
+_expected = 6;
+ASSERT_OP(_result,==,_expected,_fn);
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/arrays_test_join.sqf BASE_A2Free/x/cba/addons/arrays_test_join.sqf
--- BASE_MISSION/x/cba/addons/arrays_test_join.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_test_join.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,42 @@
+// ----------------------------------------------------------------------------
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_join);
+
+// ----------------------------------------------------------------------------
+
+private ["_expected", "_result", "_fn"];
+
+_fn = "CBA_fnc_join";
+ASSERT_DEFINED(_fn,"");
+
+LOG("Testing " + _fn);
+
+_result = [[], "x"] call CBA_fnc_join;
+_expected = "";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = [[""], "x"] call CBA_fnc_join;
+_expected = "";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = [["frog"], "x"] call CBA_fnc_join;
+_expected = "frog";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = [["", ""], "x"] call CBA_fnc_join;
+_expected = "x";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = [["a","b","c"], "x"] call CBA_fnc_join;
+_expected = "axbxc";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = [["a",1,[objNull]], "x^x"] call CBA_fnc_join;
+_expected = "ax^x1x^x[<Null-Object>]";
+ASSERT_OP(_result,==,_expected,_fn);
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/arrays_test_shuffle.sqf BASE_A2Free/x/cba/addons/arrays_test_shuffle.sqf
--- BASE_MISSION/x/cba/addons/arrays_test_shuffle.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/arrays_test_shuffle.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,40 @@
+// ----------------------------------------------------------------------------
+
+#include "arrays_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_shuffle);
+
+// ----------------------------------------------------------------------------
+
+private ["_expected", "_result", "_fn"];
+
+_fn = "CBA_fnc_shuffle";
+ASSERT_DEFINED(_fn,"");
+
+LOG("Testing " + _fn);
+
+_original = [1, 2, 3];
+_result = [_original] call CBA_fnc_shuffle;
+ASSERT_OP(count _result,==,count _original,_fn);
+
+{
+	ASSERT_OP(_x,in,_original,_fn);
+} forEach _result;
+
+// Test depecated version.
+_original = [1, 2, 3];
+_result = _original call CBA_fnc_shuffle;
+ASSERT_OP(count _result,==,count _original,_fn);
+
+{
+	ASSERT_OP(_x,in,_original,_fn);
+} forEach _result;
+
+// Test depecated version.
+_original = [];
+_result = _original call CBA_fnc_shuffle;
+ASSERT_OP(count _result,==,count _original,_fn);
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/common_XEH_postInit.sqf BASE_A2Free/x/cba/addons/common_XEH_postInit.sqf
--- BASE_MISSION/x/cba/addons/common_XEH_postInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_XEH_postInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,145 @@
+// #define DEBUG_MODE_FULL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+LOG(MSG_INIT);
+
+// if (true) exitWith {};
+
+// NOTE: Due to the way the BIS functions initializations work, and the requirement of BIS_functions_mainscope to be a unit (in a group)
+//       the logic is created locally on MP dedicated client, to still allow this early, called precompilation of the functions.
+//       But initialization doesn't officially finish until the official (server created / mission.sqm included) logic is available.
+//		 In SP or as server (dedicated or clientServer), the logic is created with group and createUnit.
+[] spawn {
+	waitUntil {!isNil "BIS_MPF_InitDone"}; //functions init must be after MPF init
+	waitUntil {!isNil "bis_functions_mainscope"};
+	BIS_fnc_init = true;
+	#ifdef DEBUG_MODE_FULL
+		diag_log [diag_frameNo, diag_tickTime, time, "BLA: Function module init true!"];
+	#endif
+};
+
+private ["_group", "_logic"];
+if (isNil "BIS_functions_mainscope") then
+{
+	if (SLX_XEH_MACHINE select 3) then
+	{
+		// CREATE_CENTER sideLogic; // Handled in function
+		_group = [sideLogic] call CBA_fnc_getSharedGroup;
+		_logic = _group createUnit ["FunctionsManager", [0,0,0], [], 0, "none"];
+		TRACE_2("Created FunctionsManager Logic",_group,_logic);
+	} else {
+		// TODO: Evaluate cleanup for this one
+		_logic = "LOGIC" createVehicleLocal [0, 0];
+		TRACE_1("Created FunctionsManager Logic (local)",_logic);
+	};
+} else {
+	_logic = BIS_functions_mainscope;
+	TRACE_1("Using already available BIS_functions_mainscope",_logic);
+};
+
+CBA_logic = _logic;
+
+if (isNil "RE" && isNil "BIS_MPF_logic") then
+{
+	LOG("Initialising the MP module early.");
+	_this call compile preprocessFileLineNumbers "\ca\Modules\MP\data\scripts\MPframework.sqf";
+};
+[] spawn {
+	_done = false;
+	while {true} do {
+		sleep 1;
+		if (typeName nil == "STRING" || str(nil) != "ANY") then {
+			if !(CBA_NIL_CHECKED) then { "WARNING: NIL VARIABLE OVERRIDEN; Please fix Mission or loaded addon-scripts" spawn FUNC(log); CBA_NIL_CHECKED = true; };
+			nil = CBA_nil select 0; // TODO: This doesn't work properly.. it will at least undefine nil, making the error more apparant, yet not exactly what we want.
+		};
+	};
+};
+
+// A2 / Operation Arrowhead, standalone / combined operations check
+TRACE_1("OA Check",nil);
+private ["_hasCbaOa", "_hasCbaA2", "_hasA2", "_hasOa"];
+_hasCbaA2 = true;//isClass(configFile >> "CfgMods" >> "CBA_A2");
+_hasCbaOa = isClass(configFile >> "CfgMods" >> "CBA_OA");
+_hasA2 = isClass(configFile >> "CfgPatches" >> "Chernarus");
+_hasOa = isClass(configFile >> "CfgPatches" >> "Takistan");
+
+if (_hasA2 && _hasCbaOa) then { (localize "STR_CBA_COMMON_OA_CO_HAS_CBA_OA") spawn FUNC(log) };
+if (!_hasA2 && !_hasCbaOa) then { (localize "STR_CBA_COMMON_OA_ST_NO_CBA_OA") spawn FUNC(log) };
+
+if (_hasOa && _hasCbaA2) then { (localize "STR_CBA_COMMON_OA_HAS_CBA_A2") spawn FUNC(log) };
+if (!_hasOa && !_hasCbaA2) then { (localize "STR_CBA_COMMON_A2_ST_NO_CBA_A2") spawn FUNC(log) };
+
+// Upgrade check - Registry for removed addons, warn the user if found
+// TODO: Evaluate registry of 'current addons' and verifying that against available CfgPatches
+TRACE_1("Upgrade Check",nil);
+#define CFG configFile >> "CfgSettings" >> "CBA" >> "registry"
+private ["_entry"];
+for "_i" from 0 to ((count (CFG)) - 1) do {
+	_entry = (CFG) select _i;
+	if (isClass(_entry)) then {
+		if (isArray(_entry >> "removed")) then {
+			{
+				if (isClass(configFile >> "CfgPatches" >> _x)) then {
+					format["WARNING: Found addon that should be removed: %1; Please remove and restart game", _x] spawn FUNC(log);
+				};
+			} forEach (getArray(_entry >> "removed"));
+		};
+	};
+};
+
+// Run the per frame handler init code, bringing up the hidden map control
+[] spawn {
+	waitUntil {time > 0};
+	7771 cutRsc ["CBA_FrameHandlerTitle", "PLAIN"];
+	sleep 0.1;
+
+	GVAR(lastFrameRender) = diag_tickTime;
+	// Use a trigger, runs every 0.5s, unscheduled execution
+	GVAR(perFrameTrigger) = createTrigger["EmptyDetector", [0,0,0]];
+	GVAR(perFrameTrigger) setTriggerStatements[QUOTE(call FUNC(monitorFrameRender)), "", ""];
+};
+
+if !(isDedicated) then {
+	[] spawn
+	{
+		LOG("Action monitor started");
+		while { true } do
+		{
+			// Don't mess around endlessly adding and re-adding to a
+			// corpse/destroyed vehicle.
+			waitUntil { alive (vehicle player) };
+			
+			// Add actions to new vehicle.
+			_veh = vehicle player;
+			_actionIndexes = [];
+			[GVAR(actionList), { PUSH(_actionIndexes,_veh addAction _value) }] call CBA_fnc_hashEachPair;
+			TRACE_2("Added actions",_veh,count _actionIndexes);
+			waitUntil
+			{
+				sleep 1;
+				(vehicle player) != _veh || !(alive player) || GVAR(actionListUpdated)
+			};
+	
+			// Remove actions from previous vehicle.
+			GVAR(actionListUpdated) = false;
+			{ _veh removeAction _x } foreach _actionIndexes;
+	
+			TRACE_2("Removed actions",_veh,count _actionIndexes);
+	
+			sleep 1;
+		};
+	};
+};
+
+// TODO: Consider a waitUntil loop with tickTime check to wait for some frames as opposed to trying to sleep until time > 0. Re MP Briefings etc.
+[CBA_COMMON_ADDONS] spawn {
+	PARAMS_1(_addons);
+	//TRACE_1("Activating addons",nil);
+	//activateAddons _addons;
+	//sleep 0.001;
+	//if (SLX_XEH_MACHINE select 1) then { sleep 0.001 }; // JIP, sleep uses time, and time skips for JIP.
+	//TRACE_1("Activating addons",nil);
+	//activateAddons _addons;
+};
diff -rupN BASE_MISSION/x/cba/addons/common_XEH_preClientInit.sqf BASE_A2Free/x/cba/addons/common_XEH_preClientInit.sqf
--- BASE_MISSION/x/cba/addons/common_XEH_preClientInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_XEH_preClientInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,7 @@
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+LOG(MSG_INIT);
+
+call COMPILE_FILE(init_actionmonitor);
diff -rupN BASE_MISSION/x/cba/addons/common_XEH_preInit.sqf BASE_A2Free/x/cba/addons/common_XEH_preInit.sqf
--- BASE_MISSION/x/cba/addons/common_XEH_preInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_XEH_preInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,144 @@
+// #define DEBUG_MODE_FULL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(XEH_preInit);
+
+/*
+ * Prepare BIS functions/MP and precompile all functions we already have
+ * registered with it. In order to have the functions loaded early,
+ * we do so in the "init_functionsModule" script. However, to make sure
+ * everything is done properly, we also create a new BIS functions manager
+ * module so that the whole BIS MP and functions framework is initialised
+ * completely. (We need to do it this way since the BIS function manager
+ * defers initialisation by way of execVM:ing its init script.)
+ *
+ * Yes, there's some redundancy in that the functions will be
+ * loaded and preprocessed twice, but this should only occur once per mission
+ * and will hopefully ensure forward compatibility with future ArmA II patches.
+ */
+
+if (!SLX_XEH_DisableLogging) then
+{
+	diag_log [diag_frameNo, diag_tickTime, time, "MISSINIT",missionName,worldName,isMultiplayer,isServer,isDedicated];
+};
+
+/*
+if (isNil "RE" && isNil "BIS_MPF_logic") then
+{
+	LOG("Initialising the MP module early.");
+	_this call compile preprocessFileLineNumbers "\ca\Modules\MP\data\scripts\MPframework.sqf";
+};
+*/
+
+LOG("Initialising the Functions module early.");
+[] call COMPILE_FILE(init_functionsModule);
+LOG(MSG_INIT);
+// if (true) exitWith {};
+
+ADDON = false;
+
+CBA_nil = [nil];
+
+GVAR(centers) = [];
+CBA_actionHelper = QUOTE(PATHTO(actionHelper));
+GVAR(delayless) = "x\cba\addons\delayless.fsm";
+GVAR(delayless_loop) = QUOTE(PATHTOF(delayless_loop.fsm));
+
+// DirectCall, using single-frame-code-executioner by Xeno
+// The directCall function will execute (with parameters) next frame, and without delay
+// [[1,2,3], {mycode to execute}] call FUNC(directCall);
+// _obj = [[1,2,3], {mycode to execute}] call FUNC(directCall); waitUntil {isNull _obj}; // waits until the code has completed
+GVAR(call_i) = 0;
+FUNC(directCallInt) = { (_this getVariable QUOTE(GVAR(params))) call (_this getVariable QUOTE(GVAR(code))); deleteVehicle _this };
+FUNC(directCall) = {
+	private ["_obj", "_objName"];
+	PARAMS_2(_params,_code);
+
+	INC(GVAR(call_i));
+	_objName = format[QUOTE(GVAR(call_obj_%1)), GVAR(call_i)];
+	_obj = "HeliHEmpty" createVehicleLocal [0, 0, 0];
+	missionNameSpace setVariable [_objName, _obj];
+	_obj setVariable [QUOTE(GVAR(params)), _params];
+	_obj setVariable [QUOTE(GVAR(code)), _code];
+	_obj addEventHandler ["killed", compile format[QUOTE(%1 call FUNC(directCallInt); %1 = nil), _objName]];
+	_obj setDamage 1;
+	_obj;
+};
+
+CBA_logic = objNull;
+
+FUNC(log) = {
+		diag_log text _this;
+		sleep 1;
+		CBA_logic globalChat _this;
+		hintC _this;
+};
+
+// Nil check
+if (isNil "CBA_NIL_CHECKED") then { CBA_NIL_CHECKED = false };
+
+// Prepare all functions
+DEPRECATE(fAddMagazine,fnc_addMagazine);
+DEPRECATE(fAddMagazineCargo,fnc_addMagazineCargo);
+DEPRECATE(fAddWeapon,fnc_addWeapon);
+DEPRECATE(fAddWeaponCargo,fnc_addWeaponCargo);
+DEPRECATE(fDetermineMuzzles,fnc_determineMuzzles);
+DEPRECATE(fDropMagazine,fnc_dropMagazine);
+DEPRECATE(fDropWeapon,fnc_dropWeapon);
+DEPRECATE(fGetAnimType,fnc_getAnimType);
+DEPRECATE(fGetConfigEntry,fnc_getConfigEntry);
+DEPRECATE(fGetPistol,fnc_getPistol);
+DEPRECATE(fGetUnitAnim,fnc_getUnitAnim);
+DEPRECATE(fGetUnitDeathAnim,fnc_getUnitDeathAnim);
+DEPRECATE(fGetVehicleAnim,fnc_isTurnedOut);
+DEPRECATE(fHeadDir,fnc_headDir);
+
+OBSOLETE(fMyWeapon,{ currentWeapon player });
+
+DEPRECATE(fObjectRandom,fnc_objectRandom);
+DEPRECATE(fPlayers,fnc_players);
+DEPRECATE(fRealHeight,fnc_realHeight);
+DEPRECATE(fRemoveMagazine,fnc_removeMagazine);
+DEPRECATE(fRemoveWeapon,fnc_removeWeapon);
+
+OBSOLETE(fSelectedWeapon,{ currentWeapon _this });
+
+DEPRECATE_SYS(DOUBLES(PREFIX,fVectorSum3d),BIS_fnc_vectorAdd);
+
+DEPRECATE(fAddMagazineVerified,fnc_addMagazineVerified);
+DEPRECATE(fCreateMarker,fnc_createMarker);
+DEPRECATE(fCreateTrigger,fnc_createTrigger);
+DEPRECATE(fGetArg,fnc_getArg);
+DEPRECATE(fInheritsFrom,fnc_inheritsFrom);
+DEPRECATE(fNearPlayer,fnc_nearPlayer);
+
+DEPRECATE_SYS(DOUBLES(PREFIX,fRndInt),BIS_fnc_randomInt);
+DEPRECATE_SYS(DOUBLES(PREFIX,fRndSelect),BIS_fnc_selectRandom);
+
+DEPRECATE(fSelectWeapon,fnc_selectWeapon);
+DEPRECATE(fShuffle,fnc_shuffle);
+DEPRECATE(fSwitchPlayer,fnc_switchPlayer);
+
+// Initialize Components
+GVAR(groups) = [grpNull, grpNull, grpNull, grpNull, grpNull];
+call COMPILE_FILE(init_gauss);
+call COMPILE_FILE(init_kron_strings);
+
+OBSOLETE_SYS(KRON_StrUpper,{ toUpper (_this select 0) });
+OBSOLETE_SYS(KRON_StrLower,{ toLower (_this select 0) });
+DEPRECATE_SYS(KRON_StrIndex,DOUBLES(PREFIX,fnc_find)); // CBA_fnc_find does the same and more.
+DEPRECATE_SYS(KRON_StrLen,DOUBLES(PREFIX,fnc_strLen));
+DEPRECATE_SYS(KRON_StrToArray,DOUBLES(PREFIX,fnc_split)); // CBA_fnc_split does the same and more.
+DEPRECATE_SYS(KRON_Replace,DOUBLES(PREFIX,fnc_replace)); // KRON is faster, but CBA one is 1 line (reuses other functions).
+
+
+call COMPILE_FILE(init_perFrameHandler);
+
+// NOTE: Due to activateAddons being overwritten by eachother (only the last executed command will be active), we apply this bandaid
+call COMPILE_FILE(init_addons);
+
+call COMPILE_FILE(init_delayLess);
+
+// Announce Initialization Complete
+ADDON = true;
diff -rupN BASE_MISSION/x/cba/addons/common_actionHelper.sqf BASE_A2Free/x/cba/addons/common_actionHelper.sqf
--- BASE_MISSION/x/cba/addons/common_actionHelper.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_actionHelper.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,26 @@
+/*
+	CBA_actionHelper - By BigDawgKS
+
+	Examples:
+	_obj addAction ["My Action",CBA_actionHelper,_myOnActCode,1,false,true,"",""];
+	Or:
+	_obj addAction ["My Action 2",CBA_actionHelper,[_myOnActCode,_moreArgs],1,false,true,"",""]
+*/
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+// #define DEBUG_MODE_FULL
+private ["_param", "_code", "_args"];
+_param = _this select 3;
+
+if (typeName _param == "ARRAY")then{
+	_code = _param select 0;
+	_args = _param select 1;
+
+	[_this select 0,_this select 1,_this select 2,_args] call _code;
+} else {
+	_code = _param;
+	[_this select 0,_this select 1,_this select 2] call _code;
+};
diff -rupN BASE_MISSION/x/cba/addons/common_dummy.sqf BASE_A2Free/x/cba/addons/common_dummy.sqf
--- BASE_MISSION/x/cba/addons/common_dummy.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_dummy.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,2 @@
+diag_log "Dummy file called, please fix!";
+false;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_actionArgument.sqf BASE_A2Free/x/cba/addons/common_fnc_actionArgument.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_actionArgument.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_actionArgument.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,32 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_actionArgument
+
+Description:
+	Used to call the code parsed in the addaction argument.
+
+Parameters:
+
+Returns:
+
+Examples:
+	(begin example)
+	captive addaction ["rescue",CBA_fnc_actionargument_path,[[],{[_target] join (group _caller)},true]] //captive joins action callers group, action is removed (true)
+	(end)
+
+Author:
+	Rommel
+---------------------------------------------------------------------------- */
+
+private ["_target","_caller","_id","_arguments"];
+_target = _this select 0;
+_caller = _this select 1;
+_id = _this select 2;
+_arguments = _this select 3;
+
+(_arguments select 0) call (_arguments select 1);
+
+if (count _arguments > 2) then {
+	if (_arguments select 2) then {
+		_target removeAction _id;
+	};
+};
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_addMagazine.sqf BASE_A2Free/x/cba/addons/common_fnc_addMagazine.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_addMagazine.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_addMagazine.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,64 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addMagazine
+
+Description:
+	Add magazine to a vehicle/unit.
+
+	The function also verifies existence of _item and _unit, returns false in
+	case of trouble, or true when able to add _item to _unit.
+
+Parameters:
+	_unit - the unit or vehicle
+	_item - name of the magazine to add
+
+Returns:
+	true on success, false otherwise
+
+Examples:
+	(begin example)
+	_result = [player, "SmokeShell"] call CBA_fnc_addMagazine
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(addMagazine);
+
+#define __scriptname fAddMagazine
+
+#define __cfg (configFile >> "CfgMagazines")
+#define __action addMagazine
+
+PARAMS_2(_unit,_item);
+if (typeName _unit != "OBJECT") exitWith
+{
+	TRACE_2("Unit not Object",_unit,_item);
+	false
+};
+if (typeName _item != "STRING") exitWith
+{
+	TRACE_2("Item not String",_unit,_item);
+	false
+};
+if (isNull _unit) exitWith
+{
+	TRACE_2("Unit isNull",_unit,_item);
+	false
+};
+if (_item == "") exitWith
+{
+	TRACE_2("Empty Item",_unit,_item);
+	false
+};
+if !(isClass (__cfg >> _item)) exitWith
+{
+	TRACE_2("Item not exist in Config",_unit,_item);
+	false
+};
+_unit __action _item;
+TRACE_2("Success",_unit,_item);
+true
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_addMagazineCargo.sqf BASE_A2Free/x/cba/addons/common_fnc_addMagazineCargo.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_addMagazineCargo.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_addMagazineCargo.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,76 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addMagazineCargo
+
+Description:
+	Add magazine(s) to a vehicle's cargo.
+
+	Function which verifies existence of _item and _unit, returns false in case
+	of trouble, or when able to add _item to _unit true in case of success.
+
+Parameters:
+	_unit  - the vehicle [Object]
+	_item  - name of magazine to [String] 
+	_count - number of magazines to add [Number] (Default: 1)
+
+Returns:
+	true on success, false otherwise
+
+Examples:
+	(begin example)
+	// Add one mine to the cargo of SomeTruck
+	_result = [ SomeTruck, "Mine"] call CBA_fnc_AddMagazineCargo
+
+	// Add three smoke cans to MyCar
+	_result = [ MyCar, "SmokeShell", 3] call CBA_fnc_AddMagazineCargo
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(addMagazineCargo);
+
+#define __scriptname fnc_addMagazineCargo
+
+#define __cfg (configFile >> "CfgMagazines")
+#define __action addMagazineCargo
+
+PARAMS_2(_unit,_item);
+DEFAULT_PARAM(2,_count,1);
+if (typeName _unit != "OBJECT") exitWith
+{
+	TRACE_2("Unit not Object",_unit,_item);
+	false
+};
+//_item = _this select 1;
+if (typeName _item != "STRING") exitWith
+{
+	TRACE_2("Item not String",_unit,_item);
+	false
+};
+if (isNull _unit) exitWith
+{
+	TRACE_2("Unit isNull",_unit,_item);
+	false
+};
+if (_item == "") exitWith
+{
+	TRACE_2("Empty Item",_unit,_item);
+	false
+};
+if !(isClass (__cfg >> _item)) exitWith
+{
+	TRACE_2("Item not exist in Config",_unit,_item);
+	false
+};
+if (typeName _count != "SCALAR") exitWith
+{
+	TRACE_3("Count is not a number",_unit,_item,_count);
+	false
+};
+_unit __action [_item, _count];
+TRACE_3("Success",_unit,_item,_count);
+true
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_addMagazineVerified.sqf BASE_A2Free/x/cba/addons/common_fnc_addMagazineVerified.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_addMagazineVerified.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_addMagazineVerified.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,169 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addMagazineVerified
+
+Description:
+	Add magazines to the unit, but verify that it was
+	successful and doesn't over-burden the recipient. The
+	function has to options to fill all available inventory slots with
+	the requested magazine type, create excess magazines on the ground
+	or do nothing.
+
+Parameters:
+	_unit - the unit to add magazine too. [Object]
+	_magazine - the magazine type to add. [String]
+	_action - 0 (default) do nothing, return false
+		- 1 create excess magazines on ground
+		- 2 fill all inventory slots
+
+Returns:
+	true, if the unit has sufficient inventory space
+	for the magazine in question
+
+Examples:
+	(begin example)
+	[player, "SmokeShell",1] call CBA_fnc_AddMagazineVerified
+	(end)
+
+Author:
+	Sickboy, Killswitch, Wolffy.Au
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(addMagazineVerified);
+
+#define __pistol 16
+#define __rifle 256
+#define __ruck 4096
+
+#define __pistolMax 8
+#define __rifleMax 12
+#define __ruckMax 20
+
+private ["_unit", "_magazine", "_action", "_return", "_cfg", "_type", "_pistol", "_rifle", "_num", "_exit", "_ruck"];
+// BWC
+if (typeName _this != "ARRAY") then {
+	_unit = player;
+	_magazine = _this;
+	_action = 2;
+} else {
+	EXPLODE_2(_this,_unit,_magazine);
+	DEFAULT_PARAM(2,_action,0);
+};
+
+_cfg = (configFile >> "CfgMagazines" >> _magazine);
+_type = getNumber (_cfg >> "type");
+
+_pistol = 0;
+_rifle = 0;
+_ruck = 0;
+{
+	private ["_cfg", "_type"];
+	_cfg = (configFile >> "CfgMagazines" >> _x);
+	_type = getNumber (_cfg >> "type");
+	switch _type do
+	{
+		case __pistol:
+		{
+			_pistol = _pistol + 1;
+		};
+		case __rifle:
+		{
+			_rifle = _rifle + 1;
+		};
+		case __ruck:
+		{
+			_ruck = _ruck + 1;
+		};
+		default
+		{
+			if (_type > (__rifle * __rifleMax)) exitWith {};
+			_num = _type / __rifle;
+			if (_num == (round _num)) then
+			{
+				_rifle = _rifle + _num;
+			} else {
+				if (_type > (__pistol * __pistolMax)) exitWith {};
+
+				_num = _type / __pistol;
+				if (_num == (round _num)) then
+				{
+					_pistol = _pistol + _num;
+				};
+			};
+		};
+	};
+} forEach (magazines _unit);
+
+private ["_j", "_k"];
+_exit = false;
+switch _type do
+{
+	case __pistol:
+	{
+		_num = 1;
+		_j = _pistol;
+		_k = __pistolMax;
+	};
+	case __rifle:
+	{
+		_num = 1;
+		_j = _rifle;
+		_k = __rifleMax;
+	};
+	case __ruck:
+	{
+		_num = 1;
+		_j = _ruck;
+		_k = __ruckMax;
+	};
+	default
+	{
+		if (_type > (__rifle * __rifleMax)) exitWith { _exit = true };
+		_num = _type / __rifle;
+		if (_num == (round _num)) then
+		{
+			_j = _rifle;
+			_k = __rifleMax;
+		} else {
+			if (_type > (__pistol * __pistolMax)) exitWith { _exit = true };
+			_num = _type / __pistol;
+			if (_num == (round _num)) then
+			{
+				_j = _pistol;
+				_k = __pistolMax;
+			};
+		};
+	};
+};
+
+if (_exit && (_action == 0 || _action == 2)) exitWith { diag_log "CBA_fnc_addMagazineVerified: Sorry, can't carry more of these magazines!"; false; };
+_return = false;
+if ((_k - _j) >= _num)  then
+{
+        switch (_action) do 
+        {
+                case 2: {
+			for "_i" from 1 to ((_k - _j) / _num) do
+			{
+                                [_unit,_magazine] call CBA_fnc_addMagazine;
+			};
+		};
+                default {
+                        [_unit,_magazine] call CBA_fnc_addMagazine;
+                };
+        };
+        _return = true;
+} else {
+        if (_action == 1) then {
+                private ["_wh"];
+                _unit switchMove "ainvpknlmstpslaywrfldnon_1"; 
+		_wh = createVehicle ["WeaponHolder", position _unit, [], 0, "NONE"];
+                [_wh, _magazine] call CBA_fnc_AddMagazineCargo;
+		_wh setPos ([_wh, 2] call CBA_fnc_randPos);
+        };
+};
+
+_return;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_addPerFrameHandler.sqf BASE_A2Free/x/cba/addons/common_fnc_addPerFrameHandler.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_addPerFrameHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_addPerFrameHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,39 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addPerFrameHandler
+
+Description:
+	Add a handler that will execute every frame, or every x number of seconds
+
+Parameters:
+	_func - The function you wish to execute
+	_delay - The amount of time in seconds (can be less than 0) between executions, 0 for everyframe.
+	_params - Parameters passed to the function executing. This will be the same array every execution.
+
+Returns:
+	_handle - a number representing the handle of the function. Use this to remove the handler.
+
+Examples:
+	(begin example)
+		[{player sideChat format["every frame! _this: %1", _this];}, 0, ["some","params",1,2,3]] call CBA_fnc_addPerFrameHandler;
+	(end)
+
+Author:
+	Nou & Jaynus, donated from ACRE project code for use by the community.
+
+---------------------------------------------------------------------------- */
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private["_handle", "_data"];
+PARAMS_2(_func,_delay);
+DEFAULT_PARAM(2,_params,[]);
+
+_handle = -1;
+if(!isNil "_func") then {
+	_handle = (count GVAR(perFrameHandlerArray));
+	_data = [_func, _delay, 0, diag_tickTime, _params, _handle];
+	GVAR(perFrameHandlerArray) set [_handle, _data];
+};
+
+_handle
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_addPlayerAction.sqf BASE_A2Free/x/cba/addons/common_fnc_addPlayerAction.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_addPlayerAction.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_addPlayerAction.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,47 @@
+/*
+Function: CBA_fnc_addPlayerAction
+
+Description:
+	Adds persistent action to player (which will also be available in vehicles
+	and after respawn or teamswitch).
+
+	Remove action with <CBA_fnc_removePlayerAction>. *Do not* use standard
+	removeAction command with these player-action indices!
+
+Parameters:
+	_actionArray - Array that defines the action, as used in addAction command [Array]
+
+Returns:
+	Index of action if added. -1 if used on a dedicated server [Number]
+
+Example:
+	(begin example)
+		_actionIndex = [["Teleport", "teleport.sqf"]] call CBA_fnc_addPlayerAction;
+	(end)
+
+Author:
+	Sickboy
+
+*/
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_1(_actionArray);
+
+private "_return";
+
+_return = if (isDedicated) then
+{
+	WARNING("Function ran on a dedicated server. Function only usable on a client. Action: " + str _actionArray);
+	-1; // Invalid action number.
+} else {
+	_index = GVAR(nextActionIndex);
+	[GVAR(actionList), _index, _actionArray] call CBA_fnc_hashSet;
+	GVAR(actionListUpdated) = true;
+	INC(GVAR(nextActionIndex));
+	_index;
+};
+
+_return;
+
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_addWeapon.sqf BASE_A2Free/x/cba/addons/common_fnc_addWeapon.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_addWeapon.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_addWeapon.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,64 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addWeapon
+
+Description:
+	Add a weapon to a unit.
+
+	Function which verifies existence of _item and _unit, returns false in
+	case of trouble, or when able to add _item to _unit true in case of success.
+
+Parameters:
+	_unit - the unit
+	_item - name of the weapon to add
+
+Returns:
+	true on success, false otherwise
+
+Examples:
+	(begin example)
+	_result = [player, "Binocular"] call CBA_fnc_addWeapon
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(addWeapon);
+
+#define __scriptname fAddWeapon
+
+#define __cfg (configFile >> "CfgWeapons")
+#define __action addWeapon
+
+PARAMS_2(_unit,_item);
+if (typeName _unit != "OBJECT") exitWith
+{
+	TRACE_2("Unit not Object",_unit,_item);
+	false
+};
+if (typeName _item != "STRING") exitWith
+{
+	TRACE_2("Item not String",_unit,_item);
+	false
+};
+if (isNull _unit) exitWith
+{
+	TRACE_2("Unit isNull",_unit,_item);
+	false
+};
+if (_item == "") exitWith
+{
+	TRACE_2("Empty Item",_unit,_item);
+	false
+};
+if !(isClass (__cfg >> _item)) exitWith
+{
+	TRACE_2("Item not exist in Config",_unit,_item);
+	false
+};
+_unit __action _item;
+TRACE_2("Success",_unit,_item);
+true
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_addWeaponCargo.sqf BASE_A2Free/x/cba/addons/common_fnc_addWeaponCargo.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_addWeaponCargo.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_addWeaponCargo.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,77 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addWeaponCargo
+
+Description:
+	Add weapon(s) to vehicle cargo.
+
+	Function which verifies existence of _item and _unit, returns false in case
+	of trouble, or when able to add _item to _unit true in case of success.
+
+Parameters:
+	_unit  - the vehicle [Object]
+	_item  - name of weapon [String] 
+	_count - number of weapons to add [Number] (Default: 1)
+
+Returns:
+	true on success, false otherwise
+
+Examples:
+	(begin example)
+	// Add one laser designator to the cargo of SomeTruck
+	_result = [SomeTruck, "LaserDesignator"] call CBA_fnc_addWeaponCargo
+
+	// Add two AK 107 rifles to MyUAZ
+	_result = [MyUAZ, "AK_107_KOBRA", 2] call CBA_fnc_addWeaponCargo
+	(end)
+
+Author:
+	Sickboy
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(addWeaponCargo);
+
+#define __scriptname fAddWeaponCargo
+
+#define __cfg (configFile >> "CfgWeapons")
+#define __action addWeaponCargo
+
+PARAMS_2(_unit,_item);
+DEFAULT_PARAM(2,_count,1);
+if (typeName _unit != "OBJECT") exitWith
+{
+	TRACE_2("Unit not Object",_unit,_item);
+	false
+};
+_item = _this select 1;
+if (typeName _item != "STRING") exitWith
+{
+	TRACE_2("Item not String",_unit,_item);
+	false
+};
+if (isNull _unit) exitWith
+{
+	TRACE_2("Unit isNull",_unit,_item);
+	false
+};
+if (_item == "") exitWith
+{
+	TRACE_2("Empty Item",_unit,_item);
+	false
+};
+if !(isClass (__cfg >> _item)) exitWith
+{
+	TRACE_2("Item not exist in Config",_unit,_item);
+	false
+};
+if (typeName _count != "SCALAR") exitWith
+{
+	TRACE_3("Count is not a number",_unit,_item,_count);
+	false
+};
+_unit __action [_item, _count];
+TRACE_2("Success",_unit,_item);
+true
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_createCenter.sqf BASE_A2Free/x/cba/addons/common_fnc_createCenter.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_createCenter.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_createCenter.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,27 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_createCenter
+
+Description:
+	Selects center if it already exists, creates it if it doesn't yet.
+
+Parameters:
+	_side - [SIDE]
+
+Returns:
+	Center [Side]
+
+Examples:
+	(begin example)
+		_group = createGroup ([West] call CBA_fnc_createCenter);
+	(end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+private ["_center"];
+PARAMS_1(_side);
+// TODO: Add _side if already a unit exists on this side ? by trying to create one or otherwise
+if (_side in GVAR(centers)) then { _side } else { _center = createCenter _side; PUSH(GVAR(centers),_center); _center };
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_createMarker.sqf BASE_A2Free/x/cba/addons/common_fnc_createMarker.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_createMarker.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_createMarker.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,76 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_createMarker
+
+Description:
+	Creates a marker all at once.
+
+Parameters:
+	_markerName - Name of marker to create [String]
+	_position - [Array: [x, y]]
+	_shape - "Icon", "Rectangle" or "Elipse" [String]
+	_size - [Array: [width, height]]
+
+Optional Parameters:
+	"GLOBAL" - Add for a global marker, but leave out for a local marker.
+	"PERSIST" - Add for persisting global marker to JIP players. Implies "GLOBAL" when included.
+	"BRUSH:" - e.g. "Solid"
+	"COLOR:" - e.g. "ColorRed"
+	"TEXT:" - e.g. "Objective Area"
+	"TYPE:" - e.g. "Pickup"
+
+Returns:
+	Name of the marker [String]
+
+Examples:
+	(begin example)
+		// simple marker creation
+		_marker = ["markername", [positionX,positionY], "Rectangle", [sizeX, sizeY]] call CBA_fnc_createMarker;
+		// Color yellow
+		_marker = ["markername", [positionX,positionY], "Rectangle", [sizeX, sizeY], "COLOR:", "ColorYellow"] call CBA_fnc_createMarker;
+		// Global marker - will be visible to all players currently ingame
+		_marker = ["markername", [positionX,positionY], "Rectangle", [sizeX, sizeY], "COLOR:", "ColorYellow", "GLOBAL"] call CBA_fnc_createMarker;
+		// Global persistent marker - will be visible to all players currently ingame, and also to JIP players
+		_marker = ["markername", [positionX,positionY], "Rectangle", [sizeX, sizeY], "COLOR:", "ColorYellow", "PERSIST"] call CBA_fnc_createMarker;
+	(end)
+
+Author:
+	Sickboy (sb_at_dev-heaven.net) 6thSense.eu Mod
+---------------------------------------------------------------------------- */
+// #define DEBUG_MODE_FULL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(createMarker);
+
+private ["_m", "_br", "_ty", "_co", "_tx", "_persist", "_global"];
+
+_br = ["BRUSH:", "brush:", "", _this] call CBA_fnc_getArg;
+_ty = ["TYPE:", "type:", "", _this] call CBA_fnc_getArg;
+_co = ["COLOR:", "color:", "", _this] call CBA_fnc_getArg;
+_tx = ["TEXT:", "text:", "", _this] call CBA_fnc_getArg;
+_persist = "PERSIST" in _this;
+_global = "GLOBAL" in _this || _persist;
+TRACE_6("",_br,_ty,_co,_tx,_persist,_global);
+
+
+if (_global) then
+{
+	_m = createMarker [_this select 0, _this select 1];
+	_m setMarkerShape (_this select 2);
+	_m setMarkerSize (_this select 3);
+	if (_br!= "") then { _m setMarkerBrush _br };
+	if (_ty!= "") then { _m setMarkerType _ty };
+	if (_co!= "") then { _m setMarkerColor _co };
+	if (_tx!= "") then { _m setMarkerText _tx };
+	if (_persist) then { [_m, true] call CBA_fnc_setMarkerPersistent };
+} else {
+	_m = createMarkerLocal [_this select 0, _this select 1];
+	_m setMarkerShapeLocal (_this select 2);
+	_m setMarkerSizeLocal (_this select 3);
+	if (_br!= "") then { _m setMarkerBrushLocal _br };
+	if (_ty!= "") then { _m setMarkerTypeLocal _ty };
+	if (_co!= "") then { _m setMarkerColorLocal _co };
+	if (_tx!= "") then { _m setMarkerTextLocal _tx };
+};
+
+_m;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_createTrigger.sqf BASE_A2Free/x/cba/addons/common_fnc_createTrigger.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_createTrigger.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_createTrigger.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,62 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_createTrigger
+
+Description:
+	Create a trigger all at once.
+
+Parameters:
+	_pos - Position [Array]
+
+Optional Parameters:
+	"AREA:" - e.g. [5, 5, 0, false]
+	"ACT:" - e.g. ["CIV", "PRESENT", true]
+	"STATE:" - e.g. ["this", "hint 'Civilian near player'", "hint 'no civilian near'"]
+	"NAME:" - e.g. "VariableName"
+
+Returns:
+	Trigger and parameters given in an array: [_trigger, _parameters]
+
+Examples:
+	(begin example)
+		[_position] call createTrigger;
+
+		[_position, "AREA:", [5, 5, 0, false], "ACT:", ["CIV", "PRESENT", true]] call createTrigger;
+	(end)
+
+Author:
+	Sickboy (sb_at_dev-heaven.net)
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(createTrigger);
+
+/*
+	createTrigger function by
+
+*/
+
+private
+[
+	"_pos",
+	"_area",
+	"_activation",
+	"_name",
+	"_statements",
+	"_trg"
+];
+
+PARAMS_1(_pos);
+_area = ["AREA:", "area:", [],_this] call CBA_fnc_getArg;
+_activation = ["ACT:", "act:", [],_this] call CBA_fnc_getArg;
+_statements = ["STATE:", "state:", [],_this] call CBA_fnc_getArg;
+_name = ["NAME:", "name:", "", _this] call CBA_fnc_getArg;
+
+_trg = createTrigger["EmptyDetector", _pos];
+if (count _area>0) then { _trg setTriggerArea _area };
+if (count _activation>0) then { _trg setTriggerActivation _activation };
+if (count _statements>0) then { _trg setTriggerStatements _statements };
+if (_name != "") then { call compile format["%1 = _trg", _name] };
+
+[_trg, _this]
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_defaultParam.sqf BASE_A2Free/x/cba/addons/common_fnc_defaultParam.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_defaultParam.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_defaultParam.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,66 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_defaultParam
+
+Description:
+	Gets a value from parameters list (usually _this) with a default.
+
+Example (direct use of function):
+(begin code)
+	private "_frog";
+	_frog = [_this, 2, 12] call CBA_fnc_defaultParam;
+(end code)
+
+Example (macro):
+(begin code)
+	#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+	DEFAULT_PARAM(2,_frog,12);
+(end code)
+
+Parameters:
+	_params - Array of parameters, usually _this [Array]
+	_index - Parameter index in the params array [Integer: >= 0]
+	_defaultValue - Value to use if the array is too short [Any]
+
+Returns:
+	Value of parameter [Any]
+---------------------------------------------------------------------------- */
+#define DEBUG_MODE_NORMAL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(defaultParam);
+
+// -----------------------------------------------------------------------------
+PARAMS_3(_params,_index,_defaultValue);
+
+private "_value";
+
+if (not isNil "_defaultValue") then
+{
+	_value = _defaultValue;
+};
+
+if (not isNil "_params") then
+{
+	if ((typeName _params) == "ARRAY") then
+	{
+		if ((count _params) > (_index)) then
+		{
+			if (not isNil { _params select (_index) }) then
+			{
+				_value = _params select (_index);
+			};
+		};
+	};
+};
+
+// Return.
+if (isNil "_value") then
+{
+	nil;
+} else {
+	_value;
+};
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_deleteEntity.sqf BASE_A2Free/x/cba/addons/common_fnc_deleteEntity.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_deleteEntity.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_deleteEntity.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,49 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_deleteEntity
+
+Description:
+	A function used to delete entities
+Parameters:
+	Array, Object, Group or Marker
+Example:
+	[car1,car2,car3] call CBA_fnc_deleteEntity
+Returns:
+	Nothing
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+private "_typename";
+_typename = tolower (typename _this);
+
+switch (_typename) do {
+	case ("array") : {
+		{
+			_x call CBA_fnc_deleteentity;
+		} foreach _this;
+	};
+	case ("object") : {
+		if (vehicle _this != _this) then {
+			unassignvehicle _this;
+			_this setposasl [0,0,0];
+		} else {
+			if (count ((crew _this)-[_this]) > 0) then {
+				(crew _this) call CBA_fnc_deleteentity;
+			};
+		};
+		deletevehicle _this;
+	};
+	case ("group") : {
+		(units _this) call CBA_fnc_deleteentity;
+		{deletewaypoint _x} foreach (waypoints _this);
+		deletegroup _this;
+	};
+	case ("location") : {
+		deletelocation _this;
+	};
+	case ("string") : {
+		deletemarker _this
+	};
+	default {deletevehicle _this};
+};
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_determineMuzzles.sqf BASE_A2Free/x/cba/addons/common_fnc_determineMuzzles.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_determineMuzzles.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_determineMuzzles.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,42 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_determineMuzzles
+
+Description:
+	Gets the list of possible muzzles for a weapon.
+
+Parameters:
+	_weap - name of the weapon to examine [String]
+
+Returns:
+	- array of muzzle names if the weapon has muzzles and the first
+	  muzzle is not "this"
+	- nil (nothing) otherwise
+
+Examples:
+	(begin example)
+	_muzzles = "M4A1_RCO_GL" call CBA_fnc_determineMuzzles
+	// _muzzles = ["M4_ACOG_Muzzle", "M203Muzzle"]
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(determineMuzzles);
+PARAMS_1(_weap);
+#define __cfg configFile >> "CfgWeapons" >> _weap
+
+private ["_r"];
+_r = [_weap];
+if (isArray(__cfg >> "muzzles")) then
+{
+	_ar = getArray(__cfg >> "muzzles");
+	if (count _ar == 0) exitWith {};
+	if ((_ar select 0) == "this") exitWith {};
+	_r = _ar;
+};
+
+_r;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_dropMagazine.sqf BASE_A2Free/x/cba/addons/common_fnc_dropMagazine.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_dropMagazine.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_dropMagazine.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,88 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_dropMagazine
+
+Description:
+	Drop a magazine.
+
+	Function which verifies existence of _item and _unit, returns false in case
+	of trouble, or when able to remove _item from _unit true in case of success.
+
+Parameters:
+	_unit   - the unit that should drop a magazine [Object]
+	_item   - class name of the magazine to drop [String]
+
+Returns:
+	true if successful, false otherwise 
+
+Examples:
+	(begin example)
+	_result = [player, "SmokeShell"] call CBA_fnc_dropMagazine
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(dropMagazine);
+
+#define __scriptname fnc_dropMagazine
+
+#define __cfg (configFile >> "CfgMagazines")
+#define __action "DROPMAGAZINE"
+#define __ar (magazines _unit)
+
+private ["_unit", "_item", "_holder"];
+PARAMS_1(_unit);
+if (typeName _unit != "OBJECT") exitWith
+{
+	TRACE_2("Unit not Object",_unit,_item);
+	false
+};
+_item = _this select 1;
+if (typeName _item != "STRING") exitWith
+{
+	TRACE_2("Item not String",_unit,_item);
+	false
+};
+if (isNull _unit) exitWith
+{
+	TRACE_2("Unit isNull",_unit,_item);
+	false
+};
+if (_item == "") exitWith
+{
+	TRACE_2("Empty Item",_unit,_item);
+	false
+};
+if !(isClass (__cfg >> _item)) exitWith
+{
+	TRACE_2("Item not exist in Config",_unit,_item);
+	false
+};
+if !(_item in __ar) exitWith
+{
+	TRACE_2("Item not available on Unit",_unit,_item);
+	false
+};
+if (count _this > 2) then
+{
+	_holder = _this select 2;
+} else {
+	_holder = _unit;
+};
+if (typeName _holder != "OBJECT") exitWith
+{
+	TRACE_3("Holder not object",_unit,_item,_holder);
+	false
+};
+if (isNull _holder) exitWith
+{
+	TRACE_3("Holder isNull",_unit,_item,_holder);
+	false
+};
+_unit action [__action, _holder, _item];
+TRACE_3("Holder: %3 - Success",_unit,_item,_holder);
+true
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_dropWeapon.sqf BASE_A2Free/x/cba/addons/common_fnc_dropWeapon.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_dropWeapon.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_dropWeapon.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,88 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_dropWeapon
+
+Description:
+	Drops a weapon.
+
+	Function which verifies existence of _item and _unit, returns false in case
+	of trouble, or when able to remove _item from _unit true in case of success
+
+Parameters:
+	_unit   - the unit that should drop a magazine [Object]
+	_item   - class name of the weapon to drop [String]
+
+Returns:
+	true if successful, false otherwise
+Examples:
+	(begin example)
+	_result = [player, primaryWeapon player] call CBA_fnc_dropWeapon
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(dropWeapon);
+
+#define __scriptname fDropWeapon
+
+#define __cfg (configFile >> "CfgWeapons")
+#define __action "DROPWEAPON"
+#define __ar (weapons _unit)
+
+private ["_unit", "_item", "_holder"];
+PARAMS_1(_unit);
+if (typeName _unit != "OBJECT") exitWith
+{
+	TRACE_2("Unit not Object",_unit,_item);
+	false
+};
+_item = _this select 1;
+if (typeName _item != "STRING") exitWith
+{
+	TRACE_2("Item not String",_unit,_item);
+	false
+};
+if (isNull _unit) exitWith
+{
+	TRACE_2("Unit isNull",_unit,_item);
+	false
+};
+if (_item == "") exitWith
+{
+	TRACE_2("Empty Item",_unit,_item);
+	false
+};
+if !(isClass (__cfg >> _item)) exitWith
+{
+	TRACE_2("Item not exist in Config",_unit,_item);
+	false
+};
+if !(_item in __ar) exitWith
+{
+	TRACE_2("Item not available on Unit",_unit,_item);
+	false
+};
+if (count _this > 2) then
+{
+	_holder = _this select 2;
+} else {
+	_holder = _unit;
+};
+if (typeName _holder != "OBJECT") exitWith
+{
+	TRACE_3("Holder: %3 - Holder not object",_unit,_item,_holder);
+	false
+};
+if (isNull _holder) exitWith
+{
+	TRACE_3("Holder: %3 - Holder isNull",_unit,_item,_holder);
+	false
+};
+
+_unit action [__action, _holder, _item];
+TRACE_3("Holder: %3 - Success",_unit,_item,_holder);
+true
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_findEntity.sqf BASE_A2Free/x/cba/addons/common_fnc_findEntity.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_findEntity.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_findEntity.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,33 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_findEntity
+
+Description:
+	A function used to find out the first entity of parsed type in a nearEntitys call
+Parameters:
+	- Type (Classname, Object)
+	- Position (XYZ, Object, Location or Group)
+	Optional:
+	- Radius (Scalar)
+Example:
+	_veh = ["LaserTarget", player] call CBA_fnc_findEntity
+Returns:
+	First entity; nil return if nothing
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(findEntity);
+
+PARAMS_2(_type,_position);
+DEFAULT_PARAM(2,_radius,50);
+
+// this function doesn't return the nearest entity, neither did the previous version
+
+_ret = (_position call CBA_fnc_getpos) nearEntities [[_type], _radius];
+if (count _ret > 0) exitWith {_ret select 0};
+nil
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getAlive.sqf BASE_A2Free/x/cba/addons/common_fnc_getAlive.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getAlive.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getAlive.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,36 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getAlive
+
+Description:
+	A function used to find out who is alive in an array or a group.
+Parameters:
+	Array, Group or Unit
+Example:
+	_alive = (Units player) call CBA_fnc_getAlive
+Returns:
+	Array
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+private "_typename";
+_typename = tolower (typename _this);
+if (_typename == "object") exitwith {alive _this};
+
+private ["_return","_array"];
+_array = [];
+switch (_typename) do {
+	case ("group") : {
+		_array = units _this;
+	};
+	case ("array") :{
+		_array =+ _this;
+	};
+};
+{
+	if (alive _x) then {
+		_return set [count _return, _x];
+	}
+} foreach _array;
+_return
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getAnimType.sqf BASE_A2Free/x/cba/addons/common_fnc_getAnimType.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getAnimType.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getAnimType.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,91 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getAnimType
+
+Description:
+	Used to determine which weapon unit is currently holding and return proper
+	animation type.
+
+	Main types are for pistol, rifle and no weapon.
+
+Parameters:
+
+Returns:
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(getAnimType);
+
+private ["_man", "_array", "_anim", "_weapon", "_pos"];
+
+PARAMS_2(_man,_array);
+_anim = "";
+_weapon = format["%1", currentWeapon _man];
+_pos = "";
+
+if (_weapon != "") then {
+    _class = configFile >> "CfgWeapons" >> _weapon;
+
+    if (isClass _class) then {
+        _temp = "";
+        while { isClass _class && _temp == "" } do {
+			_temp = switch (configName _class) do {
+				case "RifleCore": {"rfl"};
+				case "LauncherCore": {"lnr"};
+				case "PistolCore": {"pst"};
+				default {""};
+			};
+            _class = inheritsFrom _class;
+        };
+        _weapon = _temp;
+    } else {
+        // If some unknown class used.
+        //_anim = _array select 0;
+        _weapon = "";
+    };
+};
+
+if (typeName (_array select 0) == "ARRAY") then {
+    _stance = (_man call CBA_fnc_getUnitAnim) select 0;
+	_pos = switch ( _stance ) do {
+		case "stand": {0};
+		case "kneel": {1};
+		case "prone": {2};
+		default {0};
+	};
+	private "_num";
+	_num = switch ( _weapon ) do {
+		case "rfl": {0};
+		case "lnr": {1};
+		case "pst": {2};
+		default {3};
+	};
+    _array = (_array select _num) select _pos;
+    _anim = _array call BIS_fnc_selectRandom;
+
+    if ( _anim == "") then { _anim = "AdthPercMstpSnonWnonDnon_1"; };
+} else {
+	private "_num";
+	_num = switch ( _weapon ) do {
+		case "rfl": {0};
+		case "lnr": {2};
+		case "pst": {1};
+		default {2};
+	};
+    _anim = _array select _num;
+    if ( _anim == "") then { _anim = "AmovPpneMstpSrasWrflDnon_healed"; };
+};
+
+// Debug
+TRACE_3("",_weapon,_pos,_anim);
+
+_anim
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getArg.sqf BASE_A2Free/x/cba/addons/common_fnc_getArg.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getArg.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getArg.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,28 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getArg
+
+Description:
+	Get default named argument from list.
+
+Parameters:
+
+Returns:
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Kronzky (www.kronzky.info)
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(getArg);
+
+private["_cLC", "_cUC", "_arg", "_list", "_a", "_v"];
+_cLC = _this select 0; _cUC = _this select 1; _arg = _this select 2; _list = _this select 3; _a = -1;
+{ _a = _a+1; _v = format["%1", _list select _a]; if ((_v == _cLC) || (_v == _cUC)) then { _arg = (_list select _a+1) } } foreach _list;
+_arg
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getAspectRatio.sqf BASE_A2Free/x/cba/addons/common_fnc_getAspectRatio.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getAspectRatio.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getAspectRatio.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,86 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getAspectRatio
+
+Description:
+	Used to determine the Aspect ratio of the screen.
+
+Parameters:
+	_output - string with one of ["ARRAY","NUMBER","STRING"]
+
+Returns:
+	array, string or number of screenratio i.e. [16,9] or "16:9" or 1.333 ..
+
+Examples:
+	(begin example)
+		_ratio = "STRING" call CBA_fnc_getAspectRatio;
+		_ratio = "ARRAY" call CBA_fnc_getAspectRatio;
+		_ratio = "NUMBER" call CBA_fnc_getAspectRatio;
+	(end)
+
+Author:
+  Deadfast @ Skypechat 090909, inspired and made CBA compliant by Vigilante
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(getAspectRatio);
+
+
+ private ["_output","_aspectStr","_aspectArr","_ratio","_return"];
+
+_output = toUpper (_this);
+
+_aspectStr = "";
+_aspectArr = [];
+_return = 0;
+
+_ratio = (round ((safeZoneW / safeZoneH) * 1000)) / 1000;
+switch (_ratio) do
+{
+	case 1:
+	{
+			_aspectStr = "4:3";
+			_aspectArr = [4,3];
+	};
+	case (1.333):
+	{
+			_aspectStr = "16:9";
+			_aspectArr = [16,9];
+	};
+	case (1.334):
+	{
+			_aspectStr = "16:9";
+			_aspectArr = [16,9];
+	};
+	case 1.2:
+	{
+			_aspectStr = "16:10";
+			_aspectArr = [16,10];
+	};
+	case 0.937:
+	{
+			_aspectStr = "5:4";
+			_aspectArr = [5,4];
+	};
+	case 0.938:
+	{
+			_aspectStr = "5:4";
+			_aspectArr = [5,4];
+	};
+	case 1.001:
+	{
+			_aspectStr = "12:3";
+			_aspectArr = [12,3];
+	};
+	default
+	{
+		hint str _ratio;
+	};
+};
+
+if(_output == "ARRAY") then {_return = _aspectArr;};
+if(_output == "STRING") then {_return = _aspectStr;};
+if(_output == "NUMBER") then {_return = _ratio;};
+
+_return;;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getConfigEntry.sqf BASE_A2Free/x/cba/addons/common_fnc_getConfigEntry.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getConfigEntry.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getConfigEntry.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,60 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getConfigEntry
+
+Description:
+	Gets a configuration entry.
+
+	Will check if _cfg exists, and will return either the config value, or
+	supplied default value.
+
+Parameters:
+	_configEntry - Entry to get value of [Config]
+	_entryType - "text", "number" or "array" [String]
+	_defaultValue - Value to return if config entry unavailable [Any]
+
+Returns:
+	Value found [String, Number or Array]
+
+Examples:
+	(begin example)
+		[configFile >> "CfgJellies" >> "Wobbliness", "number", 0] call _f
+	(end)
+
+Author:
+	Sickboy (sb_at_dev-heaven.net)
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(getConfigEntry);
+
+private ["_r"];
+switch (toLower(_this select 1)) do
+{
+	case "text":
+	{
+		if (isText (_this select 0)) then
+		{
+			_r = getText (_this select 0);
+		};
+	};
+	case "array":
+	{
+		if (isArray (_this select 0)) then
+		{
+			_r = getArray (_this select 0);
+		};
+	};
+	case "number":
+	{
+		if (isNumber (_this select 0)) then
+		{
+			_r = getNumber (_this select 0);
+		};
+	};
+};
+
+if (isNil "_r") then { _r = _this select 2 };
+
+_r
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getDistance.sqf BASE_A2Free/x/cba/addons/common_fnc_getDistance.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getDistance.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getDistance.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,17 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getDistance
+
+Description:
+	A function used to find out the distance between two positions.
+Parameters:
+	Array containing two of [Marker, Object, Location, Group or Position]
+Example:
+	_distance = [Player, [0,0,0]] call CBA_fnc_getDistance
+Returns:
+	Number - Distance in meters
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+((_this select 0) call CBA_fnc_getPos) distance ((_this select 1) call CBA_fnc_getPos)
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getFirer.sqf BASE_A2Free/x/cba/addons/common_fnc_getFirer.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getFirer.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getFirer.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,56 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getFirer
+
+Description:
+	A function used to find out which unit exactly fired (Replacement for gunner, on multi-turret vehicles).
+Parameters:
+	Vehicle that fired
+	Weapon that was used
+Example:
+	_unit = player call CBA_fnc_getFirer
+Returns:
+	Unit
+	Turretpath
+Author:
+	Rocko
+
+---------------------------------------------------------------------------- */
+
+// #define DEBUG_MODE_FULL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#define __cfg (configFile >> "CfgVehicles" >> (typeof _v) >> "turrets")
+private ["_tp", "_tc", "_tp", "_st", "_stc", "_wtp", "_tu", "_mainWeapons", "_r"];
+PARAMS_2(_v,_w);  // Vehicle that fired	// Weapon that was fired
+if (_v isKindOf "CAManBase") exitWith { _r = [_v, []]; TRACE_1("Result",_r); _r; }; // return the unit itself when it's a Man
+if (_v isKindOf "Air") exitWith { _gunney = gunner _v; _r = [if (isNull _gunney) then { driver _v } else { _gunney }, [0]]; TRACE_1("Result",_r); _r; };
+
+_tp = [];
+_tc  = count __cfg;
+if (_tc > 0) then {
+	for "_mti" from 0 to (_tc-1) do {
+		_tp set [(count _tp), [_mti]];
+		_st = (__cfg select _mti) >> "turrets";
+		_stc = count _st;
+		if (_stc > 0) then {
+			for "_sti" from 0 to (_stc-1) do {
+				_stp = (_st select _sti);
+				_tp set [(count _tp), [_mti,_sti]];
+			};
+		};
+	};
+};
+
+_wtp = [];
+{
+	_weapons = getArray([_v, _x] call CBA_fnc_getTurret >> "weapons");
+	TRACE_3("",_weapons,_x,_v turretUnit _x);
+	if (_w in _weapons) exitWith { _wtp = _x; };
+} foreach _tp;
+
+if (count _wtp == 0) exitWith { _r = [objNull, []]; TRACE_1("Result",_r); _r; }; // Or should we exit with gunner _v ?
+
+_r = [_v turretUnit _wtp, _wtp];
+TRACE_1("Result",_r);
+_r;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getFov.sqf BASE_A2Free/x/cba/addons/common_fnc_getFov.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getFov.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getFov.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,60 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getFov
+
+Description:
+	Get current camera's field of view in radians and zoom.
+	Fov is calculated in the same format as it is set up in configs and used by camSetFov and alike.
+	Precision is about 95%.
+
+Parameters:
+	(optional) base fov value corresponding to 1x zoom (to properly calculate current zoom), defaults to 0.33333
+
+Examples:
+	(begin example)
+		_fovarray = call CBA_fnc_getFov
+
+		_fovarray = 0.4 call CBA_fnc_getFov
+	(end)
+
+Returns:
+	Array [fov,zoom]
+
+Author:
+	q1184
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#define __dist 1
+
+private ["_xoff","_wreal","_pos","_pos2","_xpos","_xpos2","_deltax","_fov","_k"];
+
+_k = if (typename _this == "SCALAR") then {_this} else {0.33333};
+
+_wreal = safezonew/2;
+_xoff = -0.05*__dist;
+
+_pos = positioncameratoworld [0,0,__dist];
+_xpos = (worldtoscreen _pos) select 0;
+
+_pos2 = positioncameratoworld [_xoff,0,__dist];
+_xpos2 = worldtoscreen _pos2;
+
+while {count _xpos2 == 0 || _xoff > -0.001} do
+{
+	_xoff = _xoff/2;
+	_pos2 = positioncameratoworld [_xoff,0,__dist];
+	_xpos2 = worldtoscreen _pos2;
+};
+if (count _xpos2 == 0) exitwith {-1};
+
+_xpos2 = _xpos2 select 0;
+_deltax = _xpos - _xpos2;
+
+_fov = (safezoneh/safezonew)*atan((_wreal*abs(_xoff))/(__dist*_deltax));
+
+_fov = _fov*pi/180;
+
+[_fov,_k/_fov]
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getGroup.sqf BASE_A2Free/x/cba/addons/common_fnc_getGroup.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getGroup.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getGroup.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,18 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getGroup
+
+Description:
+	A function used to find out the group of an object.
+Parameters:
+	Group or Unit
+Example:
+	_group = player call CBA_fnc_getGroup
+Returns:
+	Group
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+if (tolower (typeName _this) == "group") exitwith {_this};
+group _this
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getGroupIndex.sqf BASE_A2Free/x/cba/addons/common_fnc_getGroupIndex.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getGroupIndex.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getGroupIndex.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,53 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getGroupIndex
+
+Description:
+	Finds out the actual ID number of a person within his group as assigned by
+	the game and used in the squad leader's command menu, not just the order
+	within the units of his group (this order can change due to players joining
+	and leaving the game, deaths or promotions).
+
+	Inspired by the OFP function, squadNumber.sqf, by General Barron
+	(http://www.ofpec.com/ed_depot/index_new.php?action=details&id=139&page=1&game=OFP&type=fu&cat=xyz)
+
+Parameters:
+	_man - Man to check [Object: "Man"]
+
+Returns:
+	Number of person in his group [Number: 1+]
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_strings.hpp"
+
+SCRIPT(getGroupIndex);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_1(_man);
+
+private ["_varName", "_manLabel", "_number", "_labelArray", "_groupLabelLen"];
+
+// Save and remove the person's varName, so that format doesn't just show that.
+_varName = vehicleVarName _man;
+_man setVehicleVarName "";
+
+_labelArray = toArray (str _man);
+_groupLabelLen = [str (group _man)] call CBA_fnc_strLen;
+_number = [];
+
+// Read in all digits after the group name and colon in the full player label.
+// Format of player label is "<groupName>:<groupNumber> <playerName>"
+for "_i" from (_groupLabelLen + 1) to ((count _labelArray) - 1) do
+{
+	if ((_labelArray select _i) == ASCII_SPACE) exitWith {};
+	PUSH(_number,_labelArray select _i);
+};
+
+// Go back to the original varName.
+_man setVehicleVarName _varName;
+
+parseNumber (toString _number); // Return.
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getNearest.sqf BASE_A2Free/x/cba/addons/common_fnc_getNearest.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getNearest.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getNearest.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,44 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getNearest
+
+Description:
+	A function used to find out the nearest entity parsed in an array to a position. Compares the distance between entity's in the parsed array.
+Parameters:
+	_position - Marker, Object, Location, Group or Position
+	_array - Array of [Marker, Object, Location, Group and or Positions]
+	_radius - Maximum distance from _position
+	_code - Condition to meet (Code)
+Example:
+	_nearestVeh = [player, vehicles] call CBA_fnc_getNearest
+	_nearestGroups = [[0,0,0], allGroups, 50, {count (units _x) > 1}] call CBA_fnc_getNearest
+Returns:
+	Nearest given entity or List of entities within given distance
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_2(_position,_array);
+
+DEFAULT_PARAM(2,_radius,10^5)
+DEFAULT_PARAM(3,_code,{true})
+
+private "_return";
+_return = if (count _this > 2) then {[]} else {objNull};
+{
+	_distance = [_position,_x] call CBA_fnc_getDistance;
+	if (_distance < _radius) then {
+		if !(call _code) exitwith {};
+		if (count _this > 2) then {
+			_return set [count _return, _x];
+		} else {
+			_radius = _distance;
+			_return = _x;
+		};
+	};
+} foreach _array;
+_return
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getNearestBuilding.sqf BASE_A2Free/x/cba/addons/common_fnc_getNearestBuilding.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getNearestBuilding.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getNearestBuilding.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,22 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getNearestBuilding
+
+Description:
+	A function used to find out the nearest building and appropriate building positions available.
+Parameters:
+	Object
+Example:
+	_array = player call CBA_fnc_getNearestBuilding
+Returns:
+	Array with [building object, building positions (count)]
+Author:
+	Rommel
+---------------------------------------------------------------------------- */
+
+private ["_building", "_i"];
+
+_building = nearestBuilding _this;
+_i = 0;
+
+while {str(_building buildingPos _i) != "[0,0,0]"} do {_i = _i + 1;};
+[_building, _i]
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getPistol.sqf BASE_A2Free/x/cba/addons/common_fnc_getPistol.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getPistol.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getPistol.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,54 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getPistol
+
+Description:
+	Returns name of pistol in unit's inventory, if any.
+
+Parameters:
+	_unit - Unit to check for a pistol in [Object]
+
+Returns:
+	Class name of pistol, if carried, otherwise "" [String]
+
+Examples:
+	(begin example)
+		_pistol = [player] call CBA_fnc_getPistol;
+		// => "", assuming that the player was not carrying any pistol.
+		// => "Makarov", assuming that the player was carrying a Makarov pistol.
+	(end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define PISTOL_TYPE 2
+
+SCRIPT(getPistol);
+
+private ["_pistol", "_unit"];
+_pistol = "";
+
+// Backwards compatibility (deprecated). Accept array or single value.
+if (IS_ARRAY(_this)) then
+{
+	_unit = _this select 0;
+} else {
+	_unit = _this;
+	WARNING("Expected [_unit], not _unit, passed to function. Unit was: " + str _unit);
+};
+
+if (_unit isKindOf "man") then
+{
+	{
+		if ((getNumber (configFile >> "CfgWeapons" >> _x >> "Type")) == PISTOL_TYPE) exitWith
+		{
+			_pistol = _x;
+		};
+	} forEach (weapons _unit);
+};
+
+_pistol;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getPos.sqf BASE_A2Free/x/cba/addons/common_fnc_getPos.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getPos.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getPos.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,38 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getPos
+
+Description:
+	A function used to get the position of an entity.
+Parameters:
+	Marker, Object, Location, Group or Position
+Example:
+	_position = (group player) call CBA_fnc_getPos
+Returns:
+	Position (AGL) - [X,Y,Z]
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+private "_typename";
+
+_typename = tolower (typename _this);
+
+switch (_typename) do {
+	case ("object") : {
+		getpos _this
+	};
+	case ("group") : {
+		getpos (leader _this)
+	};
+	case ("string") : {
+		getmarkerpos _this
+	};
+	case ("location") : {
+		position _this
+	};
+	case ("task") : {
+		taskdestination _this
+	};
+	default {_this};
+};
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getSharedGroup.sqf BASE_A2Free/x/cba/addons/common_fnc_getSharedGroup.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getSharedGroup.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getSharedGroup.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,47 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getSharedGroup
+
+Description:
+	Returns existing group on side, or newly created group when not existent.
+
+Parameters:
+	_side - Side to get group for [Side]
+
+Returns:
+	Group [Group]
+
+Examples:
+	(begin example)
+	(end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define SIDES [east, west, resistance, civilian, sideLogic]
+
+PARAMS_1(_side);
+
+private ["_group", "_idx", "_center"];
+_group = grpNull;
+_idx = SIDES find _side;
+if (_idx > - 1) then
+{
+	if (isNull (GVAR(groups) select _idx)) then
+	{
+		_center = [_side] call CBA_fnc_createCenter;
+		_group = createGroup _center;
+		GVAR(groups) set [_idx, _group];
+		// TODO: Evaluate if this doesn't mess things up when multiple clients are requesting groups
+		publicVariable QUOTE(GVAR(groups));
+	} else {
+		_group = GVAR(groups) select _idx;
+	};
+} else {
+	WARNING("Illegal side parameter!");
+};
+
+_group;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getTerrainProfile.sqf BASE_A2Free/x/cba/addons/common_fnc_getTerrainProfile.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getTerrainProfile.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getTerrainProfile.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,56 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getTerrainProfile
+
+Description:
+	A function used to find the terrain profile between two positions
+
+Parameters:
+	- Position A [Object, Location, Position, Marker or Group]
+	- Position B [Object, Location, Position, Marker or Group]
+	Optional:
+	- Resolution (in Metres)
+
+Returns:
+	Array containing [2D Distance, Angle, Terrain Profile (in format [Relative Altitude, 2D Distance from, 3D Distance from])
+
+Example:
+	[[0,0,0], [0,0,1000], 10] call CBA_fnc_getTerrainProfile
+
+Author:
+	Rommel && Noubernou
+
+---------------------------------------------------------------------------- */
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_2(_posA,_posB)
+_posA = _posA call CBA_fnc_getPos;
+_posB = _posB call CBA_fnc_getPos;
+_posA set [2,0]; _posB set [2,0];
+
+DEFAULT_PARAM(2,_resolution,10);
+
+private ["_angle", "_2Ddistance", "_return", "_z", "_adj", "_pos", "_alt"];
+_angle = [_posA, _posB] call BIS_fnc_dirTo;
+_2Ddistance = [_posA, _posB] call BIS_fnc_distance2D;
+
+_logic = "logic" createvehiclelocal _posA;
+_logic setposATL _posA;
+_z = (getposASL _logic) select 2;
+_return = [];
+
+for "_i" from 0 to (_2Ddistance / _resolution) do {
+	_adj = _resolution * _i;
+	_pos = [_posA, _adj, _angle] call BIS_fnc_relPos;
+	_logic setposATL _pos;
+	_alt = ((getposASL _logic) select 2) - _z;
+	_return set [_i,[_alt, _adj, _pos]];
+};
+_logic setposATL _posB;
+_alt = ((getposASL _logic) select 2) - _z;
+_return set [count _return,[_alt, _2Ddistance, _pos]];
+
+deletevehicle _logic;
+
+[_2Ddistance, _angle, _return]
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getTurret.sqf BASE_A2Free/x/cba/addons/common_fnc_getTurret.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getTurret.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getTurret.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,45 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getTurret
+
+Description:
+	A function used to find out which config turret is turretpath.
+Parameters:
+	Vehicle
+	Turretpath
+Example:
+	_config = [vehicle player, [0]] call CBA_fnc_getTurret
+Returns:
+	Turret Config entry
+Author:
+	Sickboy
+
+---------------------------------------------------------------------------- */
+
+// #define DEBUG_MODE_FULL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define __cfg (configFile >> "CfgVehicles" >> (typeof _v))
+private ["_path"];
+PARAMS_2(_v,_tp);
+_path = __cfg;
+
+if (count _tp > 0) then
+{
+	{
+		// First filter non classes
+		_turrets = (_path >> "turrets");
+		_turs = [];
+		for "_i" from 0 to (count _turrets) - 1 do
+		{
+			_y = _turrets select _i;
+			if (isClass(_y)) then { PUSH(_turs,_y) };
+		};
+		_path = (_turs select _x);
+
+	} forEach _tp;
+};
+
+TRACE_1("Result",_path);
+_path;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getUISize.sqf BASE_A2Free/x/cba/addons/common_fnc_getUISize.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getUISize.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getUISize.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,118 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getUISize
+
+Description:
+	Used to determine the UI size of the screen.
+
+Parameters:
+	_output - the desired output format, either "NUMBER" or "STRING".
+
+Returns:
+	If the desired output format is
+
+	"NUMBER" : an index into ["verysmall","small","normal","large"]
+	"STRING" : one of "verysmall", "small", "normal" or "large"
+
+	If an error occurs, the function returns either the number -1 or
+	the string "error", depending on the desired output format.
+
+Examples:
+	(begin example)
+		_uiSize = "STRING" call CBA_fnc_getUISize;
+	(end)
+
+Author:
+	Written by Deadfast and made CBA compliant by Vigilante
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(getUISize);
+
+
+ private ["_output", "_ratio", "_4to3", "_16to9", "_16to10", "_12to3", "_error", "_sizes", "_index", "_return"];
+
+_output = toUpper (_this);
+_ratio = "STRING" call CBA_fnc_getAspectRatio;
+
+_4to3 = [1.818, 1.429, 1.176, 1];
+_16to9 = [2.424, 1.905, 1.569, 1.333];
+_16to10 = [2.182, 1.714, 1.412, 1.2];
+_12to3 = [1.821, 1.430, 1.178, 1.001];
+_error = false;
+
+switch (_ratio) do
+{
+	case "4:3":
+	{
+		_sizes = _4to3;
+	};
+	case "5:4":
+	{
+		_sizes = _4to3;
+	};
+	case "16:9":
+	{
+		_sizes = _16to9;
+	};
+	case "16:10":
+	{
+		_sizes = _16to10;
+	};
+	case "12:3":
+	{
+		_sizes = _12to3;
+	};
+	default
+	{
+		_error = true;
+	};
+};
+
+if (!_error) then
+{
+	_index = _sizes find ((round (safeZoneW * 1000)) / 1000);
+	//hint str _index;
+	if (_index == -1) exitWith
+	{
+		_error = true;
+	};
+};
+
+if (_error) then
+{
+	if (_output == "STRING") then
+	{
+		_return = "error";
+	} else {
+		_return = -1;
+	};
+} else {
+	if (_output == "STRING") then
+	{
+		switch (_index) do
+		{
+			case 0:
+			{
+				_return = "verysmall";
+			};
+			case 1:
+			{
+				_return = "small";
+			};
+			case 2:
+			{
+				_return = "normal";
+			};
+			case 3:
+			{
+				_return = "large";
+			};
+		};
+	} else {
+		_return = _index;
+	};
+};
+
+_return;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getUnitAnim.sqf BASE_A2Free/x/cba/addons/common_fnc_getUnitAnim.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getUnitAnim.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getUnitAnim.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,70 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getUnitAnim
+
+Description:
+	Get information about a unit's stance and speed.
+
+Parameters:
+	_unit - get stance and movement mode for this unit
+
+Returns:
+	An array containing two strings, [ stance, speed ] where
+
+	- stance is one of "prone", "kneel" or "stand"
+	- speed is one of "stop", "slow", "normal" or "fast"
+
+Examples:
+	(begin example)
+	_result = player call CBA_fnc_getUnitAnim;
+
+	_stance = _result select 0;
+	_speed = _result select 1;
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(getUnitAnim);
+
+private ["_unit", "_anim", "_upos", "_umov", "_dthstr", "_posstr", "_movstr"];
+
+_unit = _this;
+_anim = toArray(toLower(animationState _unit));
+_upos = "unknown";
+_umov = "stop";
+
+if ((vehicle _unit) != _unit) then
+{
+	_upos = "vehicle";
+} else {
+	if (count(_anim)<12) exitWith {};
+	_dthstr = toString([_anim select 0, _anim select 1, _anim select 2, _anim select 3]);
+	_posstr = toString([_anim select 4, _anim select 5, _anim select 6, _anim select 7]);
+	_movstr = toString([_anim select 8, _anim select 9, _anim select 10, _anim select 11]);
+	if (_dthstr == "adth" || _dthstr == "slx_") then
+	{
+		_upos = "prone";
+	} else {
+		_upos = switch (_posstr) do
+		{
+			case "ppne": { "prone" };
+			case "pknl": { "kneel" };
+			case "perc": { "stand" };
+			default { "kneel" };
+		};
+	};
+	_umov = switch (_movstr) do
+	{
+		case "mstp": { "stop" };
+		case "mwlk": { "slow" };
+		case "mrun": { "normal" };
+		case "meva": { "fast" };
+		default { "stop" };
+	};
+};
+
+[_upos,_umov]
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getUnitDeathAnim.sqf BASE_A2Free/x/cba/addons/common_fnc_getUnitDeathAnim.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getUnitDeathAnim.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getUnitDeathAnim.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,50 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getUnitDeathAnim
+
+Description:
+	Get death animation for a unit.
+
+Parameters:
+	_unit - the unit to get the death animation for. [Object]
+
+Returns:
+	_deathAnim - the name of the animation. [String]
+
+Examples:
+	(begin example)
+	_anim = player call CBA_fnc_getUnitDeathAnim;
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(getUnitDeathAnim);
+
+private ["_unit", "_curAnim", "_deathAnim", "_deathAnimCfg"];
+_unit = _this;
+_deathAnim = "";
+_curAnim = (configFile >> "CfgMovesMaleSdr" >> "States" >> (animationState _unit));
+
+if (isText (_curAnim >> "actions")) then
+{
+	if ((vehicle _unit) == _unit) then
+	{
+		_deathAnimCfg = (configFile >> "CfgMovesBasic" >> "Actions" >> (getText (_curAnim >> "actions")) >> "die");
+		if (isText _deathAnimCfg) then
+		{
+			_deathAnim = getText _deathAnimCfg;
+		};
+	} else {
+		_deathAnimCfg = (configFile >> "CfgMovesMaleSdr" >> "States" >> (animationState _unit));
+		if (isArray (_deathAnimCfg >> "interpolateTo")) then
+		{
+			_deathAnim = getArray (_deathAnimCfg >> "interpolateTo") select 0;
+		};
+	};
+};
+
+_deathAnim
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_getVolume.sqf BASE_A2Free/x/cba/addons/common_fnc_getVolume.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_getVolume.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_getVolume.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,32 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_getVolume
+
+Description:
+	Return the volume of an object based on the object's model's bounding
+	box.
+
+Parameters:
+	_object - an object to calculate the volume of. [Object]
+
+Returns:
+	_volume - the volume. [Number]
+
+Examples:
+	(begin example)
+	_vol = _vehicle call CBA_fnc_getVolume
+	(end)
+
+Author:
+	Rommel
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_1(_object);
+
+private "_bounds";
+_bounds = (boundingBox _object) select 1;
+
+((_bounds select 0) * (_bounds select 1) * (_bounds select 2));
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_headDir.sqf BASE_A2Free/x/cba/addons/common_fnc_headDir.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_headDir.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_headDir.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,104 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_headDir
+
+Description:
+	Get the direction of a unit's head.
+
+	For anyone except the local player,	the head is assumed to be facing
+	straight forward.
+
+Parameters:
+	_unit - Unit to check [Object]
+	_object - Relative object/position to get direction to [Object or
+		Position Array, defaults to getting compass direction]
+
+Returns:
+	[<NUMBER>, <NUMBER>, <BOOL>, <BOOL>]
+		* Direction of unit head (for the local player, this is taken to be the
+			true head direction; for other players or AI, the value is just the
+		* Difference angle (negative or positive), e.g how many degrees turning
+			to center object horizontally
+		* True/False if given object is in field of view of player relative to
+			his head
+		* True/False if player is using 3rd person view
+
+Examples:
+	(begin example)
+		_data = [player] call CBA_fnc_headDir;
+		// => returns direction of head (freelook)
+
+		_data = [player, house1] call CBA_fnc_headDir;
+		// => returns direction of head, difference angle, if house is in fov
+		//    and if 3rd person is on or not
+
+		_data = [ai] call CBA_fnc_headDir;
+		// => returns the direction of ai (not head)
+
+		_data = [ai, getpos player] call CBA_fnc_headDir;
+		// => direction of ai, difference towards players pos, if player is in
+		//    fov of ai, and 3rd person off (default return)
+	(end)
+
+TODO:
+	Vertical angle.
+
+ImplementationNote:
+	positionCameraToWorld is only valid for player object, it is not handled for
+	other players or AI!! For these you can only check if its turned towards an
+	object, not looking at it.
+
+Author:
+	rocko
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(headDir);
+
+private["_azimuth", "_angle", "_dif", "_infov", "_threed", "_do"];
+
+PARAMS_1(_unit);
+DEFAULT_PARAM(1,_object,_unit);
+_threed = false;
+
+_do = (typeName _object != typeName _unit);
+if (!_do) then {
+	_do = (_object != _unit);
+};
+
+if (_do) then {
+	_angle = [(_unit call CBA_fnc_getpos),(_object call CBA_fnc_getpos)] call BIS_fnc_dirTo;
+} else {
+	_angle = 0;
+};
+if (_unit != player) then
+{
+	_azimuth = getdir _unit;
+} else {
+	private ["_position","_viewPos","_vector","_magnitude"];
+	_position = positionCameraToWorld [0, 0, 0];
+	_threed = if ((_position distance _unit)>2) then {true} else {false};
+	_viewPos = positionCameraToWorld [0, 0, 99999999];
+	_vector = [
+		(_viewPos select 0) - (_position select 0),
+		(_viewPos select 1) - (_position select 1),
+		(_viewPos select 2) - (_position select 2)
+	];
+	_magnitude = [0, 0, 0] distance _vector;
+	_vector = [
+		(_vector select 0) / _magnitude,
+		(_vector select 1) / _magnitude,
+		(_vector select 2) / _magnitude
+	];
+	_azimuth = (_vector select 0) atan2 (_vector select 1);
+	_azimuth = [_azimuth] call CBA_fnc_simplifyAngle;
+};
+
+_dif = _angle - _azimuth;
+
+if (_dif < 0) then { _dif = 360 + _dif;};
+if (_dif > 180) then { _dif = _dif - 360;};
+_infov = if (abs(_dif) < 43) then {true} else {false};
+
+[_azimuth,_dif,_infov,_threed]
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_inArea.sqf BASE_A2Free/x/cba/addons/common_fnc_inArea.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_inArea.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_inArea.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,99 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_inArea
+
+Description:
+	A function used to determine if a position is within a zone.
+
+	The "position" can be given as a marker name, an object,
+	location, group or a position array.
+
+	The zone is specificed either as a marker name or a trigger.
+
+Parameters:
+	A two-element array, [ position, zone], where
+
+	- position: Marker|Object|Location|Group|Position
+	- zone:     Marker|Trigger
+
+Example:
+	(begin example)
+	// Is the marker "playermarker" inside the "safezone" marker area?
+	_safe = [ "playermarker", "safezone"] call CBA_fnc_inArea;
+
+	// is the player within the safe zone marker area?
+	_pos = getPos player;
+	_safe = [ _pos, "safezone" ] call CBA_fnc_inArea;
+
+	// Deny artillery if target is inside the trigger area
+	if ([_target, cityTrigger] call CBA_fnc_inArea) then
+	{
+		// deny fire mission
+	}
+	else
+	{
+		// fire away!
+	};
+	(end)	
+
+Returns:
+	Boolean
+
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_2(_position,_zRef);
+
+_position = (_position call CBA_fnc_getpos);
+
+private ["_typename"];
+_typename = tolower (typename _zRef);
+
+private ["_zSize","_zDir","_zShape","_zPos"];
+switch (_typeName) do {
+	case ("string") : {
+		_zSize = markerSize _zRef;
+		_zDir = markerDir _zRef;
+		_zShape = tolower (markerShape _zRef);
+		_zPos = (_zRef call CBA_fnc_getpos);
+	};
+	case ("object") : {
+		_zSize = triggerArea _zRef;
+		_zDir = _zSize select 2;
+		_zShape = if (_zSize select 3) then {"rectangle"} else {"ellipse"};
+		_zPos = getpos _zRef;
+	};
+};
+
+if (isnil "_zSize") exitwith {false};
+
+_position = [_zPos,_position,_zDir] call CBA_fnc_vectRotate2D;
+
+private ["_x1","_y1"];
+_x1 = _zpos select 0;
+_y1 = _zpos select 1;
+
+private ["_x2","_y2"];
+_x2 = _position select 0;
+_y2 = _position select 1;
+
+private ["_dx","_dy"];
+_dx = _x2 - _x1;
+_dy = _y2 - _y1;
+
+private ["_zx","_zy"];
+_zx = _zsize select 0;
+_zy = _zsize select 1;
+
+switch (_zShape) do {
+	case ("ellipse") : {
+		((_dx^2)/(_zx^2) + (_dy^2)/(_zy^2)) < 1
+	};
+	case ("rectangle") : {
+		(abs _dx < _zx) and (abs _dy < _zy)
+	};
+};
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_inheritsFrom.sqf BASE_A2Free/x/cba/addons/common_fnc_inheritsFrom.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_inheritsFrom.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_inheritsFrom.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,45 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_inheritsFrom
+
+Description:
+	Checks whether a config entry inherits, directly or indirectly, from another
+	one.
+
+	For objects, it is probably simpler to use the *isKindOf* command.
+
+Parameters:
+	_config - Class to check if it is a descendent of _baseConfig [Config]
+	_baseConfig - Ancestor config class [Config]
+
+Returns:
+	true if _config is a decendent of _baseConfig [Boolean]
+
+Examples:
+	(begin example)
+		_rifle = configFile >> "CfgWeapons" >> "m16a4_acg_gl";
+		_baseRifle = configFile >> "CfgWeapons" >> "RifleCore";
+		_inherits = [_rifle, _baseRifle] call CBA_fnc_inheritsFrom;
+		// => true in this case, since all rifles are descended from RifleCore.
+	(end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(inheritsFrom);
+
+PARAMS_2(_config,_baseConfig);
+
+private "_valid";
+_valid = false;
+
+while { (configName _config) != "" } do
+{
+	_config = inheritsFrom _config;
+	if (_config == _baseConfig) exitWith { _valid = true };
+};
+
+_valid;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_isAlive.sqf BASE_A2Free/x/cba/addons/common_fnc_isAlive.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_isAlive.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_isAlive.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,38 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_isAlive
+
+Description:
+	A function used to find out if the group or object is alive.
+Parameters:
+	Array, Group or Unit
+Example:
+	_alive = (Units player) call CBA_fnc_getAlive
+Returns:
+	Boolean
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+private "_typename";
+_typename = tolower(typename _this);
+
+switch (_typename) do {
+	case ("array") : {
+		{
+			if (_x call CBA_fnc_isalive) exitwith {true};
+			false;
+		} foreach _this;
+	};
+	case ("object") : {
+		alive _this;
+	};
+	case ("group") : {
+		if (isnull (leader _this)) then {
+			false;
+		} else {
+			(units _this) call CBA_fnc_isalive;
+		};
+	};
+	default {alive _this};
+};
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_isTurnedOut.sqf BASE_A2Free/x/cba/addons/common_fnc_isTurnedOut.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_isTurnedOut.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_isTurnedOut.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,40 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_isTurnedOut
+
+Description:
+	Checks whether a unit is turned out in a vehicle or not.
+
+Parameters:
+	_unit - Unit to check [Object]
+
+Returns:
+	"true" for turned out or "false" for not turned out [Boolean]
+
+Examples:
+	(begin example)
+		if ( [player] call CBA_fnc_isTurnedOut ) then
+		{
+			player sideChat "I am turned out!";
+		};
+	(end)
+
+Author:
+	(c) rocko 2008, 2009
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(isTurnedOut);
+
+private["_unit", "_anim", "_count", "_out", "_ret"];
+PARAMS_1(_unit);
+_anim = toArray(toLower(animationState _unit));
+_count = (count _anim)-1;
+_out = toString([_anim select (_count-2),_anim select (_count-1),_anim select _count]);
+if(_out == "ep1") then {
+	_out = toString([_anim select (_count-6),_anim select (_count-5),_anim select (_count-4)]);
+};
+if (_out == "out") then { _ret = true; } else { _ret = false; };
+_ret
+
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_isUnitGetOutAnim.sqf BASE_A2Free/x/cba/addons/common_fnc_isUnitGetOutAnim.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_isUnitGetOutAnim.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_isUnitGetOutAnim.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,43 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_isUnitGetOutAnim
+
+Description:
+	Checks whether a unit is turned out in a vehicle or not.
+
+Parameters:
+	_unit - Unit to check [Object]
+
+Returns:
+	"true" for turned out or "false" for not turned out [Boolean]
+
+Examples:
+	(begin example)
+		if ( [player] call CBA_fnc_isTurnedOut ) then
+		{
+			player sideChat "I am turned out!";
+		};
+	(end)
+
+Author:
+	(c) Denisko-Redisko
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(isUnitGetOutAnim);
+PARAMS_1(_unit);
+private [
+    "_animationState",
+    "_moves",
+    "_actions",
+    "_getOutAction",
+    "_getOutState"
+];
+
+_animationState = animationState _unit;
+_moves = configFile >> getText ( configFile >> "CfgVehicles" >> typeof _unit >> "moves" );
+_actions = _moves >> "Actions" >> getText( _moves >> "States" >> _animationState >> "actions" );
+_getOutAction = getText( configFile >> "CfgVehicles" >> typeof vehicle _unit >> "getOutAction" );
+_getOutState = getText ( _actions >> _getOutAction );
+_animationState == _getOutState;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_mapDirTo.sqf BASE_A2Free/x/cba/addons/common_fnc_mapDirTo.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_mapDirTo.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_mapDirTo.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,42 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_mapDirTo
+
+Description:
+	Gets the direction between two map grid references.
+
+Parameters:
+	_pos1 - Origin position array in format [Easting, Northing] [Array]
+	_pos2 - End position in format [Easting, Northing] [Array]
+
+Returns:
+	Direction from _pos1 to _pos2 [Number]
+
+Examples:
+	(begin example)
+		_dir = [[024,015], [025,014]] call CBA_fnc_mapDirTo;
+		// _dir will be 45 degrees
+	(end)
+	(begin example)
+		_dir = [["024","015"], ["025","014"]] call CBA_fnc_mapDirTo;
+		// _dir will be 45 degrees
+	(end)
+	(begin example)
+		_dir = ["024015", "025014"] call CBA_fnc_mapDirTo;
+		// _dir will be 45 degrees
+	(end)
+
+
+Author:
+	Nou (with credit to Headspace for the real math :p)
+---------------------------------------------------------------------------- */
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(mapDirTo);
+
+PARAMS_2(_pos1,_pos2);
+_pos1 = _pos1 call CBA_fnc_mapGridToPos;
+_pos2 = _pos2 call CBA_fnc_mapGridToPos;
+
+(([_pos1,_pos2] call BIS_fnc_dirTo) + 360) mod 360;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_mapGridToPos.sqf BASE_A2Free/x/cba/addons/common_fnc_mapGridToPos.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_mapGridToPos.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_mapGridToPos.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,139 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_mapGridToPos
+
+Description:
+	Converts a 2, 4, 6, 8, or 10 digit grid reference into a Position.
+
+Parameters:
+	_pos - The position, either an array of strings for the northing & easting or a string.
+	_doOffSet - If true, return the center of the gridsquare, if false return upper left. Default false.
+
+Returns:
+	Position in internal gridspace.
+
+Examples:
+	(begin example)
+		_pos = ["024","015"] call CBA_fnc_mapGridToPos;
+	(end)
+	(begin example)
+		_pos = [["024","015"], true] call CBA_fnc_mapGridToPos;
+	(end)
+	(begin example)
+		_pos = "024015" call CBA_fnc_mapGridToPos;
+	(end)
+
+Author:
+	Nou
+---------------------------------------------------------------------------- */
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(mapGridToPos);
+
+private ["_pos", "_doOffset", "_posArray", "_ea", "_na", "_start", "_check",
+         "_minus", "_digits", "_maxNorthing", "_height", "_easting", "_northing",
+         "_eastingSize", "_northingSize", "_eastingMultiple", "_northingMultiple",
+         "_posX", "_posY", "_offset", "_return", "_reversed"];
+
+
+_doOffSet = false;
+_reversed = [] call CBA_fnc_northingReversed;
+_pos = [];
+if(IS_ARRAY(_this)) then {
+    if((count _this) > 1) then {
+        if(IS_BOOL(_this select 1)) then {
+            _pos = _this select 0;
+            _doOffSet = _this select 1;
+        } else {
+            _pos = _this;
+        };
+    } else {
+        if(IS_ARRAY(_this select 0)) then {
+            _pos = _this select 0;
+        } else {
+            _pos = _this;
+        };
+    };
+} else {
+    _pos = _this;
+};
+
+if(IS_STRING(_pos)) then {
+    _posArray = toArray _pos;
+    _pos = [];
+    _ea = [];
+    for "_i" from 0 to (((count _posArray)/2)-1) do {
+        _ea set [(count _ea), _posArray select _i];
+    };
+    _na = [];
+    for "_i" from (((count _posArray)/2)) to (((count _posArray))-1) do {
+        _na set [(count _na), _posArray select _i];
+    };
+    _pos set[0, (toString _ea)];
+    _pos set[1, (toString _na)];
+};
+
+/**
+ * Get extents of the Y Northing column for the map.
+ * This uses mapGridPosition to get the 6 digit coordinate
+ * at the bottom internal grid position, then it adds 1
+ * meter to the internal Y coordinate till mapGridPosition
+ * changes. This reveals the correct height in meters of the
+ * map.
+ */
+ if(_reversed) then {
+	_start = format["%1", mapGridPosition [0, 0]];
+	_check = _start;
+	_minus = 0;
+	while{_check == _start} do {
+		_check = format["%1", mapGridPosition [0, _minus]];
+		_minus = _minus - 1;
+	};
+
+	_digits = toArray _start;
+	_maxNorthing = parseNumber (toString [_digits select 3, _digits select 4, _digits select 5]);
+	_height = (_maxNorthing*100) - abs(_minus) + 1;
+};
+
+/**
+ * Do the math to get the right internal grid.
+ */
+_easting = _pos select 0;
+_northing = _pos select 1;
+
+if(IS_NUMBER(_easting)) then {
+    _easting = format["%1", _easting];
+};
+if(IS_NUMBER(_northing)) then {
+    _northing = format["%1", _northing];
+};
+
+_eastingSize = (count (toArray _easting)) min 5;
+_northingSize = (count (toArray _northing)) min 5;
+_eastingMultiple = (10^((10-(_eastingSize*2))/2));
+_northingMultiple = (10^((10-(_northingSize*2))/2));
+_posY = 0;
+if(_reversed) then {
+	_posY = (_height-((parseNumber _northing)*_northingMultiple))+100;
+} else {
+	_posY = ((parseNumber _northing)*_northingMultiple);
+};
+_posX = ((parseNumber _easting)*_eastingMultiple);
+
+/**
+ * Do we want the upper left corner of the grid square, or the center?
+ */
+_offset = 0;
+if(_doOffSet && (_northingMultiple max _eastingMultiple) > 1) then {
+    _offset = (_northingMultiple max _eastingMultiple)/2;
+};
+
+// Return position.
+_return = [];
+if(_reversed) then {
+	_return = [_posX+_offset, _posY-_offset, 0];
+} else {
+	_return = [_posX+_offset, _posY+_offset, 0];
+};
+_return
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_mapRelPos.sqf BASE_A2Free/x/cba/addons/common_fnc_mapRelPos.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_mapRelPos.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_mapRelPos.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,87 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_mapRelPos
+
+Description:
+	Find a position relative to a known position on the map. Passing strings
+	in for the Northing and Easting is the preferred way.
+
+Parameters:
+	_pos - Position in 10 digit grid format [Easting, Northing] [Array]
+	_dist - Distance from the starting position [Number]
+	_dir  - Direction from the starting position [Number]
+
+Returns:
+	New grid reference (10 digit) in format [Easting, Northing]
+
+Examples:
+	(begin example)
+		_endPos = [[024,015], 20, 45] call CBA_fnc_mapDirTo;
+	(end)
+	(begin example)
+		// preferred
+		_endPos = [["024","015"], 20, 45] call CBA_fnc_mapDirTo;
+	(end)
+Author:
+	Nou (with credit to Headspace, Rommel & Meat187 for the real math :p)
+---------------------------------------------------------------------------- */
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(mapRelPos);
+
+private ["_pos","_dist","_dir","_northing","_easting","_northingSize",
+         "_eastingSize","_e","_n","_posArray","_ea","_na","_reversed"];
+
+_pos  = _this select 0;
+_dist = _this select 1;
+_dir  = _this select 2;
+_reversed = [] call CBA_fnc_northingReversed;
+if(IS_STRING(_pos)) then {
+    _posArray = toArray _pos;
+    _pos = [];
+    _ea = [];
+    for "_i" from 0 to (((count _posArray)/2)-1) do {
+        _ea set [(count _ea), _posArray select _i];
+    };
+    _na = [];
+    for "_i" from (((count _posArray)/2)) to (((count _posArray))-1) do {
+        _na set [(count _na), _posArray select _i];
+    };
+    _pos set[0, (toString _ea)];
+    _pos set[1, (toString _na)];
+};
+
+_easting = _pos select 0;
+_northing = _pos select 1;
+
+if(IS_NUMBER(_easting)) then {
+    _easting = format["%1", _easting];
+};
+if(IS_NUMBER(_northing)) then {
+    _northing = format["%1", _northing];
+};
+
+_eastingSize = (count (toArray _easting)) min 5;
+_northingSize = (count (toArray _northing)) min 5;
+
+// Convert the numbers into 5 digits out of a 10 digit ref
+_e = (parseNumber _easting)*(10^((10-(_eastingSize*2))/2));
+_n = (parseNumber _northing)*(10^((10-(_northingSize*2))/2));
+
+_pos = [_e, _n];
+
+if(_reversed) then {
+	// flip the Y position into its negative value (to compensate for the northings
+	// going down)
+	_pos set [1, ((_pos select 1)*-1)];
+};
+
+//find position relative to passed position
+_pos = [floor ((_pos select 0) + _dist*sin _dir), floor ((_pos select 1) + _dist*cos _dir)];
+_pos set [1, ((_pos select 1)*-1)];
+
+_pos set [0, ([_pos select 0, 5] call CBA_fnc_formatNumber)];
+_pos set [1, ([_pos select 1, 5] call CBA_fnc_formatNumber)];
+
+_pos
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_modelHeadDir.sqf BASE_A2Free/x/cba/addons/common_fnc_modelHeadDir.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_modelHeadDir.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_modelHeadDir.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,76 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_modelHeadDir
+
+Description:
+	Get the direction of any unit's head.
+	
+	This can be used on any character model provided it has the "neck" and
+	"pilot" mem points defined in the model.
+
+Parameters:
+	_unit - Unit to check [Object]
+
+Returns:
+	[<NUMBER>, <NUMBER>, <NUMBER>]
+		* Direction of unit head
+		* Difference angle (negative or positive), e.g how many degrees turning
+			to center object horizontally
+		* Pitch of head (off of flat plane)
+
+Examples:
+	(begin example)
+		_data = [object] call CBA_fnc_headDir;
+		// => returns direction of objects head
+	(end)
+
+TODO:
+	Check for mem points.
+	Make sure that it doesn't throw an RPT error if executed pre-init/during init
+
+ImplementationNote:
+	Model must contain the needed mempoints for the calculations to work. This
+	should not be an issue for any ArmA2 models, but I can not guarantee it will
+	work on all models all the time. Until there is a way to test for that it
+	should be used with some caution and if you are getting invalid results
+	then revert to the older method of CBA_fnc_headDir.
+
+Author:
+	Nou
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(modelHeadDir);
+private["_modelLogics", "_pilotLogic", "_neckLogic", "_pilotPos", "_neckPos",
+	"_polar", "_pitch", "_abs", "_dif", "_world", "_return"];
+
+PARAMS_1(_unit);
+
+_return = [];
+
+if (_unit isKindOf "CAManBase" ) then {
+	_modelLogics = _unit getVariable [QUOTE(GVAR(modelLogics)), []];
+	if (count _modelLogics == 0) then {
+		_pilotLogic = "logic" createVehicleLocal (getPos _unit);
+		_pilotLogic attachTo [_unit, [0,0,0], "pilot"];
+		_neckLogic = "logic" createVehicleLocal (getPos _unit);
+		_neckLogic attachTo [_unit, [0,0,0], "neck"];
+		_modelLogics set[0, _pilotLogic];
+		_modelLogics set[1, _neckLogic];
+		_unit setVariable [QUOTE(GVAR(modelLogics)), _modelLogics];
+	};
+
+	_pilotPos = _unit worldToModel (getPosATL (_modelLogics select 0));
+	_neckPos = _unit worldToModel (getPosATL (_modelLogics select 1));
+	_polar = ([_neckPos, _pilotPos] call BIS_fnc_vectorFromXToY) call CBA_fnc_vect2polar;
+	_pitch = (_polar select 2) - 35; // Subtract 35 to compensate for mem point height dif
+	_abs = _polar select 1;
+	_dif = 0;
+
+	_dif = if (_abs > 180) then {_abs - 360} else {_abs};
+	_world = (getDir _unit) + _dif mod 360;
+	_return = [_world, _dif, _pitch];
+};
+
+_return;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_nearPlayer.sqf BASE_A2Free/x/cba/addons/common_fnc_nearPlayer.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_nearPlayer.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_nearPlayer.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,37 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_nearPlayer
+
+Description:
+	Check whether these are any players within a certain distance of a unit.
+
+Parameters:
+	_unit:       the unit to check the distance from. [Object]
+	_distance:   the desired distance. [Number]
+
+Returns:
+	Boolean - true if there are any players within the given
+                  distance of the unit, false if there aren't.
+
+
+Examples:
+	(begin example)
+	[unit, distance] call CBA_fnc_nearPlayer
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(nearPlayer);
+
+PARAMS_2(_unit,_distance);
+
+private "_position";
+_position = _unit call CBA_fnc_getpos;
+{
+	if ((_position distance _x) < _distance) exitWith { true };
+	false;
+} forEach ([] call CBA_fnc_players);
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_northingReversed.sqf BASE_A2Free/x/cba/addons/common_fnc_northingReversed.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_northingReversed.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_northingReversed.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,30 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_northingReversed
+
+Description:
+	Checks if the maps northing is reversed (like Chernarus & Utes, or any map pre-OA)
+
+Parameters:
+	None
+
+Returns:
+	_reversed - Bool, true if its reversed, false if it is not.
+
+Examples:
+	(begin example)
+		_reversed = [] call CBA_fnc_northingReversed
+	(end)
+
+Author:
+	Nou
+
+---------------------------------------------------------------------------- */
+
+private ["_test", "_reversed"];
+_test = getNumber (configFile >> "CfgWorlds" >> worldName >> "Grid" >> "Zoom1" >> "stepY");
+_reversed = false;
+if(_test > 0) then {
+	_reversed = true;
+};
+
+_reversed
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_objectRandom.sqf BASE_A2Free/x/cba/addons/common_fnc_objectRandom.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_objectRandom.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_objectRandom.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,44 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_objectRandom
+
+Description:
+	Creates a "random" number 0-9 based on an object's velocity
+
+Parameters:
+	_o - an object to base the random number on. [Object]
+
+Returns:
+	A number between 0 and 9.
+
+Examples:
+	(begin example)
+	_random = _helicopter call CBA_fnc_objectRandom;
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(objectRandom);
+
+private["_o", "_r", "_v", "_s", "_a", "_b", "_c"];
+PARAMS_1(_o);
+_r = 0;
+if!(isNull _o) then
+{
+	_v = velocity(vehicle _o);
+	_s = sqrt((_v select 0)^2+(_v select 1)^2+(_v select 2)^2);
+	if (_s>0) then
+	{
+		_a = acos((_v select 0)/_s); _b = acos((_v select 1)/_s); _c = acos((_v select 2)/_s);
+		_r = (_a+_b+_c)%10;
+		_r = _r-(_r%1);
+	} else {
+		_r = (getDir _o)%10;
+		_r = _r-(_r%1);
+	};
+};
+_r
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_parseYAML.sqf BASE_A2Free/x/cba/addons/common_fnc_parseYAML.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_parseYAML.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_parseYAML.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,360 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_parseYAML
+
+Description:
+	Parses a YAML file into a nested array/Hash structure.
+
+	See also: <CBA_fnc_dataPath>
+
+Parameters:
+	_file - Name of Yaml formatted file to parse [String].
+
+Returns:
+	Data structure taken from the file, or nil if file had syntax errors.
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_strings.hpp"
+
+#define YAML_MODE_STRING 0
+#define YAML_MODE_ASSOC_KEY 1
+#define YAML_MODE_ASSOC_VALUE 2
+#define YAML_MODE_ARRAY 3
+
+#define YAML_TYPE_UNKNOWN 0
+#define YAML_TYPE_SCALAR 1
+#define YAML_TYPE_ARRAY 2
+#define YAML_TYPE_ASSOC 3
+
+#define ASCII_YAML_COMMENT ASCII_HASH
+#define ASCII_YAML_ASSOC ASCII_COLON
+#define ASCII_YAML_ARRAY ASCII_MINUS
+
+SCRIPT(parseYAML);
+
+// -----------------------------------------------------------------------------
+
+private "_raiseError";
+_raiseError =
+{
+	PARAMS_4(_message,_yaml,_pos,_lines);
+
+	private ["_errorBlock", "_i", "_lastLine", "_lastChar"];
+
+	_lastLine = _lines select ((count _lines) - 1);
+	_lastChar = _lastLine select ((count _lastLine) - 1);
+	_lastLine resize ((count _lastLine) - 1);
+
+	PUSH(_lastLine,ASCII_VERTICAL_BAR);
+	PUSH(_lastLine,ASCII_HASH);
+	PUSH(_lastLine,ASCII_VERTICAL_BAR);
+	PUSH(_lastLine,_lastChar);
+
+	_pos = _pos + 1;
+	while { _pos < (count _yaml) } do
+	{
+		_char = _yaml select _pos;
+
+		if (_char in [ASCII_YAML_COMMENT, ASCII_CR, ASCII_NEWLINE]) exitWith {};
+
+		PUSH(_lastLine,_char);
+
+		_pos = _pos + 1;
+	};
+
+	_errorBlock = "";
+	for [{ _i = 0 max ((count _lines) - 6) }, { _i < (count _lines)}, { _i = _i + 1 }] do
+	{
+		_errorBlock = _errorBlock + format ["\n%1: %2", [_i + 1, 3] call CBA_fnc_formatNumber,
+			toString (_lines select _i)];
+	};
+
+	_message = format ["%1, in ""%2"" at line %3:\n%4", _message,
+		_file, count _lines, _errorBlock];
+
+	ERROR_WITH_TITLE("CBA YAML parser error",_message);
+};
+
+private "_parse";
+_parse =
+{
+	PARAMS_4(_yaml,_pos,_indent,_lines);
+
+	private ["_error", "_currentIndent", "_key", "_value", "_return",
+		"_mode", "_dataType", "_data"];
+
+	_error = false;
+	_currentIndent = _indent max 0;
+	_key = [];
+	_value = [];
+	_return = false;
+	_mode = YAML_MODE_STRING;
+	_dataType = YAML_TYPE_UNKNOWN;
+	// _data is initially undefined.
+
+	//TRACE_3("Parsing YAML data item",_currentIndent,_pos,count _lines);
+
+	while { (_pos < ((count _yaml) - 1)) and (not _error) and (not _return) } do
+	{
+		_pos = _pos + 1;
+		_char = _yaml select _pos;
+
+		if (_char == ASCII_YAML_COMMENT) then
+		{
+			// Trim comments.
+			while { not (_char in _lineBreaks) } do
+			{
+				_pos = _pos + 1;
+				_char = _yaml select _pos;
+			};
+
+			_pos = _pos - 1; // Parse the newline normally.
+		} else {
+			if (_char in _lineBreaks) then
+			{
+				_currentIndent = 0;
+				PUSH(_lines,[]);
+			} else {
+				PUSH(_lines select ((count _lines) - 1), _char);
+			};
+
+			switch (_mode) do
+			{
+				case YAML_MODE_ARRAY:
+				{
+					if (_char in _lineBreaks) then
+					{
+						_value = [toString _value] call CBA_fnc_trim;
+
+						// If remainder of line is blank, assume
+						// multi-line data.
+						if (([_value] call CBA_fnc_strLen) == 0) then
+						{
+							private ["_retVal"];
+
+							_retVal = ([_yaml, _pos, _currentIndent, _lines] call _parse);
+							_pos = _retVal select 0;
+							_value = _retVal select 1;
+							_error = _retVal select 2;
+						};
+
+						if (not _error) then
+						{
+							//TRACE_1("Added Array element",_value);
+							PUSH(_data,_value);
+							_mode = YAML_MODE_STRING;
+						};
+					} else {
+						PUSH(_value,_char);
+					};
+				};
+				case YAML_MODE_ASSOC_KEY:
+				{
+					if (_char in _lineBreaks) then
+					{
+						["Unexpected new-line, when expecting ':'",
+								_yaml, _pos, _lines] call _raiseError;
+							_error = true;
+					} else {
+						switch (_char) do
+						{
+							case ASCII_YAML_ASSOC:
+							{
+								_key = [toString _key] call CBA_fnc_trim;
+								_mode = YAML_MODE_ASSOC_VALUE;
+							};
+							default
+							{
+								PUSH(_key,_char);
+							};
+						};
+					};
+				};
+				case YAML_MODE_ASSOC_VALUE:
+				{
+					if (_char in _lineBreaks) then
+					{
+						_value = [toString _value] call CBA_fnc_trim;
+
+						// If remainder of line is blank, assume
+						// multi-line data.
+						if (([_value] call CBA_fnc_strLen) == 0) then
+						{
+							private ["_retVal"];
+
+							_retVal = ([_yaml, _pos, _currentIndent, _lines] call _parse);
+							_pos = _retVal select 0;
+							_value = _retVal select 1;
+							_error = _retVal select 2;
+						};
+
+						if (not _error) then
+						{
+							//TRACE_1("Added Hash element",_value);
+							[_data, _key, _value] call CBA_fnc_hashSet;
+							_mode = YAML_MODE_STRING;
+						};
+					} else {
+						PUSH(_value,_char);
+					};
+				};
+				case YAML_MODE_STRING:
+				{
+					switch (_char) do
+					{
+						case ASCII_CR:
+						{
+							// Already dealt with.
+						};
+						case ASCII_NEWLINE:
+						{
+							// Already dealt with.
+						};
+						case ASCII_SPACE:
+						{
+							_currentIndent = _currentIndent + 1;
+							//TRACE_2("Indented",_indent,_currentIndent);
+						};
+						case ASCII_TAB:
+						{
+							["Tab character not allowed for indenting YAML; use spaces instead",
+									_yaml, _pos, _lines] call _raiseError;
+							_error = true;
+						};
+						case ASCII_YAML_ASSOC:
+						{
+							["Can't start a line with ':'",
+								_yaml, _pos, _lines] call _raiseError;
+							_error = true;
+						};
+						case ASCII_YAML_ARRAY:
+						{
+							//TRACE_2("Array element found",_indent,_currentIndent);
+
+							if (_currentIndent > _indent) then
+							{
+								if (_dataType == YAML_TYPE_UNKNOWN) then
+								{
+									//TRACE_2("Starting new Array",count _lines,_indent);
+
+									_data = [];
+									_dataType = YAML_TYPE_ARRAY;
+
+									_indent = _currentIndent;
+
+									_value = [];
+									_mode = YAML_MODE_ARRAY;
+								} else {
+									//TRACE_2("BLAH",_indent,_currentIndent);
+									_error = true;
+								};
+							}
+							else{if (_currentIndent < _indent) then
+							{
+								// Ignore and pass down the stack.
+								//TRACE_2("End of Array",count _lines,_indent);
+								_pos = _pos - 1;
+								_return = true;
+							} else {
+								if (_dataType == YAML_TYPE_ARRAY) then
+								{
+									//TRACE_2("New element of Array",count _lines,_indent);
+									_value = [];
+									_mode = YAML_MODE_ARRAY;
+								} else {
+									//TRACE_3("BLEHH",_dataType,_indent,_currentIndent);
+									_error = true;
+								};
+							}; };
+						};
+						default // Anything else must be the start of an associative key.
+						{
+							if (_currentIndent > _indent) then
+							{
+								if (_dataType == YAML_TYPE_UNKNOWN) then
+								{
+									//TRACE_2("Starting new Hash",count _lines,_indent);
+
+									_data = [] call CBA_fnc_hashCreate;
+									_dataType = YAML_TYPE_ASSOC;
+
+									_indent = _currentIndent;
+
+									_key = [_char];
+									_value = [];
+									_mode = YAML_MODE_ASSOC_KEY;
+								} else {
+									//TRACE_3("BLAH",_dataType,_indent,_currentIndent);
+									_error = true;
+								};
+							}
+							else{if (_currentIndent < _indent) then
+							{
+								// Ignore and pass down the stack.
+								//TRACE_2("End of Hash",count _lines,_indent);
+								_pos = _pos - 1;
+								_return = true;
+							} else {
+								if (_dataType == YAML_TYPE_ASSOC) then
+								{
+									//TRACE_2("New element of Hash",count _lines,_indent);
+									_key = [_char];
+									_value = [];
+									_mode = YAML_MODE_ASSOC_KEY;
+								} else {
+									//TRACE_3("BLEH",_dataType,_indent,_currentIndent);
+									_error = true;
+								};
+							}; };
+						};
+					};
+				};
+			};
+		};
+	};
+
+	//TRACE_4("Parsed YAML data item",_indent,_pos,_error,count _lines);
+
+	[_pos, _data, _error]; // Return.
+};
+
+// ----------------------------------------------------------------------------
+
+PARAMS_1(_file);
+
+private ["_yamlString", "_yaml", "_outerData", "_lineBreaks"];
+_yamlString = loadFile _file;
+_yaml = toArray _yamlString;
+
+_lineBreaks = [ASCII_NEWLINE, ASCII_CR];
+
+//TRACE_2("Parsing YAML file",_file,count _yaml);
+
+// Ensure input ends with a newline.
+if (count _yaml > 0) then
+{
+	if (not ((_yaml select ((count _yaml) - 1)) in _lineBreaks)) then
+	{
+		PUSH(_yaml,ASCII_NEWLINE);
+	};
+};
+
+_pos = -1;
+
+_retVal = ([_yaml, _pos, -1, [[]]] call _parse);
+_pos = _retVal select 0;
+_value = _retVal select 1;
+_error = _retVal select 2;
+//TRACE_2("Parsed",_pos,_error);
+
+if (_error) then
+{
+	nil; // Return.
+} else {
+	_value; // Return.
+};
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_perFrameEngine.sqf BASE_A2Free/x/cba/addons/common_fnc_perFrameEngine.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_perFrameEngine.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_perFrameEngine.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,19 @@
+/* ----------------------------------------------------------------------------
+Internal Function: CBA_events_fnc_perFrameEngine
+
+THIS FUNCTION IS PRIVATE AND NOT FOR USER EXECUTION!
+
+This file creates two functions, one that executes every frame and is
+added to the map control, and the other which spawns up and monitors
+for a stoppage of the on frame handler (because alt-tabbing stops its
+execution).
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+// prepare our handlers list
+uiNamespace setVariable ["CBA_PFHIDD", (_this select 0)];
+((_this select 0) displayCtrl 40122) ctrlSetEventHandler ["Draw", QUOTE([_this] call FUNC(onFrame)) ];
+
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_players.sqf BASE_A2Free/x/cba/addons/common_fnc_players.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_players.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_players.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,48 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_players
+
+Description:
+	Get a list of current player objects.
+
+	In multi-player missions, returns list of human players, rather than all
+	playable units (playableUnits includes playable AI). Will include dead
+	player objects for players who are waiting to respawn.
+
+	In single-player missions, just returns an array containing the current
+	player object.
+
+	This command is similar to BIS_fnc_listPlayers. In fact, it is the same in
+	MP, but in SP it returns a result which is consistent to prevent the need
+	to handle things differently in different types of game
+	(BIS_fnc_listPlayers uses different criteria for the list in SP and MP).
+
+Parameters:
+	None.
+
+Returns:
+	List of player objects [Array of Objects].
+
+Examples:
+	(begin example)
+		_players = call CBA_fnc_players;
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(players);
+
+private "_return";
+
+_return = if (isMultiplayer) then
+{
+	[playableUnits, { isPlayer _x }] call BIS_fnc_conditionalSelect;
+} else {
+	[player];
+};
+
+_return;
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_randPos.sqf BASE_A2Free/x/cba/addons/common_fnc_randPos.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_randPos.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_randPos.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,23 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_randPos
+
+Description:
+	A function used to randomize a position around a given center
+Parameters:
+	Marker, Object, Location, Group or Position, Radius
+Example:
+	_position =  [position, radius] call CBA_fnc_randPos
+Returns:
+	Position - [X,Y,Z]
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+private ["_position","_radius"];
+_position = +((_this select 0) call CBA_fnc_getpos);
+_radius = _this select 1;
+
+_position set [0,(_position select 0) + (_radius - (random (2*_radius)))];
+_position set [1,(_position select 1) + (_radius - (random (2*_radius)))];
+_position
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_realHeight.sqf BASE_A2Free/x/cba/addons/common_fnc_realHeight.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_realHeight.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_realHeight.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,30 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_realHeight
+
+Description:
+	Real z coordinate of an object, for placing stuff on roofs, etc.
+
+Parameters:
+	_obj: an object [Object]
+
+Returns:
+	The z coordinate of the top of that object. [Number]
+
+Examples:
+	(begin example)
+	_height = _house call CBA_fnc_realHeight;
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(realHeight);
+
+private "_obj";
+PARAMS_1(_obj);
+
+((getpos _obj) select 2) + (_obj distance (getpos _obj))
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_removeMagazine.sqf BASE_A2Free/x/cba/addons/common_fnc_removeMagazine.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_removeMagazine.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_removeMagazine.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,72 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_removeMagazine
+
+Description:
+	Remove a magazine.
+
+	Function which verifies existence of _item and _unit, returns false in case
+	of trouble, or when able to remove _item from _unit true in case of success.
+
+Parameters:
+	_unit - the unit or vehicle
+	_item - name of the magazine to remove
+
+Returns:
+	true on success, false otherwise
+	
+Examples:
+	(begin example)
+	_result = [player, "SmokeShell"] call CBA_fnc_removeMagazine
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(removeMagazine);
+
+#define __scriptname fRemoveMagazine
+
+#define __cfg (configFile >> "CfgMagazines")
+#define __action removeMagazine
+#define __ar (magazines _unit)
+
+private ["_unit", "_item"];
+PARAMS_1(_unit);
+if (typeName _unit != "OBJECT") exitWith
+{
+	TRACE_2("Unit not Object",_unit,_item);
+	false
+};
+_item = _this select 1;
+if (typeName _item != "STRING") exitWith
+{
+	TRACE_2("Item not String",_unit,_item);
+	false
+};
+if (isNull _unit) exitWith
+{
+	TRACE_2("Unit isNull",_unit,_item);
+	false
+};
+if (_item == "") exitWith
+{
+	TRACE_2("Empty Item",_unit,_item);
+	false
+};
+if !(isClass (__cfg >> _item)) exitWith
+{
+	TRACE_2("Item not exist in Config",_unit,_item);
+	false
+};
+if !(_item in __ar) exitWith
+{
+	TRACE_2("Item not available on Unit",_unit,_item);
+	false
+};
+_unit __action _item;
+TRACE_2("Success",_unit,_item);
+true
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_removePerFrameHandler.sqf BASE_A2Free/x/cba/addons/common_fnc_removePerFrameHandler.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_removePerFrameHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_removePerFrameHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,31 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_removePerFrameHandler
+
+Description:
+	Remove a handler that you have added using CBA_fnc_addPerFrameHandler
+
+Parameters:
+	_handle - The function handle you wish to remove
+
+Returns:
+	_handle - a number representing the handle of the function. Use this to remove the handler.
+
+Examples:
+	(begin example)
+		_handle = [{player sideChat format["every frame! _this: %1", _this];}, 0, ["some","params",1,2,3]] call CBA_fnc_addPerFrameHandler;
+		sleep 10;
+		[_handle] call CBA_fnc_removePerFrameHandler;
+	(end)
+
+Author:
+	Nou & Jaynus, donated from ACRE project code for use by the community.
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_1(_handle);
+if (isNil "_handle") exitWith {}; // Nil handle, nil action
+GVAR(perFrameHandlerArray) set [_handle, nil];
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_removePlayerAction.sqf BASE_A2Free/x/cba/addons/common_fnc_removePlayerAction.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_removePlayerAction.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_removePlayerAction.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,53 @@
+/*
+Function: CBA_fnc_removePlayerAction
+
+Description:
+	Removes player action previously added with <CBA_fnc_addPlayerAction>.
+
+Parameters:
+	_actionIndex - Index of action to remove [Number]
+
+Returns:
+	True if removed. False if a dedicated server or where the action was not
+	defined [Boolean]
+
+Example:
+	(begin example)
+		actionIndex = [["Teleport", "teleport.sqf"]] call CBA_fnc_addPlayerAction;
+
+		// later
+
+		[actionIndex] call CBA_fnc_removePlayerAction;
+	(end)
+
+Author:
+	Sickboy
+
+*/
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_1(_actionIndex);
+TRACE_1(_this);
+
+private "_return";
+
+_return = if (isDedicated) then
+{
+	WARNING("Function ran on a dedicated server. Function only usable on a client. Index was: " + str _actionIndex);
+	false;
+} else {
+	if ([GVAR(actionList), _actionIndex] call CBA_fnc_hashHasKey) then
+	{
+		[GVAR(actionlist),_actionIndex, nil] call CBA_fnc_hashSet;
+		GVAR(actionListUpdated) = true;
+		true;
+	} else {
+		WARNING("Action was not persistent: " + str _actionIndex);
+		false;
+	};
+};
+
+_return;
+
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_removeWeapon.sqf BASE_A2Free/x/cba/addons/common_fnc_removeWeapon.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_removeWeapon.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_removeWeapon.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,72 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_removeWeapon
+
+Description:
+	Remove a weapon.
+
+	Function which verifies existence of _item and _unit, returns false in case
+	of trouble, or when able to remove _item from _unit true in case of success.
+
+Parameters:
+	_unit - the unit
+	_item - name of the weapon to remove
+
+Returns:
+	true on success, false otherwise
+	
+Examples:
+	(begin example)
+	_result = [player, "Binocular"] call CBA_fnc_removeWeapon
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(removeWeapon);
+
+#define __scriptname fRemoveWeapon
+
+#define __cfg (configFile >> "CfgWeapons")
+#define __action removeWeapon
+#define __ar (weapons _unit)
+
+private ["_unit", "_item"];
+PARAMS_1(_unit);
+if (typeName _unit != "OBJECT") exitWith
+{
+	TRACE_2("Unit not Object",_unit,_item);
+	false
+};
+_item = _this select 1;
+if (typeName _item != "STRING") exitWith
+{
+	TRACE_2("Item not String",_unit,_item);
+	false
+};
+if (isNull _unit) exitWith
+{
+	TRACE_2("Unit isNull",_unit,_item);
+	false
+};
+if (_item == "") exitWith
+{
+	TRACE_2("Empty Item",_unit,_item);
+	false
+};
+if !(isClass (__cfg >> _item)) exitWith
+{
+	TRACE_2("Item not exist in Config",_unit,_item);
+	false
+};
+if !(_item in __ar) exitWith
+{
+	TRACE_2("Item not available on Unit",_unit,_item);
+	false
+};
+_unit __action _item;
+TRACE_2("Success",_unit,_item);
+true
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_selectWeapon.sqf BASE_A2Free/x/cba/addons/common_fnc_selectWeapon.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_selectWeapon.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_selectWeapon.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,41 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_selectWeapon
+
+Description:
+	Selects weapon, if the player has the weapon, including correctly selecting a muzzle, if any.
+
+Parameters:
+	_unit - Unit object to perform function on [Object]
+	_weap - Weapon to select [String]
+
+Returns:
+	Success or Failed [Boolean]
+
+Examples:
+	(begin example)
+	_result = [player, secondaryWeapon player] call CBA_fnc_selectWeapon
+	(end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(selectWeapon);
+
+private ["_cfg", "_muz", "_ar"];
+PARAMS_2(_unit,_weap);
+_cfg = (configFile >> "CfgWeapons" >> _weap >> "muzzles");
+if (isArray _cfg) then
+{
+	_ar = getArray _cfg;
+	_muz = _ar select 0;
+	if (_muz == "this") then { _muz = _weap };
+} else {
+	_muz = _weap;
+};
+
+if (vehicle player != player) exitWith { false };
+if (player hasWeapon _weap) then { _unit selectWeapon _muz; true } else { false };
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_setHeight.sqf BASE_A2Free/x/cba/addons/common_fnc_setHeight.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_setHeight.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_setHeight.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,39 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_setHeight
+
+Description:
+	A function used to set the height of an object
+Parameters:
+	_object - Object or Location
+	_height - Height in metres
+	_type - Optional parameter, 0 is getpos, 1 is getpos ASL, 2 is getposATL (Default: 1)
+Example:
+	[this, 10] call CBA_fnc_setHeight
+Returns:
+	Nothing
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_2(_object,_height);
+DEFAULT_PARAM(2,_type,1);
+
+private "_position";
+_position = switch (_type) do {
+	case 0 : {getPos _object};
+	case 1 : {getPosASL _object};
+	case 2 : {getPosATL _object};
+};
+_position set [2, _height];
+
+switch (_type) do {
+	case 0 : {_object setPos _position};
+	case 1 : {_object setPosASL _position};
+	case 2 : {_object setPosATL _position};
+};
+_object setDir (getDir _object);
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_setPos.sqf BASE_A2Free/x/cba/addons/common_fnc_setPos.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_setPos.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_setPos.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,63 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_setPos
+
+Description:
+	A function used to set the position of an entity.
+Parameters:
+	Marker, Object, Location, Group or Position
+Example:
+	[player, "respawn_west"] call CBA_fnc_setPos
+Returns:
+	Nil
+Author:
+	Rommel
+
+---------------------------------------------------------------------------- */
+
+private ["_entity","_position","_radius"];
+_entity = _this select 0;
+_position = _this select 1;
+_radius = if (count _this > 2) then {_this select 2} else {0};
+
+private "_typename";
+_typename = tolower (typename _entity);
+_position = _position call CBA_fnc_getpos;
+
+if (_radius > 0) then {
+	_position = [_position, _radius] call CBA_fnc_randPos;
+};
+
+switch (_typename) do {
+	case ("object") : {
+		_entity setpos _position;
+	};
+	case ("group") : {
+		private ["_ldp","_dx","_dy","_dz"];
+		_ldp = getpos (leader _entity);
+		_dx = _position select 0;
+		_dy = _position select 1;
+		_dz = _position select 2;
+		{
+			private ["_txyz","_tx", "_ty", "_tz"];
+			_txyz = _x worldtomodel _ldp;
+			_tx = _dx + (_txyz select 0);
+			_ty = _dy + (_txyz select 1);
+			_tz = _dz + (_txyz select 2);
+			_x setpos [_tx,_ty,_tz];
+		} foreach (units _entity);
+	};
+	case ("string") : {
+		_entity setmarkerpos _position;
+	};
+	case ("location") : {
+		if (surfaceiswater _position) then {
+			_entity setPosition _position;
+		} else {
+			_entity setPosition _position;
+		};
+	};
+	case ("task") : {
+		_entity setsimpletaskdestination _position;
+	};
+	default {_entity setpos _position};
+};
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_switchPlayer.sqf BASE_A2Free/x/cba/addons/common_fnc_switchPlayer.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_switchPlayer.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_switchPlayer.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,96 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_switchPlayer
+
+Description:
+	Switch player to another unit.
+
+Parameters:
+	type:   The type of the new unit the player should switch to [String]
+	
+	Optional:
+	[type, "LEAVEWEPS"] - switch to new unit of the given type, but keep
+                              the weapons the player had before.
+
+
+	NOTE: the function must be spawned. It cannot be called.
+
+Returns:
+	nil
+
+Examples:
+	(begin example)
+	// Change into a M136 AT rifleman
+	_h = "USMC_Soldier_LAT" spawn CBA_fnc_switchPlayer;
+
+	// Switch into a corpsman, but keep the weapons
+	_h = ["USMC_Soldier_Medic", "LEAVEWEPS"] spawn CBA_fnc_switchPlayer;
+	(end)
+
+Author:
+
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(switchPlayer);
+
+private ["_type", "_ar", "_oldUnit", "_newUnit", "_dummyUnit", "_dummyGroup"];
+PARAMS_1(_type);
+_oldUnit = player;
+
+_ar = [weapons _oldUnit, magazines _oldUnit, rank _oldUnit, score _oldUnit, group _oldUnit, getPos _oldUnit, (leader _oldUnit) == _oldUnit, vehicleVarName _oldUnit];
+
+_dummyGroup = createGroup (side _oldUnit);
+if (isNull _dummyGroup) exitWith { hint "Sorry, something went wrong, dummyGroup is null" };
+_dummyUnit = (_ar select 4) createUnit [_type, [0, 0, 0], [], 0, "NONE"]; // Join in the old group incase there was only 1 member
+if (isNull _dummyUnit) exitWith { hint "Sorry, something went wrong, dummyUnit is null" };
+[_oldUnit] join _dummyGroup;
+
+hint format["1.Dummy created, State saved and put oldUnit in new group: %1", _dummyGroup];
+
+_newUnit = _dummyGroup createUnit [_type, _ar select 5, [], 0, "NONE"];
+
+if (isNull _newUnit) exitWith { hint "Sorry, something went wrong, newUnit is null" };
+
+hint format["2.New unit created, local: %1", local _newUnit];
+sleep 1;
+
+addSwitchableUnit _newUnit;
+selectPlayer _newUnit;
+
+_newUnit setRank (_ar select 2);
+_newUnit addScore (_ar select 3);
+
+hint format["3.State transfered, switched player control to new unit, local: %1", local _newUnit];
+sleep 1;
+if (_ar select 7 != "") then {
+	_newUnit setVehicleInit format["this setVehicleVarName '%1'; %1 = this", _ar select 7];
+	processInitCommands;
+};
+
+if ("LEAVEWEAPS" in _this) then
+{
+	sleep 1;
+} else {
+	removeAllWeapons _newUnit;
+	{ _newUnit addMagazine _x } forEach (_ar select 1);
+	{ _newUnit addWeapon _x } forEach (_ar select 0);
+};
+if ((primaryWeapon _newUnit) != "") then { [_newUnit, primaryWeapon _newUnit] call CBA_fnc_selectWeapon };
+
+hint "4.Weapons switched on new unit";
+sleep 1;
+
+[_newUnit] join (_ar select 4);
+//removeSwitchableUnit _newUnit;
+
+hint "5.New Unit joined in original group";
+sleep 1;
+
+{ deleteVehicle _x } forEach [_oldUnit, _dummyUnit]; // Might have to remote execute this to be successfull in MP
+
+hint "6.Deleted and moved away dummy units etc";
+sleep 1;
+
+if (_ar select 6) then { (group _newUnit) selectLeader _newUnit };
diff -rupN BASE_MISSION/x/cba/addons/common_fnc_systemChat.sqf BASE_A2Free/x/cba/addons/common_fnc_systemChat.sqf
--- BASE_MISSION/x/cba/addons/common_fnc_systemChat.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_fnc_systemChat.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,29 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_systemChat
+
+Description:
+	Display a message in the global chat channel.
+
+Parameters:
+	_message - the message to display [String]
+	
+Returns:
+	nothing
+	
+Examples:
+	(begin example)
+	"Hello, world!" call CBA_fnc_systemChat
+	(end)
+
+Author:
+	Killswitch
+---------------------------------------------------------------------------- */
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_1(_message);
+
+CBA_logic globalChat _message;
+
diff -rupN BASE_MISSION/x/cba/addons/common_init_actionmonitor.sqf BASE_A2Free/x/cba/addons/common_init_actionmonitor.sqf
--- BASE_MISSION/x/cba/addons/common_init_actionmonitor.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_init_actionmonitor.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,15 @@
+// #define DEBUG_MODE_FULL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+///////////////////////////////////////////////////////////
+// ArmA - actionmonitor.sqf v1.0 Original by BN880, converted by Sickboy (sb_at_dev-heaven.net), 6th Sense - Share the Spirit
+// THIS IS FOR PLAYER ACTIONS ONLY  CoC Bn880 11/2003
+///////////////////////////////////////////////////////////
+
+private ["_actionIndexes", "_veh"];
+
+GVAR(actionList) = [] call CBA_fnc_hashCreate;
+GVAR(actionListUpdated) = false; // Set true to force recreation of actions.
+GVAR(nextActionIndex) = 0; // Next index that will be given out.
+
diff -rupN BASE_MISSION/x/cba/addons/common_init_addons.sqf BASE_A2Free/x/cba/addons/common_init_addons.sqf
--- BASE_MISSION/x/cba/addons/common_init_addons.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_init_addons.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,29 @@
+// #define DEBUG_MODE_FULL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private ["_cfg", "_c", "_addons"];
+
+// Find and Count CfgPatches
+_cfg = (configFile >> "CfgPatches");
+_c = count _cfg;
+if (_c == 0) exitWith {
+	WARNING("Somehow No Addons found to Activate");
+};
+
+// Process all CfgPatches
+_addons = [];
+for "_i" from 0 to (_c - 1) do {
+	_entry = _cfg select _i;
+	if (isClass _entry) then {
+		PUSH(_addons,configName _entry);
+	};
+};
+
+// Activate all CfgPatches
+activateAddons _addons;
+TRACE_1("Activated",count _addons);
+
+CBA_common_addons = _addons;
+
diff -rupN BASE_MISSION/x/cba/addons/common_init_delayLess.sqf BASE_A2Free/x/cba/addons/common_init_delayLess.sqf
--- BASE_MISSION/x/cba/addons/common_init_delayLess.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_init_delayLess.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,30 @@
+// #define DEBUG_MODE_FULL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+// Generic twice-a-second loop instantiator(?)
+GVAR(d) = [];
+FUNC(addTriggerHandler) = {
+        private ["_c"];
+	// #include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+	// #define DEBUG_MODE_FULL
+	// [[_param1, _param2], { _param1 = _this select 0; _param2 = _this select 1; /* do stuff */}] call cba_fnc_addTriggerHandler;
+	_c = count GVAR(d);
+	GVAR(d) set [_c, _this];
+
+	// Create the trigger, only on first use
+	if (isNil QUOTE(GVAR(d_trigger))) then {
+		GVAR(d_trigger) = createTrigger["EmptyDetector", [0,0]];
+		GVAR(d_trigger) setTriggerActivation ["ANY", "PRESENT", true];
+		GVAR(d_trigger) setTriggerStatements["{ if (count _x == 2) then { (_x select 0) call (_x select 1) } } forEach cba_common_d", "", ""];
+	};
+	_c; // return index, so can either change array parameter count, or empty?
+};
+// TODO: Cleanup functions?
+
+// Specific twice-a-second loop
+// TODO: Should be a function that creates a trigger per loop, and uses onAct, onDeact, and removes the trigger on finish?
+
diff -rupN BASE_MISSION/x/cba/addons/common_init_functionsModule.sqf BASE_A2Free/x/cba/addons/common_init_functionsModule.sqf
--- BASE_MISSION/x/cba/addons/common_init_functionsModule.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_init_functionsModule.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,101 @@
+// Modified by Spooner for CBA in order to allow function initialisation
+// in preinit phase.
+
+// #define DEBUG_MODE_FULL
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+scriptName "CBA\common\init_functionsModule";
+
+private ["_recompile"];
+_recompile = (count _this) > 0;
+
+#ifdef DEBUG_MODE_FULL
+	_timeStart = diag_tickTime;
+	diag_log [diag_frameNo, diag_tickTime, time, "Initializing function module", _this];
+#endif
+
+
+//--- Functions are already running
+if (!isNil "BIS_fnc_init" && !_recompile) exitWith {};
+
+
+//-----------------------------------------------------------------------------
+//--- PREPROCESS --------------------------------------------------------------
+//-----------------------------------------------------------------------------
+
+//--- Create variables for all functions (and preprocess them after first call)
+for "_t" from 0 to 2 do {
+	_pathConfig = [configfile,campaignconfigfile,missionconfigfile] select _t;
+	_pathFile = ["ca\modules\functions","functions","functions"] select _t;
+
+	_cfgFunctions = (_pathConfig >> "cfgfunctions");
+	for "_c" from 0 to (count _cfgFunctions - 1) do {
+		_currentTag = _cfgFunctions select _c;
+
+		//--- Is Tag
+		if (isclass _currentTag) then {
+			_tagName = configname _currentTag;
+			_itemPathTag = gettext (_currentTag >> "file");
+
+			#ifdef DEBUG_MODE_FULL
+				diag_log [_tagName, _itemPathTag];
+			#endif
+
+			for "_i" from 0 to (count _currentTag - 1) do {
+				_currentCategory = _currentTag select _i;
+
+				//--- Is Category
+				if (isclass _currentCategory) then {
+
+					_categoryName = configname _currentCategory;
+					_itemPathCat = gettext (_currentCategory >> "file");
+					#ifdef DEBUG_MODE_FULL
+						diag_log [_categoryName,_itemPathCat];
+					#endif
+
+					for "_n" from 0 to (count _currentCategory - 1) do {
+						_currentItem = _currentCategory select _n;
+
+						//--- Is Item
+						if (isclass _currentItem) then {
+							_itemName = configname _currentItem;
+							_itemPathItem = gettext (_currentItem >> "file");
+							_itemPath = if (_itemPathItem != "") then {_itemPathItem} else {
+								if (_itemPathCat != "") then {_itemPathCat + "\fn_" + _itemName + ".sqf"} else {
+									if (_itemPathTag != "") then {_itemPathTag + "\fn_" + _itemName + ".sqf"} else {""};
+								};
+							};
+							_itemPath = if (_itemPath == "") then {_pathFile + "\" + _categoryName + "\fn_" + _itemName + ".sqf"} else {_itemPath};
+							#ifdef DEBUG_MODE_FULL
+								diag_log [_itemName,_itemPathItem,_itemPath];
+							#endif
+
+							_fn = format["%1_fnc_%2", _tagName, _itemName];
+							if (isNil _fn || _recompile) then {
+								missionNameSpace setVariable [_fn, compile preProcessFileLineNumbers _itemPath];
+								_fnPath = format["%1_path", _fn];
+								missionNameSpace setVariable [_fnPath, _itemPath];
+							};
+						};
+					};
+				};
+			};
+		};
+	};
+};
+
+private ["_test", "_test2"];
+_test = (_this select 0) setPos (position (_this select 0)); if (isnil "_test") then {_test = false};
+_test2 = (_this select 0) playMove ""; if (isnil "_test2") then {_test2 = false};
+if (_test || _test2) then {0 call (compile (preprocessFileLineNumbers "ca\modules\functions\misc\fn_initCounter.sqf"))};
+
+//--------------------------------------------------------------------------------------------------------
+//--- INIT COMPLETE --------------------------------------------------------------------------------------
+//--------------------------------------------------------------------------------------------------------
+
+#ifdef DEBUG_MODE_FULL
+	diag_log [diag_frameNo, diag_tickTime, time, diag_tickTime - _timeStart, "Function module done!"];
+#endif
+
diff -rupN BASE_MISSION/x/cba/addons/common_init_gauss.sqf BASE_A2Free/x/cba/addons/common_init_gauss.sqf
--- BASE_MISSION/x/cba/addons/common_init_gauss.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_init_gauss.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,124 @@
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+// Uses Gaussian random number generator for dispersion.
+// Adapted from gauss.c by Jochen Voss, at http://www.jstatsoft.org/v05/i08/
+// Brought to Arma by NWD
+// Used in generating normally distributed dispersion for tank shells,
+// canister pellets and unguided rockets.
+// Called once from AllVehicles init handler.
+
+if !(isNil "CBA_GAUSS_INIT") exitWith {};
+CBA_GAUSS_INIT = true;
+
+
+CBA_PARAM_R = 3.44428647676;
+
+/* tabulated values for the height of the Ziggurat levels */
+CBA_YTAB = [
+  1, 0.963598623011, 0.936280813353, 0.913041104253,
+  0.892278506696, 0.873239356919, 0.855496407634, 0.838778928349,
+  0.822902083699, 0.807732738234, 0.793171045519, 0.779139726505,
+  0.765577436082, 0.752434456248, 0.739669787677, 0.727249120285,
+  0.715143377413, 0.703327646455, 0.691780377035, 0.68048276891,
+  0.669418297233, 0.65857233912, 0.647931876189, 0.637485254896,
+  0.62722199145, 0.617132611532, 0.607208517467, 0.597441877296,
+  0.587825531465, 0.578352913803, 0.569017984198, 0.559815170911,
+  0.550739320877, 0.541785656682, 0.532949739145, 0.524227434628,
+  0.515614886373, 0.507108489253, 0.498704867478, 0.490400854812,
+  0.482193476986, 0.47407993601, 0.466057596125, 0.458123971214,
+  0.450276713467, 0.442513603171, 0.434832539473, 0.427231532022,
+  0.419708693379, 0.41226223212, 0.404890446548, 0.397591718955,
+  0.390364510382, 0.383207355816, 0.376118859788, 0.369097692334,
+  0.362142585282, 0.355252328834, 0.348425768415, 0.341661801776,
+  0.334959376311, 0.328317486588, 0.321735172063, 0.31521151497,
+  0.308745638367, 0.302336704338, 0.29598391232, 0.289686497571,
+  0.283443729739, 0.27725491156, 0.271119377649, 0.265036493387,
+  0.259005653912, 0.253026283183, 0.247097833139, 0.241219782932,
+  0.235391638239, 0.229612930649, 0.223883217122, 0.218202079518,
+  0.212569124201, 0.206983981709, 0.201446306496, 0.195955776745,
+  0.190512094256, 0.185114984406, 0.179764196185, 0.174459502324,
+  0.169200699492, 0.1639876086, 0.158820075195, 0.153697969964,
+  0.148621189348, 0.143589656295, 0.138603321143, 0.133662162669,
+  0.128766189309, 0.123915440582, 0.119109988745, 0.114349940703,
+  0.10963544023, 0.104966670533, 0.100343857232, 0.0957672718266,
+  0.0912372357329, 0.0867541250127, 0.082318375932, 0.0779304915295,
+  0.0735910494266, 0.0693007111742, 0.065060233529, 0.0608704821745,
+  0.056732448584, 0.05264727098, 0.0486162607163, 0.0446409359769,
+  0.0407230655415, 0.0368647267386, 0.0330683839378, 0.0293369977411,
+  0.0256741818288, 0.0220844372634, 0.0185735200577, 0.0151490552854,
+  0.0118216532614, 0.00860719483079, 0.00553245272614, 0.00265435214565
+];
+
+/* tabulated values for 2^24 times x[i]/x[i+1],
+ * used to accept for U*x[i+1]<= x[i] without any floating point operations */
+CBA_KTAB = [
+  0, 12590644, 14272653, 14988939,
+  15384584, 15635009, 15807561, 15933577,
+  16029594, 16105155, 16166147, 16216399,
+  16258508, 16294295, 16325078, 16351831,
+  16375291, 16396026, 16414479, 16431002,
+  16445880, 16459343, 16471578, 16482744,
+  16492970, 16502368, 16511031, 16519039,
+  16526459, 16533352, 16539769, 16545755,
+  16551348, 16556584, 16561493, 16566101,
+  16570433, 16574511, 16578353, 16581977,
+  16585398, 16588629, 16591685, 16594575,
+  16597311, 16599901, 16602354, 16604679,
+  16606881, 16608968, 16610945, 16612818,
+  16614592, 16616272, 16617861, 16619363,
+  16620782, 16622121, 16623383, 16624570,
+  16625685, 16626730, 16627708, 16628619,
+  16629465, 16630248, 16630969, 16631628,
+  16632228, 16632768, 16633248, 16633671,
+  16634034, 16634340, 16634586, 16634774,
+  16634903, 16634972, 16634980, 16634926,
+  16634810, 16634628, 16634381, 16634066,
+  16633680, 16633222, 16632688, 16632075,
+  16631380, 16630598, 16629726, 16628757,
+  16627686, 16626507, 16625212, 16623794,
+  16622243, 16620548, 16618698, 16616679,
+  16614476, 16612071, 16609444, 16606571,
+  16603425, 16599973, 16596178, 16591995,
+  16587369, 16582237, 16576520, 16570120,
+  16562917, 16554758, 16545450, 16534739,
+  16522287, 16507638, 16490152, 16468907,
+  16442518, 16408804, 16364095, 16301683,
+  16207738, 16047994, 15704248, 15472926
+];
+
+/* tabulated values of 2^{ -24 }*x[i] */
+CBA_WTAB = [
+  1.62318314817e-08, 2.16291505214e-08, 2.54246305087e-08, 2.84579525938e-08,
+  3.10340022482e-08, 3.33011726243e-08, 3.53439060345e-08, 3.72152672658e-08,
+  3.8950989572e-08, 4.05763964764e-08, 4.21101548915e-08, 4.35664624904e-08,
+  4.49563968336e-08, 4.62887864029e-08, 4.75707945735e-08, 4.88083237257e-08,
+  5.00063025384e-08, 5.11688950428e-08, 5.22996558616e-08, 5.34016475624e-08,
+  5.44775307871e-08, 5.55296344581e-08, 5.65600111659e-08, 5.75704813695e-08,
+  5.85626690412e-08, 5.95380306862e-08, 6.04978791776e-08, 6.14434034901e-08,
+  6.23756851626e-08, 6.32957121259e-08, 6.42043903937e-08, 6.51025540077e-08,
+  6.59909735447e-08, 6.68703634341e-08, 6.77413882848e-08, 6.8604668381e-08,
+  6.94607844804e-08, 7.03102820203e-08, 7.11536748229e-08, 7.1991448372e-08,
+  7.2824062723e-08, 7.36519550992e-08, 7.44755422158e-08, 7.52952223703e-08,
+  7.61113773308e-08, 7.69243740467e-08, 7.77345662086e-08, 7.85422956743e-08,
+  7.93478937793e-08, 8.01516825471e-08, 8.09539758128e-08, 8.17550802699e-08,
+  8.25552964535e-08, 8.33549196661e-08, 8.41542408569e-08, 8.49535474601e-08,
+  8.57531242006e-08, 8.65532538723e-08, 8.73542180955e-08, 8.8156298059e-08,
+  8.89597752521e-08, 8.97649321908e-08, 9.05720531451e-08, 9.138142487e-08,
+  9.21933373471e-08, 9.30080845407e-08, 9.38259651738e-08, 9.46472835298e-08,
+  9.54723502847e-08, 9.63014833769e-08, 9.71350089201e-08, 9.79732621669e-08,
+  9.88165885297e-08, 9.96653446693e-08, 1.00519899658e-07, 1.0138063623e-07,
+  1.02247952126e-07, 1.03122261554e-07, 1.04003996769e-07, 1.04893609795e-07,
+  1.05791574313e-07, 1.06698387725e-07, 1.07614573423e-07, 1.08540683296e-07,
+  1.09477300508e-07, 1.1042504257e-07, 1.11384564771e-07, 1.12356564007e-07,
+  1.13341783071e-07, 1.14341015475e-07, 1.15355110887e-07, 1.16384981291e-07,
+  1.17431607977e-07, 1.18496049514e-07, 1.19579450872e-07, 1.20683053909e-07,
+  1.21808209468e-07, 1.2295639141e-07, 1.24129212952e-07, 1.25328445797e-07,
+  1.26556042658e-07, 1.27814163916e-07, 1.29105209375e-07, 1.30431856341e-07,
+  1.31797105598e-07, 1.3320433736e-07, 1.34657379914e-07, 1.36160594606e-07,
+  1.37718982103e-07, 1.39338316679e-07, 1.41025317971e-07, 1.42787873535e-07,
+  1.44635331499e-07, 1.4657889173e-07, 1.48632138436e-07, 1.50811780719e-07,
+  1.53138707402e-07, 1.55639532047e-07, 1.58348931426e-07, 1.61313325908e-07,
+  1.64596952856e-07, 1.68292495203e-07, 1.72541128694e-07, 1.77574279496e-07,
+  1.83813550477e-07, 1.92166040885e-07, 2.05295471952e-07, 2.22600839893e-07
+];
diff -rupN BASE_MISSION/x/cba/addons/common_init_kron_strings.sqf BASE_A2Free/x/cba/addons/common_init_kron_strings.sqf
--- BASE_MISSION/x/cba/addons/common_init_kron_strings.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_init_kron_strings.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,406 @@
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+// =========================================================================================================
+//
+//  String Functions Library
+//  Version: 2.2.1
+//  Author: Kronzky
+//
+// =========================================================================================================
+//
+//  Usage:
+//
+//     KRON_StrToArray - Converts a string into an array of characters:
+//                        _array =[_str] call KRON_StrToArray
+//
+//     KRON_StrLen     - Returns the length of the string
+//                        _len =[_str] call KRON_StrLen
+//
+//     KRON_StrLeft    - Returns l characters from the left side of the string
+//                        _left =[_str,l] call KRON_StrLeft
+//
+//     KRON_StrRight   - Returns l characters from the right side of the string
+//                        _right =[_str,l] call KRON_StrRight
+//
+//     KRON_StrMid     - Returns l characters from the string, starting at position p (zero-based)
+//                        If l is not defined, the rest of the string is returned
+//                        _mid =[_str,p,(l)] call KRON_StrMid
+//
+//     KRON_StrInStr   - Tests whether string b is present in string a
+//                        _found =[a,b] call KRON_StrInStr
+//
+//     KRON_StrIndex   - Returns the position of string b in string a
+//                        _index =[a,b] call KRON_StrIndex
+//
+//     KRON_StrUpper   - Converts a string to uppercase characters
+//                        _upper =[_str] call KRON_StrUpper
+//
+//     KRON_StrLower   - Converts a string to lowercase characters
+//                        _lower =[_str] call KRON_StrLower
+//
+//     KRON_Replace    - Replaces every occurrence of string _old in string _str with string _new
+//                        _index =[_str,_old,_new] call KRON_Replace
+//
+//     KRON_FindFlag   - Checks a mixed array (_this) for the presence of a string (_str)
+//                        _flg =[_this,_str] call KRON_FindFlag
+//
+//     KRON_getArg     - Searches a mixed array (_this) for a matching string beginning with (_t), and returns the part after a separator (s)
+//                        A default value can be defined as (_d).
+//                        _arg =[_this,_t,(_d)] call KRON_getArg
+//
+//     KRON_getArgRev  - Works like getArg, but search for the part *after* the colon, and return the part in front of it
+//                        A default value can be defined as (_d).
+//                        _arg =[_this,_t,(_d)] call KRON_getArgRev
+//
+//     KRON_Compare    - Compares two elements and returns -1 if first is smaller, 1 if second is smaller, and 0 if equal
+//                        If optional parameter "case" is given, capitalization is considered (upper before lowercase)
+//                        _cmp =[_str1,_str2,("case")] call KRON_Compare
+//
+//     KRON_ArraySort  - Sorts an array of strings in acsending order (Numbers before letters, uppercase before lowercase)
+//                        If array is multi-dimensional, optional parameter (_idx) specifies which column is used for sorting
+//                        If optional parameter "desc" is given, order is reversed
+//                        If optional parameter "case" is given, capitalization is considered (upper before lowercase)
+//                        _srt =[_arr,(_idx),("desc"),("case")] call KRON_ArraySort
+//
+// =========================================================================================================
+
+/*
+KRON_StrToArray = {
+	private["_in", "_i", "_arr", "_out"];
+	_in = _this select 0;
+	_arr = toArray(_in);
+	_out =[];
+	for "_i" from 0 to (count _arr)-1 do
+	{
+		_out = _out+[toString([_arr select _i])];
+	};
+	_out
+};
+*/
+
+KRON_StrLeft = {
+	private["_in", "_len", "_arr", "_out"];
+	_in = _this select 0;
+	_len =(_this select 1)-1;
+	_arr =[_in] call KRON_StrToArray;
+	_out ="";
+	if (_len>=(count _arr)) then
+	{
+		_out = _in;
+	} else {
+		for "_i" from 0 to _len do
+		{
+			_out = _out + (_arr select _i);
+		};
+	};
+	_out
+};
+
+/*
+KRON_StrLen = {
+	private["_in", "_arr", "_len"];
+	_in = _this select 0;
+	_arr =[_in] call KRON_StrToArray;
+	_len = count (_arr);
+	_len
+};
+*/
+
+KRON_StrRight = {
+	private["_in", "_len", "_arr", "_i", "_out"];
+	_in = _this select 0;
+	_len = _this select 1;
+	_arr =[_in] call KRON_StrToArray;
+	_out ="";
+	if (_len>(count _arr)) then { _len = count _arr };
+	for "_i" from ((count _arr)-_len) to ((count _arr)-1) do
+	{
+		_out = _out + (_arr select _i);
+	};
+ _out
+};
+
+KRON_StrMid = {
+	private["_in", "_pos", "_len", "_arr", "_i", "_out"];
+	_in = _this select 0;
+	_pos = abs(_this select 1);
+	_arr =[_in] call KRON_StrToArray;
+	_len = count(_arr);
+	if ((count _this)>2) then { _len =(_this select 2)};
+	_out ="";
+	if ((_pos+_len)>=(count _arr)) then { _len =(count _arr)-_pos };
+	if (_len>0) then
+	{
+		for "_i" from _pos to (_pos+_len-1) do
+		{
+			_out = _out + (_arr select _i);
+		};
+	};
+	_out
+};
+
+/*
+KRON_StrIndex = {
+	private["_hay", "_ndl", "_lh", "_ln", "_arr", "_tmp", "_i", "_j", "_out"];
+	_hay = _this select 0;
+	_ndl = _this select 1;
+	_out =-1;
+	_i = 0;
+	if (_hay == _ndl) exitWith { 0 };
+	_lh =[_hay] call KRON_StrLen;
+	_ln =[_ndl] call KRON_StrLen;
+	if (_lh < _ln) exitWith {-1 };
+	_arr =[_hay] call KRON_StrToArray;
+	for "_i" from 0 to (_lh-_ln) do
+	{
+		_tmp ="";
+		for "_j" from _i to (_i+_ln-1) do
+		{
+			_tmp = _tmp + (_arr select _j);
+		};
+		if (_tmp == _ndl) exitWith { _out = _i };
+	};
+	_out
+};
+*/
+
+KRON_StrInStr = {
+	private["_out"];
+	_in = _this select 0;
+	_out = if (([_this select 0,_this select 1] call KRON_StrIndex)==-1) then { false } else { true };
+	_out
+};
+
+/*
+KRON_Replace = {
+	private["_str", "_old", "_new", "_out", "_tmp", "_jm", "_la", "_lo", "_ln", "_i"];
+	_str = _this select 0;
+	_arr = toArray(_str);
+	_la = count _arr;
+	_old = _this select 1;
+	_new = _this select 2;
+	_na =[_new] call KRON_StrToArray;
+	_lo =[_old] call KRON_StrLen;
+	_ln =[_new] call KRON_StrLen;
+	_out ="";
+	for "_i" from 0 to (count _arr)-1 do
+	{
+		_tmp ="";
+		if (_i <= _la-_lo) then
+		{
+			for "_j" from _i to (_i+_lo-1) do
+			{
+				_tmp = _tmp + toString([_arr select _j]);
+			};
+		};
+		if (_tmp == _old) then
+		{
+			_out = _out+_new;
+			_i = _i+_lo-1;
+		} else {
+			_out = _out+toString([_arr select _i]);
+		};
+	};
+	_out
+};
+*/
+
+/*
+KRON_StrUpper = {
+	private["_in", "_out"];
+	_in = _this select 0;
+	_out = toUpper(_in);
+	_out
+};
+*/
+
+/*
+KRON_StrLower = {
+	private["_in", "_out"];
+	_in = _this select 0;
+	_out = toLower(_in);
+	_out
+};
+*/
+
+KRON_ArrayToUpper = {
+	private["_in", "_i", "_e", "_out"];
+	_in = _this select 0;
+	_out =[];
+	if ((count _in)>0) then
+	{
+		for "_i" from 0 to (count _in)-1 do
+		{
+			_e = _in select _i;
+			if (typeName _e =="STRING") then {
+				_e = toUpper(_e);
+			};
+			_out set [_i,_e];
+		};
+	};
+	_out
+};
+
+KRON_Compare = {
+	private["_k", "_n", "_s", "_i", "_c", "_t", "_s1", "_s2", "_l1", "_l2", "_l"];
+	_k =[_this, "CASE"] call KRON_findFlag;
+	_n = 0;
+	_s = 0;
+	for "_i" from 0 to 1 do
+	{
+		_t = _this select _i;
+		switch (typeName _t) do
+		{
+			case "SCALAR": { _n = 1 };
+			case "BOOL": { _this set [_i,str(_t)]};
+			case "SIDE": { _this set [_i,str(_t)]};
+			case "STRING": { if !(_k) then { _this =[_this] call KRON_ArrayToUpper }};
+			default { _n =-1 };
+		};
+	};
+	_s1 = _this select 0;
+	_s2 = _this select 1;
+	if (_n!= 0) exitWith
+	{
+		if (_n == 1) then
+		{
+			if (_s1<_s2) then { _s =-1 } else { if (_s1>_s2) then { _s = 1 }};
+		};
+		_s
+	};
+	_s1 = toArray(_s1);
+	_s2 = toArray(_s2);
+	_l1 = count _s1;
+	_l2 = count _s2;
+	_l = if (_l1<_l2) then { _l1 } else { _l2 };
+	for "_i" from 0 to _l-1 do
+	{
+		if ((_s1 select _i)<(_s2 select _i)) then
+		{
+			_s =-1;
+			_i = _l;
+		} else {
+			if ((_s1 select _i)>(_s2 select _i)) then
+			{
+				_s = 1;
+				_i = _l;
+			};
+		};
+	};
+	if (_s == 0) then
+	{
+		if (_l1<_l2) then
+		{
+			_s =-1;
+		} else {
+			if (_l1>_l2) then { _s = 1 };
+		};
+	};
+	_s
+};
+
+KRON_ArraySort = {
+	private["_a", "_d", "_k", "_s", "_i", "_vo", "_v1", "_v2", "_j", "_c", "_x"];
+	_a = +(_this select 0);
+	_d = if ([_this, "DESC"] call KRON_findFlag) then {-1 } else { 1 };
+	_k = if ([_this, "CASE"] call KRON_findFlag) then { "CASE" } else { "nocase" };
+	_s = -1;
+	if (typeName (_a select 0)=="ARRAY") then
+	{
+		_s = 0;
+		if (((count _this)>1) && (typeName (_this select 1)=="SCALAR")) then
+		{
+			_s = _this select 1;
+		};
+	};
+	for "_i" from 0 to (count _a)-1 do
+	{
+		_vo = _a select _i;
+		_v1 = _vo;
+		if (_s>-1) then { _v1 = _v1 select _s };
+		_j = 0;
+		for [{ _j = _i-1 },{ _j>= 0 },{ _j = _j-1 }] do
+		{
+			_v2 = _a select _j;
+			if (_s>-1) then { _v2 = _v2 select _s };
+			_c =[_v2,_v1,_k] call KRON_Compare;
+			if (_c!= _d) exitWith {};
+			_a set [_j+1,_a select _j];
+		};
+		_a set [_j+1,_vo];
+	};
+	_a
+};
+
+KRON_findFlag = {
+	private["_in", "_flg", "_arr", "_out"];
+	_in = _this select 0;
+	_flg = toUpper(_this select 1);
+	_arr =[_in] call KRON_ArrayToUpper;
+	_out = _flg in _arr;
+	_out
+};
+
+KRON_getArg = {
+	private["_in", "_flg", "_fl", "_def", "_arr", "_i", "_j", "_as", "_aa", "_org", "_p", "_out"];
+	_in = _this select 0;
+	_flg = toUpper(_this select 1);
+	_fl =[_flg] call KRON_StrLen;
+	_out ="";
+	if ((count _this)>2) then { _out = _this select 2 };
+	_arr =[_in] call KRON_ArrayToUpper;
+	if ((count _arr)>0) then
+	{
+		for "_i" from 0 to (count _in)-1 do
+		{
+			_as = _arr select _i;
+			if (typeName _as =="STRING") then
+			{
+				_aa = [_as] call KRON_StrToArray;
+				_p = _aa find ":";
+				if (_p == _fl) then
+				{
+					if (([_as,_fl] call KRON_StrLeft)== _flg) then
+					{
+						_org = _in select _i;
+						_out =[_org,_p+1] call KRON_StrMid;
+					};
+				};
+			};
+		};
+	};
+	_out
+};
+
+
+KRON_getArgRev = {
+	private["_in", "_flg", "_fl", "_def", "_arr", "_i", "_j", "_as", "_aa", "_org", "_p", "_out"];
+	_in = _this select 0;
+	_flg = toUpper(_this select 1);
+	_fl =[_flg] call KRON_StrLen;
+	_out ="";
+	if ((count _this)>2) then { _out = _this select 2 };
+	_arr =[_in] call KRON_ArrayToUpper;
+	if ((count _arr)>0) then
+	{
+		for "_i" from 0 to (count _in)-1 do
+		{
+			_as = _arr select _i;
+			if (typeName _as =="STRING") then
+			{
+				_aa = [_as] call KRON_StrToArray;
+				_p = _aa find ":";
+				if (_p+1 ==(count _aa)-_fl) then
+				{
+					if (([_as,_p+1] call KRON_StrMid)== _flg) then
+					{
+						_org = _in select _i;
+						_out =[_org,_p] call KRON_StrLeft;
+					};
+				};
+			};
+		};
+	};
+	_out
+};
diff -rupN BASE_MISSION/x/cba/addons/common_init_perFrameHandler.sqf BASE_A2Free/x/cba/addons/common_init_perFrameHandler.sqf
--- BASE_MISSION/x/cba/addons/common_init_perFrameHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_init_perFrameHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,169 @@
+//init_perFrameHandler.sqf
+// #define DEBUG_MODE_FULL
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define _DELAY_MONITOR_THRESHOLD 0.4 // 1
+
+PREP(perFrameEngine);
+
+FUNC(blaHandler) = {
+	// All functions get _logic as _this param. Params inside _logic getVariable "params";
+	private ["_logic"];
+	PARAMS_1(_params);
+	_logic = _params select 0;
+
+	if (isNil "_logic") exitWith {
+		// Remove handler
+		[_logic getVariable "handle"] call CBA_fnc_removePerFrameHandler;
+	};
+
+	if (isNull _logic) exitWith {
+		// Remove handler
+		[_logic getVariable "handle"] call CBA_fnc_removePerFrameHandler;
+	};
+
+	// Deserialize
+	private (_logic getVariable "private");
+	{ call _x } forEach (_logic getVariable "deserialize");
+
+	// Check exit condition - Exit if false
+	if (_logic call (_logic getVariable "exit_condition")) exitWith {
+		TRACE_1("Exit Condition", _logic);
+		// Execute End code
+		_logic call (_logic getVariable "end");
+		// Remove handler
+		[_logic getVariable "handle"] call CBA_fnc_removePerFrameHandler;
+
+		// Bai Bai logic
+		deleteVehicle _logic;
+	};
+
+	// Check Run Condition - Exit until next loop if false
+	if !(_logic call (_logic getVariable "run_condition")) exitWith {};
+	// TRACE_1("Executing",_logic);
+	// Execute code
+	_logic call (_logic getVariable "run");
+
+	// Serialize
+	{ call _x } forEach (_logic getVariable "serialize");
+};
+
+
+FUNC(addPerFrameHandlerLogic) = {
+	PARAMS_1(_function);
+	DEFAULT_PARAM(1,_params,[]);
+	DEFAULT_PARAM(2,_delay,0);
+	DEFAULT_PARAM(3,_start,{});
+	DEFAULT_PARAM(4,_end,{});
+	DEFAULT_PARAM(5,_runCondition,{true});
+	DEFAULT_PARAM(6,_exitCondition,{false});
+	DEFAULT_PARAM(7,_private,[]);
+
+	// Store vars on Logic
+	_logic = "HeliHEmpty" createVehicleLocal [0, 0, 0];
+	_logic setVariable ["start", _start];
+	_logic setVariable ["run_condition", _runCondition];
+	_logic setVariable ["exit_condition", _exitCondition];
+	_logic setVariable ["run", _function];
+	_logic setVariable ["end", _end];
+	_logic setVariable ["params", _params];
+	_logic setVariable ["private", _private];
+
+	// Prepare Serialization and Deserialization code
+	_serialize = [];
+	{
+		_serialize set [count _serialize, compile format["_logic setVariable ['%1', if (isNil '%1') then { nil } else { %1 }]", _x]];
+	} forEach (_logic getVariable 'private');
+
+	_deSerialize = [];
+	{
+		_deSerialize set [count _deSerialize, compile format["%1 = _logic getVariable '%1'", _x]];
+	} forEach (_logic getVariable 'private');
+
+	_logic setVariable ["serialize", _serialize];
+	_logic setVariable ["deserialize", _deserialize];
+
+	// Run start code
+	private (_logic getVariable "private");
+	_params call (_logic getVariable "start");
+
+	// Serialize
+	{ call _x } forEach (_logic getVariable "serialize");
+
+	// Add handler
+	_handle = [FUNC(blaHandler), _delay, [_logic]] call CBA_fnc_addPerFrameHandler;
+	_logic setVariable ["handle", _handle];
+
+	_logic; // Returns logic because you can get the handle from it, and much more
+};
+
+// We monitor all our frame render's in this loop. If the frames stop rendering, that means they alt+tabbed
+// and we still want to at least TRY and run them until the onDraw kicks up again
+FUNC(monitorFrameRender) = {
+	private["_func", "_delay", "_delta", "_handlerData"];
+	disableSerialization;
+	TRACE_1("Monitor frame render loop",nil);
+	// Check if the PFH died for some reason.
+	_pfhIdd = uiNamespace getVariable "CBA_PFHIDD";
+	if(!(isNil "_pfhIdd")) then {
+		if(isNull _pfhIdd) then {
+			7771 cutRsc ["CBA_FrameHandlerTitle", "PLAIN"];
+		};
+	};
+	// check to see if the frame-render hasn't run in a second.
+	// if it hasnt, pick it up for now
+	if((diag_tickTime - GVAR(lastFrameRender)) > _DELAY_MONITOR_THRESHOLD) then {
+		TRACE_1("Executing frameRender",nil);
+		{
+			_handlerData = _x;
+			if !(isNil "_handlerData") then {
+				if (IS_ARRAY(_handlerData)) then {
+					_func = _handlerData select 0;
+					_delay = _handlerData select 1;
+					_delta = _handlerData select 2;
+					if(diag_tickTime > _delta) then {
+						[(_handlerData select 4), (_handlerData select 5)] call _func;
+						_delta = diag_tickTime + _delay;
+						//TRACE_1("data", _data);
+						_handlerData set [2, _delta];
+					};
+				};
+			};
+		} forEach GVAR(perFrameHandlerArray);
+	};
+};
+
+FUNC(onFrame) = {
+	private["_func", "_delay", "_delta", "_handlerData"];
+	GVAR(lastFrameRender) = diag_tickTime;
+	// if(GVAR(lastCount) > (GVAR(fpsCount)-1)) then {
+		// hint "FUCK UP IN SEQUENCE!";
+	// };
+	// player sideChat format["fps: %1 %2 %3", (GVAR(fpsCount)/diag_fps), diag_fps, GVAR(fpsCount)];
+	// GVAR(lastCount) = GVAR(fpsCount);
+	// GVAR(fpsCount) = GVAR(fpsCount) + 1;
+	// player sideChat format["c: %1", GVAR(perFrameHandlerArray)];
+	{
+		_handlerData = _x;
+		if !(isNil "_handlerData") then {
+			if (IS_ARRAY(_handlerData)) then {
+				_func = _handlerData select 0;
+				_delay = _handlerData select 1;
+				_delta = _handlerData select 2;
+				if(diag_tickTime > _delta) then {
+					[(_handlerData select 4), (_handlerData select 5)] call _func;
+					_delta = diag_tickTime + _delay;
+					//TRACE_1("data", _data);
+					_handlerData set [2, _delta];
+				};
+			};
+		};
+	} forEach GVAR(perFrameHandlerArray);
+};
+GVAR(perFrameHandlerArray) = [];
+GVAR(fpsCount) = 0;
+GVAR(lastCount) = -1;
+GVAR(lastFrameRender) = 0;
diff -rupN BASE_MISSION/x/cba/addons/common_script_component.hpp BASE_A2Free/x/cba/addons/common_script_component.hpp
--- BASE_MISSION/x/cba/addons/common_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,13 @@
+#define COMPONENT common
+#include "script_mod.hpp"
+
+
+#ifdef DEBUG_ENABLED_COMMON
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_COMMON
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_COMMON
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/common_test.sqf BASE_A2Free/x/cba/addons/common_test.sqf
--- BASE_MISSION/x/cba/addons/common_test.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_test.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,22 @@
+// -----------------------------------------------------------------------------
+// Automatically generated by 'functions_config.rb'
+// DO NOT MANUALLY EDIT THIS FILE!
+// -----------------------------------------------------------------------------
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define TESTS ["inheritsFrom", "parseYaml"]
+
+SCRIPT(test-common);
+
+// ----------------------------------------------------------------------------
+
+LOG("=== Testing Common ===");
+
+{
+	call compile preprocessFileLineNumbers format ["\x\cba\addons\common\test_%1.sqf", _x];
+} forEach TESTS;
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/common_test_inheritsFrom.sqf BASE_A2Free/x/cba/addons/common_test_inheritsFrom.sqf
--- BASE_MISSION/x/cba/addons/common_test_inheritsFrom.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_test_inheritsFrom.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,33 @@
+// ----------------------------------------------------------------------------
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_inheritsFrom);
+
+// ----------------------------------------------------------------------------
+
+private ["_class", "_base", "_expected", "_result", "_fn"];
+
+_fn = "CBA_fnc_inheritsFrom";
+ASSERT_DEFINED(_fn,_fn);
+
+LOG("Testing " + _fn);
+
+_class = configFile >> "CfgWeapons" >> "m16a4_acg_gl";
+_base = configFile >> "CfgWeapons" >> "RifleCore";
+_result = [_class, _base] call CBA_fnc_inheritsFrom;
+ASSERT_TRUE(_result,_fn);
+
+_class = configFile >> "CfgWeapons" >> "RifleCore";
+_base = configFile >> "CfgWeapons" >> "m16a4_acg_gl";
+_result = [_class, _base] call CBA_fnc_inheritsFrom;
+ASSERT_FALSE(_result,_fn);
+
+_class = configFile >> "CfgWeapons" >> "m16a4_acg_gl";
+_base = configFile >> "CfgWeapons" >> "PistolCore";
+_result = [_class, _base] call CBA_fnc_inheritsFrom;
+ASSERT_FALSE(_result,_fn);
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/common_test_parseYaml.sqf BASE_A2Free/x/cba/addons/common_test_parseYaml.sqf
--- BASE_MISSION/x/cba/addons/common_test_parseYaml.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/common_test_parseYaml.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,34 @@
+// ----------------------------------------------------------------------------
+
+#include "common_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_parseYaml);
+
+// ----------------------------------------------------------------------------
+
+private ["_expected", "_result", "_fn", "_data"];
+
+_fn = "CBA_fnc_parseYaml";
+ASSERT_DEFINED(_fn,_fn);
+
+LOG("Testing " + _fn);
+
+_data = ["\x\cba\addons\common\test_parseYaml_config.yml"] call CBA_fnc_parseYaml;
+
+ASSERT_TRUE([_data] call CBA_fnc_isHash,_fn);
+
+_result = [_data, "anotherNumber"] call CBA_fnc_hashGet;
+_expected = "42";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = ([_data, "nestedArray"] call CBA_fnc_hashGet) select 0;
+_expected = "first";
+ASSERT_OP(_result,==,_expected,_fn);
+
+_result = (([_data, "nestedArray"] call CBA_fnc_hashGet) select 2) select 1;
+_expected = "3.2";
+ASSERT_OP(_result,==,_expected,_fn);
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/delayless.fsm BASE_A2Free/x/cba/addons/delayless.fsm
--- BASE_MISSION/x/cba/addons/delayless.fsm	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/delayless.fsm	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,57 @@
+/*%FSM<COMPILE "D:\Program files\Bohemia Interactive\Tools\FSM Editor Personal Edition\scriptedFSM.cfg, SBs SupaFSM">*/
+/*%FSM<HEAD>*/
+/*
+item0[] = {"",7,210,-30.000000,-425.000000,-20.000000,-425.000000,0.000000,""};
+item1[] = {"Init",0,250,-150.000000,-175.000000,-50.000000,-125.000000,0.000000,"Init"};
+item2[] = {"execute",8,4314,-275.000000,-175.000000,-175.000000,-125.000000,1.000000,"execute"};
+item3[] = {"End",1,250,-400.000000,-175.000000,-300.000000,-125.000000,0.000000,"End"};
+link0[] = {1,2};
+link1[] = {2,3};
+globals[] = {25.000000,1,0,0,0,640,480,3,121,6316128,1,-466.578888,208.527237,350.990051,-396.594299,829,918,1};
+window[] = {2,-1,-1,-1,-1,863,110,1070,145,3,847};
+*//*%FSM</HEAD>*/
+class FSM
+{
+  fsmName = "SBs SupaFSM";
+  class States
+  {
+    /*%FSM<STATE "Init">*/
+    class Init
+    {
+      name = "Init";
+      init = /*%FSM<STATEINIT""">*/""/*%FSM</STATEINIT""">*/;
+      precondition = /*%FSM<STATEPRECONDITION""">*/""/*%FSM</STATEPRECONDITION""">*/;
+      class Links
+      {
+        /*%FSM<LINK "execute">*/
+        class execute
+        {
+          priority = 1.000000;
+          to="End";
+          precondition = /*%FSM<CONDPRECONDITION""">*/""/*%FSM</CONDPRECONDITION""">*/;
+          condition=/*%FSM<CONDITION""">*/"call _this; true"/*%FSM</CONDITION""">*/;
+          action=/*%FSM<ACTION""">*/""/*%FSM</ACTION""">*/;
+        };
+        /*%FSM</LINK>*/
+      };
+    };
+    /*%FSM</STATE>*/
+    /*%FSM<STATE "End">*/
+    class End
+    {
+      name = "End";
+      init = /*%FSM<STATEINIT""">*/""/*%FSM</STATEINIT""">*/;
+      precondition = /*%FSM<STATEPRECONDITION""">*/""/*%FSM</STATEPRECONDITION""">*/;
+      class Links
+      {
+      };
+    };
+    /*%FSM</STATE>*/
+  };
+  initState="Init";
+  finalStates[] =
+  {
+    "End",
+  };
+};
+/*%FSM</COMPILE>*/
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_XEH_preInit.sqf BASE_A2Free/x/cba/addons/diagnostic_XEH_preInit.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_XEH_preInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_XEH_preInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,25 @@
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+LOG(MSG_INIT);
+
+[QUOTE(GVAR(debug)), { _this call CBA_fnc_debug }] call CBA_fnc_addEventHandler;
+
+if (SLX_XEH_MACHINE select 3) then
+{
+	FUNC(handle_peak) =
+	{
+		PARAMS_1(_variable);
+		if (isNil _variable) then
+		{
+			[QUOTE(GVAR(receive_peak)), [_variable, nil]] call CBA_fnc_globalEvent;
+		} else {
+			[QUOTE(GVAR(receive_peak)), [_variable, call compile _variable]] call CBA_fnc_globalEvent;
+		};
+
+	};
+	[QUOTE(GVAR(peek)), { _this call CBA_fnc_handle_peak }] call CBA_fnc_addEventHandler;
+};
+
+PREP(perf_loop);
+
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_fnc_benchmarkFunction.sqf BASE_A2Free/x/cba/addons/diagnostic_fnc_benchmarkFunction.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_fnc_benchmarkFunction.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_fnc_benchmarkFunction.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,69 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_benchmarkFunction
+
+Description:
+	Benchmarks a function to see how long it will take to execute.
+
+	Recommended to run with small number of iterations first and build up, to
+	prevent locking up the machine.
+
+Parameters:
+	_function - Function to test [Function]
+	_parameters - Parameters to pass to the function on each iteration
+		[Array or nil]
+	_iterations - Number of iterations to run, in order to get an accurate
+		average time [Number]
+
+Returns:
+	Average execution time [Number]
+
+Examples:
+(begin example)
+	// Array creation through use of push.
+	_array = [];
+	_took = [{ _array set [count _array, 1] }, nil, 1000] call CBA_fnc_benchmarkFunction;
+
+	// Array creation through use of concatenation.
+	_array = [];
+	_took = [{ _array = _array + [1] }, nil, 1000] call CBA_fnc_benchmarkFunction;
+
+	// "Null function" to compare to (use as a control vs. operation time
+	//	of other functions).
+	_array = [];
+	_took = [{}, nil, 1000] call CBA_fnc_benchmarkFunction;
+(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(benchmarkFunction);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_3(_function,_parameters,_iterations);
+
+private ["_start", "_averageTime"];
+
+_start = diag_tickTime;
+
+if (isNil "_parameters") then
+{
+	for "_i" from 1 to _iterations do
+	{
+		call _function;
+	};
+} else {
+	for "_i" from 1 to _iterations do
+	{
+		_parameters call _function;
+	};
+};
+
+_averageTime = (diag_tickTime - _start) / _iterations;
+
+_averageTime; // Return.
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_fnc_debug.sqf BASE_A2Free/x/cba/addons/diagnostic_fnc_debug.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_fnc_debug.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_fnc_debug.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,134 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_debug
+
+Description:
+	General Purpose Debug Message Writer
+
+	Handles very long messages without losing text or crashing the game.
+
+Parameters:
+	_message - Message to write or data structure to dump [String or Array].
+	_component - component [String, defaults to "CBA_DIAGNOSTIC"]
+	_typeOfDebug - Type of message [3-element Array, as described below...]
+	... _useGlobalChat - Write to global chat [Boolean, defaults to true].
+	... _local - Log to local arma.rpt [Boolean, defaults to true]
+    ... _global - Log to local and remote arma.rpt [Boolean, defaults to false]
+
+Returns:
+	nil
+
+Examples:
+    (begin example)
+		// Write the debug message in chat-log of local computer, and in
+		// local and remote arma.rpt.
+		[ "New Player Joined the Server!", "cba_network", [true, false, true] ] call CBA_fnc_debug;
+    (end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+if (isNil QUOTE(ADDON)) then
+{
+	CREATELOGICLOCAL;
+	// GVAR(debug) = []; // TODO: Evaluate if this is useful... Logging to rpt and using a tail reader seems okay too!
+};
+
+_ar2msg = {
+	private ["_ar", "_str", "_msg", "_orig", "_total", "_i"];
+	_ar = [];
+	if (typeName (_this select 0) == "ARRAY") then
+	{
+		_orig = _this select 0;
+		_str = format["%1 [", _this select 1];
+	} else {
+		_orig = _this;
+		_str = "[";
+	};
+	{ PUSH(_ar,toArray _x) } forEach _orig;
+	_msg = [];
+	_total = 0; _i = 0;
+	{
+		_c = count _x;
+		if (_total + _c < 178) then
+		{
+			_total = _total + _c;
+			if (_i > 0) then { _str = _str + ", " };
+			_str = _str + toString(_x);
+		} else {
+			PUSH(_msg,_str);
+			_total = _c;
+			_str = toString(_x);
+		};
+		_i = _i + 1;
+	} forEach _ar;
+	_str = _str + "]";
+	PUSH(_msg,_str);
+	_msg
+};
+
+_str2msg = {
+	private ["_ar", "_i", "_nar", "_msg"];
+	_ar = toArray _this;
+	if (count _ar < 180) exitWith { [_this] };
+	_i = 0; _nar = []; _msg = [];
+	{
+		if (_i < 180) then
+		{
+			PUSH(_nar,_x);
+			_i = _i + 1;
+		} else {
+			PUSH(_msg,toString(_nar));
+			_nar = [_x];
+			_i = 1;
+		};
+	} forEach _ar;
+	if (count _nar > 0) then { PUSH(_msg,toString(_nar)) };
+	_msg
+};
+
+_format = {
+	private ["_msg"];
+	_msg = [];
+	switch (typeName _this) do
+	{
+		case "ARRAY": { { { PUSH(_msg,_x) } forEach (_x call _str2msg) } forEach _this };
+		case "STRING": { _msg = _this call _str2msg };
+		default { _msg = format["%1", _this] call _str2msg };
+	};
+	_msg
+};
+
+private ["_c", "_type", "_component", "_message", "_msg", "_ar2", "_i", "_msgAr"];
+_c = count _this;
+_type = [true, true, false];
+_component = QUOTE(ADDON);
+_message = _this select 0;
+if (_c > 1) then
+{
+	_component = _this select 1;
+	if (_c > 2) then
+	{
+		_type = _this select 2;
+	};
+};
+
+if (_type select 2) exitWith
+{
+	[QUOTE(GVAR(debug)), [_message, _component, [_type select 0,_type select 1,false]]] call CBA_fnc_globalEvent;
+};
+
+_msgAr = [];
+switch (typeName _message) do
+{
+	case "ARRAY": { _msgAr = [format["%3 (%2) %1 -", _component, [time, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime, [diag_tickTime, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime]]; { PUSH(_msgAr,_x) } forEach (_message call _ar2msg) };
+	default { _msgAr = (format["%4 (%3) %1 - %2", _component, _message, [time, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime, [diag_tickTime, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime] call _format) };
+};
+
+if (_type select 0) then { if (SLX_XEH_MACHINE select 0) then { { ADDON globalChat _x } forEach _msgAr } };
+if (_type select 1) then { { if (_x != "") then { diag_log text _x } } forEach _msgAr };
+//PUSH(GVAR(debug),_msgAr); // TODO: Evaluate cleanup system?
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_fnc_error.sqf BASE_A2Free/x/cba/addons/diagnostic_fnc_error.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_fnc_error.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_fnc_error.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,45 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_error
+
+Description:
+	Logs an error message to the RPT log.
+
+	Should not be used directly, but rather via macros (<ERROR()>,
+		<ERROR_WITH_TITLE()> or the <Assertions>).
+
+Parameters:
+	_file - Name of file [String]
+	_lineNum - Line of file (starting at 0) [Number]
+	_title - Title of the error [String]
+	_message - Error message [String, which may contain \n]
+
+Returns:
+	nil
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(error);
+
+// -----------------------------------------------------------------------------
+PARAMS_4(_file,_lineNum,_title,_message);
+
+private ["_time", "_lines"];
+
+// TODO: popup window with error message in it.
+_time = [diag_tickTime, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime;
+
+diag_log text format ["%1 (%2) [%3:%4] -ERROR- %5", _time, time, _file, _lineNum + 1, _title];
+
+_lines = [_message, "\n"] call CBA_fnc_split;
+
+{
+	diag_log text format ["            %1", _x];
+} forEach _lines;
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_fnc_log.sqf BASE_A2Free/x/cba/addons/diagnostic_fnc_log.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_fnc_log.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_fnc_log.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,78 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_log
+
+Description:
+	Logs a message to the RPT log.
+
+	Should not be used directly, but rather via macro (<LOG()>).
+
+	This function is unaffected by the debug level (<DEBUG_MODE_x>).
+
+Parameters:
+	_file - File error occurred in [String]
+	_lineNum - Line number error occurred on (starting from 0) [Number]
+	_message - Message [String]
+
+Returns:
+	nil
+
+Author:
+	Spooner and Rommel
+-----------------------------------------------------------------------------*/
+#define DEBUG_MODE_NORMAL
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(log);
+
+// ----------------------------------------------------------------------------
+
+#ifndef DEBUG_SYNCHRONOUS
+	if (isNil "CBA_LOG_ARRAY") then { CBA_LOG_ARRAY = [] };
+	private ["_msg"];
+	_msg = [_this select 0, _this select 1, _this select 2, diag_frameNo, diag_tickTime, time]; // Save it here because we want to know when it was happening, not when it is outputted
+	PUSH(CBA_LOG_ARRAY,_msg);
+
+	if (isNil "CBA_LOG_VAR") then
+	{
+		CBA_LOG_VAR = true;
+		[] spawn
+		{
+			_fnc_log =
+			{
+				PARAMS_6(_file,_lineNum,_message,_frameNo,_tickTime,_gameTime);
+				// TODO: Add log message to trace log
+				diag_log [_frameNo, 
+					_tickTime, _gameTime, //[_tickTime, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime, [_gameTime, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime,
+					_file + ":"+str(_lineNum + 1), _message];
+			};
+
+			while {count CBA_LOG_ARRAY > 0} do
+			{
+				_selected = CBA_LOG_ARRAY select 0;
+				_selected call _fnc_log;
+
+				// Removal method one
+				CBA_LOG_ARRAY set [0, objNull];
+				CBA_LOG_ARRAY = CBA_LOG_ARRAY - [objNull];
+
+				/*
+				// Removal method 2
+				for "_i" from 1 to (count CBA_LOG_ARRAY - 1) do {
+					CBA_LOG_ARRAY set [_i - 1, CBA_LOG_ARRAY select _i];
+				};
+				*/
+			};
+			CBA_LOG_VAR = nil;
+		};
+	};
+#else
+	PARAMS_3(_file,_lineNum,_message);
+	// TODO: Add log message to trace log
+	diag_log [diag_frameNo,
+		diag_tickTime, time, // [diag_tickTime, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime, [time, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime
+		_file + ":"+str(_lineNum + 1), _message];
+#endif
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_fnc_peek.sqf BASE_A2Free/x/cba/addons/diagnostic_fnc_peek.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_fnc_peek.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_fnc_peek.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,29 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_peek
+
+Description:
+	Peek at variable on the server
+	To receive the variable content back, you will have to
+	["cba_diagnostics_receive_peak", {_this call myFunction}] call CBA_fnc_addEventHandler;
+
+Parameters:
+        _variable - string
+
+Returns:
+	nil
+
+Author:
+	Sickboy
+-----------------------------------------------------------------------------*/
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(peek);
+PARAMS_1(_variable);
+
+// ----------------------------------------------------------------------------
+
+[GVAR(peek), _variable] call CBA_fnc_globalEvent;
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_fnc_perf_loop.sqf BASE_A2Free/x/cba/addons/diagnostic_fnc_perf_loop.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_fnc_perf_loop.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_fnc_perf_loop.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,166 @@
+/*
+	Script performance measurements, by Sickboy. Originally by Rommel
+*/
+// #define DEBUG_MODE_FULL
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#define DELAY 1
+#define DIFF 1.1
+#define HIGH_DIFF 2
+#define INTERVAL 10
+#define LAG_INTERVAL 2 // INTERVAL
+#define DEFAULT_VALUES diag_tickTime, time, diag_fps, diag_fpsMin
+
+/*
+	// For usage outside CBA
+	#define QUOTE(A) #A
+	#define GVAR(A) my_##A
+	#define PUSH(A,B) A set [count A, B]
+*/
+
+// temp
+//GVAR(lag) = true;
+
+private ["_entry", "_create", "_dump", "_f"];
+
+if (isNil QUOTE(GVAR(running))) then { GVAR(running) = false };
+if (GVAR(running)) exitWith {}; // Already running
+GVAR(running) = true;
+
+FUNC(lag) = {
+		//_unit = if (isNull player) then { allUnits select 0 } else { player };
+		for "_i" from 0 to 100 do {
+			{ _unit = _x; call compile format["nearestObjects [call compile ""_unit"", [""All""], 5000]"] } forEach allUnits;
+		};
+};
+
+FUNC(lag3) = {
+	// Piece of ace_sys_maptools that caused lags for sys_missileguidance
+    DOUBLES(ADDON,compassRuler) = "";
+	DOUBLES(ADDON,compassRose) = "";
+    while { true } do {
+        if("ace_sys_maptools_tools_tools_tools" in ["A", "B", "C"]) then {
+		} else {
+            _actionId = -1;
+			deleteMarkerLocal QUOTE(DOUBLES(ADDON,compassRuler));
+            deleteMarkerLocal QUOTE(DOUBLES(ADDON,compassRose));
+            GVAR(MouseDown) = false;
+            GVAR(DragOK)    = false;
+            GVAR(OffDrag)   = false;
+            GVAR(LastDragPosition) = [];
+            GVAR(RulerStartPos) = [];
+            GVAR(MouseShift) = false;
+            GVAR(LastDragAzimuth) = -1000;
+            GVAR(MapLineSegmentStart) = [0, 0, 0];
+            GVAR(MapLineColor) = 0;
+            GVAR(MapPreviousDir) = 0;
+            GVAR(RulerKeyDown) = -1000;
+		};
+	};
+
+};
+
+FUNC(lag2) = {
+		{ deleteVehicle _x } forEach _objects; // _x setDamage 1
+		_objects = [];
+		for "_i" from 0 to 100 do {
+			_logic = "LOGIC" createVehicleLocal [0, 0, 0];
+			PUSH(_objects,_logic);
+		};
+};
+
+
+GVAR(logs) = []; GVAR(ar) = [];
+if (isNil QUOTE(GVAR(log))) then { GVAR(log) = true };
+if (isNil QUOTE(GVAR(lag))) then { GVAR(lag) = false };
+if (isNil QUOTE(GVAR(interactive))) then { GVAR(interactive) = true };
+
+_dump = {
+	//diag_log format ["%1	%2	%3	%4	%5",count allunits,time,diag_ticktime,diag_fpsmin,diag_fps];
+};
+
+_create = {
+	private "_pid";
+	_pid = [] spawn _dump;
+	waituntil {scriptDone _pid};
+};
+
+waitUntil {SLX_XEH_MACHINE select 5}; // waitUntil player ready etc
+TRACE_1("Started",GVAR(running));
+
+if (time == 0) then { sleep 0.001 }; // Sleep until after the briefing
+
+// Induce lag by executing commands
+if (GVAR(lag)) then {
+	[] spawn {
+		// By HojO
+		for "_i" from 0 to 100 do {
+		_null = [] spawn {
+			while{true} do {_LagMyGame = sin(cos(tan(sin(cos(tan(sin(cos(tan(0.12345678)))))))));};
+		};
+		};
+	/*
+		private ["_nextTime", "_objects", "_logic"];
+		_nextTime = time + LAG_INTERVAL;
+		_objects = [];
+		while {GVAR(lag)} do {
+			waitUntil {time > _nextTime};
+			TRACE_1("Lag Started","");
+			// [] spawn FUNC(lag3);
+			call FUNC(lag);
+			_nextTime = time + LAG_INTERVAL;
+			TRACE_1("Lag Ended","");
+		};
+	*/
+	};
+};
+
+// Output logged information and add warnings when appropriate
+[] spawn {
+	private ["_nextTime", "_limit", "_high", "_a", "_b", "_deltaTick", "_deltaTime", "_log", "_do", "_ar"];
+	_nextTime = time + INTERVAL;
+	_limit = DELAY * DIFF;
+	_high = DELAY * HIGH_DIFF;
+	while {GVAR(log)} do {
+		waitUntil {time > _nextTime};
+		_ar = GVAR(ar); GVAR(ar) = [];
+		_log = ["Current", DEFAULT_VALUES];
+		PUSH(GVAR(logs),_log);
+		{
+			// TODO: Also compare the delta between the previous few entries?
+			_a = _x select 0; _b = _x select 1;
+			_deltaTick = (_b select 0) - (_a select 0);
+			_deltaTime = (_b select 1) - (_a select 1);
+			_log = ["Delta", _a, _b, _deltaTick, _deltaTime];
+			_do = false;
+			if (_deltaTime > _limit) then { _do = true; if (_deltaTime > _high) then { PUSH(_log,"WARNING: Large deltaTime"); PUSH(_log,_deltaTime) } };
+			if (_deltaTick > _limit) then { _do = true; if (_deltaTick > _high) then { PUSH(_log,"WARNING: Large deltaTick"); PUSH(_log,_deltaTick) } };
+			if (_do) then { PUSH(GVAR(logs),_log) };
+		} forEach _ar;
+		if (GVAR(interactive)) then {
+			// Output at each iteration
+			{ diag_log _x } forEach GVAR(logs);
+			GVAR(logs) = [];
+		};
+		_nextTime = time + INTERVAL;
+	};
+	if !(GVAR(interactive)) then {
+		// Output at exit
+		{ diag_log _x } forEach GVAR(log);
+	};
+	GVAR(log) = [];
+};
+
+// Sleep for DELAY seconds, then execute a simple command, and log the delta between the logged times and ticktimes
+while {GVAR(log)} do {
+	_entry = [[DEFAULT_VALUES]];
+	sleep DELAY;
+	[] call _create;
+	_entry set [count _entry, [DEFAULT_VALUES]];
+	PUSH(GVAR(ar),_entry);
+};
+
+GVAR(ar) = [];
+GVAR(running) = false;
+TRACE_1("Exit",GVAR(running));
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_fnc_test.sqf BASE_A2Free/x/cba/addons/diagnostic_fnc_test.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_fnc_test.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_fnc_test.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,52 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_test
+
+Description:
+	Runs unit tests for an addon or component.
+
+Parameters:
+	_addon - Prefix of addon to test [String, defaulting to "cba"].
+	_component - Name of component to test. If "main", will
+		test the whole addon [String, defaulting to "main"].
+
+Returns:
+	nil
+
+Examples:
+	(begin example)
+		[] call CBA_fnc_test; // Test whole of CBA addon.
+	(end)
+
+	(begin example)
+		[nil, "arrays"] call CBA_fnc_test; // Test Arrays component of CBA addon.
+	(end)
+
+	(begin example)
+		["SPON_Map"] call CBA_fnc_test; // Test whole of SPON_Map addon.
+	(end)
+
+	(begin example)
+		["SPON_Map", "drawing"] call CBA_fnc_test; // Test Drawing component of SPON_Map addon.
+	(end)
+
+Author:
+	Spooner
+
+---------------------------------------------------------------------------- */
+
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+// ----------------------------------------------------------------------------
+
+DEFAULT_PARAM(0,_addon,"cba");
+DEFAULT_PARAM(1,_component,"main");
+
+LOG('===== STARTING TESTS =====');
+
+call compile preprocessFileLineNumbers format ["\x\%1\addons\%2\test.sqf", _addon, _component];
+
+LOG('===== COMPLETED TESTS =====');
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_script_component.hpp BASE_A2Free/x/cba/addons/diagnostic_script_component.hpp
--- BASE_MISSION/x/cba/addons/diagnostic_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,12 @@
+#define COMPONENT diagnostic
+#include "script_mod.hpp"
+
+#ifdef DEBUG_ENABLED_DIAGNOSTIC
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_DIAGNOSTIC
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_DIAGNOSTIC
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_test.sqf BASE_A2Free/x/cba/addons/diagnostic_test.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_test.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_test.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,22 @@
+// -----------------------------------------------------------------------------
+// Automatically generated by 'functions_config.rb'
+// DO NOT MANUALLY EDIT THIS FILE!
+// -----------------------------------------------------------------------------
+
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define TESTS ["assertions", "parameters"]
+
+SCRIPT(test-diagnostic);
+
+// ----------------------------------------------------------------------------
+
+LOG("=== Testing Diagnostic ===");
+
+{
+	call compile preprocessFileLineNumbers format ["\x\cba\addons\diagnostic\test_%1.sqf", _x];
+} forEach TESTS;
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_test_assertions.sqf BASE_A2Free/x/cba/addons/diagnostic_test_assertions.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_test_assertions.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_test_assertions.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,25 @@
+// ----------------------------------------------------------------------------
+
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_assertions);
+
+// ----------------------------------------------------------------------------
+
+LOG("Testing assertions");
+
+private ["_a", "_b"];
+
+ERROR("Testing that ERROR() is output correctly");
+_a = false;
+ASSERT_TRUE(_a,"Checking ASSERT_TRUE() is output correctly");
+_a = true;
+ASSERT_FALSE(_a,"Checking ASSERT_FALSE() is output correctly");
+_a = 1; _b = 2;
+ASSERT_OP(_a,>,_b,"Checking ASSERT_OP() is output correctly");
+ASSERT_DEFINED("_imaginaryFox","Checking ASSERT_DEFINED() is output correctly");
+
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/diagnostic_test_parameters.sqf BASE_A2Free/x/cba/addons/diagnostic_test_parameters.sqf
--- BASE_MISSION/x/cba/addons/diagnostic_test_parameters.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/diagnostic_test_parameters.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,42 @@
+// ----------------------------------------------------------------------------
+
+#include "diagnostic_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_parameters);
+
+// ----------------------------------------------------------------------------
+
+LOG("Testing parameters");
+
+private ["_expected"];
+
+// Test default params.
+_this = [5];
+DEFAULT_PARAM(0,_result,12);
+_expected = 5;
+ASSERT_OP(_result,==,_expected,"DEFAULT_PARAM");
+
+_result = nil;
+
+_this = [];
+DEFAULT_PARAM(0,_result,12);
+_expected = 12;
+ASSERT_OP(_result,==,_expected,"DEFAULT_PARAM");
+
+_result = nil;
+
+_this = [nil];
+DEFAULT_PARAM(0,_result,12);
+_expected = 12;
+ASSERT_OP(_result,==,_expected,"DEFAULT_PARAM");
+
+_result = nil;
+
+_this = nil;
+DEFAULT_PARAM(0,_result,12);
+_expected = 12;
+ASSERT_OP(_result,==,_expected,"DEFAULT_PARAM");
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/dummy.sqf BASE_A2Free/x/cba/addons/dummy.sqf
--- BASE_MISSION/x/cba/addons/dummy.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/dummy.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,2 @@
+diag_log "Dummy file called, please fix!";
+false;
diff -rupN BASE_MISSION/x/cba/addons/events_XEH_preClientInit.sqf BASE_A2Free/x/cba/addons/events_XEH_preClientInit.sqf
--- BASE_MISSION/x/cba/addons/events_XEH_preClientInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_XEH_preClientInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,94 @@
+// #define DEBUG_MODE_FULL
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+/*
+	Custom events
+*/
+LOG(MSG_INIT);
+
+["CBA_loadGame", { [] spawn FUNC(attach_handler) }] call CBA_fnc_addEventHandler;
+["CBA_playerSpawn", { LOG("Player spawn detected!") }] call CBA_fnc_addEventHandler;
+
+[] spawn {
+	private ["_lastPlayer", "_newPlayer"];
+	waitUntil {player == player};
+	_lastPlayer = objNull;
+	while {true} do {
+		waitUntil {player != _lastPlayer};
+		waitUntil {!isNull player};
+		_newPlayer = player; // Cumbersome but ensures refering to the same object
+		["CBA_playerSpawn", [_newPlayer, _lastPlayer]] call CBA_fnc_localEvent;
+		_lastPlayer = _newPlayer;
+	};
+};
+
+
+// Display Eventhandlers - Abstraction layer
+GVAR(attaching) = false;
+
+FUNC(handle_retach) = {
+	private ["_id", "_ar2"];
+	// _key and _value
+	TRACE_2("",_key,_value);
+	{
+		_id = _x select 0;
+		if !(isNil "_id") then {
+			TRACE_2("Removing",_key,_id);
+			(findDisplay 46) displayRemoveEventHandler [_key, _id];
+		};
+		if (count _x != 1) then {
+			TRACE_2("Adding",_key,_x select 1);
+			_x set [0, (findDisplay 46) displayAddEventHandler [_key, _x select 1]];
+		};
+	} forEach _value;
+};
+
+CBA_EVENT_KEY_LOGIC = objNull;
+
+// TODO: Stack/multiplex into single events per type ?
+FUNC(attach_handler) = {
+	if !(isNull (CBA_EVENT_KEY_LOGIC)) exitWith {}; // Already busy
+	TRACE_1("ReAttaching",GVAR(keypressed));
+
+	waitUntil { !(isNull (findDisplay 46)) };
+	TRACE_1("Display found!",time);
+
+	CBA_EVENT_KEY_LOGIC = "HeliHEmpty" createVehicleLocal [0,0,0];
+	CBA_EVENT_KEY_LOGIC addEventHandler ["Killed", {
+		[GVAR(handler_hash), {call FUNC(handle_retach)}] call CBA_fnc_hashEachPair;
+		CBA_EVENTS_DONE = true; 
+		deleteVehicle CBA_EVENT_KEY_LOGIC;
+	}];
+	CBA_EVENT_KEY_LOGIC setDamage 1;
+};
+
+// Display Eventhandlers - Higher level API specially for keyDown/Up and Action events
+// Workaround , in macros
+#define UP [_this, 'keyup']
+#define DOWN [_this, 'keydown']
+
+["KeyUp", QUOTE(UP call FUNC(keyHandler))] call CBA_fnc_addDisplayHandler;
+["KeyDown", QUOTE(DOWN call FUNC(keyHandler))] call CBA_fnc_addDisplayHandler;
+
+[] spawn {
+	waitUntil { !isNull (findDisplay 46) };
+	// Workaround for Single Player, mission editor, or mission, preview/continue, whatever, adding double handlers
+	if !(isMultiplayer) then { { (findDisplay 46) displayRemoveAllEventHandlers _x } forEach ["KeyUp", "KeyDown"] };
+
+	call FUNC(attach_handler);
+
+	// ["KeyDown", QUOTE(_this call FUNC(actionHandler))] call CBA_fnc_addDisplayHandler;
+
+	// Workaround for displayEventhandlers falling off at gameLoad after gameRestart
+	// Once the last registered keypress is longer than 10 seconds ago, re-attach the handler.
+	GVAR(keypressed) = time;
+	if (isServer || !isMultiplayer) then {
+		while {true} do {
+			waitUntil {(time - GVAR(keypressed)) > 10};
+			TRACE_1("Longer than 10 seconds ago",_this);
+			call FUNC(attach_handler);
+			GVAR(keypressed) = time;
+		};
+	};
+};
diff -rupN BASE_MISSION/x/cba/addons/events_XEH_preInit.sqf BASE_A2Free/x/cba/addons/events_XEH_preInit.sqf
--- BASE_MISSION/x/cba/addons/events_XEH_preInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_XEH_preInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,100 @@
+//#define DEBUG_MODE_FULL
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+/*
+	Custom events
+*/
+LOG(MSG_INIT);
+
+// Initialisation required by CBA events.
+CBA_eventHandlers = "Logic" createVehicleLocal [0, 0];
+CBA_eventHandlersLocal = "Logic" createVehicleLocal [0, 0];
+CBA_EVENTS_DONE = false;
+
+// TODO: Verify if this code is okay; there can be no player object ready at PreInit, thus it's not very useful
+if (isServer || alive player) then {
+	// We want all events, as soon as they start arriving.
+	"CBA_e" addPublicVariableEventHandler { (_this select 1) call CBA_fnc_localEvent };
+	"CBA_l" addPublicVariableEventHandler { (_this select 1) call FUNC(remoteLocalEvent) };
+} else {
+	// Ignore the last event that was sent out before we joined.
+	[] spawn {
+		waitUntil { alive player };
+		"CBA_e" addPublicVariableEventHandler { (_this select 1) call CBA_fnc_localEvent };
+		"CBA_l" addPublicVariableEventHandler { (_this select 1) call FUNC(remoteLocalEvent) };
+	};
+};
+
+// Display Eventhandlers - Abstraction layer
+GVAR(handler_hash) = [[], ""] call CBA_fnc_hashCreate;
+
+// Display Eventhandlers - Higher level API specially for keyDown/Up and Action events
+/*
+	Example:
+	class CfgSettings { class CBA { class Keys { class sys_attachments { cqb = 33 }; }; }; };
+
+	- Script (in sys_attachments addon (it has COMPONENT defined as sys_attachments)):
+	[QUOTE(COMPONENT), "cqb", { _this call GVAR(keyPressed) }] call cba_fnc_AddKeyHandlerFromConfig;
+*/
+private ["_arUp", "_arDown"];
+GVAR(keyhandler_hash) = [[], []] call CBA_fnc_hashCreate;
+GVAR(keyhandlers_down) = [[], []] call CBA_fnc_hashCreate;
+GVAR(keyhandlers_up) = [[], []] call CBA_fnc_hashCreate;
+_arUp = [GVAR(keyhandler_hash), "keyup"] call CBA_fnc_hashGet;
+_arDown = [GVAR(keyhandler_hash), "keydown"] call CBA_fnc_hashGet;
+for "_i" from 0 to 250 do {
+	_arUp set [_i, []];
+	_arDown set [_i, []];
+};
+
+// Due to limitation, have to actually set the first time
+[GVAR(keyhandler_hash), "keyup", _arUp] call CBA_fnc_hashSet;
+[GVAR(keyhandler_hash), "keydown", _arDown] call CBA_fnc_hashSet;
+
+PREP(keyHandler);
+PREP(remoteLocalEvent);
+
+/*
+	// Disabled - SB - 2010-01-22: Bugged, and not working anyway.
+	// FIXME: #define __cfg ??
+	GVAR(actions) = "LOGIC" createVehicleLocal [0, 0, 0];
+	for "_i" from 0 to ((count (__cfg)) - 1) do
+	{
+		_entry = (__cfg) select _i;
+		if (isArray(_entry)) then
+		{
+			GVAR(actions) setVariable [configName _entry, []];
+		};
+	};
+
+	PREP(actionHandler);
+*/
+
+// loadGame EventHandler
+//["CBA_loadGame", { LOG("Game load detected!") }] call CBA_fnc_addEventHandler;
+
+/*
+// Disabled - SB - 2009-07-22: Script scheduling seems to mess this up. Mostly spotted at dedicated server.
+[] spawn
+{
+	// Based on the pretty much assumption that loadedGames are always back in time, not forward
+	private ["_history"];
+	waitUntil { time > 0 };
+	_history = diag_frameNo;
+
+	waitUntil
+	{
+		// Instead of + 1, using + 10, it seems script scheduling or something else can allow more than 1 frame skip per iteration
+		if (_history + 10 < diag_frameNo) then
+		{
+				["CBA_loadGame"] call CBA_fnc_localEvent;
+				diag_log text format["%1", _history];
+		};
+		_history = diag_frameNo;
+		false
+	};
+};
+*/
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_addDisplayHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_addDisplayHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_addDisplayHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_addDisplayHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,40 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addDisplayHandler
+
+Description:
+	Adds an action to a displayHandler
+
+Parameters:
+	_type - Displayhandler type to attach to [String].
+	_code - Code to execute upon event [String].
+
+Returns:
+	the id of the attached handler
+
+Examples:
+	(begin example)
+		_id = ["KeyDown", "_this call myKeyDownEH"] call CBA_fnc_addDisplayHandler;
+	(end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+// #define DEBUG_MODE_FULL
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(addDisplayHandler);
+
+private ["_ar", "_id", "_idx"];
+PARAMS_2(_type,_code);
+
+_type = toLower _type;
+// TODO: Verify if the eventhandler type exists?
+_ar = [GVAR(handler_hash), _type] call CBA_fnc_hashGet;
+if (typeName _ar != "ARRAY") then { _ar = [] };
+_id = if (isDedicated || isNull (findDisplay 46) || !CBA_EVENTS_DONE) then { nil } else { (findDisplay 46) displayAddEventhandler [_type, _code] };
+_idx = count _ar;
+_ar set [_idx, [if (isNil "_id") then { nil } else { _id }, _code]];
+[GVAR(handler_hash), _type, _ar] call CBA_fnc_hashSet;
+if (isNil "_id" && !isDedicated && CBA_EVENTS_DONE) then { [] spawn FUNC(attach_handler) };
+_idx;
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_addEventHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_addEventHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_addEventHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_addEventHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,44 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addEventHandler
+
+Description:
+	Registers an event handler for a specific CBA event.
+
+Parameters:
+	_eventType - Type of event to handle [String].
+	_handler - Function to call when event is raised [Code].
+
+Returns:
+	Index of the event handler (can be used with <CBA_fnc_removeEventHandler>).
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(addEventHandler);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_2(_eventType,_handler);
+
+private ["_handlers", "_handlerIndex"];
+
+_handlers = CBA_eventHandlers getVariable _eventType;
+
+if (isNil "_handlers") then {
+	// No handlers for this event already exist, so make a new event type.
+	CBA_eventHandlers setVariable [_eventType, [_handler]];
+	_handlerIndex = 0;
+} else {
+	// Handlers already recorded, so add another one.
+	_handlerIndex = count _handlers;
+	PUSH(_handlers,_handler);
+};
+
+TRACE_2("Added",_eventType,_handlerIndex);
+
+_handlerIndex; // Return.
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_addKeyHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_addKeyHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_addKeyHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_addKeyHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,50 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addKeyHandler
+
+Description:
+	Adds an action to a keyhandler
+
+Parameters:
+	_key - Numerical key to attach action to [Integer].
+	_settings - Shift, Ctrl, Alt required [Array].
+	_code - Code to execute upon event [Code].
+	_type - "keydown" (default) = keyDown,  "keyup" = keyUp [String].
+	_hashKey - used to identify this handler [String].
+
+Returns:
+
+Examples:
+	(begin example)
+		[47, [true, false, false], { _this call myAction }] call CBA_fnc_addKeyHandler;
+	(end)
+
+Author:
+	Sickboy
+
+---------------------------------------------------------------------------- */
+// #define DEBUG_MODE_FULL
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(addKeyHandler);
+
+private ["_ar", "_entry", "_type", "_handlers"];
+PARAMS_3(_key,_settings,_code);
+_type = if (count _this > 3) then { _this select 3 } else { "keydown" };
+_type = toLower _type;
+_hashKey = if (count _this > 4) then { _this select 4 } else { "" };
+_hashKey = toLower(_hashKey);
+if (_type in KEYS_ARRAY_WRONG) then { _type = ("key" + _type) };
+if !(_type in KEYS_ARRAY) exitWith { ERROR("Type does not exist") };
+
+[if (_type == "keydown") then { GVAR(keyhandlers_down) } else { GVAR(keyhandlers_up) }, _hashKey, [_key, _settings, _code]] call CBA_fnc_hashSet;
+
+_handlers = [GVAR(keyhandler_hash), _type] call CBA_fnc_hashGet;
+
+if (_key > count _handlers) then {_handlers resize(_key + 1)};
+_ar = _handlers select _key;
+if (isNil"_ar")then{_ar=[]};
+PUSH(_ar,_hashKey);
+_handlers set [_key, _ar];
+
+true;
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_addKeyHandlerFromConfig.sqf BASE_A2Free/x/cba/addons/events_fnc_addKeyHandlerFromConfig.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_addKeyHandlerFromConfig.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_addKeyHandlerFromConfig.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,43 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addKeyHandlerFromConfig
+
+Description:
+	Adds an action to a keyhandler, read from config
+
+Parameters:
+	_component - Classname under "CfgSettings" >> "CBA" >> "events" [String].
+	_action - Action classname [String].
+	_code - Code to execute upon event [Code].
+	_type - "keydown" (default) = keyDown,  "keyup" = keyUp [String].
+
+Returns:
+
+Examples:
+	(begin example)
+		["cba_sys_nvg", "nvgon", { _this call myAction }] call CBA_fnc_addKeyHandlerFromConfig
+	(end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+// #define DEBUG_MODE_FULL
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(addKeyHandlerFromConfig);
+
+private ["_key", "_type"];
+PARAMS_3(_component,_action,_code);
+_type = if (count _this > 3) then { _this select 3 } else { "keydown" };
+_type = toLower _type;
+if (_type in KEYS_ARRAY_WRONG) then { _type = ("key" + _type) };
+if !(_type in KEYS_ARRAY) exitWith { ERROR("Type does not exist") };
+_hashKey = toLower(format["%1_%2", _component, _action]);
+
+_key = [_component, _action] call CBA_fnc_readKeyFromConfig;
+if (_key select 0 > -1) exitWith {
+	[_key select 0, _key select 1, _code, _type, _hashKey] call CBA_fnc_addKeyHandler;
+	_hashKey;
+};
+
+"";
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_addLocalEventHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_addLocalEventHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_addLocalEventHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_addLocalEventHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,44 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_addLocalEventHandler
+
+Description:
+	Registers an event handler for a specific CBA event which only runs where the first parameter (object) is local.
+
+Parameters:
+	_eventType - Type of event to handle [String].
+	_handler - Function to call when event is raised [Code].
+
+Returns:
+	Index of the event handler (can be used with <CBA_fnc_removeEventHandler>).
+
+Author:
+	Xeno
+---------------------------------------------------------------------------- */
+
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(addLocalEventHandler);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_2(_eventType,_handler);
+
+private ["_handlers", "_handlerIndex"];
+
+_handlers = CBA_eventHandlersLocal getVariable _eventType;
+
+if (isNil "_handlers") then {
+	// No handlers for this event already exist, so make a new event type.
+	CBA_eventHandlersLocal setVariable [_eventType, [_handler]];
+	_handlerIndex = 0;
+} else {
+	// Handlers already recorded, so add another one.
+	_handlerIndex = count _handlers;
+	PUSH(_handlers,_handler);
+};
+
+TRACE_2("Added",_eventType,_handlerIndex);
+
+_handlerIndex; // Return.
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_changeKeyHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_changeKeyHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_changeKeyHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_changeKeyHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,65 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_changeKeyHandler
+
+Description:
+	Changes an action to a keyhandler
+
+Parameters:
+	_hashKey - String
+	_key - New key [integer]
+	_settings - Array of settings (shift, alt etc)
+	_type - Type of keyevent [String] - default keydown
+
+Returns:
+
+Examples:
+	(begin example)
+		["cba_somesystem_keyevent", 44, [false,false,false]] call CBA_fnc_changeKeyHandler;
+	(end)
+
+Author:
+	Sickboy
+
+---------------------------------------------------------------------------- */
+// #define DEBUG_MODE_FULL
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(changeKeyHandler);
+private ["_type", "_keyData", "_handlers", "_idx", "_myHandlers", "_ar"];
+PARAMS_3(_hashKey,_key,_settings);
+_type = if (count _this > 3) then { _this select 3 } else { "keydown" };
+_type = toLower _type;
+if (_type in KEYS_ARRAY_WRONG) then { _type = ("key" + _type) };
+if !(_type in KEYS_ARRAY) exitWith { ERROR("Type does not exist") };
+_hashKey = toLower _hashKey;
+_keyData = [if (_type == "keydown") then { GVAR(keyhandlers_down) } else { GVAR(keyhandlers_up) }, _hashKey] call CBA_fnc_hashGet;
+
+_handlers = [GVAR(keyhandler_hash), _type] call CBA_fnc_hashGet;
+
+// Remove existing key.
+_exit = true; // Doesn't exis?
+_idx = _keyData select 0;
+if (count _handlers > _idx) then {
+	_myHandlers = _handlers select _idx;
+	if (_hashKey in _myHandlers) then {
+		_myHandlers = _myHandlers - [_hashKey];
+		_handlers set [_idx, _myHandlers];
+		_exit = false; // does exist
+	};
+};
+
+if (_exit) exitWith { false };
+
+// Add to new key.
+if(_key>(count _handlers))then{_handlers resize(_key+1);};
+_ar = _handlers select _key;
+if(isNil"_ar")then{_ar=[]};
+PUSH(_ar,_hashKey);
+_handlers set [_key, _ar];
+
+// Update keydata
+_keyData set [0, _key];
+_keyData set [1, _settings];
+
+true;
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_globalEvent.sqf BASE_A2Free/x/cba/addons/events_fnc_globalEvent.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_globalEvent.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_globalEvent.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,29 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_globalEvent
+
+Description:
+	Raises a CBA event on all machines, including the local one.
+
+Parameters:
+	_eventType - Type of event to publish [String].
+	_params - Parameters to pass to the event handlers [Array].
+
+Returns:
+	nil
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(globalEvent);
+
+// ----------------------------------------------------------------------------
+
+_this call CBA_fnc_remoteEvent;
+_this call CBA_fnc_localEvent;
+
+nil; // Return.
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_keyHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_keyHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_keyHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_keyHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,76 @@
+/* ----------------------------------------------------------------------------
+Internal Function: CBA_events_fnc_keyHandler
+
+Description:
+	Executes the key's handler
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+// #define DEBUG_MODE_FULL
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(keyHandler);
+
+private ["_settings", "_code", "_handled", "_result", "_handlers", "_myHandlers", "_idx", "_data", "_keyhandlers"];
+#ifdef DEBUG_MODE_FULL
+	private ["_ar"];
+	_ar = [];
+#endif
+
+PARAMS_2(_keyData,_type);
+_type = toLower _type;
+
+_handlers = [GVAR(keyhandler_hash), _type] call CBA_fnc_hashGet;
+
+GVAR(keypressed) = time;
+
+_handled = false; // If true, suppress the default handling of the key.
+_result = false;
+
+_keyhandlers = if (_type == "keydown") then { GVAR(keyhandlers_down) } else { GVAR(keyhandlers_up) };
+
+_idx = _keyData select 1;
+if (count _handlers > _idx) then
+{
+	_myHandlers = _handlers select _idx;
+	if (isNil "_myHandlers") exitWith {};
+	if (typeName _myHandlers != typeName []) exitWith {};
+	{
+		_data = [_keyhandlers, _x] call CBA_fnc_hashGet;
+		TRACE_2("",_data,_x);
+		_settings = _data select 1;
+		_code = _data select 2;
+		if (true) then
+		{
+			// Verify if the required modifier keys are present
+			_exit = false;
+			// Cannot compare booleans, so must use ! && etc.
+			for "_i" from 0 to 2 do { if (((_settings select _i) && !(_keyData select (_i + 2))) || (!(_settings select _i) && (_keyData select (_i + 2)))) exitWith { _exit = true } };
+			if (_exit) exitWith {};
+			#ifdef DEBUG_MODE_FULL
+				PUSH(_ar,_code);
+			#endif
+			_result = _keyData call _code;
+
+			if (isNil "_result") then
+			{
+				WARNING("Nil result from handler.");
+				_result = false;
+			}
+			else{if ((typeName _result) != "BOOL") then
+			{
+				TRACE_1("WARNING: Non-boolean result from handler.",_result);
+				_result = false;
+			}; };
+		};
+
+		// If any handler says that it has completely _handled_ the keypress,
+		// then don't allow other handlers to be tried at all.
+		if (_result) exitWith { _handled = true };
+	} forEach _myHandlers;
+};
+TRACE_4("keyPressed",_this,_ar,_myHandlers,_handled);
+
+_handled;
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_localEvent.sqf BASE_A2Free/x/cba/addons/events_fnc_localEvent.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_localEvent.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_localEvent.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,46 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_localEvent
+
+Description:
+	Raises a CBA event only on the local machine.
+
+Parameters:
+	_eventType - Type of event to publish [String].
+	_params - Parameters to pass to the event handlers [Array, defaults to nil].
+
+Returns:
+	nil
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(localEvent);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_1(_eventType);
+DEFAULT_PARAM(1,_params,nil);
+
+private "_handlers";
+
+// Run locally.
+_handlers = CBA_eventHandlers getVariable _eventType;
+
+if (!isNil "_handlers") then {
+	{
+		if (!isNil "_x") then {
+			if (isNil "_params") then {
+				call _x;
+			} else {
+				_params call _x;
+			};
+		};
+	} forEach _handlers;
+};
+
+nil; // Return.
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_readKeyFromConfig.sqf BASE_A2Free/x/cba/addons/events_fnc_readKeyFromConfig.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_readKeyFromConfig.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_readKeyFromConfig.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,44 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_readKeyFromConfig
+
+Description:
+	Reads key setting from config
+
+Parameters:
+	_component - Classname under "CfgSettings" >> "CBA" >> "events" [String].
+	_action - Action classname [String].
+
+Returns:
+
+Examples:
+	(begin example)
+		_keyConfig = ["cba_sys_nvg", "nvgon"] call CBA_fnc_readKeyFromConfig;
+	(end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(readKeyFromConfig);
+
+private ["_component", "_action", "_settings", "_i"];
+PARAMS_2(_component,_action);
+_settings = [false, false, false];
+if (isNumber(CFGSETTINGS >> _component >> _action)) exitWith {
+	TRACE_2("",_this,getNumber(CFGSETTINGS >> _component >> _action));
+	[getNumber(CFGSETTINGS >> _component >> _action), _settings];
+};
+
+if (isClass(CFGSETTINGS >> _component >> _action)) exitWith {
+	TRACE_2("",_this,getNumber(CFGSETTINGS >> _component >> _action >> "key"));
+	_i = 0;
+	{
+		if (getNumber(CFGSETTINGS >> _component >> _action >> _x) == 1) then { _settings set [_i, true] };
+		INC(_i);
+	} forEach ["shift", "ctrl", "alt"];
+	[getNumber(CFGSETTINGS >> _component >> _action >> "key"), _settings];
+};
+
+[-1, _settings];
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_remoteEvent.sqf BASE_A2Free/x/cba/addons/events_fnc_remoteEvent.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_remoteEvent.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_remoteEvent.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,29 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_remoteEvent
+
+Description:
+	Raises a CBA event on all machines EXCEPT the local one.
+
+Parameters:
+	_eventType - Type of event to publish [String].
+	_params - Parameters to pass to the event handlers [Array].
+
+Returns:
+	nil
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(remoteEvent);
+
+// ----------------------------------------------------------------------------
+// Run remotely.
+CBA_e = _this;
+publicVariable "CBA_e"; // Nasty short name to limit bandwidth.
+
+nil; // Return.
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_remoteLocalEvent.sqf BASE_A2Free/x/cba/addons/events_fnc_remoteLocalEvent.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_remoteLocalEvent.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_remoteLocalEvent.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,54 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_remoteLocalEvent
+
+Description:
+	Raises a CBA event only on the machine where parameter one is local.
+
+Parameters:
+	_eventType - Type of event to publish [String].
+	_params - Parameters to pass to the event handlers. First param must be the object to check
+
+Returns:
+	nil
+
+Author:
+	Xeno
+---------------------------------------------------------------------------- */
+
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(remoteLocalEvent);
+
+// ----------------------------------------------------------------------------
+PARAMS_1(_eventType);
+DEFAULT_PARAM(1,_params,nil);
+
+private "_locobj";
+_locobj = if (typeName _params == typeName []) then {_params select 0} else {_params};
+
+// doing a local check first
+if (!local _locobj) exitWith {
+	TRACE_1("Not local",_locobj);
+	nil
+};
+
+TRACE_1("",_locobj);
+
+private "_handlers";
+_handlers = CBA_eventHandlersLocal getVariable _eventType;
+
+if (!isNil "_handlers") then {
+	{
+		if (!isNil "_x") then {
+			if (isNil "_params") then {
+				call _x;
+			} else {
+				_params call _x;
+			};
+		};
+	} forEach _handlers;
+};
+
+nil; // Return.
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_removeDisplayHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_removeDisplayHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_removeDisplayHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_removeDisplayHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,39 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_removeDisplayHandler
+
+Description:
+	Removes an action to a displayHandler
+
+Parameters:
+	_type - Displayhandler type to attach to [String].
+	_id - Displayhandler ID to remove [Code].
+
+Returns:
+
+Examples:
+	(begin example)
+		["KeyDown", _id] call CBA_fnc_removeDisplayHandler;
+	(end)
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(removeDisplayHandler);
+
+private ["_ar", "_entry"];
+PARAMS_2(_type,_index);
+
+_type = toLower _type;
+_ar = [GVAR(handler_hash), _type] call CBA_fnc_hashGet;
+if (typeName _ar == "ARRAY") then {
+	if (count _ar <= _index) exitWith {}; // Doesn't exist
+	_entry = _ar select _index;
+	if (count _entry > 1) then {
+		if !(isDedicated) then { (findDisplay 46) displayRemoveEventhandler [_type, _entry select 0] };
+		_ar set [_index, [nil]];
+		[GVAR(handler_hash), _type, _ar] call CBA_fnc_hashSet;
+	};
+};
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_removeEventHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_removeEventHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_removeEventHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_removeEventHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,51 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_removeEventHandler
+
+Description:
+	Removes an event handler previously registered with CBA_fnc_addEventHandler.
+
+Parameters:
+	_eventType - Type of event to remove [String].
+	_handlerIndex - Index of the event handler to remove [Number].
+
+Returns:
+	nil
+
+TODO:
+	Use Hash to store handlers as a sparse array, to save on lots of empty
+	elements in the array if lots of removes are made.
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(removeEventHandler);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_2(_eventType,_handlerIndex);
+
+private "_handlers";
+
+_handlers = CBA_eventHandlers getVariable _eventType;
+
+if (isNil "_handlers") then {
+	WARNING("Event type not registered: " + (str _eventType));
+} else {
+	if (count _handlers > _handlerIndex) then {
+		if (isNil { _handlers select _handlerIndex } ) then {
+			WARNING("Handler for event " + (str _eventType) + " index " + (str _handlerIndex) + " already removed.");
+		} else {
+			_handlers set [_handlerIndex, nil];
+			TRACE_2("Removed",_eventType,_handlerIndex);
+		};
+	} else {
+		WARNING("Handler for event " + (str _eventType) + " index " + (str _handlerIndex) + " never set.");
+	};
+};
+
+nil; // Return.
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_removeKeyHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_removeKeyHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_removeKeyHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_removeKeyHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,48 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_removeKeyHandler
+
+Description:
+	Removes an action to a keyhandler
+
+Parameters:
+	_hashKey
+
+Returns:
+
+Examples:
+	(begin example)
+		["cba_somesystem_keyevent"] call CBA_fnc_removeKeyHandler;
+	(end)
+
+Author:
+	Sickboy
+
+---------------------------------------------------------------------------- */
+// #define DEBUG_MODE_FULL
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(removeKeyHandler);
+private ["_type", "_hashKey", "_keyData", "_handlers", "_idx", "_myHandlers"];
+PARAMS_1(_hashKey);
+_type = if (count _this > 1) then { _this select 1 } else { "keydown" };
+_type = toLower _type;
+if (_type in KEYS_ARRAY_WRONG) then { _type = ("key" + _type) };
+if !(_type in KEYS_ARRAY) exitWith { ERROR("Type does not exist") };
+_hashKey = toLower _hashKey;
+_keyData = [if (_type == "keydown") then { GVAR(keyhandlers_down) } else { GVAR(keyhandlers_up) }, _hashKey] call CBA_fnc_hashGet;
+
+_handlers = [GVAR(keyhandler_hash), _type] call CBA_fnc_hashGet;
+
+// Remove existing key.
+_idx = _keyData select 0;
+if (count _handlers > _idx) then {
+	_myHandlers = _handlers select _idx;
+	if (_hashKey in _myHandlers) then {
+		_myHandlers = _myHandlers - [_hashKey];
+		_handlers set [_idx, _myHandlers];
+	};
+};
+
+
+true;
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_removeLocalEventHandler.sqf BASE_A2Free/x/cba/addons/events_fnc_removeLocalEventHandler.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_removeLocalEventHandler.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_removeLocalEventHandler.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,51 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_removeLocalEventHandler
+
+Description:
+	Removes an event handler previously registered with CBA_fnc_addLocalEventHandler.
+
+Parameters:
+	_eventType - Type of event to remove [String].
+	_handlerIndex - Index of the event handler to remove [Number].
+
+Returns:
+	nil
+
+TODO:
+	Use Hash to store handlers as a sparse array, to save on lots of empty
+	elements in the array if lots of removes are made.
+
+Author:
+	Xeno
+---------------------------------------------------------------------------- */
+
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(removeLocalEventHandler);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_2(_eventType,_handlerIndex);
+
+private "_handlers";
+
+_handlers = CBA_eventHandlersLocal getVariable _eventType;
+
+if (isNil "_handlers") then {
+	WARNING("Event type not registered: " + (str _eventType));
+} else {
+	if (count _handlers > _handlerIndex) then {
+		if (isNil { _handlers select _handlerIndex } ) then {
+			WARNING("Handler for event " + (str _eventType) + " index " + (str _handlerIndex) + " already removed.");
+		} else {
+			_handlers set [_handlerIndex, nil];
+			TRACE_2("Removed",_eventType,_handlerIndex);
+		};
+	} else {
+		WARNING("Handler for event " + (str _eventType) + " index " + (str _handlerIndex) + " never set.");
+	};
+};
+
+nil; // Return.
diff -rupN BASE_MISSION/x/cba/addons/events_fnc_whereLocalEvent.sqf BASE_A2Free/x/cba/addons/events_fnc_whereLocalEvent.sqf
--- BASE_MISSION/x/cba/addons/events_fnc_whereLocalEvent.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_fnc_whereLocalEvent.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,56 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_whereLocalEvent
+
+Description:
+	Raises a CBA event only on the machine where parameter one is local.
+
+Parameters:
+	_eventType - Type of event to publish [String].
+	_params - Parameters to pass to the event handlers. First param must be the object to check
+
+Returns:
+	nil
+
+Author:
+	Xeno
+---------------------------------------------------------------------------- */
+
+#include "events_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(whereLocalEvent);
+
+// ----------------------------------------------------------------------------
+
+DEFAULT_PARAM(1,_params,nil);
+
+if (isNil "_params") exitWith {
+	WARNING("Locality check parameter in CBA_fnc_whereLocalEvent function is missing!");
+};
+
+private "_locobj";
+_locobj = if (typeName _params == typeName []) then {_params select 0} else {_params};
+
+if (typeName _locobj != "OBJECT") exitWith {
+	WARNING("Locality check parameter is not an object!");
+	nil
+};
+
+TRACE_1("",_locobj);
+
+if (isNil "_locobj" || isNull _locobj) exitWith {
+	WARNING("Locality check object is nil or null!");
+	nil
+};
+
+// doing a local check first
+if (!local _locobj) exitWith {
+	CBA_l = _this;
+	publicVariable "CBA_l";
+	nil
+};
+
+_this call FUNC(remoteLocalEvent);
+
+nil; // Return.
diff -rupN BASE_MISSION/x/cba/addons/events_script_component.hpp BASE_A2Free/x/cba/addons/events_script_component.hpp
--- BASE_MISSION/x/cba/addons/events_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/events_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,17 @@
+#define COMPONENT events
+#include "script_mod.hpp"
+
+#define KEYS_ARRAY_WRONG ['down', 'up']
+#define KEYS_ARRAY ['keydown', 'keyup']
+
+// #define DEBUG_ENABLED_EVENTS
+
+#ifdef DEBUG_ENABLED_EVENTS
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_EVENTS
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_EVENTS
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/extended_eventhandlers_Init.sqf BASE_A2Free/x/cba/addons/extended_eventhandlers_Init.sqf
--- BASE_MISSION/x/cba/addons/extended_eventhandlers_Init.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/extended_eventhandlers_Init.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,317 @@
+// #define DEBUG_MODE_FULL
+#include "extended_eventhandlers_script_component.hpp"
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+/*  Extended event handlers by Solus
+*
+*  Get all inherited classes, then check if each inherited class has a counter-
+*  part in the extended event handlers classes, then and add all lines from
+*  each matching EH class and exec them.
+*/
+private [
+	"_slx_xeh_unit", "_Extended_Init_Class", "_isRespawn", "_slx_xeh_unitClass", "_classes",
+	"_inits", "_init", "_excludeClass", "_excludeClasses", "_isExcluded",
+	"_onRespawn", "_useEH", "_i", "_t", "_cfgEntry", "_scopeEntry",
+	"_initEntry", "_excludeEntry", "_respawnEntry", "_u", "_eic", "_sim", "_crew",
+	"_clientInitEntry", "_serverInitEntry", "_serverInit", "_clientInit",
+	"_justCreated", "_playable", "_isMan", "_names", "_idx", "_fSetInit", "_post", "_isDelayed",
+	"_sys_inits"
+];
+
+#ifdef DEBUG_MODE_FULL
+	format["XEH BEG: %2, %3", time, _this, local (_this select 0), typeOf (_this select 0)] call SLX_XEH_LOG;
+#endif
+
+// Get unit.
+_slx_xeh_unit = _this select 0;
+if (isNull _slx_xeh_unit) exitWith {
+	#ifdef DEBUG_MODE_FULL
+		format["XEH EXIT - NULL OBJECT: %2", time, _this] call SLX_XEH_LOG;
+	#endif
+};
+_Extended_Init_Class = _this select 1;
+_isRespawn = if (count _this < 3) then { false } else { _this select 2 };
+_isDelayed = if (count _this < 4) then { false } else { _this select 3 };
+_slx_xeh_unitClass = typeOf _slx_xeh_unit;
+
+_post = _Extended_Init_Class == "Extended_InitPost_EventHandlers";
+
+// Multiplayer respawn handling
+// Bug #7432 fix - all machines will re-run the init EH where the unit is not local, when a unit respawns
+_sim = getText(configFile/"CfgVehicles"/_slx_xeh_unitClass/"simulation");
+_isMan = _slx_xeh_unit isKindOf "Man" || { _sim == _x }count["soldier"] > 0; // "invisible"
+
+if (count _this == 2 && _isMan && (time>0) && (SLX_XEH_MACHINE select 9) && !_post) exitWith
+{
+	// Delay initialisation until we can check if it's a respawned unit
+	// or a createUnit:ed one. (Respawned units will have the object variable
+	// "slx_xeh_isplayable" set to true)
+	#ifdef DEBUG_MODE_FULL
+		format["XEH: (Bug #7432) deferring init for %2 ",time, _this] call SLX_XEH_LOG;
+	#endif
+
+	// Wait for the unit to be fully "ready"
+	if (SLX_XEH_MACHINE select 7) then {
+		_h = [_slx_xeh_unit] spawn SLX_XEH_INIT_DELAYED;
+	} else {
+		SLX_XEH_DELAYED set [count SLX_XEH_DELAYED, _slx_xeh_unit];
+	};
+
+	#ifdef DEBUG_MODE_FULL
+	format["XEH END: %2", time, _this] call SLX_XEH_LOG;
+	#endif
+	nil;
+};
+
+if (_isMan) then { if !(isNil "SLX_XEH_INIT_MEN") then { PUSH(SLX_XEH_INIT_MEN,_slx_xeh_unit) } }; // naughty JIP crew double init!
+
+// Get array of inherited classes of unit.
+_classes = [_slx_xeh_unitClass];
+while { !((_classes select 0) in ["", "All"]) } do
+{
+	_classes = [(configName (inheritsFrom (configFile/"CfgVehicles"/(_classes select 0))))]+_classes;
+};
+
+// Check each class to see if there is a counterpart in extended event handlers
+// If there is, add it to an array of init event handlers "_inits". Use
+// _names to keep track of handler entry names so that a given handler
+// of a certain name can be overriden in a child class.
+// (See dev-heaven.net issues #12104 and #12108)
+_names = [];	// event handler config entry names
+_inits = [];	// array of handlers or arrays with handlers, the
+			// later being used for XEH handlers that make use of
+			// the serverInit and clientInit feature.
+_init = {};
+_excludeClass = "";
+_excludeClasses = [];
+_isExcluded = { (_slx_xeh_unitClass isKindOf _excludeClass) || ({ _slx_xeh_unitClass isKindOf _x }count _excludeClasses>0) };
+
+// Function to update the event handler or handlers at a given index
+// into the _inits array
+_fSetInit = {
+	private ["_idx", "_init", "_type", "_handler", "_cur"];
+
+	_idx=_this select 0;
+	_init = _this select 1;
+	_type=["all", "server", "client"] find (_this select 2);	// 0 1 2
+
+	_handler={};
+	_cur=_inits select _idx;
+	if (isNil"_cur")then{_cur={};};
+	if (typeName _cur == "ARRAY") then
+	{
+		_handler = _cur;
+		_handler set [_type, _init];
+	} else {
+		if (_type > 0) then
+		{
+			_handler=[_cur,{},{}];
+			_handler set [_type, _init];
+		} else {
+			_handler=_init;
+		};
+	};
+	_inits set [_idx, _handler];
+};
+
+
+/*  If we're called following a respawn, the use of a XEH init EH is
+*  determined by the "composite EH" class property "onRespawn". The default
+*  is to not call the XEH init EH, since the ArmA default behaviour is that
+*  "init" event handlers are not called when a unit respawns.
+*/
+_onRespawn=false;
+_useEH = { if (_isRespawn) then { _onRespawn } else { true } };
+
+// Naughty but more flexible...
+_sys_inits = [];
+if !(_isRespawn) then {
+	// Compile code for other EHs to run and put them in the setVariable.
+	// Set up code for the remaining event handlers too...
+	// This is in PostInit as opposed to (pre)Init,
+	// because units in a player's group setVariables are lost (counts at least for disabledAI = 1;)
+	// Run men's SLX_XEH_initOthers in PostInit, only when in Multiplayer
+	// Run supportM
+	if (_post) then {
+		if (_isMan) then {
+			_sys_inits set [count _sys_inits, {_this call SLX_XEH_initPlayable }];
+			if (isMultiplayer) then { _sys_inits set [count _sys_inits, {_this call SLX_XEH_initOthers}] };
+		};
+	} else {
+		_sys_inits set [count _sys_inits, {_this call SLX_XEH_FNC_SUPPORTM2}];
+		if (!_isMan || !isMultiplayer) then { _sys_inits set [count _sys_inits, {_this call SLX_XEH_initOthers}] };
+	};
+};
+
+if !(_post) then { _sys_inits set [count _sys_inits, compile format ["[_this select 0, %1, %2] call SLX_XEH_initPost",_isRespawn,_isDelayed]] };
+
+
+/*
+*  Several BIS vehicles use a set of EH:s in the BIS "DefaultEventhandlers"
+*  ("DEH" in the following) class - Car, Tank, Helicopter, Plane and Ship.
+*
+*  Further, The AAV class uses a variation of this DefaultEventhandlers set with
+*  it's own specific init EH.  Here, we make sure to include the BIS DEH init
+*  event handler and make it the first one that will be called by XEH. The AAV
+*  is accomodated by code further below and two composite
+*  Extended_Init_EventHandlers definitions in the config.cpp that define
+*  a property "replaceDefault" which will replace the DEH init with the
+*  class-specific BIS init EH for that vehicle.
+*/
+
+_useDEHinit = false;
+if !(_post) then
+{
+	_ehSuper = inheritsFrom(configFile/"CfgVehicles"/_slx_xeh_unitClass/"EventHandlers");
+	if (configName(_ehSuper)=="DefaultEventhandlers") then
+	{
+		if (isText (configFile/"DefaultEventhandlers"/"init")) then
+		{
+			_useDEHinit = true;
+			_DEHinit = getText(configFile/"DefaultEventhandlers"/"init");
+			_inits = [compile(_DEHinit)];
+		};
+	};
+};
+
+// All inits
+{
+	_configFile=_x;
+	{
+		if ((configName (_configFile/_Extended_Init_Class/_x))!= "") then
+		{
+			_i = 0;
+			_t = count (_configFile/_Extended_Init_Class/_x);
+			while { _i<_t } do
+			{
+				_cfgEntry = (_configFile/_Extended_Init_Class/_x) select _i;
+				_name = configName _cfgEntry;
+				_idx = _names find _name;
+				if (_idx < 0) then
+				{
+					// This particular handler entry name hasn't been seen
+					// yet, so add it to the end of the _inits array
+					_idx = count _inits;
+					_names set [_idx, _name];
+				};
+				// Standard XEH init string
+				if (isText _cfgEntry && [] call _useEH) then
+				{
+					_inits set [_idx, compile(getText _cfgEntry)];
+				} else {
+					// Composite XEH init class
+					if (isClass _cfgEntry) then
+					{
+						_scopeEntry = _cfgEntry / "scope";
+						_initEntry = _cfgEntry / "init";
+						_serverInitEntry = _cfgEntry / "serverInit";
+						_clientInitEntry = _cfgEntry / "clientInit";
+						_excludeEntry = _cfgEntry / "exclude";
+						_respawnEntry = _cfgEntry / "onRespawn";
+						_replaceEntry = _cfgEntry / "replaceDEH";
+						_excludeClasses = [];
+						_excludeClass = "";
+						if (isText _excludeEntry) then
+						{
+							_excludeClass = (getText _excludeEntry);
+						} else {
+							if (isArray _excludeEntry) then
+							{
+								_excludeClasses = (getArray _excludeEntry);
+							};
+						};
+						_onRespawn = false;
+						if (isText _respawnEntry) then
+						{
+							_onRespawn = ({ (getText _respawnEntry) == _x }count["1", "true"]>0);
+						} else {
+							if (isNumber _respawnEntry) then
+							{
+								_onRespawn = ((getNumber _respawnEntry) == 1);
+							};
+						};
+						_replaceDEH = false;
+						if (isText _replaceEntry) then
+						{
+							_replaceDEH = ({ (getText _replaceEntry) == _x }count["1", "true"]>0);
+						} else {
+							if (isNumber _replaceEntry) then
+							{
+								_replaceDEH = ((getNumber _replaceEntry) == 1);
+							};
+						};
+						_scope = if (isNumber _scopeEntry) then { getNumber _scopeEntry } else { 2 };
+						if !(_scope == 0 && (_slx_xeh_unitClass != _x)) then
+						{
+							if (!([] call _isExcluded) && [] call _useEH) then
+							{
+								if (isText _initEntry) then
+								{
+									/*  If the init EH is private and vehicle is of the
+									*  "wrong" class, do nothing, ie don't add the EH.
+									*  Also, if we're called after a respawn and the
+									*  init EH shouldn't be used, then don't.
+									*/
+									_init = compile(getText _initEntry);
+									if (_useDEHinit && _replaceDEH) then
+									{
+										//_inits set [0, _init];
+										[0, _init, "all"] call _fSetInit;
+									} else {
+										//_inits set [_idx, _init];
+										[_idx, _init, "all"] call _fSetInit;
+									};
+								};
+								if (SLX_XEH_MACHINE select 3) then
+								{
+									if (isText _serverInitEntry) then
+									{
+										_serverInit = compile(getText _serverInitEntry);
+										//_inits set [_idx, _serverInit];
+										[_idx, _serverInit, "server"] call _fSetInit;
+									};
+								};
+								if (SLX_XEH_MACHINE select 0) then
+								{
+									if (isText _clientInitEntry) then
+									{
+										_clientInit = compile(getText _clientInitEntry);
+										//_inits set [_idx, _clientInit];
+										[_idx, _clientInit, "client"] call _fSetInit;
+									};
+								};
+							};
+						};
+					};
+				};
+				_i = _i+1;
+			};
+		};
+	} forEach _classes;
+} forEach [configFile, campaignConfigFile, missionConfigFile];
+
+if (count _sys_inits > 0) then { _inits = _sys_inits + _inits };
+
+// Now call all the init EHs on the unit.
+#ifdef DEBUG_MODE_FULL
+format["XEH RUN: %2 - %3 - %4", time, _this, typeOf (_this select 0), _inits] call SLX_XEH_LOG;
+#endif
+
+{
+	private ["_h"];
+	if (typeName _x=="CODE") then
+	{
+		// Normal code type handler
+		[_slx_xeh_unit] call _x;
+	} else {
+		// It's an array of handlers (all, server, client)
+		_h=_x;
+		{[_slx_xeh_unit] call _x} forEach _h;
+	};
+} forEach _inits;
+
+#ifdef DEBUG_MODE_FULL
+format["XEH END: %2", time, _this] call SLX_XEH_LOG;
+#endif
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/extended_eventhandlers_InitOthers.sqf BASE_A2Free/x/cba/addons/extended_eventhandlers_InitOthers.sqf
--- BASE_MISSION/x/cba/addons/extended_eventhandlers_InitOthers.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/extended_eventhandlers_InitOthers.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,276 @@
+/* Extended event handlers by Solus and Killswitch
+*
+* Get all inherited classes, then check if each inherited class has a
+* counterpart in the extended event handlers classes. Then and add all lines
+* from each matching EH class and set things up.
+*
+*/
+// #define DEBUG_MODE_FULL
+#include "extended_eventhandlers_script_component.hpp"
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+private [
+	"_unit", "_isExcluded", "_event", "_Extended_EH_Class", "_class",
+	"_unitClass", "_classes", "_excludeClass", "_excludeClasses", "_handlers",
+	"_handler", "_cfgEntry", "_scopeEntry", "_handlerEntry", "_excludeEntry",
+	"_scope", "_i", "_t", "_xeh", "_event", "_replaceDEH", "_name", "_names",
+	"_namesPlayer", "_idx", "_idxPlayer", "_ha"
+];
+
+#ifdef DEBUG_MODE_FULL
+	format["XEH BEG: %2 - %3", time, _this, typeOf (_this select 0)] call SLX_XEH_LOG;
+#endif
+
+// Get unit.
+_unit = _this select 0;
+_unitClass = typeOf _unit;
+
+_ehSuper = inheritsFrom(configFile/"CfgVehicles"/_unitClass/"EventHandlers");
+_hasDefaultEH = (configName(_ehSuper)=="DefaultEventhandlers");
+
+_isExcluded = { (_unitClass isKindOf _excludeClass) || ({ _unitClass isKindOf _x }count _excludeClasses>0) };
+
+// Get array of inherited classes of unit.
+_classes = [_unitClass];
+while {!((_classes select 0) in ["", "All"])} do
+{
+	_classes = [(configName (inheritsFrom (configFile/"CfgVehicles"/(_classes select 0))))]+_classes;
+};
+
+// Adds or updates a handler in the _handlers or _handlersPlayer arrays
+// used when collecting event handlers.
+_fSetHandler = {
+	private ["_idx", "_handler", "_h", "_type", "_cur"];
+
+	_idx=_this select 0;
+	_handler = _this select 1;
+	_type=["all", "server", "client"] find (_this select 2);
+
+	_h="";
+	_cur=_handlers select _idx;
+	if (isNil"_cur")then{_cur="";};
+	if (typeName _cur == "ARRAY") then
+	{
+		_h = _cur;
+		_h set [_type, _handler]
+	} else {
+		if (_type > 0) then
+		{
+			_h=[_cur,"",""];
+			_h set [_type, _handler];
+		} else {
+			_h=_handler;
+		};
+	};
+	_handlers set [_idx, _h];
+};
+
+_f = {
+	private ["_handlers", "_eventCus", "_idx"];
+	_eventCus = format["%1%2",_event, _this select 0];
+	_handlers = _this select 1;
+	_idx = _this select 2;
+	_handlerEntry = _cfgEntry / _eventCus;
+	_serverHandlerEntry = _cfgEntry / format["server%1", _eventCus];
+	_clientHandlerEntry = _cfgEntry / format["client%1", _eventCus];
+	// If the particular EH is private and vehicle is of the
+	// "wrong" class, do nothing, ie don't add the EH.
+	//diag_log ["EventCus",_eventCus, getText _handlerEntry,_handlers];
+	if !(_scope == 0 && (_unitClass != _class)) then
+	{
+		if !( [] call _isExcluded ) then
+		{
+			if (isText _handlerEntry) then
+			{
+				if (isText _replaceEntry) then
+				{
+					_replaceDEH = ({ (getText _replaceEntry) == _x }count["1", "true"]>0);
+				} else {
+					if (isNumber _replaceEntry) then
+					{
+						_replaceDEH = ((getNumber _replaceEntry) == 1);
+					};
+				};
+				if (_hasDefaultEH && _replaceDEH) then
+				{
+					//_handlers set [0, getText _handlerEntry];
+					[0, getText _handlerEntry, "all"] call _fSetHandler;
+				} else {
+					//_handlers set [count _handlers, getText _handlerEntry];
+					[_idx, getText _handlerEntry, "all"] call _fSetHandler;
+				};
+			};
+			if (SLX_XEH_MACHINE select 3) then
+			{
+				if (isText _serverHandlerEntry) then
+				{
+					//_handlers set [count _handlers, getText _serverHandlerEntry];
+					[_idx, getText _serverHandlerEntry, "server"] call _fSetHandler;
+				};
+			};
+			if (SLX_XEH_MACHINE select 0) then
+			{
+				if (isText _clientHandlerEntry) then
+				{
+					//_handlers set [count _handlers, getText _clientHandlerEntry];
+					[_idx, getText _clientHandlerEntry, "client"] call _fSetHandler;
+				};
+			};
+		} else {
+			#ifdef DEBUG_MODE_FULL
+				str(["Excluded", _unit, _class, _excludeClass, _excludeClasses]) call SLX_XEH_LOG;
+			#endif
+		};
+	} else {
+		#ifdef DEBUG_MODE_FULL
+			str(["Scoped", _unit, _class, _scope]) call SLX_XEH_LOG;
+		#endif
+	};
+};
+
+// Iterate over the above event types and set up any extended event handlers
+// that might be defined.
+{
+	_event = _x;
+	_Extended_EH_Class = format["Extended_%1_EventHandlers", _event];
+
+	// Check each class to see if there is a counterpart in the extended event
+	// handlers, add all lines from matching classes to an array, "_handlers"
+	_handlers = []; _handlersPlayer = [];
+	_names = []; _namesPlayer = [];
+
+	// Does the vehicle's class EventHandlers inherit from the BIS
+	// DefaultEventhandlers? If so, include BIS own default handler for the
+	// event type currently being processed and make it the first
+	// EH to be called.
+	if (_hasDefaultEH && isText(configFile/"DefaultEventhandlers"/_event)) then
+	{
+		_handlers = [getText(configFile/"DefaultEventhandlers"/_event)];
+	};
+
+	// Search the mission config file (description.ext), then campaign
+	// config file (description.ext) and finally addon config for
+	// extended event handlers to use.
+	{
+		_configFile=_x;
+		{
+			_class = _x;
+			if ((configName (_configFile/_Extended_EH_Class/_class))!= "") then
+			{
+				_i = 0;
+				_t = count (_configFile/_Extended_EH_Class/_class);
+				while { _i<_t } do
+				{
+					_excludeClass = "";
+					_excludeClasses = [];
+					_cfgEntry = (_configFile/_Extended_EH_Class/_class) select _i;
+					_name = configName _cfgEntry;
+					_idx = _names find _name;
+					if (_idx < 0) then
+					{
+						_idx = count _handlers;
+						_names set [_idx, _name];
+					};
+					_idxPlayer = _namesPlayer find _name;
+					if (_idxPlayer < 0) then
+					{
+						_idxPlayer = count _handlersPlayer;
+						_namesPlayer set [_idxPlayer, _name];
+					};
+					// Standard XEH event handler string
+					if (isText _cfgEntry) then
+					{
+						//_handlers set [count _handlers, getText _cfgEntry];
+						_handlers set [_idx, getText _cfgEntry];
+					} else {
+						// Composite XEH event handler class
+						if (isClass _cfgEntry) then
+						{
+							_scopeEntry = _cfgEntry / "scope";
+							_excludeEntry = _cfgEntry / "exclude";
+							_replaceEntry = _cfgEntry / "replaceDEH";
+							_replaceDEH = false;
+
+							if (isText _excludeEntry) then
+							{
+								_excludeClass = (getText _excludeEntry);
+							} else {
+								if (isArray _excludeEntry) then
+								{
+									_excludeClasses = (getArray _excludeEntry);
+								};
+							};
+							_scope = if (isNumber _scopeEntry) then { getNumber _scopeEntry } else { 2 };
+							// Handle event, serverEvent and clientEvent, for both normal and player
+							{ _x call _f } forEach [["", _handlers, _idx], ["Player", _handlersPlayer, _idxPlayer]];
+						};
+					};
+					_i = _i + 1;
+				};
+			};
+		} forEach _classes;
+	} forEach [configFile, campaignConfigFile, missionConfigFile];
+
+	// Now concatenate all the handlers into one string
+	_handler = "";
+	{
+		if (typeName _x=="STRING") then
+		{
+			// Some entries are empty, because they do not contain all variants (server, client, and normal)
+			if (_x != "") then {
+				_handler = _handler + _x + ";"
+			};
+		} else {
+			_h=_x;
+			// Some entries are empty, because they do not contain all variants (server, client, and normal)
+			{
+				if (_x != "") then {
+					_handler = _handler + _x + ";"
+				};
+			} forEach _h;
+		};
+	} forEach _handlers;
+
+	_handlerPlayer = "";
+	{
+		if (typeName _x=="STRING") then
+		{
+			// Some entries are empty, because they do not contain all variants (server, client, and normal)
+			if (_x != "") then {
+				_handlerPlayer = _handlerPlayer + _x + ";"
+			};
+		} else {
+			_h=_x;
+			{
+				// Some entries are empty, because they do not contain all variants (server, client, and normal)
+				if (_x != "") then {
+					_handlerPlayer = _handlerPlayer + _x + ";"
+				};
+			} forEach _h;
+		};
+	} forEach _handlersPlayer;
+	
+	if (isNull _unit) exitWith {};
+
+	// Attach the compiled extended event handler to the unit.
+	_xeh = format["Extended_%1EH", _event];
+	_xehPlayer = format["Extended_%1EH_Player", _event];
+	_ha = _unit getVariable _xeh;
+	if (isNil "_ha") then { _ha = [] };
+	if (_handler != "") then {
+		_ha set [0, compile _handler];
+	};
+	_unit setVariable [_xeh, _ha];
+	_unit setVariable [_xehPlayer, compile _handlerPlayer];
+
+	#ifdef DEBUG_MODE_FULL
+		format["XEH RUN: %2 - %3 - %4 - %5", time, _this, _event, typeOf (_this select 0), _handler != "", _handlerPlayer != ""] call SLX_XEH_LOG;
+	#endif
+} forEach SLX_XEH_OTHER_EVENTS;
+
+_unit setVariable ["SLX_XEH_READY", true];
+
+#ifdef DEBUG_MODE_FULL
+	format["XEH END: %2", time, _this] call SLX_XEH_LOG;
+#endif
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/extended_eventhandlers_InitPost.sqf BASE_A2Free/x/cba/addons/extended_eventhandlers_InitPost.sqf
--- BASE_MISSION/x/cba/addons/extended_eventhandlers_InitPost.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/extended_eventhandlers_InitPost.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,15 @@
+#include "extended_eventhandlers_script_component.hpp"
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#define INITPOST _unit, "Extended_InitPost_EventHandlers"
+
+private ["_unit", "_isRespawn", "_isDelayed"];
+_unit = _this select 0; _isRespawn = _this select 1; _isDelayed = _this select 2;
+
+// Add unit to InitPost mechanism, or else spawn initPost manually (JIP probably)
+if (SLX_XEH_MACHINE select 7) then
+{
+	if (_isDelayed) then { [INITPOST, _isRespawn, _isDelayed] call SLX_XEH_init } else { [INITPOST, _isRespawn, _isDelayed] spawn SLX_XEH_init }; // Spawn; Otherwise setVariable won't hold etc
+} else {
+	// StartInit was not yet done, this unit is spawned in start of mission
+	SLX_XEH_objects set [count SLX_XEH_objects, [INITPOST, _isRespawn, _isDelayed]];
+};
diff -rupN BASE_MISSION/x/cba/addons/extended_eventhandlers_InitXEH.sqf BASE_A2Free/x/cba/addons/extended_eventhandlers_InitXEH.sqf
--- BASE_MISSION/x/cba/addons/extended_eventhandlers_InitXEH.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/extended_eventhandlers_InitXEH.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,414 @@
+// #define DEBUG_MODE_FULL
+#include "extended_eventhandlers_script_component.hpp"
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+// Compile all necessary scripts and start one vehicle crew initialisation thread
+SLX_XEH_DisableLogging = isClass(configFile/"CfgPatches"/"Disable_XEH_Logging");
+XEH_LOG("XEH: PreInit Started. v"+getText(configFile >> "CfgPatches" >> "Extended_Eventhandlers" >> "version"));
+if (time > 0) then { XEH_LOG("XEH WARNING: Time > 0; This probably means there are no XEH compatible units by default on the map, perhaps add the SLX_XEH_Logic module.") };
+
+private ["_cfgRespawn", "_respawn"];
+_cfgRespawn = (missionConfigFile/"respawn");
+_respawn = false;
+if ( isNumber(_cfgRespawn) ) then
+{
+	_respawn = !(getNumber(_cfgRespawn) in [0, 1, 4, 5]);
+};
+if ( isText(_cfgRespawn) ) then
+{
+	_respawn = !(getText(_cfgRespawn) in ["none", "bird", "group", "side"]);
+};
+
+SLX_XEH_MACHINE =
+[
+	!isDedicated, // 0 - isClient (and thus has player)
+	false, // 1 - isJip
+	!isServer, // 2 - isDedicatedClient (and thus not a Client-Server)
+	isServer, // 3 - isServer
+	isDedicated, // 4 - isDedicatedServer (and thus not a Client-Server)
+	false, // 5 - Player Check Finished
+	!isMultiplayer, // 6 - SP?
+	false, // 7 - StartInit Passed
+	false, // 8 - Postinit Passed
+	isMultiplayer && _respawn      // 9 - Multiplayer && respawn?
+];
+
+SLX_XEH_objects = [];
+SLX_XEH_INIT_MEN = [];
+// All events except the init event
+SLX_XEH_OTHER_EVENTS = [XEH_EVENTS,XEH_CUSTOM_EVENTS];
+
+SLX_XEH_LOG = {
+	XEH_LOG(_this);
+};
+
+// Process each new unit
+SLX_XEH_F_INIT = {
+	private [
+		"_i", "_c", "_entry", "_entryServer", "_entryClient", "_Inits"
+	];
+	_Inits = [];
+	#ifdef DEBUG_MODE_FULL
+	_msg = format["XEH BEG: Init %1", _this];
+	XEH_LOG(_msg);
+	#endif
+
+	if (isClass _this) then
+	{
+		_i = 0;
+		_c = count _this;
+		while { _i<_c } do
+		{
+			_entry = _this select _i;
+			if (isClass _entry) then
+			{
+				_entryServer = (_entry/"serverInit");
+				_entryClient = (_entry/"clientInit");
+				_entry = (_entry/"init");
+				if (isText _entry) then
+				{
+					_Inits set [count _Inits, compile(getText _entry)];
+				};
+				if (SLX_XEH_MACHINE select 3) then
+				{
+					if (isText _entryServer) then
+					{
+						_Inits set [count _Inits, compile(getText _entryServer)];
+					};
+				};
+				if (!isDedicated) then
+				{
+					if (isText _entryClient) then
+					{
+						_Inits set [count _Inits, compile(getText _entryClient)];
+					};
+				};
+			} else {
+				if (isText _entry) then
+				{
+					_Inits set [count _Inits, compile(getText _entry)];
+				};
+			};
+			_i = _i+1;
+		};
+		{
+			#ifdef DEBUG_MODE_FULL
+				XEH_LOG(_x);
+			#endif
+			call _x;
+		} forEach _Inits;
+	};
+	#ifdef DEBUG_MODE_FULL
+	_msg = format["XEH END: Init %1", _this];
+	XEH_LOG(_msg);
+	#endif
+};
+
+// Add / Remove the playerEvents
+SLX_XEH_F_ADDPLAYEREVENTS = {
+	private ["_event", "_curEvt"];
+	if (isNull _this) exitWith {}; // not a valid object
+	{ _event = format["Extended_%1EH",_x]; _curEvt = _this getVariable _event; if (isNil "_curEvt") then { _curEvt = [] }; _this setVariable [_event, [if (count _curEvt > 0) then { _curEvt select 0 } else { {} }, compile format["_this call ((_this select 0) getVariable '%1_Player')",_event]]] } forEach SLX_XEH_OTHER_EVENTS;
+};
+SLX_XEH_F_REMOVEPLAYEREVENTS = {
+	private ["_event", "_curEvt"];
+	if (isNull _this) exitWith {}; // not a valid object
+	{ _event = format["Extended_%1EH",_x]; _curEvt = _this getVariable _event; if (isNil "_curEvt") then { _curEvt = [] }; if (count _curEvt > 0) then { _this setVariable [_event, [_curEvt select 0]] } } forEach SLX_XEH_OTHER_EVENTS;
+};
+
+// The actual XEH functions that are called from within the engine eventhandlers.
+// This can also be uesd for better debugging
+#ifdef DEBUG_MODE_FULL
+	#define XEH_FUNC(A) SLX_XEH_EH_##A = { if ('A' in ['Respawn', 'MPRespawn', 'Killed', 'MPKilled', 'Hit', 'MPHit']) then { diag_log ['A',_this, local (_this select 0), typeOf (_this select 0)] }; {_this call _x}forEach((_this select 0)getVariable'Extended_##A##EH') }
+#endif
+#ifndef DEBUG_MODE_FULL
+	#define XEH_FUNC(A) SLX_XEH_EH_##A = { {_this call _x}forEach((_this select 0)getVariable'Extended_##A##EH') }
+#endif
+
+XEH_FUNC(Hit);
+XEH_FUNC(AnimChanged);
+XEH_FUNC(AnimStateChanged);
+XEH_FUNC(Dammaged);
+XEH_FUNC(Engine);
+XEH_FUNC(FiredNear);
+XEH_FUNC(Fuel);
+XEH_FUNC(Gear);
+XEH_FUNC(GetIn);
+XEH_FUNC(GetOut);
+XEH_FUNC(IncomingMissile);
+XEH_FUNC(Hit);
+XEH_FUNC(Killed);
+XEH_FUNC(LandedTouchDown);
+XEH_FUNC(LandedStopped);
+XEH_FUNC(Respawn);
+XEH_FUNC(MPHit);
+XEH_FUNC(MPKilled);
+XEH_FUNC(MPRespawn);
+
+SLX_XEH_EH_Init = { PUSH(SLX_XEH_PROCESSED_OBJECTS,_this select 0); [_this select 0,'Extended_Init_EventHandlers']call SLX_XEH_init };
+SLX_XEH_EH_RespawnInit = { PUSH(SLX_XEH_PROCESSED_OBJECTS,_this select 0); [_this select 0, "Extended_Init_EventHandlers", true] call SLX_XEH_init };
+SLX_XEH_EH_GetInMan = { {[_this select 2, _this select 1, _this select 0] call _x}forEach((_this select 2)getVariable'Extended_GetInManEH') };
+SLX_XEH_EH_GetOutMan = { {[_this select 2, _this select 1, _this select 0] call _x}forEach((_this select 2)getVariable'Extended_GetOutManEH') };
+SLX_XEH_EH_Fired =
+{
+	#ifdef DEBUG_MODE_FULL
+		// diag_log ['Fired',_this, local (_this select 0), typeOf (_this select 0)];
+	#endif
+	_this call SLX_XEH_EH_FiredBis; _feh = ((_this select 0)getVariable'Extended_FiredEH'); if (count _feh > 0) then { _c=count _this;if(_c<6)then{_this set[_c,nearestObject[_this select 0,_this select 4]];_this set[_c+1,currentMagazine(_this select 0)]}else{_this = +_this; _mag=_this select 5;_this set[5,_this select 6];_this set[6,_mag]};{_this call _x}forEach _feh }
+};
+SLX_XEH_EH_FiredBis = {
+	{_this call _x}forEach((_this select 0)getVariable'Extended_FiredBisEH');
+};
+
+// XEH init functions
+SLX_XEH_initPlayable =
+{
+	_unit = _this select 0;
+	_var = _unit getVariable "SLX_XEH_PLAYABLE";
+	if !(isNil "_var") exitWith {}; // Already set
+	if (_unit in playableUnits || isPlayer _unit || _unit == player) then
+	{
+		#ifdef DEBUG_MODE_FULL
+			str(['Playable unit!', _unit]) call SLX_XEH_LOG;
+		#endif
+		if (_unit == player) then {
+			_unit setVariable ['SLX_XEH_PLAYABLE', true, true]; // temporary until better solution for players in MP..
+		} else {
+			// Workaround for JIP players thinking they are respawners :P
+			_unit setVariable ['SLX_XEH_PLAYABLE', true];
+		};
+	};
+};
+
+SLX_XEH_init = compile preProcessFileLineNumbers "x\cba\addons\extended_eventhandlers_Init.sqf";
+SLX_XEH_initPost = compile preProcessFileLineNumbers "x\cba\addons\extended_eventhandlers_InitPost.sqf";
+SLX_XEH_initOthers = compile preProcessFileLineNumbers "x\cba\addons\extended_eventhandlers_InitOthers.sqf";
+SLX_XEH_postInit = compile preProcessFileLineNumbers "x\cba\addons\extended_eventhandlers_PostInit.sqf";
+
+SLX_XEH_DELAYED = [];
+SLX_XEH_INIT_DELAYED = {
+	private ["_unit", "_unitPlayable"];
+	_unit = _this select 0;
+
+	
+	if (isNull _unit) exitWith {
+		#ifdef DEBUG_MODE_FULL
+			format["XEH BEG: (Bug #7432) %2 Null Object", time, _unit] call SLX_XEH_LOG;
+		#endif
+	};
+
+	#ifdef DEBUG_MODE_FULL
+		format["XEH BEG: (Bug #7432) %2 is now ready for init", time, _unit] call SLX_XEH_LOG;
+	#endif
+
+	_unitPlayable = _unit getVariable "SLX_XEH_PLAYABLE";
+	if (isNil "_unitPlayable") then { _unitPlayable = false };
+
+	// If unit already has the variable, it is a respawned unit.
+	// Set by InitPost Man-eventhandler.
+	if (_unitPlayable) then {
+		[_unit, "Extended_Init_EventHandlers", true, true] call SLX_XEH_init; // is respawn
+	} else {
+		[_unit, "Extended_Init_EventHandlers", false, true] call SLX_XEH_init; // is not respawn
+	};
+};
+
+// XEH for non XEH supported addons
+// Only works until someone uses removeAllEventhandlers on the object
+// Only works if there is at least 1 XEH-enabled object on the Map - Place SLX_XEH_Logic to make sure XEH initializes.
+// TODO: Perhaps do a config verification - if no custom eventhandlers detected in _all_ CfgVehicles classes, don't run this XEH handler - might be too much processing.
+
+SLX_XEH_EVENTS_NAT = [XEH_EVENTS];
+SLX_XEH_EXCLUDES = ["LaserTarget"]; // TODO: Anything else?? - Ammo crates for instance have no XEH by default due to crashes) - however, they don't appear in 'vehicles' list anyway.
+SLX_XEH_PROCESSED_OBJECTS = []; // Used to maintain the list of processed objects
+SLX_XEH_CLASSES = []; // Used to cache classes that have full XEH setup
+SLX_XEH_FULL_CLASSES = []; // Used to cache classes that NEED full XEH setup
+SLX_XEH_EXCL_CLASSES = []; // Used for exclusion classes
+
+// Used by SupportMonitor
+SLX_XEH_FNC_SUPPORTM = {
+	private ["_obj", "_cfg", "_init", "_initAr", "_XEH", "_type", "_excl"];
+	_obj = _this select 0;
+	_type = typeOf _obj;
+
+	if (_type in SLX_XEH_EXCL_CLASSES) exitWith { TRACE_2("Exclusion, abort (cache hit)",_obj,_type) };
+
+	_excl = getNumber(configFile >> "CfgVehicles" >> _type >> "SLX_XEH_DISABLED") == 1;
+	if !(_excl) then { { if (_obj isKindOf _x) exitWith { _excl = true } } forEach SLX_XEH_EXCLUDES };
+	if (_excl) exitWith {
+		TRACE_2("Exclusion, abort and caching",_obj,_type);
+		PUSH(SLX_XEH_EXCL_CLASSES,_type);
+	};
+
+	_cfg = (configFile >> "CfgVehicles" >> _type >> "EventHandlers");
+
+	// No EH class - Needs full XEH
+	if !(isClass _cfg) exitWith {
+		TRACE_2("Adding XEH Full and caching",_obj,_type);
+		PUSH(SLX_XEH_FULL_CLASSES,_type);
+		[_obj] call SLX_XEH_EH_Init;
+	};
+
+	// Check 2 - XEH init EH detected
+	_XEH = false;
+	_init = _cfg >> "init";
+	if (isText _init) then {
+		_initAr = toArray(getText(_init));
+		if (count _initAr > 11) then {
+			_ar = [];
+			for "_i" from 0 to 11 do {
+				PUSH(_ar,_initAr select _i);
+			};
+			if (toString(_ar) == "if(isnil'SLX") then { _XEH = true };
+		};
+	};
+
+	if (_XEH) then {
+		TRACE_2("Has XEH init",_obj,_type)
+	} else {
+		TRACE_2("Adding XEH init",_obj,_type);
+		[_obj] call SLX_XEH_EH_Init;
+	};
+};
+
+// Used on Init of all objects, not on respawn.
+SLX_XEH_FNC_SUPPORTM2 = {
+	private ["_obj", "_type", "_cfg", "_partial", "_full"];
+	_obj = _this select 0;
+	_type = typeOf _obj;
+
+	// No XEH EH entries at all - Needs full XEH
+	if (_type in SLX_XEH_FULL_CLASSES) exitWith {
+		TRACE_2("Adding XEH Full (cache hit)",_obj,_type);
+		{ _obj addEventHandler [_x, compile format["_this call SLX_XEH_EH_%1", _x]] } forEach SLX_XEH_EVENTS_NAT;
+	};
+
+	// Already has Full XEH EH entries - Needs nothing!
+	if (_type in SLX_XEH_CLASSES) exitWith { TRACE_2("Already XEH (cache hit)",_obj,_type) };
+
+	_cfg = (configFile >> "CfgVehicles" >> _type >> "EventHandlers");
+
+	// Add script-eventhandlers for those events that are not setup properly.
+	_partial = false; _full = true;
+
+	{
+		_event = (_cfg >> _x);
+		_XEH = false;
+
+		if (isText _event) then {
+			_eventAr = toArray(getText(_event));
+			if (count _eventAr > 13) then {
+				_ar = [];
+				for "_i" from 0 to 13 do {
+					PUSH(_ar,_eventAr select _i);
+				};
+				if (toString(_ar) == "_this call SLX") then { _full = false; _XEH = true };
+			};
+		};
+		if !(_XEH) then {
+			_partial = true;
+			TRACE_3("Adding missing EH",_obj,_type,_x);
+			_obj addEventHandler [_x, compile format["_this call SLX_XEH_EH_%1", _x]];
+		};
+	} forEach SLX_XEH_EVENTS_NAT;
+
+	if !(_partial) then { TRACE_2("Caching",_obj,_type); PUSH(SLX_XEH_CLASSES,_type); };
+	if (_full) then { TRACE_2("Caching (full)",_obj,_type); PUSH(SLX_XEH_FULL_CLASSES,_type); };
+};
+
+/*
+* Process the crews of vehicles. This "thread" will run just
+* before PostInit and the mission init.sqf is processed. The order of execution is
+*
+*  1) all config.cpp init EHs (including all Extended_Init_Eventhandlers)
+*  2) all the init lines in the mission.sqm
+*  3) spawn:ed "threads" are started
+*  4) the mission's init.sqf/sqs is run
+*/
+
+GVAR(init_obj) = "HeliHEmpty" createVehicleLocal [0, 0, 0];
+GVAR(init_obj) addEventHandler ["killed", {
+	XEH_LOG("XEH: VehicleCrewInit: "+str(count vehicles));
+	{
+		_sim = getText(configFile/"CfgVehicles"/(typeOf _x)/"simulation");
+		_crew = crew _x;
+		/*
+		* If it's a vehicle then start event handlers for the crew.
+		* (Vehicles have crew and are neither humanoids nor game logics)
+		*/
+		if ((count _crew>0)&&{ _sim == _x }count["soldier", "invisible"] == 0) then
+		{
+			{ if !(_x in SLX_XEH_INIT_MEN) then { [_x] call SLX_XEH_EH_Init } } forEach _crew;
+		};
+	} forEach vehicles;
+	SLX_XEH_INIT_MEN = nil;
+	
+	deleteVehicle GVAR(init_obj);GVAR(init_obj) = nil
+}];
+
+GVAR(init_obj) setDamage 1; // Schedule to run itsy bitsy later
+
+// Prepare postInit
+GVAR(init_obj2) = "HeliHEmpty" createVehicleLocal [0, 0, 0];
+GVAR(init_obj2) addEventHandler ["killed", {
+	call SLX_XEH_postInit;
+	deleteVehicle GVAR(init_obj2);GVAR(init_obj2) = nil;
+}];
+
+// Schedule PostInit
+[] spawn {
+	// Warn if PostInit takes longer than 10 tickTime seconds
+	[] spawn
+	{
+		private["_time2Wait"];
+		_time2Wait = diag_ticktime + 10;
+		waituntil {diag_ticktime > _time2Wait};
+		if !(SLX_XEH_MACHINE select 8) then { XEH_LOG("WARNING: PostInit did not finish in a timely fashion"); };
+	};
+
+	// On Server + Non JIP Client, we are now after all objects have inited
+	// and at the briefing, still time == 0
+	if (isNull player) then
+	{
+		#ifdef DEBUG_MODE_FULL
+		"NULL PLAYER" call SLX_XEH_LOG;
+		#endif
+		if !((SLX_XEH_MACHINE select 4) || (SLX_XEH_MACHINE select 6)) then // only if MultiPlayer and not dedicated
+		{
+			#ifdef DEBUG_MODE_FULL
+			"JIP" call SLX_XEH_LOG;
+			#endif
+	
+			SLX_XEH_MACHINE set [1, true]; // set JIP
+			// TEST for weird jip-is-server-issue :S
+			if (!(SLX_XEH_MACHINE select 2) || SLX_XEH_MACHINE select 3 || SLX_XEH_MACHINE select 4) then {
+				str(["WARNING: JIP Client, yet wrong detection", SLX_XEH_MACHINE]) call SLX_XEH_LOG;
+				SLX_XEH_MACHINE set [2, true]; // set Dedicated client
+				SLX_XEH_MACHINE set [3, false]; // set server
+				SLX_XEH_MACHINE set [4, false]; // set dedicatedserver
+			};
+			waitUntil { !(isNull player) };
+		};
+	};
+	
+	if !(isNull player) then
+	{
+		if (isNull (group player) && player isKindOf "CAManBase") then
+		{
+			// DEBUG TEST: Crashing due to JIP, or when going from briefing
+			//			 into game
+			#ifdef DEBUG_MODE_FULL
+			"NULLGROUP" call SLX_XEH_LOG;
+			#endif
+			waitUntil { !(isNull (group player)) };
+		};
+		waitUntil { local player };
+	};
+
+	GVAR(init_obj2) setDamage 1; // Schedule to run itsy bitsy later
+};
+
+
+// Load and call any "pre-init", run-once event handlers
+call compile preprocessFileLineNumbers "x\cba\addons\extended_eventhandlers_PreInit.sqf";
+XEH_LOG("XEH: PreInit Finished");
diff -rupN BASE_MISSION/x/cba/addons/extended_eventhandlers_PostInit.sqf BASE_A2Free/x/cba/addons/extended_eventhandlers_PostInit.sqf
--- BASE_MISSION/x/cba/addons/extended_eventhandlers_PostInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/extended_eventhandlers_PostInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,77 @@
+/*  PostInit.sqf
+
+	Compile code strings in the Extended_PostInit_EventHandlers class and call
+	them. This is done once per mission and after all the extended init event
+	handler code is run. An addon maker can put run-once, late initialisation
+	code in such a post-init "EH" rather than in a normal XEH init EH which
+	might be called several times.
+*/
+// #define DEBUG_MODE_FULL
+#include "extended_eventhandlers_script_component.hpp"
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#ifdef DEBUG_MODE_FULL
+	"XEH BEG: PostInit" call SLX_XEH_LOG;
+	str([player, group player, local player]) call SLX_XEH_LOG;
+#endif
+
+XEH_LOG("XEH: PostInit Started");
+
+SLX_XEH_postInit = nil;
+
+SLX_XEH_MACHINE set [5, true]; // set player check = complete
+// format["(%2) SLX_XEH_MACHINE: %1", SLX_XEH_MACHINE, time] call SLX_XEH_LOG;
+
+// General InitPosts
+{ (_x/"Extended_PostInit_EventHandlers") call SLX_XEH_F_INIT } forEach [configFile, campaignConfigFile, missionConfigFile];
+
+// we set this BEFORE executing the inits, so that any unit created in another
+// thread still gets their InitPost ran
+SLX_XEH_MACHINE set [7, true];
+{ [_x] call SLX_XEH_INIT_DELAYED } forEach SLX_XEH_DELAYED; // Run Delayed inits for man-based units
+SLX_XEH_DELAYED = [];
+{ _x call SLX_XEH_init } forEach SLX_XEH_OBJECTS; // Run InitPosts
+SLX_XEH_OBJECTS = [];
+
+
+if (!isDedicated && !isNull player) then { // isNull player check is for Main Menu situation.
+	// Doing this before the spawn so we pull this into the PostInit, halted simulation state, for the initial player.
+	[] spawn {
+		private ["_ready"];
+		waitUntil {_ready = player getVariable "SLX_XEH_READY"; if (isNil "_ready") then { _ready = false }; _ready};
+		_lastPlayer = player;
+		_lastPlayer call SLX_XEH_F_ADDPLAYEREVENTS;
+		#ifdef DEBUG_MODE_FULL
+			str(["Running Player EH check", _lastPlayer]) call SLX_XEH_LOG;
+		#endif
+		// TODO: Perhaps this is possible in some event-style fashion, which would add the player events asap, synchronous.
+		// (though perhaps not possible like teamswitch, besides, player == _unit is probably false at (preInit)?
+		// TODO: Perhaps best run the statements in 'delayLess' FSM (or completely in delaylessLoop), synchronous, unscheduled?
+		// TODO: Evaluate with respawn...
+		while {true} do {
+			waitUntil {sleep 1; player != _lastPlayer};
+			sleep 1;
+			_lastPlayer call SLX_XEH_F_REMOVEPLAYEREVENTS;
+			waitUntil {sleep 1; !(isNull player)};
+			sleep 1;
+			_newPlayer = player;
+			#ifdef DEBUG_MODE_FULL
+				str(["New Player", _newPlayer, _lastPlayer]) call SLX_XEH_LOG;
+			#endif
+			_newPlayer call SLX_XEH_F_ADDPLAYEREVENTS;
+			_lastPlayer = _newPlayer;
+		};
+	};
+};
+
+// XEH for non XEH supported addons
+execVM "x\cba\addons\extended_eventhandlers_supportMonitor.sqf";
+
+SLX_XEH_MACHINE set [8, true];
+XEH_LOG("XEH: PostInit Finished; " + str(SLX_XEH_MACHINE));
+
+#ifdef DEBUG_MODE_FULL
+	"XEH END: PostInit" call SLX_XEH_LOG;
+#endif
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/extended_eventhandlers_PreInit.sqf BASE_A2Free/x/cba/addons/extended_eventhandlers_PreInit.sqf
--- BASE_MISSION/x/cba/addons/extended_eventhandlers_PreInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/extended_eventhandlers_PreInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,13 @@
+/*  PreInit.sqf
+
+	Compile code strings in the Extended_PreInit_EventHandlers class and call
+	them. This is done once per mission and before any extended init event
+	handler code is run. An addon maker can put run-once initialisation code
+	in such a pre-init "EH" rather than in a normal XEH init EH which might be
+	called several times.
+*/
+{
+	(_x/"Extended_PreInit_EventHandlers") call SLX_XEH_F_INIT;
+} forEach [configFile, campaignConfigFile, missionConfigFile];
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/extended_eventhandlers_delayless.fsm BASE_A2Free/x/cba/addons/extended_eventhandlers_delayless.fsm
--- BASE_MISSION/x/cba/addons/extended_eventhandlers_delayless.fsm	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/extended_eventhandlers_delayless.fsm	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,57 @@
+/*%FSM<COMPILE "D:\Program files\Bohemia Interactive\Tools\FSM Editor Personal Edition\scriptedFSM.cfg, SBs SupaFSM">*/
+/*%FSM<HEAD>*/
+/*
+item0[] = {"",7,210,-30.000000,-425.000000,-20.000000,-425.000000,0.000000,""};
+item1[] = {"Init",0,250,-150.000000,-175.000000,-50.000000,-125.000000,0.000000,"Init"};
+item2[] = {"execute",8,4314,-275.000000,-175.000000,-175.000000,-125.000000,1.000000,"execute"};
+item3[] = {"End",1,250,-400.000000,-175.000000,-300.000000,-125.000000,0.000000,"End"};
+link0[] = {1,2};
+link1[] = {2,3};
+globals[] = {25.000000,1,0,0,0,640,480,3,121,6316128,1,-466.578888,208.527237,350.990051,-396.594299,829,918,1};
+window[] = {2,-1,-1,-1,-1,863,110,1070,145,3,847};
+*//*%FSM</HEAD>*/
+class FSM
+{
+  fsmName = "SBs SupaFSM";
+  class States
+  {
+    /*%FSM<STATE "Init">*/
+    class Init
+    {
+      name = "Init";
+      init = /*%FSM<STATEINIT""">*/""/*%FSM</STATEINIT""">*/;
+      precondition = /*%FSM<STATEPRECONDITION""">*/""/*%FSM</STATEPRECONDITION""">*/;
+      class Links
+      {
+        /*%FSM<LINK "execute">*/
+        class execute
+        {
+          priority = 1.000000;
+          to="End";
+          precondition = /*%FSM<CONDPRECONDITION""">*/""/*%FSM</CONDPRECONDITION""">*/;
+          condition=/*%FSM<CONDITION""">*/"call _this; true"/*%FSM</CONDITION""">*/;
+          action=/*%FSM<ACTION""">*/""/*%FSM</ACTION""">*/;
+        };
+        /*%FSM</LINK>*/
+      };
+    };
+    /*%FSM</STATE>*/
+    /*%FSM<STATE "End">*/
+    class End
+    {
+      name = "End";
+      init = /*%FSM<STATEINIT""">*/""/*%FSM</STATEINIT""">*/;
+      precondition = /*%FSM<STATEPRECONDITION""">*/""/*%FSM</STATEPRECONDITION""">*/;
+      class Links
+      {
+      };
+    };
+    /*%FSM</STATE>*/
+  };
+  initState="Init";
+  finalStates[] =
+  {
+    "End",
+  };
+};
+/*%FSM</COMPILE>*/
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/extended_eventhandlers_script_component.hpp BASE_A2Free/x/cba/addons/extended_eventhandlers_script_component.hpp
--- BASE_MISSION/x/cba/addons/extended_eventhandlers_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/extended_eventhandlers_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,23 @@
+#define COMPONENT eventhandlers
+
+#include "script_mod.hpp"
+
+// #define DEBUG_ENABLED_XEH
+
+#ifdef DEBUG_ENABLED_XEH
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_XEH
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_XEH
+#endif
+
+#define XEH_LOG(MESSAGE) if !(SLX_XEH_DisableLogging) then { diag_log [diag_frameNo, diag_tickTime, time, MESSAGE] }
+#define XEH_EVENTS "AnimChanged", "AnimStateChanged", "AnimDone", "Dammaged", "Engine", \
+	"Fired", "FiredNear", "Fuel", "Gear", "GetIn", "GetOut", "Hit", \
+	"IncomingMissile", "Killed", "LandedTouchDown", "LandedStopped", \
+	"Respawn" //, "MPHit", "MPKilled", "MPRespawn"
+//"HandleDamage", "HandleHealing"
+#define XEH_CUSTOM_EVENTS "GetInMan", "GetOutMan", "FiredBis"
+
+#include "script_macros_common.hpp"
diff -rupN BASE_MISSION/x/cba/addons/extended_eventhandlers_supportMonitor.sqf BASE_A2Free/x/cba/addons/extended_eventhandlers_supportMonitor.sqf
--- BASE_MISSION/x/cba/addons/extended_eventhandlers_supportMonitor.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/extended_eventhandlers_supportMonitor.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,14 @@
+#include "extended_eventhandlers_script_component.hpp"
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+// Detect new units and check if XEH is enabled on them
+while {true} do {
+	SLX_XEH_PROCESSED_OBJECTS = SLX_XEH_PROCESSED_OBJECTS - [objNull]; // cleanup
+	{
+		if !(isNull _x) then {
+			PUSH(SLX_XEH_PROCESSED_OBJECTS,_x);
+			[_x] call SLX_XEH_FNC_SUPPORTM;
+		};
+	} forEach ((vehicles+allUnits) - SLX_XEH_PROCESSED_OBJECTS); // TODO: Does this need an isNull check?
+	sleep 3;
+};
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/igui_button_default_ca.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/igui_button_default_ca.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/igui_button_disabled_ca.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/igui_button_disabled_ca.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/igui_button_down_ca.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/igui_button_down_ca.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/igui_button_focus_ca.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/igui_button_focus_ca.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/igui_button_normal_ca.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/igui_button_normal_ca.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/igui_button_over_ca.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/igui_button_over_ca.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/mid_button_disabled.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/mid_button_disabled.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/mid_button_down.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/mid_button_down.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/mid_button_focus.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/mid_button_focus.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/mid_button_normal.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/mid_button_normal.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/arma2/mid_button_over.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/arma2/mid_button_over.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/buttonList/default.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/buttonList/default.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/buttonList/disabled.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/buttonList/disabled.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/buttonList/down.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/buttonList/down.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/buttonList/focused.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/buttonList/focused.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/buttonList/normal.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/buttonList/normal.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/buttonList/over.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/buttonList/over.paa differ
diff -rupN BASE_MISSION/x/cba/addons/flexiMenu/data/common.hpp BASE_A2Free/x/cba/addons/flexiMenu/data/common.hpp
--- BASE_MISSION/x/cba/addons/flexiMenu/data/common.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/flexiMenu/data/common.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,52 @@
+// THIS IS A COPY OF DATA INSIDE x\cba\addons\ui\script_component.hpp   for legacy purposes
+// Somehow using this common.hpp is problematic for some.
+
+// this is a duplicate #define which should match the one in script_component.hpp
+#define _flexiMenu_useSlowCleanDrawMode
+
+//#define _flexiMenu_IDD 406
+
+#define _flexiMenu_maxButtons 30
+#define _flexiMenu_maxListButtons 30
+
+#define _flexiMenu_IDC_menuDesc 230
+#define _flexiMenu_IDC_listMenuDesc 231
+
+// Base IDC value of first button.
+#define _flexiMenu_baseIDC_button 240
+// Successive buttons are numbered in sequence from base IDC value.
+// _flexiMenu_maxButtons represents theoretical maximum IDC value. Each dialog determines this upper limit itself.
+// The reserved range of IDC's is from: _flexiMenu_baseIDC_button to (_flexiMenu_baseIDC_button+_flexiMenu_maxButtons-1).
+
+// Base IDC value of first list button.
+#define _flexiMenu_baseIDC_listButton 340
+
+#define _flexiMenu_typeMenuSources_ID_type 0
+#define _flexiMenu_typeMenuSources_ID_DIKCodes 1
+#define _flexiMenu_typeMenuSources_ID_priority 2
+#define _flexiMenu_typeMenuSources_ID_menuSource 3
+
+#define _flexiMenu_menuProperty_ID_menuName 0
+#define _flexiMenu_menuProperty_ID_menuDesc 1
+#define _flexiMenu_menuProperty_ID_menuResource 2
+#define _flexiMenu_menuProperty_ID_iconFolder 3
+#define _flexiMenu_menuProperty_ID_multiReselect 4
+
+#define _flexiMenu_menuDef_ID_caption 0
+#define _flexiMenu_menuDef_ID_action 1
+#define _flexiMenu_menuDef_ID_icon 2
+#define _flexiMenu_menuDef_ID_tooltip 3
+#define _flexiMenu_menuDef_ID_subMenuSource 4
+#define _flexiMenu_menuDef_ID_shortcut 5
+#define _flexiMenu_menuDef_ID_enabled 6
+#define _flexiMenu_menuDef_ID_visible 7
+#define _flexiMenu_menuDef_ID_totalIDs 8
+
+#define _menuRscPrefix "CBA_flexiMenu_rsc"
+
+#define _flexiMenu_path "x\cba\addons\flexiMenu"
+//#define _eval_action(_param) __EVAL(format ["[%2] execVM '%1\action.sqf'", _flexiMenu_path, ##_param])
+
+#define _SMW 0.15*safeZoneW // common sub-menu width
+
+#define _LBH 0.033*safeZoneH // list button height
diff -rupN BASE_MISSION/x/cba/addons/flexiMenu/data/menu_arma2.hpp BASE_A2Free/x/cba/addons/flexiMenu/data/menu_arma2.hpp
--- BASE_MISSION/x/cba/addons/flexiMenu/data/menu_arma2.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/flexiMenu/data/menu_arma2.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,257 @@
+#include "common.hpp"
+//#include "common_rose.hpp"
+
+#define _DefaultAspectRatio 3/4
+#define _SX (safeZoneX+safeZoneW/2) // screen centre x
+#define _SY (safeZoneY+safeZoneH/2) // screen centre y
+#define _BW 0.18*safeZoneW // button width
+#define _BH (_CH/5.5) // button height
+#define _CX_correction 0.011*safeZoneW
+#define _CW 0.15*safeZoneW*_DefaultAspectRatio // _CH // exception // 0.10*safeZoneW // circle (button) width
+#define _CH 0.15*safeZoneH // 0.15*safeZoneW // exception safeZoneH // circle (button) height
+#define _SMW 0.15*safeZoneW // sub-menu width
+//#define _captionColorBG 58/256, 80/256, 55/256 // BIS mid green (button over colour)
+#define _captionColorFG 138/256, 146/256, 105/256 // BIS greenish text
+#define _captionHgt 0.85
+
+#define _gapW 0.01*safeZoneW // Horizontal gap "width" between circle button and side buttons
+#define _gapH ((_CH/2-2*_BH)*2/3) // Button "height" vertical spacing
+
+#define _eval_image(_param) __EVAL(format ["%1\data\arma2\mid_button_%2.paa", _flexiMenu_path, ##_param])
+#define _eval_imageCA(_param) __EVAL(format ["\ca\ui\data\igui_button_%1_ca.paa", ##_param])
+
+#define _gapWLevel1 (0.01*safeZoneW) // extra indentation required for side buttons on row 1 and 4 to reach circle edge
+#define _gapWLevel2 (0.01*safeZoneW) // extra indentation required for side buttons on row 2 and 3 to reach circle edge
+#define _gapWRight (-0.015*safeZoneW-_gapW) // extra indentation required for all right side buttons to reach circle edge
+
+#define _leftButtonLevel1X (_SX-(_CW/2+_gapW+_gapWLevel1)-_BW-_gapWRight)
+#define _leftButtonLevel2X (_SX-(_CW/2+_gapW+_gapWLevel2)-_BW-_gapWRight)
+#define _rightButtonLevel1X (_SX+(_CW/2+_gapW+_gapWLevel1)+_gapWRight)
+#define _rightButtonLevel2X (_SX+(_CW/2+_gapW+_gapWLevel2)+_gapWRight)
+
+class CBA_flexiMenu_rscArma2 {
+	idd = -1; //_flexiMenu_IDD;
+	movingEnable = 0;
+	onLoad = __EVAL(format["uiNamespace setVariable ['%1', _this select 0]", QUOTE(GVAR(display))]);
+	onUnload = __EVAL(format["uiNamespace setVariable ['%1', displayNull]", QUOTE(GVAR(display))]);
+	class controlsBackground {};
+	class objects {};
+
+	// custom flexiMenu properties
+	flexiMenu_primaryMenuControlWidth = _BW;
+	flexiMenu_subMenuControlWidth = _SMW;
+	flexiMenu_subMenuCaptionWidth = 0.40;
+
+	//class listButton; // external ref
+	//#include "common_listClass.hpp"
+	#define _eval_image2(_param) __EVAL(format ["%1\data\buttonList\%2.paa", _flexiMenu_path, ##_param])
+
+	class listButton: _flexiMenu_RscShortcutButton {
+		x = 0.5;
+		y = 0.5;
+		w = 0; //_SMW; // hide initially
+		//w = _SMW;
+		h = _LBH;
+		sizeEx = _LBH;
+		size = _LBH*0.75;
+
+		color[] = {_captionColorFG, 1};
+		color2[] = {1, 1, 1, 0.8}; //{1, 1, 1, 0.4};
+		colorBackground[] = {1, 1, 1, 1};
+		colorbackground2[] = {1, 1, 1, 1}; //{1, 1, 1, 0.4};
+		colorDisabled[] = {1, 1, 1, 0.25};
+		class TextPos {
+			left = 0.02;
+			top = 0.005;
+			right = 0.02;
+			bottom = 0.005;
+		};
+		class Attributes {
+			font = "Zeppelin32";
+			color = "#E5E5E5";
+			align = "left";
+			shadow = "true";
+		};
+		animTextureNormal = _eval_image2("normal");
+		animTextureDisabled = _eval_image2("disabled");
+		animTextureOver = _eval_image2("over");
+		animTextureFocused = _eval_image2("focused");
+		animTexturePressed = _eval_image2("down");
+		animTextureDefault = _eval_image2("default");
+		animTextureNoShortcut = _eval_image2("normal");
+	};
+
+	class button: _flexiMenu_RscShortcutButton {
+		w = 0; //_BW; // hide initially
+		h = _BH*1.52; // paa's only use 66% of hgt
+		sizeEx = _BH;
+		size = _BH*0.85;
+
+		color[] = {_captionColorFG, 1};
+		color2[] = {1, 1, 1, 0.8}; //{1, 1, 1, 0.4};
+		colorBackground[] = {1, 1, 1, 1};
+		colorbackground2[] = {1, 1, 1, 1}; //{1, 1, 1, 0.4};
+		colorDisabled[] = {1, 1, 1, 0.25};
+		//action = _eval_action(-1);
+
+		class ShortcutPos {
+			left = 0;
+			top = 0;
+			w = 0.1;
+			h = 0.1;
+		};
+		class Attributes {
+			font = "Zeppelin32";
+			color = "#E5E5E5";
+			align = "center";
+			shadow = "true";
+		};
+	};
+	//---------------------------------
+	class controls {
+		class caption: rscText {
+			idc = _flexiMenu_IDC_menuDesc;
+			//x = _SX-_BW;
+			x = _leftButtonLevel1X;
+			//y = _SY-_buttonsBeforeCenter*_BH-_gapH-_BH*_captionHgt;
+			y = _SY-(_CH/2+_gapH)-_BH-_gapH-_BH*_captionHgt;
+			w = 0.40;
+			h = _BH*_captionHgt;
+			sizeEx = _BH*_captionHgt;
+			color[] = {_captionColorFG, 1};
+			text = "";
+		};
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_button);
+		class button01: button {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _SX-_CW/2+_CX_correction;
+			y = _SY-_CH/2;
+			w = _CW;
+			h = _CH;
+			sizeEx = _CH;
+			//size = _BH*0.8;
+			class TextPos {
+				left = -_CX_correction*2; // not sure if logic is correct, but seems close enough
+				top = _CH/2-_BH/2;
+				right = 0; //0.002;
+				bottom = 0.0;
+			};
+			/*
+			class Attributes {
+				font = "Zeppelin32";
+				color = "#E5E5E5";
+				align = "left";
+				shadow = "true";
+			};
+			*/
+			animTextureNormal = _eval_image("normal");
+			animTextureDisabled = _eval_image("disabled");
+			animTextureOver = _eval_image("over");
+			animTextureFocused = _eval_image("focus");
+			animTexturePressed = _eval_image("down");
+			animTextureDefault = _eval_image("normal"); // used?
+			animTextureNoShortcut = _eval_image("normal"); // used?
+		};
+		class button02: button {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _SX-_BW/2;
+			y = _SY-(_CH/2+_gapH)-_BH;
+			animTextureNormal = _eval_imageCA("normal");
+			animTextureDisabled = _eval_imageCA("disabled");
+			animTextureOver = _eval_imageCA("over");
+			animTextureFocused = _eval_imageCA("focus");
+			animTexturePressed = _eval_imageCA("down");
+			animTextureDefault = _eval_imageCA("normal");
+			animTextureNoShortcut = _eval_imageCA("normal");
+		};
+		class button03: button02 {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _SX-_BW/2;
+			y = _SY+(_CH/2+_gapH);
+		};
+		//---------------------------------
+		class button04: button02 {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _leftButtonLevel1X;
+			y = _SY-_gapH/2-_BH-_gapH-_BH;
+		};
+		class button05: button02 {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _leftButtonLevel2X;
+			y = _SY-_gapH/2-_BH;
+		};
+		class button06: button02 {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _leftButtonLevel2X;
+			y = _SY+_gapH/2;
+		};
+		class button07: button02 {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _leftButtonLevel1X;
+			y = _SY+_gapH/2+_BH+_gapH;
+		};
+		//---------------------------------
+		class button08: button02 {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _rightButtonLevel1X;
+			y = _SY-_gapH/2-_BH-_gapH-_BH;
+		};
+		class button09: button02 {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _rightButtonLevel2X;
+			y = _SY-_gapH/2-_BH;
+		};
+		class button10: button02 {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _rightButtonLevel2X;
+			y = _SY+_gapH/2;
+		};
+		class button11: button02 {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _rightButtonLevel1X;
+			y = _SY+_gapH/2+_BH+_gapH;
+		};
+		//-----------------------
+		class caption2: caption {
+			idc = _flexiMenu_IDC_listMenuDesc;
+			x = _SX-(_SMW/2);
+			y = _SY+(_CH/2+_gapH)+_BH+_gapH+0*_LBH;
+			w = 0; //flexiMenu_subMenuCaptionWidth; // hide initially
+		};
+
+//#include "common_listControls.hpp"
+#define ExpandMacro_ListControls(ID)\
+	class listButton##ID: listButton\
+	{\
+		idc = __EVAL(_flexiMenu_IDC);\
+		__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);\
+		x = _SX-(_SMW/2);\
+		y = _SY+(_CH/2+_gapH)+_BH+_gapH+(1+##ID)*_LBH;\
+	}
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_listButton);
+		ExpandMacro_ListControls(00);
+		ExpandMacro_ListControls(01);
+		ExpandMacro_ListControls(02);
+		ExpandMacro_ListControls(03);
+		ExpandMacro_ListControls(04);
+		ExpandMacro_ListControls(05);
+		ExpandMacro_ListControls(06);
+		ExpandMacro_ListControls(07);
+		ExpandMacro_ListControls(08);
+		ExpandMacro_ListControls(09);
+		ExpandMacro_ListControls(10);
+	};
+};
diff -rupN BASE_MISSION/x/cba/addons/flexiMenu/data/menu_buttonList.hpp BASE_A2Free/x/cba/addons/flexiMenu/data/menu_buttonList.hpp
--- BASE_MISSION/x/cba/addons/flexiMenu/data/menu_buttonList.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/flexiMenu/data/menu_buttonList.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,173 @@
+#include "common.hpp"
+
+#define _eval_image(_param) __EVAL(format ["%1\data\buttonList\%2.paa", _flexiMenu_path, ##_param])
+
+#define _SX (safeZoneX+safeZoneW/2) // screen centre x
+#define _SY (safeZoneY+safeZoneH/2) // screen centre y
+#define _BW 0.18*safeZoneW // button width
+#define _BH 0.033*safeZoneH // button height
+#define _SMW 0.15*safeZoneW // sub-menu width
+#define _gapH 0.01*safeZoneH
+#define _buttonsBeforeCenter 7 // buttons above screen centre, allowing menu to appear centred.
+#define _captionColorBG 58/256, 80/256, 55/256 // BIS mid green (button over colour)
+#define _captionColorFG 138/256, 146/256, 105/256 // BIS greenish text
+#define _captionHgt 0.75
+
+class CBA_flexiMenu_rscButtonList { //: _flexiMenu_rscRose
+	idd = -1; //_flexiMenu_IDD;
+	movingEnable = 0;
+	onLoad = __EVAL(format["uiNamespace setVariable ['%1', _this select 0]", QUOTE(GVAR(display))]);
+	onUnload = __EVAL(format["uiNamespace setVariable ['%1', displayNull]", QUOTE(GVAR(display))]);
+	class controlsBackground {};
+	class objects {};
+
+	// custom flexiMenu properties
+	flexiMenu_primaryMenuControlWidth = _BW;
+	flexiMenu_subMenuControlWidth = _SMW;
+	flexiMenu_subMenuCaptionWidth = 0.40;
+
+//class listButton; // external ref
+//#include "common_listClass.hpp"
+#define _eval_image2(_param) __EVAL(format ["%1\data\buttonList\%2.paa", _flexiMenu_path, ##_param])
+
+	class listButton: _flexiMenu_RscShortcutButton {
+		x = 0.5;
+		y = 0.5;
+		w = 0; //_SMW; // hide initially
+		//w = _SMW;
+		h = _LBH;
+		sizeEx = _LBH;
+		size = _LBH*0.75;
+
+		color[] = {_captionColorFG, 1};
+		color2[] = {1, 1, 1, 0.8}; //{1, 1, 1, 0.4};
+		colorBackground[] = {1, 1, 1, 1};
+		colorbackground2[] = {1, 1, 1, 1}; //{1, 1, 1, 0.4};
+		colorDisabled[] = {1, 1, 1, 0.25};
+		class TextPos {
+			left = 0.02;
+			top = 0.005;
+			right = 0.02;
+			bottom = 0.005;
+		};
+		class Attributes {
+			font = "Zeppelin32";
+			color = "#E5E5E5";
+			align = "left";
+			shadow = "true";
+		};
+		animTextureNormal = _eval_image2("normal");
+		animTextureDisabled = _eval_image2("disabled");
+		animTextureOver = _eval_image2("over");
+		animTextureFocused = _eval_image2("focused");
+		animTexturePressed = _eval_image2("down");
+		animTextureDefault = _eval_image2("default");
+		animTextureNoShortcut = _eval_image2("normal");
+	};
+
+	class button: _flexiMenu_RscShortcutButton {
+		x = _SX-_BW;
+		y = _SY;
+		w = 0; //_BW; // hide initially
+		h = _BH;
+		sizeEx = _BH;
+		size = _BH*0.75;
+
+		color[] = {_captionColorFG, 1};
+		color2[] = {1, 1, 1, 0.8}; //{1, 1, 1, 0.4};
+		colorBackground[] = {1, 1, 1, 1};
+		colorbackground2[] = {1, 1, 1, 1}; //{1, 1, 1, 0.4};
+		colorDisabled[] = {1, 1, 1, 0.25};
+		class TextPos {
+			left = 0.02;
+			top = 0.000;
+			right = 0.02;
+			bottom = 0.000;
+		};
+		class Attributes {
+			font = "Zeppelin32";
+			color = "#E5E5E5";
+			align = "left";
+			shadow = "true";
+		};
+		animTextureNormal = _eval_image("normal");
+		animTextureDisabled = _eval_image("disabled");
+		animTextureOver = _eval_image("over");
+		animTextureFocused = _eval_image("focused");
+		animTexturePressed = _eval_image("down");
+		animTextureDefault = _eval_image("default");
+		animTextureNoShortcut = _eval_image("normal");
+		//action = _eval_action(-1);
+	};
+	//---------------------------------
+	class controls {
+		class caption: rscText {
+			idc = _flexiMenu_IDC_menuDesc;
+			x = _SX-_BW;
+			y = _SY-_buttonsBeforeCenter*_BH-_gapH-_BH*_captionHgt;
+			w = 0.40;
+			h = _BH*_captionHgt;
+			sizeEx = _BH*_captionHgt;
+			color[] = {_captionColorFG, 1};
+			text = "";
+		};
+
+#define ExpandMacro_RowControls(ID) \
+	class button##ID: button\
+	{\
+		idc = __EVAL(_flexiMenu_IDC);\
+		__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);\
+		y = _SY-_buttonsBeforeCenter*_BH+##ID*_BH;\
+	}
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_button);
+		ExpandMacro_RowControls(00);
+		ExpandMacro_RowControls(01);
+		ExpandMacro_RowControls(02);
+		ExpandMacro_RowControls(03);
+		ExpandMacro_RowControls(04);
+		ExpandMacro_RowControls(05);
+		ExpandMacro_RowControls(06);
+		ExpandMacro_RowControls(07);
+		ExpandMacro_RowControls(08);
+		ExpandMacro_RowControls(09);
+		ExpandMacro_RowControls(10);
+		ExpandMacro_RowControls(11);
+		ExpandMacro_RowControls(12);
+		ExpandMacro_RowControls(13);
+		ExpandMacro_RowControls(14);
+		ExpandMacro_RowControls(15);
+		ExpandMacro_RowControls(16);
+		ExpandMacro_RowControls(17);
+		//-----------------------
+		class caption2: caption {
+			idc = _flexiMenu_IDC_listMenuDesc;
+			x = _SX;
+			y = _SY-_buttonsBeforeCenter*_BH+(-1*_LBH);
+			w = 0; //flexiMenu_subMenuCaptionWidth; // hide initially
+		};
+
+//#include "common_listControls.hpp"
+#define ExpandMacro_ListControls(ID)\
+	class listButton##ID: listButton\
+	{\
+		idc = __EVAL(_flexiMenu_IDC);\
+		__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);\
+		x = _SX;\
+		y = _SY-_buttonsBeforeCenter*_BH+##ID*_LBH;\
+    }
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_listButton);
+		ExpandMacro_ListControls(00);
+		ExpandMacro_ListControls(01);
+		ExpandMacro_ListControls(02);
+		ExpandMacro_ListControls(03);
+		ExpandMacro_ListControls(04);
+		ExpandMacro_ListControls(05);
+		ExpandMacro_ListControls(06);
+		ExpandMacro_ListControls(07);
+		ExpandMacro_ListControls(08);
+		ExpandMacro_ListControls(09);
+		ExpandMacro_ListControls(10);
+	};
+};
diff -rupN BASE_MISSION/x/cba/addons/flexiMenu/data/menu_iconRow.hpp BASE_A2Free/x/cba/addons/flexiMenu/data/menu_iconRow.hpp
--- BASE_MISSION/x/cba/addons/flexiMenu/data/menu_iconRow.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/flexiMenu/data/menu_iconRow.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,179 @@
+#include "common.hpp"
+
+#define _eval_image(_param) __EVAL(format ["%1\data\arma2\mid_button_%2.paa", _flexiMenu_path, ##_param])
+
+#define _SX (safeZoneX+safeZoneW/2) // screen centre x
+#define _SY (safeZoneY+safeZoneH/2) // screen centre y
+#define _BW 0.04*safeZoneW // button width
+#define _BH 0.04*safeZoneH // button height
+#define _BH2 _BH*1.52 // button height adjust for some paa's which only use 66% of hgt
+#define _StandardBH 0.033*safeZoneH // button height
+#define _SMW 0.15*safeZoneW // sub-menu width
+#define _gapW 0.01*safeZoneW
+#define _gapH 0.01*safeZoneH
+#define _buttonsBeforeCenter 6 // buttons before screen centre, allowing menu to appear centred.
+#define _buttonsPerRow 5
+#define _captionColorBG 58/256, 80/256, 55/256 // BIS mid green (button over colour)
+#define _captionColorFG 138/256, 146/256, 105/256 // BIS greenish text
+#define _captionHgt 0.75
+
+class CBA_flexiMenu_rscIconRow { //: _flexiMenu_rscRose
+	idd = -1; //_flexiMenu_IDD;
+	movingEnable = 0;
+	onLoad = __EVAL(format["uiNamespace setVariable ['%1', _this select 0]", QUOTE(GVAR(display))]);
+	onUnload = __EVAL(format["uiNamespace setVariable ['%1', displayNull]", QUOTE(GVAR(display))]);
+	class controlsBackground {};
+	class objects {};
+
+	// custom flexiMenu properties
+	flexiMenu_primaryMenuControlWidth = _BW;
+	flexiMenu_subMenuControlWidth = _SMW;
+	flexiMenu_subMenuCaptionWidth = 0.40;
+
+//class listButton; // external ref
+//#include "common_listClass.hpp"
+#define _eval_image2(_param) __EVAL(format ["%1\data\buttonList\%2.paa", _flexiMenu_path, ##_param])
+
+	class listButton: _flexiMenu_RscShortcutButton {
+		x = 0.5;
+		y = 0.5;
+		w = 0; //_SMW; // hide initially
+		h = _LBH;
+		sizeEx = _LBH;
+		size = _LBH*0.75;
+
+		color[] = {_captionColorFG, 1};
+		color2[] = {1, 1, 1, 0.8}; //{1, 1, 1, 0.4};
+		colorBackground[] = {1, 1, 1, 1};
+		colorbackground2[] = {1, 1, 1, 1}; //{1, 1, 1, 0.4};
+		colorDisabled[] = {1, 1, 1, 0.25};
+		class TextPos {
+			left = 0.02;
+			top = 0.005;
+			right = 0.02;
+			bottom = 0.005;
+		};
+		class Attributes {
+			font = "Zeppelin32";
+			color = "#E5E5E5";
+			align = "left";
+			shadow = "true";
+		};
+		animTextureNormal = _eval_image2("normal");
+		animTextureDisabled = _eval_image2("disabled");
+		animTextureOver = _eval_image2("over");
+		animTextureFocused = _eval_image2("focused");
+		animTexturePressed = _eval_image2("down");
+		animTextureDefault = _eval_image2("default");
+		animTextureNoShortcut = _eval_image2("normal");
+	};
+
+  class button: _flexiMenu_RscShortcutButton {
+		x = _SX-_BW;
+		y = _SY;
+		w = 0; //_BW; // hide initially
+		h = _BH2;
+		sizeEx = _BH;
+		size = _BH; //*0.85;
+
+		color[] = {_captionColorFG, 1};
+		color2[] = {1, 1, 1, 0.8}; //{1, 1, 1, 0.4};
+		colorBackground[] = {1, 1, 1, 1};
+		colorbackground2[] = {1, 1, 1, 1}; //{1, 1, 1, 0.4};
+		colorDisabled[] = {1, 1, 1, 0.25};
+		class TextPos {
+			left = 0.0055;
+			top = 0.009;
+			right = 0.00;
+			bottom = 0.000;
+		};
+		class Attributes {
+			font = "Zeppelin32";
+			color = "#E5E5E5";
+			align = "center";
+			shadow = "true";
+		};
+		animTextureNormal = _eval_image("normal");
+		animTextureDisabled = _eval_image("disabled");
+		animTextureOver = _eval_image("over");
+		animTextureFocused = _eval_image("focus");
+		animTexturePressed = _eval_image("down");
+		animTextureDefault = _eval_image("normal"); // used?
+		animTextureNoShortcut = _eval_image("normal"); // used?
+		//action = _eval_action(-1);
+	};
+	//---------------------------------
+	class controls {
+		class caption: rscText {
+			idc = _flexiMenu_IDC_menuDesc;
+			x = _SX-_buttonsBeforeCenter*_BW;
+			y = _SY-_gapH-_StandardBH*_captionHgt;
+			w = 0.40;
+			h = _StandardBH*_captionHgt;
+			sizeEx = _StandardBH*_captionHgt;
+			color[] = {_captionColorFG, 1};
+			text = "";
+		};
+
+#define ExpandMacro_RowControls(ID)\
+	class button##ID: button\
+	{\
+		idc = __EVAL(_flexiMenu_IDC);\
+		__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);\
+		x = _SX-_buttonsBeforeCenter*_BW+(##ID mod _buttonsPerRow)*_BW;\
+		y = _SY+floor(##ID / _buttonsPerRow)*(_gapH+_BH2);\
+    }
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_button);
+		ExpandMacro_RowControls(00);
+		ExpandMacro_RowControls(01);
+		ExpandMacro_RowControls(02);
+		ExpandMacro_RowControls(03);
+		ExpandMacro_RowControls(04);
+		ExpandMacro_RowControls(05);
+		ExpandMacro_RowControls(06);
+		ExpandMacro_RowControls(07);
+		ExpandMacro_RowControls(08);
+		ExpandMacro_RowControls(09);
+		ExpandMacro_RowControls(10);
+		ExpandMacro_RowControls(11);
+		ExpandMacro_RowControls(12);
+		ExpandMacro_RowControls(13);
+		ExpandMacro_RowControls(14);
+		ExpandMacro_RowControls(15);
+		ExpandMacro_RowControls(16);
+		ExpandMacro_RowControls(17);
+		ExpandMacro_RowControls(18);
+		ExpandMacro_RowControls(19);
+		//-----------------------
+		class caption2: caption {
+			idc = _flexiMenu_IDC_listMenuDesc;
+			x = _SX-_buttonsBeforeCenter*_BW+(_buttonsPerRow+1)*_BW;
+			y = _SY;
+			w = 0; //flexiMenu_subMenuCaptionWidth; // hide initially
+		};
+
+//#include "common_listControls.hpp"
+#define ExpandMacro_ListControls(ID)\
+	class listButton##ID: listButton\
+	{\
+		idc = __EVAL(_flexiMenu_IDC);\
+		__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);\
+		x = _SX-_buttonsBeforeCenter*_BW+(_buttonsPerRow+1)*_BW;\
+		y = _SY+##ID*_LBH;\
+	}
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_listButton);
+		ExpandMacro_ListControls(00);
+		ExpandMacro_ListControls(01);
+		ExpandMacro_ListControls(02);
+		ExpandMacro_ListControls(03);
+		ExpandMacro_ListControls(04);
+		ExpandMacro_ListControls(05);
+		ExpandMacro_ListControls(06);
+		ExpandMacro_ListControls(07);
+		ExpandMacro_ListControls(08);
+		ExpandMacro_ListControls(09);
+		ExpandMacro_ListControls(10);
+	};
+};
diff -rupN BASE_MISSION/x/cba/addons/flexiMenu/data/menu_popup.hpp BASE_A2Free/x/cba/addons/flexiMenu/data/menu_popup.hpp
--- BASE_MISSION/x/cba/addons/flexiMenu/data/menu_popup.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/flexiMenu/data/menu_popup.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,146 @@
+#include "common.hpp"
+
+#define _eval_image(_param) __EVAL(format ["%1\data\popup\%2.paa", _flexiMenu_path, ##_param])
+
+#define _SX (safeZoneX+safeZoneW/2) // screen centre x
+#define _SY (safeZoneY+safeZoneH/2) // screen centre y
+#define _BW 0.20*safeZoneW // button width
+#define _BH 0.033*safeZoneH // button height
+#define _gapH 0.01*safeZoneH
+#define _buttonsBeforeCenter 7 // buttons above screen centre, allowing menu to appear centred.
+#define _captionColorBG 58/256, 80/256, 55/256 // BIS mid green (button over colour)
+#define _captionColorFG 138/256, 146/256, 105/256 // BIS greenish text
+#define _captionHgt 0.75
+
+class CBA_flexiMenu_rscPopup { //: _flexiMenu_rscRose
+	idd = -1; //_flexiMenu_IDD;
+	movingEnable = 0;
+	onLoad = __EVAL(format["uiNamespace setVariable ['%1', _this select 0]", QUOTE(GVAR(display))]);
+	onUnload = __EVAL(format["uiNamespace setVariable ['%1', displayNull]", QUOTE(GVAR(display))]);
+	class controlsBackground {};
+	class objects {};
+
+	flexiMenu_primaryMenuControlWidth = _BW;
+	flexiMenu_subMenuControlWidth = _BW;
+	flexiMenu_subMenuCaptionWidth = _BW;
+
+//class listButton; // external ref
+//#include "common_listClass.hpp"
+
+	class listButton: _flexiMenu_RscShortcutButton {
+		x = _SX-_BW;
+		y = safeZoneY+0.30*safeZoneH;
+		w = 0; //_BW; // hide initially
+		h = _BH;
+		sizeEx = _BH;
+		size = _BH*0.75;
+
+		color[] = {_captionColorFG, 1};
+		color2[] = {1, 1, 1, 0.8}; //{1, 1, 1, 0.4};
+		colorBackground[] = {1, 1, 1, 1};
+		colorbackground2[] = {1, 1, 1, 1}; //{1, 1, 1, 0.4};
+		colorDisabled[] = {1, 1, 1, 0.25};
+		class TextPos {
+			left = 0.02;
+			top = 0.005;
+			right = 0.02;
+			bottom = 0.005;
+		};
+		class Attributes {
+			font = "Zeppelin32";
+			color = "#E5E5E5";
+			align = "left";
+			shadow = "true";
+		};
+		animTextureNormal = _eval_image("normal");
+		animTextureDisabled = _eval_image("disabled");
+		animTextureOver = _eval_image("over");
+		animTextureFocused = _eval_image("focused");
+		animTexturePressed = _eval_image("down");
+		animTextureDefault = _eval_image("default");
+		animTextureNoShortcut = _eval_image("normal");
+	};
+	//---------------------------------
+	class controls {
+		class caption: rscText {
+			idc = _flexiMenu_IDC_menuDesc;
+			x = _SX-_BW;
+			y = safeZoneY+0.30*safeZoneH-_BH*_captionHgt;
+			w = _BW;
+			h = _BH*_captionHgt;
+			sizeEx = _BH*_captionHgt;
+			color[] = {_captionColorFG, 1};
+			colorBackground[] = {_captionColorBG, 1};
+			text = "";
+		};
+
+#define ExpandMacro_RowControls(ID) \
+	class button##ID: listButton\
+	{\
+		idc = __EVAL(_flexiMenu_IDC);\
+		__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);\
+		y = safeZoneY+0.30*safeZoneH+##ID*_BH;\
+	}
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_button);
+		ExpandMacro_RowControls(00);
+		ExpandMacro_RowControls(01);
+		ExpandMacro_RowControls(02);
+		ExpandMacro_RowControls(03);
+		ExpandMacro_RowControls(04);
+		ExpandMacro_RowControls(05);
+		ExpandMacro_RowControls(06);
+		ExpandMacro_RowControls(07);
+		ExpandMacro_RowControls(08);
+		ExpandMacro_RowControls(09);
+		ExpandMacro_RowControls(10);
+		ExpandMacro_RowControls(11);
+		ExpandMacro_RowControls(12);
+		ExpandMacro_RowControls(13);
+		ExpandMacro_RowControls(14);
+		ExpandMacro_RowControls(15);
+		ExpandMacro_RowControls(16);
+		ExpandMacro_RowControls(17);
+		ExpandMacro_RowControls(18);
+		ExpandMacro_RowControls(19);
+		//-----------------------
+		class caption2: caption {
+			idc = _flexiMenu_IDC_listMenuDesc;
+			x = _SX;
+			y = safeZoneY+0.30*safeZoneH+_BH-_BH*_captionHgt;
+			w = 0; //flexiMenu_subMenuCaptionWidth; // hide initially
+		};
+
+//#include "common_listControls.hpp"
+#define ExpandMacro_ListControls(ID)\
+	class listButton##ID: listButton\
+	{\
+		idc = __EVAL(_flexiMenu_IDC);\
+		__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);\
+		x = _SX;\
+		y = safeZoneY+0.30*safeZoneH+_BH+##ID*_BH;\
+	}
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_listButton);
+		ExpandMacro_ListControls(00);
+		ExpandMacro_ListControls(01);
+		ExpandMacro_ListControls(02);
+		ExpandMacro_ListControls(03);
+		ExpandMacro_ListControls(04);
+		ExpandMacro_ListControls(05);
+		ExpandMacro_ListControls(06);
+		ExpandMacro_ListControls(07);
+		ExpandMacro_ListControls(08);
+		ExpandMacro_ListControls(09);
+		ExpandMacro_ListControls(10);
+		ExpandMacro_ListControls(11);
+		ExpandMacro_ListControls(12);
+		ExpandMacro_ListControls(13);
+		ExpandMacro_ListControls(14);
+		ExpandMacro_ListControls(15);
+		ExpandMacro_ListControls(16);
+		ExpandMacro_ListControls(17);
+		ExpandMacro_ListControls(18);
+		ExpandMacro_ListControls(19);
+	};
+};
diff -rupN BASE_MISSION/x/cba/addons/flexiMenu/data/menu_rose.hpp BASE_A2Free/x/cba/addons/flexiMenu/data/menu_rose.hpp
--- BASE_MISSION/x/cba/addons/flexiMenu/data/menu_rose.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/flexiMenu/data/menu_rose.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,204 @@
+#include "common.hpp"
+//#include "common_rose.hpp"
+
+#define _DefaultAspectRatio 3/4
+#define _SX (safeZoneX+safeZoneW/2) // screen centre x
+#define _SY (safeZoneY+safeZoneH/2) // screen centre y
+#define _BW 0.18*safeZoneW // button width
+#define _BH (_CH/5.5) // button height
+#define _CX_correction 0.011*safeZoneW
+#define _CW 0.15*safeZoneW*_DefaultAspectRatio // _CH // exception // 0.10*safeZoneW // circle (button) width
+#define _CH 0.15*safeZoneH // 0.15*safeZoneW // exception safeZoneH // circle (button) height
+#define _SMW 0.15*safeZoneW // sub-menu width
+//#define _captionColorBG 58/256, 80/256, 55/256 // BIS mid green (button over colour)
+#define _captionColorFG 138/256, 146/256, 105/256 // BIS greenish text
+#define _captionHgt 0.85
+
+#define _gapW 0.01*safeZoneW // Horizontal gap "width" between circle button and side buttons
+#define _gapH ((_CH/2-2*_BH)*2/3) // Button "height" vertical spacing
+
+#define _flexiMenu_PATH \x\cba\addons\ui\flexiMenu
+#define IMAGE(A,B) QUOTE(_flexiMenu_PATH\A\B.paa)
+#define _eval_image(_param) IMAGE(data\rose,_param)
+
+
+#define _gapWLevel1 (-0.025*safeZoneW) // extra indentation required for side buttons on row 1 and 4 to reach circle edge
+#define _gapWLevel2 (-0.015*safeZoneW) // extra indentation required for side buttons on row 2 and 3 to reach circle edge
+#define _gapWRight (-0.00*safeZoneW) // extra indentation required for all right side buttons to reach circle edge
+
+#define _leftButtonLevel1X (_SX-(_CW/2+_gapW+_gapWLevel1)-_BW-_gapWRight)
+#define _leftButtonLevel2X (_SX-(_CW/2+_gapW+_gapWLevel2)-_BW-_gapWRight)
+#define _rightButtonLevel1X (_SX+(_CW/2+_gapW+_gapWLevel1)+_gapWRight)
+#define _rightButtonLevel2X (_SX+(_CW/2+_gapW+_gapWLevel2)+_gapWRight)
+
+class CBA_flexiMenu_rscRose {
+	idd = -1; //_flexiMenu_IDD;
+	movingEnable = 0;
+	onLoad = __EVAL(format["uiNamespace setVariable ['%1', _this select 0]", QUOTE(GVAR(display))]);
+	onUnload = __EVAL(format["uiNamespace setVariable ['%1', displayNull]", QUOTE(GVAR(display))]);
+	class controlsBackground {};
+	class objects {};
+
+	// custom flexiMenu properties
+	flexiMenu_primaryMenuControlWidth = _BW;
+	flexiMenu_subMenuControlWidth = _SMW;
+	flexiMenu_subMenuCaptionWidth = 0.40;
+
+//class listButton; // external ref
+//#include "common_listClass.hpp"
+#define _eval_image2(_param) IMAGE(data\buttonList,_param)
+
+	class listButton: _flexiMenu_RscShortcutButton {
+		x = 0.5;
+		y = 0.5;
+		w = 0; //_SMW; // hide initially
+		//w = _SMW;
+		h = _LBH;
+		sizeEx = _LBH;
+		size = _LBH*0.75;
+
+		color[] = {_captionColorFG, 1};
+		color2[] = {1, 1, 1, 0.8}; //{1, 1, 1, 0.4};
+		colorBackground[] = {1, 1, 1, 1};
+		colorbackground2[] = {1, 1, 1, 1}; //{1, 1, 1, 0.4};
+		colorDisabled[] = {1, 1, 1, 0.25};
+		class TextPos {
+			left = 0.02;
+			top = 0.005;
+			right = 0.02;
+			bottom = 0.005;
+		};
+		class Attributes {
+			font = "Zeppelin32";
+			color = "#E5E5E5";
+			align = "left";
+			shadow = "true";
+		};
+		animTextureNormal = _eval_image2(normal);
+		animTextureDisabled = _eval_image2(disabled);
+		animTextureOver = _eval_image2(over);
+		animTextureFocused = _eval_image2(focused);
+		animTexturePressed = _eval_image2(down);
+		animTextureDefault = _eval_image2(default);
+		animTextureNoShortcut = _eval_image2(normal);
+	};
+
+	class button: _flexiMenu_RscShortcutButton {
+		w = 0; //_BW; // hide initially
+		h = _BH;
+		sizeEx = _BH;
+		size = _BH*0.85;
+
+		color[] = {_captionColorFG, 1};
+		color2[] = {1, 1, 1, 0.8}; //{1, 1, 1, 0.4};
+		colorBackground[] = {1, 1, 1, 1};
+		colorbackground2[] = {1, 1, 1, 1}; //{1, 1, 1, 0.4};
+		colorDisabled[] = {1, 1, 1, 0.25};
+		//action = _eval_action(-1);
+
+		class Attributes {
+			font = "Zeppelin32";
+			color = "#E5E5E5";
+			align = "center";
+			shadow = "true";
+		};
+	};
+	//---------------------------------
+	class controls {
+		class caption: rscText {
+			idc = _flexiMenu_IDC_menuDesc;
+			//x = _SX-_BW;
+			x = _leftButtonLevel1X;
+			//y = _SY-_buttonsBeforeCenter*_BH-_gapH-_BH*_captionHgt;
+			y = _SY-(_CH/2+_gapH)-_BH-_gapH-_BH*_captionHgt;
+			w = 0.40;
+			h = _BH*_captionHgt;
+			sizeEx = _BH*_captionHgt;
+			color[] = {_captionColorFG, 1};
+			text = "";
+		};
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_button);
+		class button01: button {
+			idc = __EVAL(_flexiMenu_IDC);
+			__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);
+			x = _SX-_CW/2+_CX_correction;
+			y = _SY-_CH/2;
+			w = _CW;
+			h = _CH;
+			sizeEx = _CH;
+			//size = _BH*0.8;
+			class TextPos {
+				left = -_CX_correction*2; // not sure if logic is correct, but seems close enough // 0.008
+				top = _CH/2-_BH/2;
+				right = 0; //0.002;
+				bottom = 0.0;
+			};
+			animTextureNormal = _eval_image(DOUBLES(normal,circle));
+			animTextureDisabled = _eval_image(DOUBLES(disabled,circle));
+			animTextureOver = _eval_image(DOUBLES(over,circle));
+			animTextureFocused = _eval_image(DOUBLES(focused,circle));
+			animTexturePressed = _eval_image(DOUBLES(down,circle));
+			animTextureDefault = _eval_image(DOUBLES(normal,circle)); // used?
+			animTextureNoShortcut = _eval_image(DOUBLES(normal,circle)); // used?
+		};
+
+		#define ExpandMacro_RowControls(ID,newX,newY,imageTag) \
+		class button##ID: button {\
+			idc = __EVAL(_flexiMenu_IDCi);\
+			__EXEC(_flexiMenu_IDCi = _flexiMenu_IDCi+1);\
+			x = ##newX;\
+			y = ##newY;\
+			text = "";\
+			action = "";\
+			animTextureNormal = _eval_image(DOUBLES(normal,imageTag));\
+			animTextureDisabled = _eval_image(DOUBLES(disabled,imageTag));\
+			animTextureOver = _eval_image(DOUBLES(over,imageTag));\
+			animTextureFocused = _eval_image(DOUBLES(focused,imageTag));\
+			animTexturePressed = _eval_image(DOUBLES(down,imageTag));\
+			animTextureDefault = _eval_image(DOUBLES(normal,imageTag));\
+			animTextureNoShortcut = _eval_image(DOUBLES(normal,imageTag));\
+		}
+
+		ExpandMacro_RowControls(02, _SX-_BW/2, _SY-(_CH/2+_gapH)-_BH,top);
+		ExpandMacro_RowControls(03, _SX-_BW/2, _SY+(_CH/2+_gapH),bottom);
+		ExpandMacro_RowControls(04, _leftButtonLevel1X, _SY-_gapH/2-_BH-_gapH-_BH,L01);
+		ExpandMacro_RowControls(05, _leftButtonLevel2X, _SY-_gapH/2-_BH,L02);
+		ExpandMacro_RowControls(06, _leftButtonLevel2X, _SY+_gapH/2,L03);
+		ExpandMacro_RowControls(07, _leftButtonLevel1X, _SY+_gapH/2+_BH+_gapH,L04);
+		ExpandMacro_RowControls(08, _rightButtonLevel1X, _SY-_gapH/2-_BH-_gapH-_BH,R01);
+		ExpandMacro_RowControls(09, _rightButtonLevel2X, _SY-_gapH/2-_BH,R02);
+		ExpandMacro_RowControls(10, _rightButtonLevel2X, _SY+_gapH/2,R03);
+		ExpandMacro_RowControls(11, _rightButtonLevel1X, _SY+_gapH/2+_BH+_gapH,R04);
+		//-----------------------
+		class caption2: caption {
+			idc = _flexiMenu_IDC_listMenuDesc;
+			x = _SX-(_SMW/2);
+			y = _SY+(_CH/2+_gapH)+_BH+_gapH+0*_LBH;
+			w = 0; //flexiMenu_subMenuCaptionWidth; // hide initially
+		};
+
+//#include "common_listControls.hpp"
+#define ExpandMacro_ListControls(ID)\
+	class listButton##ID: listButton\
+	{\
+		idc = __EVAL(_flexiMenu_IDC);\
+		__EXEC(_flexiMenu_IDC = _flexiMenu_IDC+1);\
+		x = _SX-(_SMW/2);\
+		y = _SY+(_CH/2+_gapH)+_BH+_gapH+(1+##ID)*_LBH;\
+	}
+
+		__EXEC(_flexiMenu_IDC = _flexiMenu_baseIDC_listButton);
+		ExpandMacro_ListControls(00);
+		ExpandMacro_ListControls(01);
+		ExpandMacro_ListControls(02);
+		ExpandMacro_ListControls(03);
+		ExpandMacro_ListControls(04);
+		ExpandMacro_ListControls(05);
+		ExpandMacro_ListControls(06);
+		ExpandMacro_ListControls(07);
+		ExpandMacro_ListControls(08);
+		ExpandMacro_ListControls(09);
+		ExpandMacro_ListControls(10);
+	};
+};
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/popup/default.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/popup/default.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/popup/disabled.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/popup/disabled.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/popup/down.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/popup/down.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/popup/focused.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/popup/focused.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/popup/normal.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/popup/normal.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/popup/over.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/popup/over.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/popup/separator.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/popup/separator.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_L01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_L01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_L02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_L02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_L03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_L03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_L04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_L04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_R01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_R01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_R02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_R02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_R03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_R03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_R04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_R04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_bottom.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_bottom.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_circle.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_circle.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/disabled_top.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/disabled_top.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_L01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_L01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_L02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_L02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_L03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_L03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_L04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_L04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_R01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_R01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_R02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_R02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_R03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_R03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_R04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_R04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_bottom.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_bottom.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_circle.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_circle.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/down_top.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/down_top.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_L01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_L01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_L02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_L02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_L03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_L03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_L04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_L04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_R01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_R01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_R02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_R02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_R03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_R03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_R04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_R04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_bottom.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_bottom.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_circle.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_circle.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/focused_top.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/focused_top.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_L01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_L01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_L02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_L02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_L03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_L03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_L04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_L04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_R01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_R01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_R02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_R02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_R03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_R03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_R04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_R04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_bottom.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_bottom.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_circle.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_circle.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/normal_top.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/normal_top.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_L01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_L01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_L02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_L02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_L03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_L03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_L04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_L04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_R01.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_R01.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_R02.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_R02.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_R03.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_R03.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_R04.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_R04.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_bottom.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_bottom.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_circle.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_circle.paa differ
Binary files BASE_MISSION/x/cba/addons/flexiMenu/data/rose/over_top.paa and BASE_A2Free/x/cba/addons/flexiMenu/data/rose/over_top.paa differ
diff -rupN BASE_MISSION/x/cba/addons/hashes_fnc_hashCreate.sqf BASE_A2Free/x/cba/addons/hashes_fnc_hashCreate.sqf
--- BASE_MISSION/x/cba/addons/hashes_fnc_hashCreate.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_fnc_hashCreate.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,56 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_hashCreate
+
+Description:
+	Check if a Hash has a value defined for a key.
+
+Parameters:
+	_array - Array of key-value pairs to create Hash from [Array, defaults to []]
+	_defaultValue - Default value. Used when key doesn't exist. A key is also removed from the hash if the value is set to this default [Any, defaults to nil]
+
+Returns:
+	Newly created Hash [Hash]
+
+Examples:
+(begin code)
+	_emptyHash = [] call CBA_fnc_hashCreate;
+	[_emptyHash, "frog"] call CBA_fnc_hashGet; // => nil
+
+	_pairs = [["frog", 12], ["fish", 9]];
+	_animalCounts = [_pairs, 0] call CBA_fnc_hashCreate;
+	[_animalCounts, "frog"] call CBA_fnc_hashGet; // => 12
+	[_animalCounts, "monkey"] call CBA_fnc_hashGet; // => 0
+(end code)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_hashes.hpp"
+
+SCRIPT(hashCreate);
+
+// -----------------------------------------------------------------------------
+
+DEFAULT_PARAM(0,_array,[]);
+DEFAULT_PARAM(1,_defaultValue,nil);
+private ["_keys", "_values"];
+
+_keys = [];
+_values = [];
+
+_keys resize (count _array);
+_values resize (count _array);
+
+for "_i" from 0 to ((count _array) - 1) do
+{
+	_keys set [_i, (_array select _i) select 0];
+	_values set [_i, (_array select _i) select 1];
+};
+
+// Return.
+[TYPE_HASH, _keys, _values,
+	if (isNil "_defaultValue") then { nil } else { _defaultValue }];
diff -rupN BASE_MISSION/x/cba/addons/hashes_fnc_hashEachPair.sqf BASE_A2Free/x/cba/addons/hashes_fnc_hashEachPair.sqf
--- BASE_MISSION/x/cba/addons/hashes_fnc_hashEachPair.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_fnc_hashEachPair.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,59 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_hashEachPair
+
+Description:
+	Iterate through all keys and values in a Hash.
+
+	Data passed to the function on each iteration,
+	* _key - Key from the Hash.
+	* _value - The value from the Hash corresponding to _key.
+
+	See <CBA_fnc_hashCreate>.
+
+Parameters:
+	_hash - Hash to iterate [Array which is a Hash structure]
+	_code - Function to call with each pair [Any]
+
+Returns:
+	nil
+
+Example:
+	(begin example)
+	_dumpHash = {
+		diag_log format ["Key: %1, Value: %2", _key, _value];
+	};
+
+	[_hash, _dumpHash] call CBA_fnc_hashEachPair;
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_hashes.hpp"
+
+SCRIPT(hashEachPair);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_2(_hash,_code);
+
+private ["_keys", "_values"];
+
+_keys = _hash select HASH_KEYS;
+_values = _hash select HASH_VALUES;
+
+for "_i" from 0 to ((count _keys) - 1) do
+{
+	private ["_key", "_value"];
+
+	_key = _keys select _i;
+	_value = _values select _i;
+
+	call _code;
+};
+
+nil; // Return.
diff -rupN BASE_MISSION/x/cba/addons/hashes_fnc_hashGet.sqf BASE_A2Free/x/cba/addons/hashes_fnc_hashGet.sqf
--- BASE_MISSION/x/cba/addons/hashes_fnc_hashGet.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_fnc_hashGet.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,47 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_hashGet
+
+Description:
+	Gets a value for a given key from a Hash.
+
+	See <CBA_fnc_hashCreate>.
+
+Parameters:
+	_hash - Hash to look for key in [Array which is a Hash structure]
+	_key - Key to search for in Hash [Any]
+
+Returns:
+	Value associated with the key, or Hash default value if key missing [Any]
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_hashes.hpp"
+
+SCRIPT(hashGet);
+
+// -----------------------------------------------------------------------------
+private ["_index", "_default", "_new"];
+PARAMS_2(_hash,_key);
+
+_index = (_hash select HASH_KEYS) find _key;
+if (_index >= 0) then
+{
+	(_hash select HASH_VALUES) select _index; // Return.
+} else {
+	_default = _hash select HASH_DEFAULT_VALUE;
+	if (isNil "_default") then {
+		nil // Return
+	} else {
+		// Make a copy of the array instead!
+		if (typeName _default == "ARRAY") then
+		{
+			_default = + _default;
+		};
+		_default // Return.
+	};
+};
diff -rupN BASE_MISSION/x/cba/addons/hashes_fnc_hashHasKey.sqf BASE_A2Free/x/cba/addons/hashes_fnc_hashHasKey.sqf
--- BASE_MISSION/x/cba/addons/hashes_fnc_hashHasKey.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_fnc_hashHasKey.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,31 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_hashHasKey
+
+Description:
+	Check if a Hash has a value defined for a key.
+
+	See <CBA_fnc_hashCreate>.
+
+Parameters:
+	_hash - Hash to look for key in [Array which is a Hash structure]
+	_key - Key to search for in Hash [Any]
+
+Returns:
+	True if key defined, false if not defined [Boolean]
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_hashes.hpp"
+
+SCRIPT(hashHasKey);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_2(_hash,_key);
+
+_key in (_hash select HASH_KEYS); // Return.
diff -rupN BASE_MISSION/x/cba/addons/hashes_fnc_hashRem.sqf BASE_A2Free/x/cba/addons/hashes_fnc_hashRem.sqf
--- BASE_MISSION/x/cba/addons/hashes_fnc_hashRem.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_fnc_hashRem.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,35 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_hashRem
+
+Description:
+	Removes given key from given Hash.
+
+	See <CBA_fnc_hashCreate>.
+
+Parameters:
+	_hash - Hash to use [Hash]
+	_key - Key to set in Hash [Any]
+
+Returns:
+	The hash [Hash]
+
+Author:
+	Sickboy
+---------------------------------------------------------------------------- */
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_hashes.hpp"
+
+SCRIPT(hashRem);
+
+// ----------------------------------------------------------------------------
+PARAMS_2(_hash,_key);
+
+private ["_defaultValue"];
+
+_defaultValue = _someHash select HASH_DEFAULT_VALUE;
+[_hash, _key, if (isNil "_defaultValue") then { nil } else { _defaultValue }] call CBA_fnc_hashSet;
+
+_hash; // Return.
diff -rupN BASE_MISSION/x/cba/addons/hashes_fnc_hashSet.sqf BASE_A2Free/x/cba/addons/hashes_fnc_hashSet.sqf
--- BASE_MISSION/x/cba/addons/hashes_fnc_hashSet.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_fnc_hashSet.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,69 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_hashSet
+
+Description:
+	Sets a value for a given key in a Hash.
+
+	See <CBA_fnc_hashCreate>.
+
+Parameters:
+	_hash - Hash to use [Hash]
+	_key - Key to set in Hash [Any]
+	_value - Value to set [Any]
+
+Returns:
+	The hash [Hash]
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_hashes.hpp"
+
+SCRIPT(hashSet);
+
+// ----------------------------------------------------------------------------
+PARAMS_3(_hash,_key,_value);
+
+private ["_index", "_isDefault"];
+
+// Work out whether the new value is the default value for this assoc.
+_isDefault = [if (isNil "_value") then { nil } else { _value },
+	_hash select HASH_DEFAULT_VALUE] call BIS_fnc_areEqual;
+
+_index = (_hash select HASH_KEYS) find _key;
+if (_index >= 0) then
+{
+	if (_isDefault) then
+	{
+		// Remove the key, if the new value is the default value.
+		_hash set [HASH_KEYS, (_hash select HASH_KEYS) - [_key]];
+
+		// Copy all the values, after the one we want to remove, down by
+		// one place, then cut off the last value.
+		private "_values";
+		_values = _hash select HASH_VALUES;
+
+		for "_i" from _index to ((count _values) - 2) do
+		{
+			_values set [_i, _values select (_i + 1)];
+		};
+
+		_values resize ((count _values) - 1);
+	} else {
+		// Replace the original value for this key.
+		(_hash select HASH_VALUES) set [_index, _value];
+	};
+} else {
+	// Ignore values that are the same as the default.
+	if (not _isDefault) then
+	{
+		PUSH(_hash select HASH_KEYS,_key);
+		PUSH(_hash select HASH_VALUES,_value);
+	};
+};
+
+_hash; // Return.
diff -rupN BASE_MISSION/x/cba/addons/hashes_fnc_isHash.sqf BASE_A2Free/x/cba/addons/hashes_fnc_isHash.sqf
--- BASE_MISSION/x/cba/addons/hashes_fnc_isHash.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_fnc_isHash.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,43 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_isHash
+
+Description:
+	Check if a value is a Hash data structure.
+
+	See <CBA_fnc_hashCreate>.
+
+Parameters:
+	_value - Data structure to check [Any]
+
+Returns:
+	True if it is a Hash, otherwise false [Boolean]
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_hashes.hpp"
+
+SCRIPT(isHash);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_1(_value);
+
+_result = false;
+
+if ((typeName _value) == "ARRAY") then
+{
+	if ((count _value) == 4) then
+	{
+		if ((typeName (_value select HASH_ID)) == (typeName TYPE_HASH)) then
+		{
+			_result = ((_value select HASH_ID) == TYPE_HASH);
+		};
+	};
+};
+
+_result;
diff -rupN BASE_MISSION/x/cba/addons/hashes_script_component.hpp BASE_A2Free/x/cba/addons/hashes_script_component.hpp
--- BASE_MISSION/x/cba/addons/hashes_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,13 @@
+#define COMPONENT hashes
+#include "script_mod.hpp"
+
+
+#ifdef DEBUG_ENABLED_HASHES
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_HASHES
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_HASHES
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/hashes_test.sqf BASE_A2Free/x/cba/addons/hashes_test.sqf
--- BASE_MISSION/x/cba/addons/hashes_test.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_test.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,22 @@
+// -----------------------------------------------------------------------------
+// Automatically generated by 'functions_config.rb'
+// DO NOT MANUALLY EDIT THIS FILE!
+// -----------------------------------------------------------------------------
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define TESTS ["hashEachPair", "hashes"]
+
+SCRIPT(test-hashes);
+
+// ----------------------------------------------------------------------------
+
+LOG("=== Testing Hashes ===");
+
+{
+	call compile preprocessFileLineNumbers format ["\x\cba\addons\hashes\test_%1.sqf", _x];
+} forEach TESTS;
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/hashes_test_hashEachPair.sqf BASE_A2Free/x/cba/addons/hashes_test_hashEachPair.sqf
--- BASE_MISSION/x/cba/addons/hashes_test_hashEachPair.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_test_hashEachPair.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,38 @@
+// ----------------------------------------------------------------------------
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_hashEachPair);
+
+// ----------------------------------------------------------------------------
+
+private ["_hash", "_expected", "_sumKeys", "_sumValues", "_totalIterations"];
+
+_fn = "CBA_fnc_hashEachPair";
+ASSERT_DEFINED(_fn,"");
+
+LOG("Testing " + _fn);
+
+_hash = [[[1, 12], [5, 25]], 88] call CBA_fnc_hashCreate;
+
+_sumKeys = 0;
+_sumValues = 0;
+_totalIterations = 0;
+
+[_hash,
+{
+	ADD(_sumKeys,_key);
+	ADD(_sumValues,_value);
+	INC(_totalIterations);
+}] call CBA_fnc_hashEachPair;
+
+_expected = 6;
+ASSERT_OP(_sumKeys,==,_expected,"");
+
+_expected = 37;
+ASSERT_OP(_sumValues,==,_expected,"");
+
+_expected = 2;
+ASSERT_OP(_totalIterations,==,_expected,"");
diff -rupN BASE_MISSION/x/cba/addons/hashes_test_hashes.sqf BASE_A2Free/x/cba/addons/hashes_test_hashes.sqf
--- BASE_MISSION/x/cba/addons/hashes_test_hashes.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/hashes_test_hashes.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,86 @@
+// ----------------------------------------------------------------------------
+
+#include "hashes_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_hashes);
+
+// ----------------------------------------------------------------------------
+
+private ["_hash", "_expected", "_result"];
+
+LOG("Testing Hashes");
+
+// UNIT TESTS (initStrings.sqf - stringJoin)
+ASSERT_DEFINED("CBA_fnc_hashCreate","");
+ASSERT_DEFINED("CBA_fnc_hashGet","");
+ASSERT_DEFINED("CBA_fnc_hashSet","");
+ASSERT_DEFINED("CBA_fnc_hashHasKey","");
+ASSERT_DEFINED("CBA_fnc_isHash","");
+
+ASSERT_FALSE([[]] call CBA_fnc_isHash,"CBA_fnc_isHash");
+_hash = [5, [4], [1], 2]; // Not a real hash.
+ASSERT_FALSE([_hash] call CBA_fnc_isHash,"CBA_fnc_isHash");
+ASSERT_FALSE([5] call CBA_fnc_isHash,"CBA_fnc_isHash");
+
+// Putting in and retreiving values.
+_hash = [] call CBA_fnc_hashCreate;
+ASSERT_DEFINED("_hash","hashSet/Get");
+ASSERT_TRUE([_hash] call CBA_fnc_isHash,"CBA_fnc_isHash");
+
+_result = [_hash, "frog"] call CBA_fnc_hashHasKey;
+ASSERT_FALSE(_result,"hashHashKey");
+
+[_hash, "frog", 12] call CBA_fnc_hashSet;
+ASSERT_TRUE([_hash] call CBA_fnc_isHash,"CBA_fnc_isHash");
+
+_result = [_hash, "frog"] call CBA_fnc_hashGet;
+ASSERT_OP(_result,==,12,"hashSet/Get");
+
+_result = [_hash, "frog"] call CBA_fnc_hashHasKey;
+ASSERT_TRUE(_result,"hashHashKey");
+
+_result = [_hash, "fish"] call CBA_fnc_hashHasKey;
+ASSERT_FALSE(_result,"hashHashKey");
+
+// Unsetting a value
+[_hash, "frog", nil] call CBA_fnc_hashSet;
+
+_result = [_hash, "frog"] call CBA_fnc_hashGet;
+ASSERT_TRUE(isNil "_result","hashSet/Get");
+
+// Value never put in is nil.
+_result = [_hash, "fish"] call CBA_fnc_hashGet;
+ASSERT_TRUE(isNil "_result","hashSet/Get");
+
+// Reading in from array
+_hash = [[["fish", 7], ["frog", 99]]] call CBA_fnc_hashCreate;
+ASSERT_TRUE([_hash] call CBA_fnc_isHash,"CBA_fnc_isHash");
+
+_result = [_hash, "frog"] call CBA_fnc_hashGet;
+ASSERT_DEFINED("_result","hashSet/Get");
+ASSERT_OP(_result,==,99,"hashSet/Get");
+
+// Alternative defaults.
+_hash = [[["frog", -8]], 0] call CBA_fnc_hashCreate;
+ASSERT_TRUE([_hash] call CBA_fnc_isHash,"CBA_fnc_isHash");
+
+_result = [_hash, "frog"] call CBA_fnc_hashGet;
+ASSERT_DEFINED("_result","hashSet/Get");
+ASSERT_OP(_result,==,-8,"hashSet/Get");
+
+_result = [_hash, "fish"] call CBA_fnc_hashGet;
+ASSERT_DEFINED("_result","hashSet/Get");
+ASSERT_OP(_result,==,0,"hashSet/Get");
+
+[_hash, "frog", 1] call CBA_fnc_hashSet;
+_result = [_hash, "frog"] call CBA_fnc_hashGet;
+ASSERT_DEFINED("_result","hashSet/Get");
+ASSERT_OP(_result,==,1,"hashSet/Get");
+
+[_hash, "frog", nil] call CBA_fnc_hashSet;
+_result = [_hash, "frog"] call CBA_fnc_hashGet;
+ASSERT_TRUE(isNil "_result","hashSet/Get");
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/help_XEH_postClientInit.sqf BASE_A2Free/x/cba/addons/help_XEH_postClientInit.sqf
--- BASE_MISSION/x/cba/addons/help_XEH_postClientInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/help_XEH_postClientInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,14 @@
+#include "help_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+player createDiarySubject ["CBA_docs", "CBA"];
+//player createDiaryRecord ["CBA_docs", [(localize "STR_DN_CBA_WEBSITE_WIKI"), "http://dev-heaven.net/projects/cca"]];
+player createDiaryRecord ["CBA_docs", [(localize "STR_DN_CBA_CREDITS_ADDONS"), ([GVAR(credits), "CfgPatches"] call CBA_fnc_hashGet) call FUNC(process)]];
+player createDiaryRecord ["CBA_docs", ["Docs", GVAR(docs)]];
+player createDiaryRecord ["CBA_docs", [(localize "STR_DN_CBA_HELP_KEYS"), GVAR(keys)]];
+//player createDiaryRecord ["CBA_docs", [(localize "STR_DN_CBA_CREDITS"), GVAR(credits_cba)]];
+//player createDiaryRecord ["CBA_docs", ["Credits - Vehicles", ([GVAR(credits), "CfgVehicles"] call CBA_fnc_hashGet) call FUNC(process)]];
+//player createDiaryRecord ["CBA_docs", ["Credits - Weapons", ([GVAR(credits), "CfgWeapons"] call CBA_fnc_hashGet) call FUNC(process)]];
+
+//player createDiaryRecord ["CBA_docs", [(localize "STR_DN_CBA_WEBSITE"), "http://dev-heaven.net/projects/cca"]];
diff -rupN BASE_MISSION/x/cba/addons/help_XEH_preClientInit.sqf BASE_A2Free/x/cba/addons/help_XEH_preClientInit.sqf
--- BASE_MISSION/x/cba/addons/help_XEH_preClientInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/help_XEH_preClientInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,110 @@
+#include "help_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+LOG(MSG_INIT);
+
+ADDON = false;
+
+PREP(help);
+PREP(describe);
+
+FUNC(readConfig) = {
+	PARAMS_1(_type);
+	_config = configFile >> _type;
+	_hash = [[], []] call CBA_fnc_hashCreate;
+	_hash2 = [[], ""] call CBA_fnc_hashCreate;
+	_hash3 = [[], ""] call CBA_fnc_hashCreate;
+	for "_i" from 0 to (count _config) - 1 do {
+		_entry = _config select _i;
+		if (isClass _entry) then {
+			if (isArray (_entry >> "author")) then { [_hash, configName _entry, getArray(_entry >> "author")] call CBA_fnc_hashSet };
+			if (isText (_entry >> "authorUrl")) then { [_hash2, configName _entry, getText(_entry >> "authorUrl")] call CBA_fnc_hashSet };
+			if (isText (_entry >> "version")) then { [_hash3, configName _entry, getText(_entry >> "version")] call CBA_fnc_hashSet };
+		};
+	};
+	[_hash, _hash2, _hash3];
+};
+
+FUNC(process) = {
+	PARAMS_3(_h1,_h2,_h3);
+	_ar = [];
+	[_h1, {_entry = format["%1, v%2, (%3)<br/>Author: %4", _key, [_h3, _key] call CBA_fnc_hashGet, [_h2, _key] call CBA_fnc_hashGet, [_value, ", "] call CBA_fnc_join]; PUSH(_ar,_entry) }] call CBA_fnc_hashEachPair;
+	[_ar, "<br/><br/>"] call CBA_fnc_join;
+};
+
+private ["_pkeynam", "_shift", "_ctrl", "_alt", "_keys", "_key", "_keystrg", "_mod", "_knaml", "_knam", "_k", "_text", "_cEvents", "_i", "_cSys", "_tSys", "_aSys", "_tS", "_j", "_c", "_tC", "_keyn", "_credits"];
+_pkeynam = { //local function
+	_shift = if(_shift > 0) then {42} else {0};
+	_ctrl = if(_ctrl > 0) then {56} else {0};
+	_alt = if(_alt > 0) then {29} else {0};
+	_keys = [_shift,_ctrl,_alt,_key];
+	_keystrg = "^";
+	{
+		_mod = _x in [42,56,29]; // ???
+		_knaml = call compile format["format['%2',%1]",(keyName _x),"%1"];
+		_knaml = [_knaml, " "] call CBA_fnc_split;
+		_knam = "^";
+		{_k = _x; _knam = _knam + " " + _k} forEach _knaml;
+		// if(!(_mod) || ( (_k != (localize "STR_ACE_KN_LEFT")) && (_k != (localize "STR_ACE_KN_RIGHT")) )) then {  // ?????
+		_knam = [_knam, "^ ", ""] call CBA_fnc_replace;
+		_keystrg = _keystrg + "-" + _knam;
+	} forEach _keys;
+	_keystrg = [_keystrg, "^ ", ""] call CBA_fnc_replace;
+	_keystrg = [_keystrg, "^-", ""] call CBA_fnc_replace;
+	_keystrg = [_keystrg, "^", "None"] call CBA_fnc_replace;
+	_keystrg
+};
+
+_text="";
+_cEvents = configFile/"CfgSettings"/"CBA"/"events";
+for "_i" from 0 to (count _cEvents)-1 do {
+	_cSys = _cEvents select _i;
+	_tSys = configName _cSys;
+	if (isNumber((_cSys select 0)/"key")) then {
+		//format system name
+		_aSys = [_tSys, "_"] call CBA_fnc_split;
+		_tS = "^";
+		{if((_x != "sys")) then {_tS = _tS + " " + _x;}} forEach _aSys;
+		// (_x != "ace") &&
+		_tS = [_tS, "^ ", ""] call CBA_fnc_replace;
+		_tS = format["%1:",_tS];
+		_text = _text + _tS + "<br/>";
+		for "_j" from 0 to (count _cSys)-1 do {
+			_c = _cSys select _j;
+			_tC = configName _c;
+			_tC = [_tC, "_", " "] call CBA_fnc_replace;
+			//key
+			_key = getNumber (_c/"key");
+			_shift = getNumber (_c/"shift");
+			_ctrl = getNumber (_c/"ctrl");
+			_alt = getNumber (_c/"alt");
+			_keyn = [_key,_shift,_ctrl,_alt] call _pkeynam;
+			_tC = format["    %1: %2",_tC,_keyn];
+			_text = _text + _tC + "<br/>";
+		};
+		_text = _text + "<br/>";
+	};
+};
+
+GVAR(credits) = [[], []] call CBA_fnc_hashCreate;
+{ [GVAR(credits), _x, [_x] call FUNC(readConfig)] call CBA_fnc_hashSet } forEach ["CfgPatches"]; //, "CfgVehicles", "CfgWeapons"];
+
+GVAR(docs) = "";
+_cfg = configFile >> "CfgMods";
+_c = count _cfg;
+if (_c > 0) then {
+	for "_i" from 0 to (_c - 1) do {
+		_mod = _cfg select _i;
+		if (isClass _mod) then {
+			if (isText(_mod >> "description")) then {
+				_e = format["* %1 - %2<br />%3<br /><br />", configName _mod, getText(_mod >> "name"), getText(_mod >> "description")];
+				ADD(GVAR(docs),_e);
+			};
+		};
+	};
+};
+
+GVAR(keys) = _text;
+
+ADDON = true;
diff -rupN BASE_MISSION/x/cba/addons/help_fnc_describe.sqf BASE_A2Free/x/cba/addons/help_fnc_describe.sqf
--- BASE_MISSION/x/cba/addons/help_fnc_describe.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/help_fnc_describe.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,46 @@
+#define DEBUG_MODE_FULL
+#define __cfg configFile >> _type
+#define __cfgveh configFile >> _type
+#include "help_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private ["_ar", "_entry", "_type"];
+PARAMS_1(_unit);
+_ar = [];
+_type = typeOf _unit;
+
+_entry = ["Unit", format["%1", _type]];
+PUSH(_ar,_entry);
+
+if (vehicle _unit != _unit) then {
+	_entry = ["Vehicle", format["%1", typeOf (vehicle _unit)]];
+	PUSH(_ar,_entry);
+	if (isArray(__cfgveh >> "author")) then {
+		_entry = ["VehAuthor", format["%1", getArray(__cfgveh >> "author")]];
+		PUSH(_ar,_entry);
+	};
+
+	if (isText(__cfgveh >> "authorUrl")) then {
+		_entry = ["VehAuthorUrl", format["%1", getText(__cfgveh >> "authorUrl")]];
+		PUSH(_ar,_entry);
+	};
+};
+
+_entry = ["Weapons", format["%1", weapons _unit]];
+PUSH(_ar,_entry);
+
+_entry = ["Magazines", format["%1", magazines _unit]];
+PUSH(_ar,_entry);
+
+if (isArray(__cfg >> "author")) then {
+	_entry = ["Author", format["%1", getArray(__cfg >> "author")]];
+	PUSH(_ar,_entry);
+};
+
+if (isText(__cfg >> "authorUrl")) then {
+	_entry = ["AuthorUrl", format["%1", getText(__cfg >> "authorUrl")]];
+	PUSH(_ar,_entry);
+};
+
+_ar;
diff -rupN BASE_MISSION/x/cba/addons/help_fnc_help.sqf BASE_A2Free/x/cba/addons/help_fnc_help.sqf
--- BASE_MISSION/x/cba/addons/help_fnc_help.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/help_fnc_help.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,4 @@
+#include "help_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+call BIS_fnc_help;
diff -rupN BASE_MISSION/x/cba/addons/help_script_component.hpp BASE_A2Free/x/cba/addons/help_script_component.hpp
--- BASE_MISSION/x/cba/addons/help_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/help_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,12 @@
+#define COMPONENT help
+#include "script_mod.hpp"
+
+#ifdef DEBUG_ENABLED_HELP
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_HELP
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_HELP
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/help_show.sqf BASE_A2Free/x/cba/addons/help_show.sqf
--- BASE_MISSION/x/cba/addons/help_show.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/help_show.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,74 @@
+// #define DEBUG_MODE_FULL
+#include "help_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_dialog_defines.hpp"
+
+disableSerialization;
+PARAMS_1(_data);
+private ["_disp", "_ctrlt", "_ctrl", "_config", "_stop", "_rand", "_entry", "_name", "_authors", "_author", "_url", "_text", "_version"];
+
+if ( isNil QUOTE(GVAR(show_proc)) ) then {
+	GVAR(show_proc) = true;
+
+	//get display control
+	if (typeName (_data select 0) == "DISPLAY") then {
+		_disp = _data select 0;
+	};
+
+	if (typeName (_data select 0) == "CONTROL") then {
+		_ctrlt = _data select 0;
+		_disp = ctrlParent _ctrlt;
+	};
+
+	_ctrl = _disp displayCtrl CBA_CREDITS_CONT_IDC;
+
+	//get settings
+	{
+		if (isNil _x) then { missionNamespace setVariable [_x, isClass(configFile/"CfgPatches"/_x)] };
+	} forEach ["CBA_DisableCredits", "CBA_MonochromeCredits"];
+
+	//TRACE_1("",ctrlText _ctrl);
+	//if text not already shown
+	if ( (ctrlText _ctrl) == "" && ! CBA_DisableCredits ) then {
+		//find addon with author
+		_config = configFile >> "CfgPatches";
+		_stop = false;
+		while { ! _stop } do {
+			_rand = floor(random(count _config));
+			_entry = _config select _rand;
+			if ( isClass _entry ) then { _stop = isArray (_entry >> "author"); };
+			//TRACE_1("",configName _entry);
+		};
+
+		//addon name
+		_name = configName _entry;
+		if ( ! CBA_MonochromeCredits ) then { _name = "<t color='#99cccc'>" + _name + "</t>"; };
+		//author(s) name
+		_authors = getArray(_entry >> "author");
+		_author = _authors select 0;
+		for "_x" from 1 to (count(_authors)-1) do {
+			if ( typeName (_authors select _x) == "STRING" ) then { _author = _author + ", " + (_authors select _x); }
+		};
+		//url if any
+		if (isText (_entry >> "authorUrl")) then {
+			_url = getText(_entry >> "authorUrl");
+			if ( ! CBA_MonochromeCredits ) then { _url = "<t color='#566D7E'>" + _url + "</t>"; };
+		} else {
+			_url = "";
+		};
+
+		//version if any
+		if (isText (_entry >> "version")) then {
+			_version = " v" + getText(_entry >> "version");
+		} else {
+			_version = "";
+		};
+
+		//single line
+		_text = _name + _version + " by " + _author + " " + _url;
+		_ctrl ctrlSetStructuredText parseText _text;
+		//TRACE_1("2",ctrlText _ctrl);
+	};
+	GVAR(show_proc) = nil;
+};
diff -rupN BASE_MISSION/x/cba/addons/help_showver.sqf BASE_A2Free/x/cba/addons/help_showver.sqf
--- BASE_MISSION/x/cba/addons/help_showver.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/help_showver.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,95 @@
+// #define DEBUG_MODE_FULL
+#include "help_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_dialog_defines.hpp"
+
+disableSerialization;
+private ["_init", "_ctrl_t", "_disp", "_ctrl", "_ctrl_b", "_ctrl_o", "_bi_ver_pos", "_cba_ver_pos", "_config", "_entry", "_x", "_ver_line", "_ver_act", "_ver_arr", "_key"];
+PARAMS_1(_data);
+//DEFAULT_PARAM (anything using a compiled function) not available on main menu
+_init = _this select 1;
+ISNILS(_init,false);
+
+_ctrl_t = _data select 0;
+_disp = ctrlParent _ctrl_t;
+_ctrl = _disp displayCtrl CBA_CREDITS_VER_IDC;
+_ctrl_b = _disp displayCtrl CBA_CREDITS_VER_BTN_IDC;
+
+if ( _init ) then {
+    //diag_log "mouse trap triggered";
+    _ctrl_o = _disp displayCtrl CA_Version_IDC;
+	//align with BI version position
+	_bi_ver_pos = ctrlPosition _ctrl_o;
+	//BI version width is large - halve it, move above
+	_cba_ver_pos = [_bi_ver_pos select 0,(_bi_ver_pos select 1) + (_bi_ver_pos select 3) / 1.8,_bi_ver_pos select 2,_bi_ver_pos select 3];
+	_ctrl ctrlSetPosition _cba_ver_pos;
+	_ctrl ctrlCommit 0;
+	//button align
+	_ctrl_b ctrlSetPosition _cba_ver_pos;
+	_ctrl_b ctrlCommit 0;
+
+	//get list of mods with versions
+	_config = configFile >> "CfgPatches";
+	GVAR(VerList) = [];
+	for "_x" from 0 to ((count _config) - 1) do {
+		_entry = _config select _x;
+		if ( isClass _entry ) then {
+			if ( isText(_entry >> "versionDesc") ) then {
+			    _ver_line = getText(_entry >> "versionDesc") + " v" + getText(_entry >> "version");
+			    _ver_act = getText(_entry >> "versionAct");
+			    _ver_arr = [_ver_line, _ver_act];
+				PUSH(GVAR(VerList),_ver_arr);
+			};
+		};
+	};
+	//current index
+	GVAR(VerNext) = -1;
+	GVAR(VerTime) = 2; //cycle version every 4 seconds
+	//auto-cycle, main menu never unloads so need to reset (mouse trap) when not visible
+	[_data] spawn {
+	    #include "help_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+		#include "script_dialog_defines.hpp"
+	    disableSerialization;
+		private ["_ctrl_t", "_timeout"];
+		_timeout = 30; // one minute
+		while { _timeout > 0 } do {
+			uisleep 2;
+			GVAR(VerTime) = GVAR(VerTime) - 1;
+			if ( GVAR(VerTime) <= 0 ) then {
+				_this call compile preprocessFile '\x\cba\addons\help\showver.sqf';
+			};
+			_timeout = _timeout - 1;
+		};
+		_ctrl_t = (_this select 0) select 0;
+        _ctrl_t ctrlEnable true;
+		_ctrl_t ctrlShow true;
+		//diag_log "mouse trap reset";
+	};
+};
+
+_key = _data select 1;
+ISNILS(_key,0);
+//left click forward, other click back
+if ( _key == 0 ) then {
+	GVAR(VerNext) = GVAR(VerNext) + 1;
+} else {
+    GVAR(VerNext) = GVAR(VerNext) - 1;
+};
+//stay in bounds
+if ( GVAR(VerNext) >= count GVAR(VerList) ) then {
+	GVAR(VerNext) = 0;
+} else {
+	if ( GVAR(VerNext) < 0 ) then { GVAR(VerNext) = count GVAR(VerList) - 1; };
+};
+
+_ver_arr = GVAR(VerList) select GVAR(VerNext);
+_ver_line = _ver_arr select 0;
+_ver_act = _ver_arr select 1;
+
+_ctrl ctrlSetText _ver_line; //print version line
+_ctrl_b ctrlSetEventHandler ["MouseButtonDblClick", _ver_act]; //set double-click action if any
+
+GVAR(VerTime) = 2;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/network_XEH_postServerInit.sqf BASE_A2Free/x/cba/addons/network_XEH_postServerInit.sqf
--- BASE_MISSION/x/cba/addons/network_XEH_postServerInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_XEH_postServerInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,12 @@
+// #define DEBUG_MODE_FULL
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+// Why would we send __SERVER__ to an on PLAYER connected event,
+// [["__SERVER__","0",objNull,true]] call CBA_fnc_globalEvent;
+
+// Using a SVI so that even non CBA clients will announce
+#define DATA [name player,getPlayerUID player,player,isClass(configFile>>'CfgPatches'>>'cba_main')]
+CBA_logic setVehicleInit QUOTE(if(!isDedicated)then{[]spawn{waitUntil{player == player};GVAR(joinN) = DATA;publicVariable 'GVAR(joinN)'}});
+processInitCommands;
diff -rupN BASE_MISSION/x/cba/addons/network_XEH_preInit.sqf BASE_A2Free/x/cba/addons/network_XEH_preInit.sqf
--- BASE_MISSION/x/cba/addons/network_XEH_preInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_XEH_preInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,125 @@
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+/* CBA_Network - by Sickboy (sb_at_dev-heaven.net)
+ * --------------------------------------------------------------
+ * Enables network engine support to execute code over the network
+ * or make a global say command
+ *
+ * Notes:
+ * - Each player has a unique 'id', server has always id 0
+ * - PublicVariableEventHandlers do not 'fire' on the computer where you PV the variable. As such we execute the functions also on the computer who calls
+ *
+ * Examples:
+ * - If you want a unit1,unit2, unit3 to say something on every computer:
+ * [ [unit1, unit2, unit3], "TestSound" ] call cba_network_fSay;
+ * unit1, 2 and 3 would say "TestSound" (if it existed :p)
+ *
+ * - To execute sth on server:
+ * [ 0, { superDebugMode = true } ] call cba_network_fSend;
+ *
+ * - To execute sth on all clients:
+ * [ -1, { superDebugMode = true; player sideChat "Woah A.C.E!!" }] call cba_network_fSend;
+ *
+ * - To execute sth on all clients, unit1, unit2, unit3 write something
+ * [ -1, { superDebugMode = true; { _x sideChat "Woah A.C.E!!" } forEach _this }, [unit1, unit2, unit3]] call cba_network_fSend;
+ *
+ * - To execute sth on all clients and server, use destination -2
+ * - To execute sth on all clients and server, EXCEPT the sending node, use destination -3
+ *   You can always use if (!isServer) then {  }; in the code or function you execute through the net-engine
+*/
+#define CHANGETIME 5
+
+LOG(MSG_INIT);
+
+// Announce the initialization of the script
+ADDON = false;
+
+#ifdef DEBUG_MODE_FULL
+	ISNIL(debug,true);
+#else
+	ISNIL(debug,false);
+#endif
+
+
+// COMPATIBILITY Feature - Make sure Override variables are initialized appropriately for sync broadcast.
+ISNIL(timeSync_Disabled,false); // deprecated
+ISNIL(weatherSync_Disabled,false);
+
+PREP(exec);
+//PREP(cv);
+
+DEPRECATE(fnc_remoteExecute,fnc_globalExecute);
+DEPRECATE(fnc_remoteSay,fnc_globalSay);
+
+
+#define ADD_PERSISTENT_MARKER { [_this select 0, true] call CBA_fnc_setMarkerPersistent }
+OBSOLETE(fnc_addPersistentMarker,ADD_PERSISTENT_MARKER);
+#define REMOVE_PERSISTENT_MARKER { [_this select 0, false] call CBA_fnc_setMarkerPersistent }
+OBSOLETE(fnc_removePersistentMarker,REMOVE_PERSISTENT_MARKER);
+
+// TODO: Add functions that add to opc/opd, instead of direct handling?
+
+GVAR(init) = false;
+
+if (SLX_XEH_MACHINE select 3) then
+{
+	ISNIL(MARKERS,[]); // Sync Markers for JIP
+
+	PREP(opc);
+	PREP(opd);
+	PREP(sync);
+
+	FUNC(id) = { "server" };
+
+	[QUOTE(GVAR(opc)), { _this call FUNC(opc) }] call CBA_fnc_addEventHandler;
+	[QUOTE(GVAR(opd)), { _this call FUNC(opd) }] call CBA_fnc_addEventHandler;
+	QUOTE(GVAR(joinN)) addPublicVariableEventHandler {
+		[QUOTE(GVAR(opc)), _this select 1] call CBA_fnc_localEvent;
+	};
+
+	[QUOTE(GVAR(marker_persist)), { _this call CBA_fnc_setMarkerPersistent }] call CBA_fnc_addEventHandler;
+
+	// [QUOTE(GVAR(join)), { [QUOTE(GVAR(opc)), _this] call CBA_fnc_localEvent }] call CBA_fnc_addEventHandler;
+
+	// onPlayerConnected '[_name,_id] call FUNC(opc)';
+	// TODO: Handle OPD without actually using opd
+	// Disabled for now, either not used, or annoying to mission makers
+	// onPlayerDisconnected '[_name,_id] call FUNC(opd)';
+
+	// Looped Weather Sync
+	/*
+	[] spawn
+	{
+		// Every 60 Seconds weather sync
+		while { true } do
+		{
+			sleep 60;
+			call FUNC(sync);
+		};
+	};
+	*/
+} else {
+	FUNC(id) =
+	{
+		private ["_id"];
+		if (player == player) then
+		{
+			_id = str(player);
+		} else {
+			_id = "client";
+		};
+		_id
+	};
+};
+
+[QUOTE(GVAR(cmd)), { if (GVAR(init)) then { _this spawn FUNC(exec) } }] call CBA_fnc_addEventHandler;
+[QUOTE(GVAR(say)), { private "_say"; _say = _this; { _x say (_say select 1) } forEach (_say select 0) }] call CBA_fnc_addEventHandler;
+[QUOTE(GVAR(say3d)), { private "_say"; _say = _this; (_say select 0) say3d (_say select 1)}] call CBA_fnc_addEventHandler;
+[QUOTE(GVAR(weather)), { private "_weather"; _weather = _this; CHANGETIME setOverCast (_weather select 0); CHANGETIME setRain (_weather select 2); (_weather select 1) spawn { sleep (CHANGETIME + 2); CHANGETIME setFog _this } }] call CBA_fnc_addEventHandler;
+[QUOTE(GVAR(date)), { private "_date"; _date = _this; setDate _date }] call CBA_fnc_addEventHandler;
+
+GVAR(init) = true; // Deprecated
+
+// Announce the completion of the initialization of the script
+ADDON = true;
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_cv.sqf BASE_A2Free/x/cba/addons/network_fnc_cv.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_cv.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_cv.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,47 @@
+/*
+Internal Function: CBA_network_fnc_cv
+*/
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#define __scriptname fnc_cv
+private ["_veh", "_pos", "_c", "_dir", "_object", "_varName", "_init", "_valid"];
+PARAMS_2(_veh,_pos);
+_c = count _this;
+if (_c > 2) then { _dir = _this select 2 } else { _dir = 0 };
+if (_c > 3) then { _varName = _this select 3 } else { _varName = "" };
+if (_c > 4) then { _init = _this select 4 } else { _init = "" };
+_object = null;
+
+if !(SLX_XEH_MACHINE select 3) then
+{
+	[0, { _this call FUNC(cv) }, _this] call CBA_fnc_globalExecute;
+	TRACE_1("Sending vehicle create request",_this);
+} else {
+	_object = _veh createVehicle _pos;
+	_valid = !(isNull _object);
+	if (_valid) then
+	{
+		_object setDir _dir;
+		if (_varName != "") then
+		{
+			call compile format["%1 = _object; publicVariable '%1'", _varName];
+			//_object setVehicleInit format["this setVehicleVarName '%1'; %1 = this", _varName];
+		};
+		if (_init != "") then
+		{
+			_object setVehicleInit _init;
+			processInitCommands;
+		};
+	};
+	private ["_idx", "_name", "_sid"];
+	// _id value comes from GVAR(fnc_Exec)
+	if (isNil "_id") then
+	{
+		_sid = 0;
+		_name = "Server";
+	} else {
+		_name = _id;
+	};
+	TRACE_5("Received Vehicle Create Request",_this,_sid,_name,_object,_valid);
+};
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_exec.sqf BASE_A2Free/x/cba/addons/network_fnc_exec.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_exec.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_exec.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,40 @@
+/*
+Internal Function: CBA_network_fnc_exec
+*/
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+// #define DEBUG_MODE_FULL
+// Generic NET Execution Handler
+private ["_ar", "_id", "_chan", "_cmd", "_objAr", "_ex", "_msg"];
+PARAMS_2(_id,_ar);
+if (count _ar < 2) exitWith {};
+_chan = _ar select 0;
+_cmd = _ar select 1;
+if (count _ar > 2) then { _objAr = _ar select 2 } else { _objAr = [] };
+TRACE_2("",_id,_ar);
+
+if ((typeName _chan) == "OBJECT") then
+{
+	_ex = (local _chan);
+} else {
+	switch _chan do
+	{
+		case 0: { if (SLX_XEH_MACHINE select 3) then { _ex = true } };
+		case -1: { if (SLX_XEH_MACHINE select 0) then { _ex = true } };
+		case -2: { _ex = true };
+		//case -3: { if (GVAR(uID) != _id) then { _ex = true } };
+		//default { if (GVAR(uID) == _chan) then { _ex = true } };
+	};
+};
+
+if (GVAR(debug)) then
+{
+	TRACE_6("",_ex,call FUNC(id),_id,_chan,_objAr,_cmd);
+};
+
+if (_ex) then
+{
+	TRACE_2("executing",_objAr,_cmd);
+	_objAr call _cmd; // Changed to call; should not be necessary to spawn here? this way _id etc is given to calling instance
+};
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_getMarkerPersistent.sqf BASE_A2Free/x/cba/addons/network_fnc_getMarkerPersistent.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_getMarkerPersistent.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_getMarkerPersistent.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,44 @@
+/*
+Function: CBA_fnc_getMarkerPersistent
+
+Description:
+	Checks if a global marker is persistent for JIP players.
+
+	Always returns false unless called on the server.
+
+	Set/unset persistency with <CBA_fnc_setMarkerPersistent>.
+
+Parameters:
+	_marker - Name of a marker [String]
+
+Returns:
+	True if the marker is persistent. False if not persistent or if executed
+		on a dedicated client [Boolean]
+
+Example:
+	(begin example)
+		_isPersistent = ["TAG_fishingVillage"] call CBA_fnc_getMarkerPersistent;
+	(end)
+
+Author:
+	Spooner
+*/
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_1(_marker);
+TRACE_1(_this);
+
+private ["_markerConsistent", "_return"];
+_markerConsistent = toLower _marker; // Ensure we use a consistent name to search for.
+
+_return = if (SLX_XEH_MACHINE select 3) then
+{
+	_markerConsistent in GVAR(MARKERS);
+} else {
+	WARNING("Function ran on a dedicated client. Function only usable on a server for marker: " + str _marker);
+	false;
+};
+
+_return;
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_globalExecute.sqf BASE_A2Free/x/cba/addons/network_fnc_globalExecute.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_globalExecute.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_globalExecute.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,26 @@
+/*
+Function: CBA_fnc_globalExecute
+
+Description:
+	Executes code on given destinations
+
+Parameters:
+	_channel - All: -2, ClientsOnly: -1, ServerOnly: 0 [Integer]
+	_code - Code to execute [Code]
+	_parameter - OPTIONAL. Parameter to pass to the code in the _this variables [Any]
+
+Returns:
+
+Example:
+	(begin example)
+		[-1, {player globalChat _this}, "TEST"] call CBA_fnc_globalExecute;
+	(end)
+
+Author:
+	Sickboy
+*/
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+TRACE_1("",_this);
+[QUOTE(GVAR(cmd)), [call FUNC(id), _this]] call CBA_fnc_globalEvent;
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_globalSay.sqf BASE_A2Free/x/cba/addons/network_fnc_globalSay.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_globalSay.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_globalSay.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,27 @@
+/*
+Function: CBA_fnc_globalSay
+
+Description:
+	Says sound on all client computer
+
+Parameters:
+	[_objects] - Array of Objects that perform Say [Object]
+	_say - [sound, maxTitlesDistance,speed] or "sound" [Array or String]
+
+Returns:
+
+Example:
+	(begin example)
+		[[player], "Alarm01"] call CBA_fnc_globalSay;
+	(end)
+
+Author:
+	Sickboy
+*/
+// Deprecated?, use now globalEvent
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+TRACE_1("",_this);
+
+[QUOTE(GVAR(say)), _this] call CBA_fnc_globalEvent;
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_globalSay3d.sqf BASE_A2Free/x/cba/addons/network_fnc_globalSay3d.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_globalSay3d.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_globalSay3d.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,26 @@
+/*
+Function: CBA_fnc_globalSay3d
+
+Description:
+	Says sound on all client computer in 3d
+
+Parameters:
+	_object - Object that performs Say [Object] can also be _array - [object, targetObject]
+	_speechName - Speechname
+
+Returns:
+
+Example:
+	(begin example)
+		[player, "Alarm01"] call CBA_fnc_globalSay3d;
+	(end)
+
+Author:
+	Sickboy
+*/
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+TRACE_1("",_this);
+
+[QUOTE(GVAR(say3d)), _this] call CBA_fnc_globalEvent;
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_opc.sqf BASE_A2Free/x/cba/addons/network_fnc_opc.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_opc.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_opc.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,19 @@
+/*
+	Internal Function: CBA_network_fnc_opc
+*/
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private["_plName"];
+PARAMS_4(_name,_id,_obj,_cba);
+
+_plName = if (isNull player) then { "" } else { name player };
+
+if ((_name!= "__SERVER__") && (_name!= format["%1", _plName])) then
+{
+	if (time > 0) then
+	{
+		[_obj] call FUNC(sync); { _x setMarkerPos (getMarkerPos _x) } forEach GVAR(markers);
+	};
+};
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_opd.sqf BASE_A2Free/x/cba/addons/network_fnc_opd.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_opd.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_opd.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,10 @@
+/*
+Internal Function: CBA_network_fnc_opd
+*/
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_2(_name,_id);
+
+TRACE_1("Player Disconnected: " + str(_name));
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_publicVariable.sqf BASE_A2Free/x/cba/addons/network_fnc_publicVariable.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_publicVariable.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_publicVariable.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,79 @@
+/*
+Function: CBA_fnc_publicVariable
+
+Description:
+	CBA_fnc_publicVariable does only broadcast the new value if it doesn't exist in missionNamespace or the new value is different to the one in missionNamespace.
+	Checks also for different types. Nil as value gets always broadcasted.
+	
+	Should reduce network traffic.
+
+Parameters:
+	_pv - Name of the publicVariable [String]
+	_value - Value to check and broadcast if it is not the same as the previous one, code will always be broadcasted [Any]
+
+Returns:
+	True if if broadcasted, otherwise false [Boolean]
+
+Example:
+	(begin example)
+		// This will only broadcast "somefish" if it either doesn't exist yet in the missionNamespace or the value is not 50
+		_broadcasted = ["somefish", 50] call CBA_fnc_publicVariable;
+	(end)
+
+Author:
+	Xeno
+*/
+// #define DEBUG_MODE_FULL
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_2(_pv,_value);
+
+if (typeName _pv != typeName "") exitWith {
+	WARNING("The first parameter is not of type string!");
+	false
+};
+
+private ["_var","_s"];
+_var = missionNamespace getVariable _pv;
+
+if (isNil "_var") exitWith {
+	TRACE_2("Broadcasting",_pv,_value);
+	missionNamespace setVariable [_pv, _value];
+	publicVariable _pv;
+	true
+};
+
+_s = if (typeName _value != typeName _var) then {
+	TRACE_2("Different typenames",_var,_value);
+	false
+} else {
+	switch (typename _value) do {
+		case "BOOL": {
+			((_var && _value) || (!_var && !_value))
+		};
+		case "ARRAY": {
+			([_var, _value] call BIS_fnc_areEqual)
+		};
+		case "CODE": {
+			false
+		};
+		case "SCRIPT": {
+			false
+		};
+		default {
+			(_var == _value)
+		};
+	}
+};
+if (_s) exitwith {
+	TRACE_2("Not broadcasting, _var and _value are equal",_var,_value);
+	false
+};
+
+TRACE_2("Broadcasting",_pv,_value);
+missionNamespace setVariable [_pv, _value];
+publicVariable _pv;
+
+true
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_setMarkerPersistent.sqf BASE_A2Free/x/cba/addons/network_fnc_setMarkerPersistent.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_setMarkerPersistent.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_setMarkerPersistent.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,65 @@
+/*
+Function: CBA_fnc_setMarkerPersistent
+
+Description:
+	Sets or unsets JIP persistency on a global marker.
+
+	Will broadcast event to server, if function is called on a client
+
+	Query persistency with <CBA_fnc_getMarkerPersistent>.
+
+Parameters:
+	_marker - Name of a marker [String]
+	_persistent - If true, marker will be kept consistent for JIP players [Boolean]
+
+Returns:
+	True if executed on the server [Boolean]
+
+Example:
+	(begin example)
+		_marker = createMarker ["TAG_fishingVillage", getPos TAG_fish];
+		[_marker, true] call CBA_fnc_setMarkerPersistent.
+		// Marker will be kept persistent for JIP players.
+		// later...
+		["TAG_fishingVillage", false] call CBA_fnc_setMarkerPersistent.
+		// Marker will no longer be kept persistent for JIP players.
+	(end)
+
+Author:
+	Sickboy
+*/
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_2(_marker,_persistent);
+TRACE_1(_this);
+
+private ["_markerConsistent", "_return"];
+_markerConsistent = toLower _marker; // Name of marker as stored internally.
+
+_return = if (SLX_XEH_MACHINE select 3) then
+{
+	if (_persistent) then
+	{
+		if (_markerConsistent in GVAR(MARKERS)) then
+		{
+			WARNING("Marker already persistent: " + str _marker);
+		} else {
+			PUSH(GVAR(MARKERS),_markerConsistent);
+		};
+	} else {
+		if (_markerConsistent in GVAR(MARKERS)) then
+		{
+			SUB(GVAR(MARKERS),[_markerConsistent]);
+		} else {
+			WARNING("Marker was already not persistent: " + str _marker);
+		};
+	};
+	true;
+} else {
+	[QUOTE(GVAR(marker_persist)), [_marker,_persistent]] call CBA_fnc_globalEvent;
+	true;
+};
+
+_return;
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_setVarNet.sqf BASE_A2Free/x/cba/addons/network_fnc_setVarNet.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_setVarNet.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_setVarNet.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,80 @@
+/*
+Function: CBA_fnc_setVarNet
+
+Description:
+	Same as setVariable ["name",var, true] but only broadcasts when the value of var is different to the one which is already saved in the variable space.
+	Checks also for different types. Nil as value gets always broadcasted.
+	
+	Should reduce network traffic.
+
+Parameters:
+	_object - Name of a marker [Object, Group]
+	_variable - Name of the variable in variable space [String]
+	_value - Value to check and broadcast if it is not the same as the previous one, code will always be broadcasted [Any]
+
+Returns:
+	True if broadcasted, otherwise false [Boolean]
+
+Example:
+	(begin example)
+		// This will only broadcast "somefish" if it either doesn't exist yet in the variable space or the value is not 50
+		_broadcasted = [player, "somefish", 50] call CBA_fnc_setVarNet;
+	(end)
+
+Author:
+	Xeno
+*/
+//#define DEBUG_MODE_FULL
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_3(_object,_variable,_value);
+
+// does setVariable public also work for other types ??
+if (typeName _object != "OBJECT" && typeName _object != "GROUP") exitWith {
+	WARNING("The first parameter is not of type object or group!");
+	false
+};
+
+private ["_var","_s"];
+
+_var = _object getVariable _variable;
+
+if (isNil "_var") exitWith {
+	TRACE_3("Broadcasting",_object,_variable,_value);
+	_object setVariable [_variable, _value, true];
+	true
+};
+
+_s = if (typeName _value != typeName _var) then {
+	TRACE_2("Different typenames",_var,_value);
+	false
+} else {
+	switch (typename _value) do {
+		case "BOOL": {
+			((_var && _value) || (!_var && !_value))
+		};
+		case "ARRAY": {
+			([_var, _value] call BIS_fnc_areEqual)
+		};
+		case "CODE": {
+			false
+		};
+		case "SCRIPT": {
+			false
+		};
+		default {
+			(_var == _value)
+		};
+	}
+};
+if (_s) exitwith {
+	TRACE_2("Not broadcasting, _var and _value are equal",_var,_value);
+	false
+};
+
+TRACE_3("Broadcasting",_object,_variable,_value);
+_object setVariable [_variable, _value, true];
+
+true
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/network_fnc_sync.sqf BASE_A2Free/x/cba/addons/network_fnc_sync.sqf
--- BASE_MISSION/x/cba/addons/network_fnc_sync.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_fnc_sync.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,10 @@
+/*
+Internal Function: CBA_network_fnc_sync
+*/
+#include "network_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+// COMPATIBILITY Feature - Check Override variables before broadcasting the sync.
+if !(GVAR(weatherSync_Disabled)) then { [QUOTE(GVAR(weather)), [overCast, fog, rain]] call CBA_fnc_globalEvent };
+//if !(GVAR(timeSync_Disabled)) then { [_channel, {[QUOTE(GVAR(date)), _this] call CBA_fnc_localEvent}, date] call CBA_fnc_globalExecute };
diff -rupN BASE_MISSION/x/cba/addons/network_script_component.hpp BASE_A2Free/x/cba/addons/network_script_component.hpp
--- BASE_MISSION/x/cba/addons/network_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/network_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,13 @@
+#define COMPONENT network
+#include "script_mod.hpp"
+
+
+#ifdef DEBUG_ENABLED_NETWORK
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_NETWORK
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_NETWORK
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/script_hashes.hpp BASE_A2Free/x/cba/addons/script_hashes.hpp
--- BASE_MISSION/x/cba/addons/script_hashes.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/script_hashes.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,6 @@
+#define HASH_ID 0
+#define HASH_KEYS 1
+#define HASH_VALUES 2
+#define HASH_DEFAULT_VALUE 3
+
+#define TYPE_HASH "#CBA_HASH#"
diff -rupN BASE_MISSION/x/cba/addons/script_macros.hpp BASE_A2Free/x/cba/addons/script_macros.hpp
--- BASE_MISSION/x/cba/addons/script_macros.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/script_macros.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1 @@
+#include "script_macros_common.hpp"
diff -rupN BASE_MISSION/x/cba/addons/script_macros_common.hpp BASE_A2Free/x/cba/addons/script_macros_common.hpp
--- BASE_MISSION/x/cba/addons/script_macros_common.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/script_macros_common.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,1186 @@
+/*
+	Header: script_macros_common.hpp
+
+	Description:
+		A general set of useful macro functions for use by CBA itself or by any module that uses CBA.
+
+	Authors:
+		Sickboy <sb_at_dev-heaven.net> and Spooner
+*/
+
+/* ****************************************************
+ New - Should be exported to general addon
+ Aim:
+   - Simplify (shorten) the amount of characters required for repetitive tasks
+   - Provide a solid structure that can be dynamic and easy editable (Which sometimes means we cannot adhere to Aim #1 ;-)
+     An example is the path that is built from defines. Some available in this file, others in mods and addons.
+
+ Follows  Standard:
+   Object variables: PREFIX_COMPONENT
+   Main-object variables: PREFIX_main
+   Paths: MAINPREFIX\PREFIX\SUBPREFIX\COMPONENT\SCRIPTNAME.sqf
+   e.g: x\six\addons\sys_menu\fDate.sqf
+
+ Usage:
+   define PREFIX and COMPONENT, then include this file
+   (Note, you could have a main addon for your mod, define the PREFIX in a macros.hpp,
+   and include this script_macros_common.hpp file.
+   Then in your addons, add a component.hpp, define the COMPONENT,
+   and include your mod's script_macros.hpp
+   In your scripts you can then include the addon's component.hpp with relative path)
+
+ TODO:
+   - Try only to use 1 string type " vs '
+   - Evaluate double functions, and simplification
+   - Evaluate naming scheme; current = prototype
+   - Evaluate "Debug" features..
+   - Evaluate "create mini function per precompiled script, that will load the script on first usage, rather than on init"
+   - Also saw "Namespace" typeName, evaluate which we need :P
+   - Single/Multi player gamelogics? (Incase of MP, you would want only 1 gamelogic per component, which is pv'ed from server, etc)
+ */
+
+#ifndef MAINPREFIX
+	#define MAINPREFIX x
+#endif
+
+#ifndef SUBPREFIX
+	#define SUBPREFIX addons
+#endif
+
+#ifndef MAINLOGIC
+	#define MAINLOGIC main
+#endif
+
+#ifndef VERSION
+	#define VERSION 0
+#endif
+
+#ifndef VERSION_AR
+	#define VERSION_AR VERSION
+#endif
+
+#ifndef VERSION_CONFIG
+	#define VERSION_CONFIG version = VERSION; versionStr = QUOTE(VERSION); versionAr[] = {VERSION_AR}
+#endif
+
+/* -------------------------------------------
+Group: Debugging
+------------------------------------------- */
+
+/* -------------------------------------------
+Macros: DEBUG_MODE_x
+	Managing debugging based on debug level.
+
+	According to the *highest* level of debugging that has been defined *before* script_macros_common.hpp is included,
+	only the appropriate debugging commands will be functional. With no level explicitely defined, assume DEBUG_MODE_NORMAL.
+
+	DEBUG_MODE_FULL - Full debugging output.
+	DEBUG_MODE_NORMAL - All debugging except <TRACE_n()> and <LOG()> (Default setting if none specified).
+	DEBUG_MODE_MINIMAL - Only <ERROR()> and <ERROR_WITH_TITLE()> enabled.
+
+Examples:
+	In order to turn on full debugging for a single file,
+	(begin example)
+		// Top of individual script file.
+		#define DEBUG_MODE_FULL
+		#include "script_component.hpp"
+	(end)
+
+	In order to force minimal debugging for a single component,
+	(begin example)
+		// Top of addons\<component>\script_component.hpp
+		// Ensure that any FULL and NORMAL setting from the individual files are undefined and MINIMAL is set.
+		#ifdef DEBUG_MODE_FULL
+		#undef DEBUG_MODE_FULL
+		#endif
+		#ifdef DEBUG_MODE_NORMAL
+		#undef DEBUG_MODE_NORMAL
+		#endif
+		#ifndef DEBUG_MODE_MINIMAL
+		#define DEBUG_MODE_MINIMAL
+		#endif
+		#include "script_macros.hpp"
+	(end)
+
+	In order to turn on full debugging for a whole addon,
+	(begin example)
+		// Top of addons\main\script_macros.hpp
+		#ifndef DEBUG_MODE_FULL
+		#define DEBUG_MODE_FULL
+		#endif
+		#include "\x\cba\addons\main\script_macros_common.hpp"
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+
+// If DEBUG_MODE_FULL, then also enable DEBUG_MODE_NORMAL.
+#ifdef DEBUG_MODE_FULL
+#define DEBUG_MODE_NORMAL
+#endif
+
+// If DEBUG_MODE_NORMAL, then also enable DEBUG_MODE_MINIMAL.
+#ifdef DEBUG_MODE_NORMAL
+#define DEBUG_MODE_MINIMAL
+#endif
+
+// If no debug modes specified, use DEBUG_MODE_NORMAL (+ DEBUG_MODE_MINIMAL).
+#ifndef DEBUG_MODE_MINIMAL
+#define DEBUG_MODE_NORMAL
+#define DEBUG_MODE_MINIMAL
+#endif
+
+#ifdef THIS_FILE
+#define THIS_FILE_ 'THIS_FILE'
+#else
+#define THIS_FILE_ __FILE__
+#endif
+
+/* -------------------------------------------
+Macro: LOG()
+	Log a timestamped message into the RPT log.
+
+	Only run if <DEBUG_MODE_FULL> or higher is defined.
+
+Parameters:
+	MESSAGE - Message to record [String]
+
+Example:
+	(begin example)
+		LOG("Initiated clog-dancing simulator.");
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#ifdef DEBUG_MODE_FULL
+#define LOG(MESSAGE) [THIS_FILE_, __LINE__, MESSAGE] call CBA_fnc_log
+#else
+#define LOG(MESSAGE) /* disabled */
+#endif
+
+/* -------------------------------------------
+Macro: WARNING()
+	Record a timestamped, non-critical error in the RPT log.
+
+	Only run if <DEBUG_MODE_NORMAL> or higher is defined.
+
+Parameters:
+	MESSAGE - Message to record [String]
+
+Example:
+	(begin example)
+		WARNING("This function has been deprecated. Please don't use it in future!");
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#ifdef DEBUG_MODE_NORMAL
+#define WARNING(MESSAGE) [THIS_FILE_, __LINE__, ('WARNING: ' + MESSAGE)] call CBA_fnc_log
+#else
+#define WARNING(MESSAGE) /* disabled */
+#endif
+
+/* -------------------------------------------
+Macro: ERROR()
+	Record a timestamped, critical error in the RPT log.
+
+	The heading is "ERROR" (use <ERROR_WITH_TITLE()> for a specific title).
+
+	TODO: Popup an error dialog & throw an exception.
+
+Parameters:
+	MESSAGE -  Message to record [String]
+
+Example:
+	(begin example)
+		ERROR("Value not found","value of frog not found in config ...yada...yada...");
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define ERROR(MESSAGE) \
+	[THIS_FILE_, __LINE__, "ERROR", MESSAGE] call CBA_fnc_error;
+
+/* -------------------------------------------
+Macro: ERROR_WITH_TITLE()
+	Record a timestamped, critical error in the RPT log.
+
+	The title can be specified (in <ERROR()> the heading is always just "ERROR")
+	Newlines (\n) in the MESSAGE will be put on separate lines.
+
+	TODO: Popup an error dialog & throw an exception.
+
+Parameters:
+	TITLE - Title of error message [String]
+	MESSAGE -  Body of error message [String]
+
+Example:
+	(begin example)
+		ERROR_WITH_TITLE("Value not found","Value of frog not found in config ...yada...yada...");
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define ERROR_WITH_TITLE(TITLE,MESSAGE) \
+	[THIS_FILE_, __LINE__, TITLE, MESSAGE] call CBA_fnc_error;
+
+/* -------------------------------------------
+Macro: RETNIL()
+	If a variable is undefined, return the value nil. Otherwise, return the
+	variable itself.
+
+Parameters:
+	VARIABLE - the variable to check
+
+Example:
+	(begin example)
+		// _var is undefined
+		hintSilent format ["_var=%1", RETNIL(_var) ]; // "_var=any"
+	(end example)
+
+Author:
+	Alef (see CBA issue #8514)
+------------------------------------------- */
+#define RETNIL(VARIABLE) if (isNil{VARIABLE}) then {nil} else {VARIABLE}
+
+/* -------------------------------------------
+Macros: TRACE_n()
+	Log a message and 1-8 variables to the RPT log.
+
+	Only run if <DEBUG_MODE_FULL> is defined.
+
+	TRACE_1(MESSAGE,A) - Log 1 variable.
+	TRACE_2(MESSAGE,A,B) - Log 2 variables.
+	TRACE_3(MESSAGE,A,B,C) - Log 3 variables.
+	TRACE_4(MESSAGE,A,B,C,D) - Log 4 variables.
+	TRACE_5(MESSAGE,A,B,C,D,E) - Log 5 variables.
+	TRACE_6(MESSAGE,A,B,C,D,E,F) - Log 6 variables.
+	TRACE_7(MESSAGE,A,B,C,D,E,F,G) - Log 7 variables.
+	TRACE_8(MESSAGE,A,B,C,D,E,F,G,H) - Log 8 variables.
+
+Parameters:
+	MESSAGE -  Message to add to the trace [String]
+	A..H - Variable names to log values of [Any]
+
+Example:
+	(begin example)
+		TRACE_3("After takeoff",_vehicle player,getPos (_vehicle player), getPosASL (_vehicle player));
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#ifdef DEBUG_MODE_FULL
+#define TRACE_1(MESSAGE,A) \
+	[THIS_FILE_, __LINE__, format ['%1: A=%2', MESSAGE, RETNIL(A)]] call CBA_fnc_log
+
+#define TRACE_2(MESSAGE,A,B) \
+	[THIS_FILE_, __LINE__, format ['%1: A=%2, B=%3', MESSAGE, RETNIL(A), RETNIL(B)]] call CBA_fnc_log
+
+#define TRACE_3(MESSAGE,A,B,C) \
+	[THIS_FILE_, __LINE__, format ['%1: A=%2, B=%3, C=%4', MESSAGE, RETNIL(A), RETNIL(B), RETNIL(C)]] call CBA_fnc_log
+
+#define TRACE_4(MESSAGE,A,B,C,D) \
+	[THIS_FILE_, __LINE__, format ['%1: A=%2, B=%3, C=%4, D=%5', MESSAGE, RETNIL(A), RETNIL(B), RETNIL(C), RETNIL(D)]] call CBA_fnc_log
+
+#define TRACE_5(MESSAGE,A,B,C,D,E) \
+	[THIS_FILE_, __LINE__, format ['%1: A=%2, B=%3, C=%4, D=%5, E=%6', MESSAGE, RETNIL(A), RETNIL(B), RETNIL(C), RETNIL(D), RETNIL(E)]] call CBA_fnc_log
+
+#define TRACE_6(MESSAGE,A,B,C,D,E,F) \
+	[THIS_FILE_, __LINE__, format ['%1: A=%2, B=%3, C=%4, D=%5, E=%6, F=%7', MESSAGE, RETNIL(A), RETNIL(B), RETNIL(C), RETNIL(D), RETNIL(E), RETNIL(F)]] call CBA_fnc_log
+
+#define TRACE_7(MESSAGE,A,B,C,D,E,F,G) \
+	[THIS_FILE_, __LINE__, format ['%1: A=%2, B=%3, C=%4, D=%5, E=%6, F=%7, G=%8', MESSAGE, RETNIL(A), RETNIL(B), RETNIL(C), RETNIL(D), RETNIL(E), RETNIL(F), RETNIL(G)]] call CBA_fnc_log
+
+#define TRACE_8(MESSAGE,A,B,C,D,E,F,G,H) \
+	[THIS_FILE_, __LINE__, format ['%1: A=%2, B=%3, C=%4, D=%5, E=%6, F=%7, G=%8, H=%9', MESSAGE, RETNIL(A), RETNIL(B), RETNIL(C), RETNIL(D), RETNIL(E), RETNIL(F), RETNIL(G), RETNIL(H)]] call CBA_fnc_log
+
+#else
+
+#define TRACE_1(MESSAGE,A) /* disabled */
+#define TRACE_2(MESSAGE,A,B) /* disabled */
+#define TRACE_3(MESSAGE,A,B,C) /* disabled */
+#define TRACE_4(MESSAGE,A,B,C,D) /* disabled */
+#define TRACE_5(MESSAGE,A,B,C,D,E) /* disabled */
+#define TRACE_6(MESSAGE,A,B,C,D,E,F) /* disabled */
+#define TRACE_7(MESSAGE,A,B,C,D,E,F,G) /* disabled */
+#define TRACE_8(MESSAGE,A,B,C,D,E,F,G,H) /* disabled */
+
+#endif
+
+/* -------------------------------------------
+Group: General
+------------------------------------------- */
+
+// *************************************
+// Internal Functions
+#define DOUBLES(var1,var2) ##var1##_##var2
+#define TRIPLES(var1,var2,var3) ##var1##_##var2##_##var3
+#define QUOTE(var1) #var1
+
+#ifdef MODULAR
+	#define COMPONENT_T DOUBLES(t,COMPONENT)
+	#define COMPONENT_M DOUBLES(m,COMPONENT)
+	#define COMPONENT_S DOUBLES(s,COMPONENT)
+	#define COMPONENT_C DOUBLES(c,COMPONENT)
+	#define COMPONENT_F COMPONENT_C
+#else
+	#define COMPONENT_T COMPONENT
+	#define COMPONENT_M COMPONENT
+	#define COMPONENT_S COMPONENT
+	#define COMPONENT_F COMPONENT
+	#define COMPONENT_C COMPONENT
+#endif
+
+/* -------------------------------------------
+Macro: INC()
+
+Description:
+	Increase a number by one.
+
+Parameters:
+	VAR - Variable to increment [Number]
+
+Example:
+	(begin example)
+	_counter = 0;
+	INC(_counter);
+	// _counter => 1
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define INC(var) var = (var) + 1
+
+/* -------------------------------------------
+Macro: DEC()
+
+Description:
+	Decrease a number by one.
+
+Parameters:
+	VAR - Variable to decrement [Number]
+
+Example:
+	(begin example)
+	_counter = 99;
+	DEC(_counter);
+	// _counter => 98
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define DEC(var) var = (var) - 1
+
+/* -------------------------------------------
+Macro: ADD()
+
+Description:
+	Add a value to a variable. Variable and value should be both Numbers or both Strings.
+
+Parameters:
+	VAR - Variable to add to [Number or String]
+	VALUE - Value to add [Number or String]
+
+Examples:
+	(begin example)
+		_counter = 2;
+		ADD(_counter,3);
+		// _counter => 5
+	(end)
+	(begin example)
+		_str = "hello";
+		ADD(_str," ");
+		ADD(_str,"Fred");
+		// _str => "hello Fred"
+	(end)
+
+Author:
+	Sickboy
+------------------------------------------- */
+#define ADD(var1,var2) var1 = (var1) + (var2)
+
+/* -------------------------------------------
+Macro: SUB()
+
+Description:
+	Subtract a value from a number variable. VAR and VALUE should both be Numbers.
+
+Parameters:
+	VAR - Variable to subtract from [Number]
+	VALUE - Value to subtract [Number]
+
+Examples:
+	(begin example)
+		_numChickens = 2;
+		SUB(_numChickens,3);
+		// _numChickens => -1
+	(end)
+------------------------------------------- */
+#define SUB(var1,var2) var1 = (var1) - (var2)
+
+/* -------------------------------------------
+Macro: REM()
+
+Description:
+	Remove an element from an array each time it occurs.
+
+	This recreates the entire array, so use BIS_fnc_removeIndex if modification of the original array is required
+	or if only one of the elements that matches ELEMENT needs to be removed.
+
+Parameters:
+	ARRAY - Array to modify [Array]
+	ELEMENT - Element to remove [Any]
+
+Examples:
+	(begin example)
+		_array = [1, 2, 3, 4, 3, 8];
+		REM(_array,3);
+		// _array = [1, 2, 4, 8];
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define REM(var1,var2) SUB(var1,[var2])
+
+/* -------------------------------------------
+Macro: PUSH()
+
+Description:
+	Appends a single value onto the end of an ARRAY. Change is made to the ARRAY itself, not creating a new array.
+
+Parameters:
+	ARRAY - Array to push element onto [Array]
+	ELEMENT - Element to push [Any]
+
+Examples:
+	(begin example)
+		_fish = ["blue", "green", "smelly"];
+		PUSH(_fish,"monkey-flavoured");
+		// _fish => ["blue", "green", "smelly", "monkey-flavoured"]
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define PUSH(var1,var2) var1 set [count (var1), var2]
+
+/* -------------------------------------------
+Macro: ISNILS()
+
+Description:
+	Sets a variable with a value, but only if it is undefined.
+
+Parameters:
+	VARIABLE - Variable to set [Any, not nil]
+	DEFAULT_VALUE - Value to set VARIABLE to if it is undefined [Any, not nil]
+
+Examples:
+	(begin example)
+		// _fish is undefined
+		ISNILS(_fish,0);
+		// _fish => 0
+	(end)
+	(begin example)
+		_fish = 12;
+		// ...later...
+		ISNILS(_fish,0);
+		// _fish => 12
+	(end)
+
+Author:
+	Sickboy
+------------------------------------------- */
+#define ISNILS(VARIABLE,DEFAULT_VALUE) if (isNil #VARIABLE) then { ##VARIABLE = ##DEFAULT_VALUE }
+#define ISNILS2(var1,var2,var3,var4) ISNILS(TRIPLES(var1,var2,var3),var4)
+#define ISNILS3(var1,var2,var3) ISNILS(DOUBLES(var1,var2),var3)
+#define ISNIL(var1,var2) ISNILS2(PREFIX,COMPONENT,var1,var2)
+#define ISNILMAIN(var1,var2) ISNILS3(PREFIX,var1,var2)
+
+#define CREATELOGICS(var1,var2) ##var1##_##var2## = ([sideLogic] call CBA_fnc_getSharedGroup) createUnit ["LOGIC", [0, 0, 0], [], 0, "NONE"]
+#define CREATELOGICLOCALS(var1,var2) ##var1##_##var2## = "LOGIC" createVehicleLocal [0, 0, 0]
+#define CREATELOGICGLOBALS(var1,var2) ##var1##_##var2## = ([sideLogic] call CBA_fnc_getSharedGroup) createUnit ["LOGIC", [0, 0, 0], [], 0, "NONE"]; publicVariable QUOTE(DOUBLES(var1,var2))
+#define CREATELOGICGLOBALTESTS(var1,var2) ##var1##_##var2## = ([sideLogic] call CBA_fnc_getSharedGroup) createUnit [QUOTE(TRIPLES(PREFIX,COMPONENT,logic)), [0, 0, 0], [], 0, "NONE"]
+
+#define GETVARS(var1,var2,var3) (##var1##_##var2 getVariable #var3)
+#define GETVARMAINS(var1,var2) GETVARS(var1,MAINLOGIC,var2)
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2\##var3.sqf
+#define PATHTOF_SYS(var1,var2,var3) \MAINPREFIX\##var1\SUBPREFIX\##var2\##var3
+#define PATHTOF2_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2\##var3
+
+#define PATHTO_R(var1) PATHTOF2_SYS(PREFIX,COMPONENT_C,var1)
+#define PATHTO_T(var1) PATHTOF_SYS(PREFIX,COMPONENT_T,var1)
+#define PATHTO_M(var1) PATHTOF_SYS(PREFIX,COMPONENT_M,var1)
+#define PATHTO_S(var1) PATHTOF_SYS(PREFIX,COMPONENT_S,var1)
+#define PATHTO_C(var1) PATHTOF_SYS(PREFIX,COMPONENT_C,var1)
+#define PATHTO_F(var1) PATHTO_SYS(PREFIX,COMPONENT_F,var1)
+
+// Already quoted ""
+#define QPATHTO_R(var1) QUOTE(PATHTO_R(var1))
+#define QPATHTO_T(var1) QUOTE(PATHTO_T(var1))
+#define QPATHTO_M(var1) QUOTE(PATHTO_M(var1))
+#define QPATHTO_S(var1) QUOTE(PATHTO_S(var1))
+#define QPATHTO_C(var1) QUOTE(PATHTO_C(var1))
+#define QPATHTO_F(var1) QUOTE(PATHTO_F(var1))
+
+#define COMPILE_FILE_SYS(var1,var2,var3) compile preProcessFileLineNumbers 'PATHTO_SYS(var1,var2,var3)'
+
+#define SETVARS(var1,var2) ##var1##_##var2 setVariable
+#define SETVARMAINS(var1) SETVARS(var1,MAINLOGIC)
+#define GVARMAINS(var1,var2) ##var1##_##var2##
+#define CFGSETTINGSS(var1,var2) configFile >> "CfgSettings" >> #var1 >> #var2
+//#define SETGVARS(var1,var2,var3) ##var1##_##var2##_##var3 =
+//#define SETGVARMAINS(var1,var2) ##var1##_##var2 =
+
+// Compile-Once, JIT: On first use.
+// #define PREPMAIN_SYS(var1,var2,var3) ##var1##_fnc_##var3 = { ##var1##_fnc_##var3 = COMPILE_FILE_SYS(var1,var2,DOUBLES(fnc,var3)); if (isNil "_this") then { call ##var1##_fnc_##var3 } else { _this call ##var1##_fnc_##var3 } }
+// #define PREP_SYS(var1,var2,var3) ##var1##_##var2##_fnc_##var3 = { ##var1##_##var2##_fnc_##var3 = COMPILE_FILE_SYS(var1,var2,DOUBLES(fnc,var3)); if (isNil "_this") then { call ##var1##_##var2##_fnc_##var3 } else { _this call ##var1##_##var2##_fnc_##var3 } }
+// #define PREP_SYS2(var1,var2,var3,var4) ##var1##_##var2##_fnc_##var4 = { ##var1##_##var2##_fnc_##var4 = COMPILE_FILE_SYS(var1,var3,DOUBLES(fnc,var4)); if (isNil "_this") then { call ##var1##_##var2##_fnc_##var4 } else { _this call ##var1##_##var2##_fnc_##var4 } }
+
+// Compile-Once, at Macro. As opposed to Compile-Once, on first use.
+#define PREPMAIN_SYS(var1,var2,var3) ##var1##_fnc_##var3 = COMPILE_FILE_SYS(var1,var2,DOUBLES(fnc,var3))
+#define PREP_SYS(var1,var2,var3) ##var1##_##var2##_fnc_##var3 = COMPILE_FILE_SYS(var1,var2,DOUBLES(fnc,var3))
+#define PREP_SYS2(var1,var2,var3,var4) ##var1##_##var2##_fnc_##var4 = COMPILE_FILE_SYS(var1,var3,DOUBLES(fnc,var4))
+
+#define LSTR(var1) TRIPLES(ADDON,STR,var1)
+
+
+#ifndef DEBUG_SETTINGS
+	#define DEBUG_SETTINGS [false, true, false]
+#endif
+
+#define MSG_INIT QUOTE(Initializing: ADDON version: VERSION)
+
+// *************************************
+// User Functions
+// Please define PREFIX and COMPONENT before including
+#define ADDON DOUBLES(PREFIX,COMPONENT)
+#define MAIN_ADDON DOUBLES(PREFIX,main)
+
+#define CFGSETTINGS CFGSETTINGSS(PREFIX,COMPONENT)
+#define PATHTO(var1) PATHTO_SYS(PREFIX,COMPONENT_F,var1)
+#define PATHTOF(var1) PATHTOF_SYS(PREFIX,COMPONENT,var1)
+
+#define COMPILE_FILE(var1) COMPILE_FILE_SYS(PREFIX,COMPONENT_F,var1)
+
+
+#define VERSIONING_SYS(var1) class CfgSettings \
+{ \
+	class CBA \
+	{ \
+		class Versioning \
+		{ \
+			class var1 \
+			{ \
+			}; \
+		}; \
+	}; \
+};
+
+#define VERSIONING VERSIONING_SYS(PREFIX)
+
+/* -------------------------------------------
+Macro: GVAR()
+	Get full variable identifier for a global variable owned by this component.
+
+Parameters:
+	VARIABLE - Partial name of global variable owned by this component [Any].
+
+Example:
+	(begin example)
+		GVAR(frog) = 12;
+		// In SPON_FrogDancing component, equivalent to SPON_FrogDancing_frog = 12
+	(end)
+
+Author:
+	Sickboy
+------------------------------------------- */
+#define GVAR(var1) TRIPLES(PREFIX,COMPONENT,var1)
+#define QGVAR(var1) QUOTE(GVAR(var1))
+
+/* -------------------------------------------
+Macro: GVARMAIN()
+	Get full variable identifier for a global variable owned by this addon.
+
+Parameters:
+	VARIABLE - Partial name of global variable owned by this addon [Any].
+
+Example:
+	(begin example)
+		GVARMAIN(frog) = 12;
+		// In SPON_FrogDancing component, equivalent to SPON_frog = 12
+	(end)
+
+Author:
+	Sickboy
+------------------------------------------- */
+#define GVARMAIN(var1) GVARMAINS(PREFIX,var1)
+// TODO: What's this?
+#define SETTINGS DOUBLES(PREFIX,settings)
+#define CREATELOGIC CREATELOGICS(PREFIX,COMPONENT)
+#define CREATELOGICGLOBAL CREATELOGICGLOBALS(PREFIX,COMPONENT)
+#define CREATELOGICGLOBALTEST CREATELOGICGLOBALTESTS(PREFIX,COMPONENT)
+#define CREATELOGICLOCAL CREATELOGICLOCALS(PREFIX,COMPONENT)
+#define CREATELOGICMAIN CREATELOGICS(PREFIX,MAINLOGIC)
+#define GETVAR(var1) GETVARS(PREFIX,COMPONENT,var1)
+#define SETVAR SETVARS(PREFIX,COMPONENT)
+#define SETVARMAIN SETVARMAINS(PREFIX)
+#define IFCOUNT(var1,var2,var3) if (count ##var1 > ##var2) then { ##var3 = ##var1 select ##var2 };
+
+//#define PREP(var1) PREP_SYS(PREFIX,COMPONENT_F,var1)
+#define PREP(var1) PREP_SYS2(PREFIX,COMPONENT,COMPONENT_F,var1)
+#define PREPMAIN(var1) PREPMAIN_SYS(PREFIX,COMPONENT_F,var1)
+#define FUNC(var1) TRIPLES(DOUBLES(PREFIX,COMPONENT),fnc,var1)
+#define FUNCMAIN(var1) TRIPLES(PREFIX,fnc,var1)
+#define FUNC_INNER(var1,var2) TRIPLES(DOUBLES(PREFIX,var1),fnc,var2)
+
+#ifndef PRELOAD_ADDONS
+	#define PRELOAD_ADDONS class CfgAddons \
+{ \
+	class PreloadAddons \
+	{ \
+		class ADDON \
+		{ \
+			list[]={ QUOTE(ADDON) }; \
+		}; \
+	}; \
+}
+#endif
+
+/* -------------------------------------------
+Macros: ARG_#()
+	Select from list of array arguments
+
+Parameters:
+	VARIABLE(1-8) - elements for the list
+
+Author:
+	Rommel
+------------------------------------------- */
+#define ARG_1(A,B) ((A) select (B))
+#define ARG_2(A,B,C) (ARG_1(ARG_1(A,B),C))
+#define ARG_3(A,B,C,D) (ARG_1(ARG_2(A,B,C),D))
+#define ARG_4(A,B,C,D,E) (ARG_1(ARG_3(A,B,C,D),E))
+#define ARG_5(A,B,C,D,E,F) (ARG_1(ARG_4(A,B,C,D,E),F))
+#define ARG_6(A,B,C,D,E,F,G) (ARG_1(ARG_5(A,B,C,D,E,F),G))
+#define ARG_7(A,B,C,D,E,F,G,H) (ARG_1(ARG_6(A,B,C,D,E,E,F,G),H))
+#define ARG_8(A,B,C,D,E,F,G,H,I) (ARG_1(ARG_7(A,B,C,D,E,E,F,G,H),I))
+
+/* -------------------------------------------
+Macros: ARR_#()
+	Create list from arguments. Useful for working around , in macro parameters.
+	1-8 arguments possible.
+
+Parameters:
+	VARIABLE(1-8) - elements for the list
+
+Author:
+	Nou
+------------------------------------------- */
+#define ARR_1(ARG1) ARG1
+#define ARR_2(ARG1,ARG2) ARG1, ARG2
+#define ARR_3(ARG1,ARG2,ARG3) ARG1, ARG2, ARG3
+#define ARR_4(ARG1,ARG2,ARG3,ARG4) ARG1, ARG2, ARG3, ARG4
+#define ARR_5(ARG1,ARG2,ARG3,ARG4,ARG5) ARG1, ARG2, ARG3, ARG4, ARG5
+#define ARR_6(ARG1,ARG2,ARG3,ARG4,ARG5,ARG6) ARG1, ARG2, ARG3, ARG4, ARG5, ARG6
+#define ARR_7(ARG1,ARG2,ARG3,ARG4,ARG5,ARG6,ARG7) ARG1, ARG2, ARG3, ARG4, ARG5, ARG6, ARG7
+#define ARR_8(ARG1,ARG2,ARG3,ARG4,ARG5,ARG6,ARG7,ARG8) ARG1, ARG2, ARG3, ARG4, ARG5, ARG6, ARG7, ARG8
+
+/* -------------------------------------------
+Macros: FORMAT_#(STR, ARG1)
+	Format - Useful for working around , in macro parameters.
+	1-8 arguments possible.
+
+Parameters:
+	STRING - string used by format
+	VARIABLE(1-8) - elements for usage in format
+
+Author:
+	Nou & Sickboy
+------------------------------------------- */
+#define FORMAT_1(STR,ARG1) format[STR, ARG1]
+#define FORMAT_2(STR,ARG1,ARG2) format[STR, ARG1, ARG2]
+#define FORMAT_3(STR,ARG1,ARG2,ARG3) format[STR, ARG1, ARG2, ARG3]
+#define FORMAT_4(STR,ARG1,ARG2,ARG3,ARG4) format[STR, ARG1, ARG2, ARG3, ARG4]
+#define FORMAT_5(STR,ARG1,ARG2,ARG3,ARG4,ARG5) format[STR, ARG1, ARG2, ARG3, ARG4, ARG5]
+#define FORMAT_6(STR,ARG1,ARG2,ARG3,ARG4,ARG5,ARG6) format[STR, ARG1, ARG2, ARG3, ARG4, ARG5, ARG6]
+#define FORMAT_7(STR,ARG1,ARG2,ARG3,ARG4,ARG5,ARG6,ARG7) format[STR, ARG1, ARG2, ARG3, ARG4, ARG5, ARG6, ARG7]
+#define FORMAT_8(STR,ARG1,ARG2,ARG3,ARG4,ARG5,ARG6,ARG7,ARG8) format[STR, ARG1, ARG2, ARG3, ARG4, ARG5, ARG6, ARG7, ARG8]
+
+// CONTROL(46) 12
+#define DISPLAY(A) (findDisplay A)
+#define CONTROL(A) DISPLAY(A) displayCtrl
+
+/* -------------------------------------------
+Macros: IS_x()
+	Checking the data types of variables.
+
+	IS_ARRAY() - Array
+	IS_BOOL() - Boolean
+	IS_BOOLEAN() - UI display handle(synonym for <IS_BOOL()>)
+	IS_CODE() - Code block (i.e a compiled function)
+	IS_CONFIG() - Configuration
+	IS_CONTROL() - UI control handle.
+	IS_DISPLAY() - UI display handle.
+	IS_FUNCTION() - A compiled function (synonym for <IS_CODE()>)
+	IS_GROUP() - Group.
+	IS_INTEGER() - Is a number a whole number?
+	IS_LOCATION() - World location.
+	IS_NUMBER() - A floating point number (synonym for <IS_SCALAR()>)
+	IS_OBJECT() - World object.
+	IS_SCALAR() - Floating point number.
+	IS_SCRIPT() - A script handle (as returned by execVM and spawn commands).
+	IS_SIDE() - Game side.
+	IS_STRING() - World object.
+	IS_TEXT() - Structured text.
+
+Parameters:
+	VARIABLE - Variable to check if it is of a particular type [Any, not nil]
+
+Author:
+	Spooner
+------------------------------------------- */
+#define IS_ARRAY(VAR)    ((typeName (VAR)) == "ARRAY")
+#define IS_BOOL(VAR)     ((typeName (VAR)) == "BOOL")
+#define IS_CODE(VAR)     ((typeName (VAR)) == "CODE")
+#define IS_CONFIG(VAR)   ((typeName (VAR)) == "CONFIG")
+#define IS_CONTROL(VAR)  ((typeName (VAR)) == "CONTROL")
+#define IS_DISPLAY(VAR)  ((typeName (VAR)) == "DISPLAY")
+#define IS_GROUP(VAR)    ((typeName (VAR)) == "GROUP")
+#define IS_OBJECT(VAR)   ((typeName (VAR)) == "OBJECT")
+#define IS_SCALAR(VAR)   ((typeName (VAR)) == "SCALAR")
+#define IS_SCRIPT(VAR)   ((typeName (VAR)) == "SCRIPT")
+#define IS_SIDE(VAR)     ((typeName (VAR)) == "SIDE")
+#define IS_STRING(VAR)   ((typeName (VAR)) == "STRING")
+#define IS_TEXT(VAR)     ((typeName (VAR)) == "TEXT")
+#define IS_LOCATION(VAR) ((typeName (VAR)) == "LOCATION")
+
+#define IS_BOOLEAN(VAR)  IS_BOOL(VAR)
+#define IS_FUNCTION(VAR) IS_CODE(VAR)
+#define IS_INTEGER(VAR)  if { IS_SCALAR(VAR) } then { (floor(VAR) == (VAR)) } else { false }
+#define IS_NUMBER(VAR)   IS_SCALAR(VAR)
+
+/* -------------------------------------------
+Macro: SCRIPT()
+	Sets name of script (relies on PREFIX and COMPONENT values being #defined).
+
+Parameters:
+	NAME - Name of script [Indentifier]
+
+Example:
+	(begin example)
+		SCRIPT(eradicateMuppets);
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define SCRIPT(NAME) \
+	scriptName 'PREFIX\COMPONENT\NAME'
+
+/* -------------------------------------------
+Macros: EXPLODE_n()
+	Splitting an ARRAY into a number of variables (A, B, C, etc).
+
+	Note that this does not make the created variables private.
+
+	EXPLODE_2(ARRAY,A,B) - Split a 2-element array into separate variables.
+	EXPLODE_3(ARRAY,A,B,C) - Split a 3-element array into separate variables.
+	EXPLODE_4(ARRAY,A,B,C,D) - Split a 4-element array into separate variables.
+	EXPLODE_5(ARRAY,A,B,C,D,E) - Split a 5-element array into separate variables.
+	EXPLODE_6(ARRAY,A,B,C,D,E,F) - Split a 6-element array into separate variables.
+	EXPLODE_7(ARRAY,A,B,C,D,E,F,G) - Split a 7-element array into separate variables.
+	EXPLODE_8(ARRAY,A,B,C,D,E,F,G,H) - Split a 8-element array into separate variables.
+	EXPLODE_9(ARRAY,A,B,C,D,E,F,G,H,I) - Split a 9-element array into separate variables.
+
+Parameters:
+	ARRAY - Array to read from [Array]
+	A..H - Names of variables to set from array [Identifier]
+
+Example:
+	(begin example)
+		_array = ["fred", 156.8, 120.9];
+		EXPLODE_3(_array,_name_height,_weight);
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define EXPLODE_2(ARRAY,A,B) \
+	private [#A,#B]; \
+	A = (ARRAY) select 0; B = (ARRAY) select 1
+
+#define EXPLODE_3(ARRAY,A,B,C) \
+	private [#A,#B,#C]; \
+	EXPLODE_2(ARRAY,A,B); C = (ARRAY) select 2
+
+#define EXPLODE_4(ARRAY,A,B,C,D) \
+	private [#A,#B,#C,#D]; \
+	EXPLODE_3(ARRAY,A,B,C); D = (ARRAY) select 3
+
+#define EXPLODE_5(ARRAY,A,B,C,D,E) \
+	private [#A,#B,#C,#D,#E]; \
+	EXPLODE_4(ARRAY,A,B,C,D); E = (ARRAY) select 4
+
+#define EXPLODE_6(ARRAY,A,B,C,D,E,F) \
+	private [#A,#B,#C,#D,#E,#F]; \
+	EXPLODE_5(ARRAY,A,B,C,D,E); F = (ARRAY) select 5
+
+#define EXPLODE_7(ARRAY,A,B,C,D,E,F,G) \
+	private [#A,#B,#C,#D,#E,#F,#G]; \
+	EXPLODE_6(ARRAY,A,B,C,D,E,F); G = (ARRAY) select 6
+
+#define EXPLODE_8(ARRAY,A,B,C,D,E,F,G,H) \
+	private [#A,#B,#C,#D,#E,#F,#G,#H]; \
+	EXPLODE_7(ARRAY,A,B,C,D,E,F,G); H = (ARRAY) select 7
+
+#define EXPLODE_9(ARRAY,A,B,C,D,E,F,G,H,I) \
+	private [#A,#B,#C,#D,#E,#F,#G,#H,#I]; \
+	EXPLODE_8(ARRAY,A,B,C,D,E,F,G,H); I = (ARRAY) select 8
+
+/* -------------------------------------------
+Group: Managing Function Parameters
+------------------------------------------- */
+
+/* -------------------------------------------
+Macros: PARAMS_n()
+	Setting variables based on parameters passed to a function.
+
+	Each parameter is defines as private and set to the appropriate value from _this.
+
+	PARAMS_1(A) - Get 1 parameter from the _this array (or _this if it's not an array).
+	PARAMS_2(A,B) - Get 2 parameters from the _this array.
+	PARAMS_3(A,B,C) - Get 3 parameters from the _this array.
+	PARAMS_4(A,B,C,D) - Get 4 parameters from the _this array.
+	PARAMS_5(A,B,C,D,E) - Get 5 parameters from the _this array.
+	PARAMS_6(A,B,C,D,E,F) - Get 6 parameters from the _this array.
+	PARAMS_7(A,B,C,D,E,F,G) - Get 7 parameters from the _this array.
+	PARAMS_8(A,B,C,D,E,F,G,H) - Get 8 parameters from the _this array.
+
+Parameters:
+	A..H - Name of variable to read from _this [Identifier]
+
+Example:
+	A function called like this:
+	(begin example)
+		[_name,_address,_telephone] call recordPersonalDetails;
+	(end)
+	expects 3 parameters and those variables could be initialised at the start of the function definition with:
+	(begin example)
+		recordPersonalDetails = {
+			PARAMS_3(_name,_address,_telephone);
+			// Rest of function follows...
+		};
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define PARAMS_1(A) \
+	private #A; \
+	A = if (IS_ARRAY(_this)) then {_this select 0} else {_this}; \
+	TRACE_1("PARAMS_1",A)
+
+#define PARAMS_2(A,B) \
+	EXPLODE_2(_this,A,B); \
+	TRACE_2("PARAMS_2",A,B)
+
+#define PARAMS_3(A,B,C) \
+	EXPLODE_3(_this,A,B,C); \
+	TRACE_3("PARAMS_3",A,B,C)
+
+#define PARAMS_4(A,B,C,D) \
+	EXPLODE_4(_this,A,B,C,D); \
+	TRACE_4("PARAMS_4",A,B,C,D)
+
+#define PARAMS_5(A,B,C,D,E) \
+	EXPLODE_5(_this,A,B,C,D,E); \
+	TRACE_5("PARAMS_5",A,B,C,D,E)
+
+#define PARAMS_6(A,B,C,D,E,F) \
+	EXPLODE_6(_this,A,B,C,D,E,F); \
+	TRACE_6("PARAMS_6",A,B,C,D,E,F)
+
+#define PARAMS_7(A,B,C,D,E,F,G) \
+	EXPLODE_7(_this,A,B,C,D,E,F,G); \
+	TRACE_7("PARAMS_7",A,B,C,D,E,F,G)
+
+#define PARAMS_8(A,B,C,D,E,F,G,H) \
+	EXPLODE_8(_this,A,B,C,D,E,F,G,H); \
+	TRACE_8("PARAMS_8",A,B,C,D,E,F,G,H)
+
+#define PARAMS_9(A,B,C,D,E,F,G,H,I) \
+	EXPLODE_9(_this,A,B,C,D,E,F,G,H,I); \
+	TRACE_9("PARAMS_8",A,B,C,D,E,F,G,H,I)
+
+/* -------------------------------------------
+Macro: DEFAULT_PARAM()
+	Getting a default function parameter. This may be used together with <PARAMS_n()> to have a mix of required and
+	optional parameters.
+
+Parameters:
+	INDEX - Index of parameter in _this [Integer, 0+]
+	NAME - Name of the variable to set [Identifier]
+	DEF_VALUE - Default value to use in case the array is too short or the value at INDEX is nil [Any]
+
+Example:
+	A function called with optional parameters:
+	(begin example)
+		[_name] call myFunction;
+		[_name, _numberOfLegs] call myFunction;
+		[_name, _numberOfLegs, _hasAHead] call myFunction;
+	(end)
+	1 required parameter and 2 optional parameters. Those variables could be initialised at the start of the function
+	definition with:
+	(begin example)
+		myFunction = {
+			PARAMS_1(_name);
+			DEFAULT_PARAM(1,_numberOfLegs,2);
+			DEFAULT_PARAM(2,_hasAHead,true);
+			// Rest of function follows...
+		};
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define DEFAULT_PARAM(INDEX,NAME,DEF_VALUE) \
+	private #NAME; \
+	NAME = [RETNIL(_this), INDEX, DEF_VALUE] call CBA_fnc_defaultParam; \
+	TRACE_3("DEFAULT_PARAM",INDEX,NAME,DEF_VALUE)
+
+/* -------------------------------------------
+Group: Assertions
+------------------------------------------- */
+
+#define ASSERTION_ERROR(MESSAGE) ERROR_WITH_TITLE("Assertion failed!",MESSAGE)
+
+/* -------------------------------------------
+Macro: ASSERT_TRUE()
+	Asserts that a CONDITION is true. When an assertion fails, an error is raised with the given MESSAGE.
+
+Parameters:
+	CONDITION - Condition to assert as true [Boolean]
+	MESSSAGE - Message to display if (A OPERATOR B) is false [String]
+
+Example:
+	(begin example)
+		ASSERT_TRUE(_frogIsDead,"The frog is alive");
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define ASSERT_TRUE(CONDITION,MESSAGE) \
+	if (not (CONDITION)) then \
+	{ \
+		ASSERTION_ERROR('Assertion (CONDITION) failed!\n\n' + (MESSAGE)); \
+	}
+
+/* -------------------------------------------
+Macro: ASSERT_FALSE()
+	Asserts that a CONDITION is false. When an assertion fails, an error is raised with the given MESSAGE.
+
+Parameters:
+	CONDITION - Condition to assert as false [Boolean]
+	MESSSAGE - Message to display if (A OPERATOR B) is true [String]
+
+Example:
+	(begin example)
+		ASSERT_FALSE(_frogIsDead,"The frog died");
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define ASSERT_FALSE(CONDITION,MESSAGE) \
+	if (CONDITION) then \
+	{ \
+		ASSERTION_ERROR('Assertion (not (CONDITION)) failed!\n\n' + (MESSAGE)) \
+	}
+
+/* -------------------------------------------
+Macro: ASSERT_OP()
+	Asserts that (A OPERATOR B) is true. When an assertion fails, an error is raised with the given MESSAGE.
+
+Parameters:
+	A - First value [Any]
+	OPERATOR - Binary operator to use [Operator]
+	B - Second value [Any]
+	MESSSAGE - Message to display if (A OPERATOR B)  is false. [String]
+
+Example:
+	(begin example)
+		ASSERT_OP(_fish,>,5,"Too few fish!");
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define ASSERT_OP(A,OPERATOR,B,MESSAGE) \
+	if (not ((A) OPERATOR (B))) then \
+	{ \
+		ASSERTION_ERROR('Assertion (A OPERATOR B) failed!\n' + 'A: ' + (str (A)) + '\n' + 'B: ' + (str (B)) + "\n\n" + (MESSAGE)); \
+	}
+
+/* -------------------------------------------
+Macro: ASSERT_DEFINED()
+	Asserts that a VARIABLE is defined. When an assertion fails, an error is raised with the given MESSAGE..
+
+Parameters:
+	VARIABLE - Variable to test if defined [String or Function].
+	MESSAGE - Message to display if variable is undefined [String].
+
+Examples:
+	(begin example)
+		ASSERT_DEFINED("_anUndefinedVar","Too few fish!");
+		ASSERT_DEFINED({ obj getVariable "anUndefinedVar" },"Too many fish!");
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define ASSERT_DEFINED(VARIABLE,MESSAGE) \
+	if (isNil VARIABLE) then \
+	{ \
+		ASSERTION_ERROR('Assertion (VARIABLE is defined) failed!\n\n' + (MESSAGE)); \
+	}
+
+/* -------------------------------------------
+Group: Managing Deprecation
+------------------------------------------- */
+
+/* -------------------------------------------
+Macro: DEPRECATE_SYS()
+	Allow deprecation of a function that has been renamed.
+
+	Replaces an old OLD_FUNCTION (which will have PREFIX_ prepended) with a NEW_FUNCTION
+	(PREFIX_ prepended) with the intention that the old function will be disabled in the future.
+
+	Shows a warning in RPT each time the deprecated function is used, but runs the new function.
+
+Parameters:
+	OLD_FUNCTION - Full name of old function [Identifier for function that does not exist any more]
+	NEW_FUNCTION - Full name of new function [Function]
+
+Example:
+	(begin example)
+		// After renaming CBA_fnc_frog as CBA_fnc_fish
+		DEPRECATE_SYS(CBA_fnc_frog,CBA_fnc_fish);
+	(end)
+
+Author:
+	Sickboy
+------------------------------------------- */
+#define DEPRECATE_SYS(OLD_FUNCTION,NEW_FUNCTION) \
+	OLD_FUNCTION = { \
+		WARNING('Deprecated function used: OLD_FUNCTION (new: NEW_FUNCTION) in ADDON'); \
+		if (isNil "_this") then { call NEW_FUNCTION } else { _this call NEW_FUNCTION }; \
+	}
+
+/* -------------------------------------------
+Macro: DEPRECATE()
+	Allow deprecation of a function, in the current component, that has been renamed.
+
+	Replaces an OLD_FUNCTION (which will have PREFIX_ prepended) with a NEW_FUNCTION
+	(PREFIX_ prepended) with the intention that the old function will be disabled in the future.
+
+	Shows a warning in RPT each time the deprecated function is used, but runs the new function.
+
+Parameters:
+	OLD_FUNCTION - Name of old function, assuming PREFIX [Identifier for function that does not exist any more]
+	NEW_FUNCTION - Name of new function, assuming PREFIX [Function]
+
+Example:
+	(begin example)
+		// After renaming CBA_fnc_frog as CBA_fnc_fish
+		DEPRECATE(fnc_frog,fnc_fish);
+	(end)
+
+Author:
+	Sickboy
+------------------------------------------- */
+#define DEPRECATE(OLD_FUNCTION,NEW_FUNCTION) \
+	DEPRECATE_SYS(DOUBLES(PREFIX,OLD_FUNCTION),DOUBLES(PREFIX,NEW_FUNCTION))
+
+/* -------------------------------------------
+Macro: OBSOLETE_SYS()
+	Replace a function that has become obsolete.
+
+	Replace an obsolete OLD_FUNCTION with a simple COMMAND_FUNCTION, with the intention that anyone
+	using the function should replace it with the simple command, since the function will be disabled in the future.
+
+	Shows a warning in RPT each time the deprecated function is used, and runs the command function.
+
+Parameters:
+	OLD_FUNCTION - Full name of old function [Identifier for function that does not exist any more]
+	COMMAND_CODE - Code to replace the old function [Function]
+
+Example:
+	(begin example)
+		// In Arma2, currentWeapon command made the CBA_fMyWeapon function obsolete:
+		OBSOLETE_SYS(CBA_fMyWeapon,{ currentWeapon player });
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define OBSOLETE_SYS(OLD_FUNCTION,COMMAND_CODE) \
+	OLD_FUNCTION = { \
+		WARNING('Obsolete function used: (use: OLD_FUNCTION) in ADDON'); \
+		if (isNil "_this") then { call COMMAND_CODE } else { _this call COMMAND_CODE }; \
+	}
+
+/* -------------------------------------------
+Macro: OBSOLETE()
+	Replace a function, in the current component, that has become obsolete.
+
+	Replace an obsolete OLD_FUNCTION (which will have PREFIX_ prepended) with a simple
+	COMMAND_CODE, with the intention that anyone using the function should replace it with the simple
+	command.
+
+	Shows a warning in RPT each time the deprecated function is used.
+
+Parameters:
+	OLD_FUNCTION - Name of old function, assuming PREFIX [Identifier for function that does not exist any more]
+	COMMAND_CODE - Code to replace the old function [Function]
+
+Example:
+	(begin example)
+		// In Arma2, currentWeapon command made the CBA_fMyWeapon function obsolete:
+		OBSOLETE(fMyWeapon,{ currentWeapon player });
+	(end)
+
+Author:
+	Spooner
+------------------------------------------- */
+#define OBSOLETE(OLD_FUNCTION,COMMAND_CODE) \
+	OBSOLETE_SYS(DOUBLES(PREFIX,OLD_FUNCTION),COMMAND_CODE)
+
+#define BWC_CONFIG(NAME) class NAME { \
+		units[] = {}; \
+		weapons[] = {}; \
+		requiredVersion = REQUIRED_VERSION; \
+		requiredAddons[] = {}; \
+		version = VERSION; \
+}
+
+// XEH Specific
+#define XEH_DISABLED class EventHandlers {}; SLX_XEH_DISABLED = 1
+
+#define XEH_PRE_INIT QUOTE(call COMPILE_FILE(XEH_PreInit_Once))
+#define XEH_PRE_CINIT QUOTE(call COMPILE_FILE(XEH_PreClientInit_Once))
+#define XEH_PRE_SINIT QUOTE(call COMPILE_FILE(XEH_PreServerInit_Once))
+
+#define XEH_POST_INIT QUOTE(call COMPILE_FILE(XEH_PostInit_Once))
+#define XEH_POST_CINIT QUOTE(call COMPILE_FILE(XEH_PostClientInit_Once))
+#define XEH_POST_SINIT QUOTE(call COMPILE_FILE(XEH_PostServerInit_Once))
diff -rupN BASE_MISSION/x/cba/addons/script_mod.hpp BASE_A2Free/x/cba/addons/script_mod.hpp
--- BASE_MISSION/x/cba/addons/script_mod.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/script_mod.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,33 @@
+// COMPONENT should be defined in the script_component.hpp and included BEFORE this hpp
+#define PREFIX cba
+// TODO: Consider Mod-wide or Component-narrow versions (or both, depending on wishes!)
+#define MAJOR 0
+#define MINOR 7
+#define PATCHLVL 7
+#define BUILD 161
+
+#define VERSION MAJOR.MINOR.PATCHLVL.BUILD
+#define VERSION_AR MAJOR,MINOR,PATCHLVL,BUILD
+
+
+// MINIMAL required version for the Mod. Components can specify others..
+#define REQUIRED_VERSION 1.05
+
+/*
+// Defined DEBUG_MODE_NORMAL in a few CBA_fncs to prevent looped logging :)
+#ifndef DEBUG_MODE_NORMAL
+	#define DEBUG_MODE_FULL
+#endif
+*/
+
+// Set a default debug mode for the component here (See documentation on how to default to each of the modes).
+/*
+	#define DEBUG_ENABLED_COMMON
+	#define DEBUG_ENABLED_DIAGNOSTIC
+	#define DEBUG_ENABLED_EVENTS
+	#define DEBUG_ENABLED_HASHES
+	#define DEBUG_ENABLED_MAIN
+	#define DEBUG_ENABLED_NETWORK
+	#define DEBUG_ENABLED_STRINGS
+	#define DEBUG_ENABLED_VERSIONING
+*/
diff -rupN BASE_MISSION/x/cba/addons/script_strings.hpp BASE_A2Free/x/cba/addons/script_strings.hpp
--- BASE_MISSION/x/cba/addons/script_strings.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/script_strings.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,13 @@
+// --- General ASCII codes.
+#define ASCII_COLON 58
+#define ASCII_MINUS 45
+#define ASCII_HASH 35
+#define ASCII_VERTICAL_BAR 124
+
+#define ASCII_NEWLINE 10
+#define ASCII_CR 13
+#define ASCII_TAB 9
+#define ASCII_SPACE 32
+
+// White-space, used by the SPON_stringTrim* functions.
+#define WHITE_SPACE [ASCII_TAB, ASCII_SPACE, ASCII_NEWLINE, ASCII_CR]
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_capitalize.sqf BASE_A2Free/x/cba/addons/strings_fnc_capitalize.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_capitalize.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_capitalize.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,45 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_capitalize
+
+Description:
+	Upper case the first letter of the string, lower case the rest.
+
+Parameters:
+	_string - String to capitalize [String]
+
+Returns:
+	Capitalized string [String].
+
+Examples:
+	(begin example)
+		_result = ["FISH"] call CBA_fnc_capitalize;
+		// _result => "Fish"
+
+		_result = ["frog-headed fish"] call CBA_fnc_capitalize;
+		// _result => "Frog-headed fish"
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(capitalize);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_1(_string);
+
+// Make the whole string into a lower case character array.
+_string = toArray (toLower _string);
+
+// If there is a first letter, capitalise it.
+if ((count _string) > 0) then
+{
+	_string set [0, (toArray (toUpper (toString [_string select 0]))) select 0];
+};
+
+toString _string; // Return.
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_find.sqf BASE_A2Free/x/cba/addons/strings_fnc_find.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_find.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_find.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,83 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_find
+
+Description:
+	Finds a string within another string.
+
+Parameters:
+	_haystack - String in which to search [String or ASCII char array]
+	_needle - String to search for [String or ASCII char array]
+	_initialIndex - Initial character index within _haystack to start the
+    search at [Number: 0+, defaults to 0].
+
+Returns:
+	First position of string. Returns -1 if not found [Number]
+
+Examples:
+	(begin example)
+		_result = ["frog-headed fish", "f"] call CBA_fnc_find;
+		// _result => 0
+
+		_result = ["frog-headed fish", "f", 5] call CBA_fnc_find;
+		// _result => 12
+
+		_result = ["frog-headed fish", "fish"] call CBA_fnc_find;
+		// _result => 12
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(find);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_2(_haystack,_needle);
+DEFAULT_PARAM(2,_initialIndex,0);
+
+private ["_haystackCount", "_needleCount", "_foundPos",
+	"_haystackIndex", "_needleIndex"];
+
+if ((typeName _haystack) == "STRING") then
+{
+	_haystack = toArray _haystack;
+};
+
+if ((typeName _needle) == "STRING") then
+{
+	_needle = toArray _needle;
+};
+
+_haystackCount = count _haystack;
+_needleCount = count _needle;
+_foundPos = -1;
+
+for [ { _haystackIndex = _initialIndex; _needleIndex = 0 },
+	{ (_haystackIndex < _haystackCount) and (_foundPos == -1)},
+	{ _haystackIndex = _haystackIndex + 1} ] do
+{
+	if ((_haystack select _haystackIndex) == (_needle select _needleIndex)) then
+	{
+		// Matched a single character.
+		_needleIndex = _needleIndex + 1;
+
+		// Found the whole needle.
+		if (_needleIndex == _needleCount) then
+		{
+			_foundPos = _haystackIndex - (_needleCount - 1);
+		};
+	}
+	else{if (_needleIndex > 0) then
+	{
+		// Found only a partial needle; start again.
+		_haystackIndex = _haystackIndex - _needleIndex;
+		_needleIndex = 0;
+	}; };
+};
+
+_foundPos;
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_formatElapsedTime.sqf BASE_A2Free/x/cba/addons/strings_fnc_formatElapsedTime.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_formatElapsedTime.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_formatElapsedTime.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,78 @@
+/* -----------------------------------------------------------------------------
+Function: CBA_fnc_formatElapsedTime
+
+Description:
+	Formats time in seconds according to a format. Intended to show time elapsed,
+	rather than time-of-day.
+
+Parameters:
+	_seconds - Number of seconds to format, for example from 'time' command [number]
+	_format - Format to put time into [String: "H:MM:SS", "M:SS",
+		"H:MM:SS.mmm" or "M:SS.mmm"; defaults to "H:MM:SS"]
+
+Returns:
+	Formatted time [String]
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#define DEBUG_MODE_NORMAL
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(formatElapsedTime);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_1(_seconds);
+DEFAULT_PARAM(1,_format,"H:MM:SS");
+
+private ["_minutes", "_hours", "_secondsDecimals"];
+
+// Discover all the digits to use.
+_hours = floor (_seconds / 3600);
+_seconds = _seconds - (_hours * 3600);
+_minutes = floor (_seconds / 60);
+_seconds = _seconds - (_minutes * 60);
+
+// Add the milliseconds if required.
+_elapsed = switch (_format) do
+{
+	case "H:MM:SS":
+	{
+		format ["%1:%2:%3",
+			_hours,
+			[_minutes, 2] call CBA_fnc_formatNumber,
+			[_seconds, 2, 0] call CBA_fnc_formatNumber];
+	};
+	case "M:SS":
+	{
+		format ["%1:%2",
+			_minutes,
+			[_seconds, 2, 0] call CBA_fnc_formatNumber];
+	};
+	case "H:MM:SS.mmm":
+	{
+		format ["%1:%2:%3",
+			_hours,
+			[_minutes, 2] call CBA_fnc_formatNumber,
+			[_seconds, 2, 3] call CBA_fnc_formatNumber];
+	};
+	case "M:SS.mmm":
+	{
+		format ["%1:%2",
+			_minutes,
+			[_seconds, 2, 3] call CBA_fnc_formatNumber];
+	};
+	default
+	{
+		private "_msg";
+		_msg = format ["%1: %2", _msg, _format];
+		ERROR(_msg);
+		_msg;
+	};
+};
+
+_elapsed; // Return.
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_formatNumber.sqf BASE_A2Free/x/cba/addons/strings_fnc_formatNumber.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_formatNumber.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_formatNumber.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,155 @@
+/* -----------------------------------------------------------------------------
+Function: CBA_fnc_formatNumber
+
+Description:
+	Formats a number to a minimum integer width and to a specific number of
+	decimal places (including padding with 0s and correct rounding). Numbers
+	are always displayed fully, never being condensed using an exponent (e.g.
+	the number 1.234e9 would be given as "1234000000").
+
+	Additionally, if required, it will separate the integer part of the number
+	with the appropriate thousands seperators as, for example,
+	"21,002" or "1,000,000".
+
+Limitations:
+	Although the function works up to a point and will display the passed
+	number correctly, due to the extremely limited accuracy of floating point
+	values used within ArmA (presumably just single-precision / 32 bit), the
+	output might not be as EXPECTED after about eight significant figures.
+
+Parameters:
+	_number - Number to format [Number]
+	_integerWidth - Minimum width of integer part of number, padded with 0s,
+		[Number: >= 0, defaults to 1]
+	_decimalPlaces - Number of decimal places, padded with trailing 0s,
+		if necessary [Number: >= 0, defaults to 0]
+	_separateThousands - True to separate each three digits with a comma
+		[Boolean, defaults to false]
+
+Returns:
+	The number formatted into a string.
+
+Examples:
+	(begin example)
+		// Assumes English formatting.
+		[0.0001, 1, 3] call CBA_fnc_formatNumber;               // => "0.000"
+		[0.0005, 1, 3] call CBA_fnc_formatNumber;               // => "0.001"
+
+		[12345, 1, 0, true] call CBA_fnc_formatNumber;          // => "12,345"
+		[1234567, 1, 0, true] call CBA_fnc_formatNumber;        // => "1,234,567"
+
+		[12345.67, 1, 1, true] call CBA_fnc_formatNumber;       // => "12,345.7"
+		[1234, 1, 3, true] call CBA_fnc_formatNumber;           // => "1,234.000"
+
+		[0.1, 1] call CBA_fnc_formatNumber;                     // => "0"
+		[0.1, 3, 1] call CBA_fnc_formatNumber;                  // => "000.1"
+		[0.1, 0, 2] call CBA_fnc_formatNumber;                  // => ".10"
+		[12, 0] call CBA_fnc_formatNumber;                      // => "12"
+		[12, 3] call CBA_fnc_formatNumber;                      // => "012"
+
+		[-12] call CBA_fnc_formatNumber;                        // => "-12"
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+#define DEBUG_MODE_NORMAL
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define DEFAULT_INTEGER_WIDTH 1
+#define DEFAULT_DECIMAL_PLACES 0
+#define DEFAULT_SEPARATE_THOUSANDS false
+
+SCRIPT(formatNumber);
+
+// -----------------------------------------------------------------------------
+
+PARAMS_1(_number);
+DEFAULT_PARAM(1,_integerWidth,DEFAULT_INTEGER_WIDTH);
+DEFAULT_PARAM(2,_decimalPlaces,DEFAULT_DECIMAL_PLACES);
+DEFAULT_PARAM(3,_separateThousands,DEFAULT_SEPARATE_THOUSANDS);
+
+private ["_integerPart", "_string", "_numIntegerDigits", "_decimalPoint",
+	"_thousandsSeparator", "_basePlaces"];
+
+_decimalPoint = localize "STR_CBA_FORMAT_NUMBER_DECIMAL_POINT";
+_thousandsSeparator = localize "STR_CBA_FORMAT_NUMBER_THOUSANDS_SEPARATOR";
+
+// Start by working out how to display the integer part of the number.
+if (_decimalPlaces > 0) then
+{
+	_basePlaces = 10 ^ _decimalPlaces;
+	_number = round(_number * _basePlaces) / _basePlaces;
+	_integerPart = floor (abs _number);
+} else {
+	_integerPart = round (abs _number);
+};
+
+_string = "";
+_numIntegerDigits = 0;
+
+while {_integerPart > 0} do
+{
+	if ((_numIntegerDigits > 0) and ((_numIntegerDigits mod 3) == 0) and _separateThousands) then
+	{
+		_string = _thousandsSeparator + _string;
+	};
+
+	_string =  (str (_integerPart mod 10)) + _string;
+	_numIntegerDigits = _numIntegerDigits + 1;
+
+	_integerPart = floor (_integerPart / 10);
+};
+
+// Pad integer with 0s
+while {_numIntegerDigits < _integerWidth} do
+{
+	if ((_numIntegerDigits > 0) and ((_numIntegerDigits mod 3) == 0) and _separateThousands) then
+	{
+		_string = _thousandsSeparator + _string;
+	};
+
+	_string = "0" + _string;
+
+	_numIntegerDigits = _numIntegerDigits + 1;
+};
+
+// Add a - sign if needed.
+if (_number < 0) then
+{
+	_string = "-" + _string;
+};
+
+// Add decimal digits, if necessary.
+if (_decimalPlaces > 0) then
+{
+	private ["_digit", "_multiplier", "_i"];
+
+	_string = _string + _decimalPoint;
+
+	_multiplier = 10;
+
+	for "_i" from 1 to _decimalPlaces do
+	{
+		_digit = floor ((_number * _multiplier) mod 10);
+
+		// If the digit has become infintesimal, pad to the end with zeroes.
+		if (not (finite _digit)) exitWith
+		{
+			private "_j";
+
+			for "_j" from _i to _decimalPlaces do
+			{
+				_string = _string + "0";
+			};
+		};
+
+		_string = _string + (str _digit);
+
+		_multiplier = _multiplier * 10;
+	};
+};
+
+_string; // Return.
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_leftTrim.sqf BASE_A2Free/x/cba/addons/strings_fnc_leftTrim.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_leftTrim.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_leftTrim.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,68 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_leftTrim
+
+Description:
+	Trims white-space (space, tab, newline) from the left end of a string.
+
+	See <CBA_fnc_rightTrim> and <CBA_fnc_trim>.
+
+Parameters:
+	_string - String to trim [String]
+
+Returns:
+	Trimmed string [String]
+
+Example:
+	(begin example)
+		_result = [" frogs are fishy   "] call CBA_fnc_leftTrim;
+		// _result => "frogs are fishy   "
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_strings.hpp"
+
+SCRIPT(leftTrim);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_1(_string);
+
+private ["_chars", "_whiteSpace"];
+
+_chars = toArray _string;
+_whiteSpace = WHITE_SPACE;
+
+// Left trim.
+if ((count _chars) > 0) then
+{
+	private "_numWhiteSpaces";
+	_numWhiteSpaces = count _chars;
+
+	for "_i" from 0 to ((count _chars) - 1) do
+	{
+		if (not ((_chars select _i) in _whiteSpace)) exitWith { _numWhiteSpaces = _i };
+	};
+
+	if (_numWhiteSpaces > 0) then
+	{
+		private "_newChars";
+
+		_newChars = [];
+		_newChars resize ((count _chars) - _numWhiteSpaces);
+
+		for "_i" from 0 to ((count _newChars) - 1) do
+		{
+			_newChars set [_i, _chars select (_i + _numWhiteSpaces)];
+		};
+
+		_chars = _newChars;
+	};
+};
+
+toString _chars; // Return.
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_replace.sqf BASE_A2Free/x/cba/addons/strings_fnc_replace.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_replace.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_replace.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,36 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_replace
+
+Description:
+	Replaces substrings within a string. Case-dependent.
+
+Parameters:
+	_string - String to make replacement in [String]
+	_pattern - Substring to replace [String]
+	_replacement - String to replace the _pattern with [String]
+
+Returns:
+	String with replacements made [String]
+
+Example:
+	(begin example)
+		_str = ["Fish frog cheese fromage", "fro", "pi"] call CBA_fnc_replace;
+		// => "Fish pig cheese pimage"
+	(end)
+
+Author:
+	Spooner
+--------------------------------------------------------------------------- */
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(replace);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_3(_string,_pattern,_replacement);
+
+// Return.
+[[_string, _pattern] call CBA_fnc_split, _replacement] call CBA_fnc_join;
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_rightTrim.sqf BASE_A2Free/x/cba/addons/strings_fnc_rightTrim.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_rightTrim.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_rightTrim.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,52 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_rightTrim
+
+Description:
+	Trims white-space (space, tab, newline) from the right end of a string.
+
+	See <CBA_fnc_leftTrim> and <CBA_fnc_trim>.
+
+Parameters:
+	_string - String to trim [String]
+
+Returns:
+	Trimmed string [String]
+
+Example:
+	(begin example)
+		_result = [" frogs are fishy   "] call CBA_fnc_rightTrim;
+		// _result => " frogs are fishy"
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "script_strings.hpp"
+
+SCRIPT(rightTrim);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_1(_string);
+
+private ["_chars", "_whiteSpace", "_pos"];
+
+_chars = toArray _string;
+_whiteSpace = WHITE_SPACE;
+
+// Right trim.
+
+_numWhiteSpaces = count _chars;
+
+for "_pos" from ((count _chars) - 1) to 0 step -1 do
+{
+	if (not ((_chars select _pos) in _whiteSpace)) exitWith { _numWhiteSpaces = (count _chars) - _pos - 1 };
+};
+
+_chars resize ((count _chars) - _numWhiteSpaces);
+
+toString _chars; // Return.
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_split.sqf BASE_A2Free/x/cba/addons/strings_fnc_split.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_split.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_split.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,95 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_split
+
+Description:
+	Splits a string into substrings using a separator. Inverse of <CBA_fnc_join>.
+
+Parameters:
+	_string - String to split up [String]
+	_separator - String to split around. If an empty string, "", then split
+		every character into a separate string [String, defaults to ""]
+
+Returns:
+	The split string [Array of Strings]
+
+Examples:
+	(begin example)
+		_result = ["FISH\Cheese\frog.sqf", "\"] call CBA_fnc_split;
+		_result is ["Fish", "Cheese", "frog.sqf"]
+
+		_result = ["Peas", ""] call CBA_fnc_split;
+		_result is ["P", "e", "a", "s"]
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(split);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_1(_string);
+DEFAULT_PARAM(1,_separator,"");
+
+private ["_stringArray", "_split"];
+_stringArray = toArray _string;
+_split = [];
+
+if (_separator == "") then
+{
+	// Special case, split into single character strings.
+	{
+		PUSH(_split,toString [_x]);
+	} forEach _stringArray;
+} else {
+	private [ "_separatorArray", "_fragment",
+	"_currentIndex", "_foundIndex"];
+
+	_separatorArray = toArray _separator;
+
+	_currentIndex = 0;
+
+	while { _currentIndex < (count _stringArray) } do
+	{
+		_foundIndex = [_stringArray, _separatorArray, _currentIndex] call CBA_fnc_find;
+
+		// Not found, so use rest of string as final fragment.
+		if (_foundIndex < 0) exitWith
+		{
+			_fragment = [];
+
+			for "_i" from _currentIndex to ((count _stringArray) - 1) do
+			{
+				PUSH(_fragment,_stringArray select _i);
+			};
+
+			PUSH(_split,toString _fragment);
+		};
+
+		// Found, so use all string before found position as next fragment.
+		_fragment = [];
+
+		for "_i" from _currentIndex to (_foundIndex - 1) do
+		{
+			PUSH(_fragment,_stringArray select _i);
+		};
+
+		PUSH(_split,toString _fragment);
+
+		_currentIndex = _foundIndex + (count _separatorArray);
+
+		// If the separator is present at the end of the string, then
+		// add an empty string.
+		if (_currentIndex == (count _stringArray)) then
+		{
+			PUSH(_split,"");
+		};
+	};
+};
+
+_split ; // Return.
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_strLen.sqf BASE_A2Free/x/cba/addons/strings_fnc_strLen.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_strLen.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_strLen.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,34 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_strLen
+
+Description:
+	Counts the number of characters in a string.
+
+Parameters:
+	_string - String to measure [String]
+
+Returns:
+	Number of characters in string [Number]
+
+Examples:
+	(begin example)
+		_length = [""] call CBA_fnc_strLen;
+		// _result => 0
+
+		_length = ["frogs are fishy"] call CBA_fnc_strLen;
+		// _result => 15
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(strLen);
+
+// ----------------------------------------------------------------------------
+
+count (toArray (_this select 0)); // Return.
diff -rupN BASE_MISSION/x/cba/addons/strings_fnc_trim.sqf BASE_A2Free/x/cba/addons/strings_fnc_trim.sqf
--- BASE_MISSION/x/cba/addons/strings_fnc_trim.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_fnc_trim.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,38 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_trim
+
+Description:
+	Trims white-space (space, tab, newline) from the both ends of a string.
+
+	See <CBA_fnc_leftTrim> and <CBA_fnc_rightTrim>.
+
+Parameters:
+	_string - String to trim [String]
+
+Returns:
+	Trimmed string [String]
+
+Example:
+	(begin example)
+		_result = [" frogs are fishy   "] call CBA_fnc_trim;
+		// _result => "frogs are fishy"
+	(end)
+
+Author:
+	Spooner
+---------------------------------------------------------------------------- */
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(trim);
+
+// ----------------------------------------------------------------------------
+
+PARAMS_1(_string);
+
+// Rtrim first for efficiency.
+_string = [_string] call CBA_fnc_rightTrim;
+
+[_string] call CBA_fnc_leftTrim; // Return.
diff -rupN BASE_MISSION/x/cba/addons/strings_script_component.hpp BASE_A2Free/x/cba/addons/strings_script_component.hpp
--- BASE_MISSION/x/cba/addons/strings_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,13 @@
+#define COMPONENT strings
+#include "script_mod.hpp"
+
+
+#ifdef DEBUG_ENABLED_STRINGS
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_STRINGS
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_STRINGS
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/strings_test.sqf BASE_A2Free/x/cba/addons/strings_test.sqf
--- BASE_MISSION/x/cba/addons/strings_test.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_test.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,22 @@
+// -----------------------------------------------------------------------------
+// Automatically generated by 'functions_config.rb'
+// DO NOT MANUALLY EDIT THIS FILE!
+// -----------------------------------------------------------------------------
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+#define TESTS ["strings"]
+
+SCRIPT(test-strings);
+
+// ----------------------------------------------------------------------------
+
+LOG("=== Testing Strings ===");
+
+{
+	call compile preprocessFileLineNumbers format ["\x\cba\addons\strings\test_%1.sqf", _x];
+} forEach TESTS;
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/strings_test_strings.sqf BASE_A2Free/x/cba/addons/strings_test_strings.sqf
--- BASE_MISSION/x/cba/addons/strings_test_strings.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/strings_test_strings.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,265 @@
+// ----------------------------------------------------------------------------
+
+#include "strings_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+SCRIPT(test_strings);
+
+// ----------------------------------------------------------------------------
+
+private ["_pos", "_str", "_array", "_expected", "_result", "_fn"];
+
+LOG('Testing Strings');
+
+// UNIT TESTS (stringFind)
+_fn = "CBA_fnc_find";
+ASSERT_DEFINED(_fn,"");
+
+_pos = ["frog", "f"] call CBA_fnc_find;
+ASSERT_OP(_pos,==,0,_fn);
+
+_pos = ["frog", "g"] call CBA_fnc_find;
+ASSERT_OP(_pos,==,3,_fn);
+
+_pos = ["frog", "z"] call CBA_fnc_find;
+ASSERT_OP(_pos,==,-1,_fn);
+
+_pos = ["bullfrog", "frog"] call CBA_fnc_find;
+ASSERT_OP(_pos,==,4,_fn);
+
+_pos = ["bullfrog", "frogs"] call CBA_fnc_find;
+ASSERT_OP(_pos,==,-1,_fn);
+
+_pos = ["frofrog", "frog"] call CBA_fnc_find;
+ASSERT_OP(_pos,==,3,_fn);
+
+// ----------------------------------------------------------------------------
+// UNIT TESTS (stringSplit)
+_fn = "CBA_fnc_split";
+ASSERT_DEFINED(_fn,"");
+
+_array = ["", "\"] call CBA_fnc_split;
+_expected = [];
+ASSERT_OP(str _array, ==, str _expected, _fn);
+
+_array = ["\", "\"] call CBA_fnc_split;
+_expected = ["", ""];
+ASSERT_OP(str _array, ==, str _expected, _fn);
+
+_array = ["\frog", "\"] call CBA_fnc_split;
+_expected = ["", "frog"];
+ASSERT_OP(str _array, ==, str _expected, _fn);
+
+_array = ["\frog\", "\"] call CBA_fnc_split;
+_expected = ["", "frog", ""];
+ASSERT_OP(str _array, ==, str _expected, _fn);
+
+_array = ["cheese\frog\fish", "\"] call CBA_fnc_split;
+_expected = ["cheese", "frog", "fish"];
+ASSERT_OP(str _array, ==, str _expected, _fn);
+
+_array = ["peas", ""] call CBA_fnc_split;
+_expected = ["p", "e", "a", "s"];
+ASSERT_OP(str _array, ==, str _expected, _fn);
+
+// ----------------------------------------------------------------------------
+// UNIT TESTS (stringReplace)
+_fn = "CBA_fnc_replace";
+
+ASSERT_DEFINED(_fn,"");
+
+_str = ["", "", ""] call CBA_fnc_replace;
+ASSERT_OP(_str,==,"",_fn);
+
+_str = ["", "frog", "fish"] call CBA_fnc_replace;
+ASSERT_OP(_str,==,"",_fn);
+
+_str = ["frog", "fish", "cheese"] call CBA_fnc_replace;
+ASSERT_OP(_str,==,"frog",_fn);
+
+_str = ["frog", "o", "a"] call CBA_fnc_replace;
+ASSERT_OP(_str,==,"frag",_fn);
+
+_str = ["frodo", "o", "ai"] call CBA_fnc_replace;
+ASSERT_OP(_str,==,"fraidai",_fn);
+
+// ----------------------------------------------------------------------------
+// UNIT TESTS (leftTrim)
+_fn = "CBA_fnc_leftTrim";
+
+ASSERT_DEFINED(_fn,"");
+
+_str = [""] call CBA_fnc_leftTrim;
+ASSERT_OP(_str,==,"",_fn);
+
+_str = ["frog"] call CBA_fnc_leftTrim;
+ASSERT_OP(_str,==,"frog",_fn);
+
+_str = [" frog"] call CBA_fnc_leftTrim;
+ASSERT_OP(_str,==,"frog",_fn);
+
+_str = ["   frog"] call CBA_fnc_leftTrim; // spaces
+ASSERT_OP(_str,==,"frog",_fn);
+
+_str = ["	frog"] call CBA_fnc_leftTrim; // tab
+ASSERT_OP(_str,==,"frog",_fn);
+
+_str = ["   "] call CBA_fnc_leftTrim;
+ASSERT_OP(_str,==,"",_fn);
+
+_str = [" x "] call CBA_fnc_leftTrim;
+ASSERT_OP(_str,==,"x ",_fn);
+
+// ----------------------------------------------------------------------------
+// UNIT TESTS (rightTrim)
+_fn = "CBA_fnc_rightTrim";
+
+ASSERT_DEFINED(_fn,"");
+
+_str = [""] call CBA_fnc_rightTrim;
+ASSERT_OP(_str,==,"",_fn);
+
+_str = ["frog"] call CBA_fnc_rightTrim;
+ASSERT_OP(_str,==,"frog",_fn);
+
+_str = ["frog "] call CBA_fnc_rightTrim;
+ASSERT_OP(_str,==,"frog",_fn);
+
+_str = ["frog   "] call CBA_fnc_rightTrim;
+ASSERT_OP(_str,==,"frog",_fn);
+
+_str = ["frog 	"] call CBA_fnc_rightTrim; // including tabs
+ASSERT_OP(_str,==,"frog",_fn);
+
+_str = ["   "] call CBA_fnc_rightTrim;
+ASSERT_OP(_str,==,"",_fn);
+
+_str = [" 	"] call CBA_fnc_rightTrim; // including tabs
+ASSERT_OP(_str,==,"",_fn);
+
+_str = [" x	"] call CBA_fnc_rightTrim;
+ASSERT_OP(_str,==," x",_fn);
+
+// ----------------------------------------------------------------------------
+// UNIT TESTS (trim)
+_fn = "CBA_fnc_trim";
+
+ASSERT_DEFINED(_fn,"");
+
+_str = [""] call CBA_fnc_trim;
+ASSERT_OP(_str,==,"",_fn);
+
+_str = [" x "] call CBA_fnc_trim;
+ASSERT_OP(_str,==,"x",_fn);
+
+// ----------------------------------------------------------------------------
+// UNIT TESTS (capitalize)
+_fn = "CBA_fnc_capitalize";
+
+ASSERT_DEFINED(_fn,"");
+
+_str = [""] call CBA_fnc_capitalize;
+ASSERT_OP(_str,==,"",_fn);
+
+_str = ["a"] call CBA_fnc_capitalize;
+ASSERT_OP(_str,==,"A",_fn);
+
+_str = ["frog"] call CBA_fnc_capitalize;
+ASSERT_OP(_str,==,"Frog",_fn);
+
+_str = ["Frog"] call CBA_fnc_capitalize;
+ASSERT_OP(_str,==,"Frog",_fn);
+
+// ----------------------------------------------------------------------------
+// UNIT TESTS (CBA_fnc_formatNumber)
+_fn = "CBA_fnc_formatNumber";
+
+ASSERT_DEFINED(_fn,"");
+
+_str = [0.0001, 1, 3] call CBA_fnc_formatNumber;
+ASSERT_OP(_str,==,"0.000",_fn);
+
+_str = [0.0005, 1, 3] call CBA_fnc_formatNumber;
+ASSERT_OP(_str,==,"0.001",_fn);
+
+_str = [12345, 1, 0, true] call CBA_fnc_formatNumber;
+_expected = "12,345";
+ASSERT_OP(_str,==,_expected,_fn);
+
+_str = [12345.67, 1, 1, true] call CBA_fnc_formatNumber;
+_expected = "12,345.7";
+ASSERT_OP(_str,==,_expected,_fn);
+
+_str = [0.1, 1] call CBA_fnc_formatNumber;
+ASSERT_OP(_str,==,"0",_fn);
+
+_str = [0.1, 3, 1] call CBA_fnc_formatNumber;
+ASSERT_OP(_str,==,"000.1",_fn);
+
+_str = [0.1, 0, 2] call CBA_fnc_formatNumber;
+ASSERT_OP(_str,==,".10",_fn);
+
+_str = [12, 0] call CBA_fnc_formatNumber;
+ASSERT_OP(_str,==,"12",_fn);
+
+_str = [12, 3] call CBA_fnc_formatNumber;
+ASSERT_OP(_str,==,"012",_fn);
+
+_str = [-12] call CBA_fnc_formatNumber;
+ASSERT_OP(_str,==,"-12",_fn);
+
+// ----------------------------------------------------------------------------
+// UNIT TESTS (elaspsedTime)
+_fn = "CBA_fnc_formatElapsedTime";
+
+ASSERT_DEFINED(_fn,"");
+
+_str = [0, "H:MM:SS"] call CBA_fnc_formatElapsedTime;
+_expected = "0:00:00";
+ASSERT_OP(_str,==,_expected,_fn);
+
+_str = [0, "M:SS"] call CBA_fnc_formatElapsedTime;
+_expected = "0:00";
+ASSERT_OP(_str,==,_expected,_fn);
+
+_str = [0, "H:MM:SS.mmm"] call CBA_fnc_formatElapsedTime;
+_expected = "0:00:00.000";
+ASSERT_OP(_str,==,_expected,_fn);
+
+_str = [0, "M:SS.mmm"] call CBA_fnc_formatElapsedTime;
+_expected = "0:00.000";
+ASSERT_OP(_str,==,_expected,_fn);
+
+// ----------------------------------------------------------------------------
+// UNIT TESTS (compareStrings)
+/* Function ISN'T implemented.
+_fn = "CBA_fnc_compare";
+ASSERT_DEFINED(_fn,"");
+
+_result = ["", ""] call CBA_fnc_compare;
+ASSERT_OP(_result, ==, 0, _fn);
+
+_result = ["", "a"] call CBA_fnc_compare;
+ASSERT_OP(_result, ==, -1, _fn);
+
+_result = ["a", ""] call CBA_fnc_compare;
+ASSERT_OP(_result, ==, +1, _fn);
+
+_result = ["a", "a"] call CBA_fnc_compare;
+ASSERT_OP(_result, ==, 0, _fn);
+
+_result = ["a", "b"] call CBA_fnc_compare;
+ASSERT_OP(_result, ==, -1, _fn);
+
+_result = ["b", "a"] call CBA_fnc_compare;
+ASSERT_OP(_result, ==, +1, _fn);
+
+_result = ["aardvark", "aardwolf"] call CBA_fnc_compare;
+ASSERT_OP(_result, ==, -1, _fn);
+
+_result = ["aardwolf", "aardvark"] call CBA_fnc_compare;
+ASSERT_OP(_result, ==, +1, _fn);
+*/
+
+nil;
diff -rupN BASE_MISSION/x/cba/addons/ui_XEH_preClientInit.sqf BASE_A2Free/x/cba/addons/ui_XEH_preClientInit.sqf
--- BASE_MISSION/x/cba/addons/ui_XEH_preClientInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_XEH_preClientInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,7 @@
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+LOG(MSG_INIT);
+
+call COMPILE_FILE(flexiMenu_init);
diff -rupN BASE_MISSION/x/cba/addons/ui_config.cpp BASE_A2Free/x/cba/addons/ui_config.cpp
--- BASE_MISSION/x/cba/addons/ui_config.cpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_config.cpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,105 @@
+class RscText
+{
+    type = 0;
+    idc = -1;
+    x = 0;
+    y = 0;
+    h = 0.037;
+    w = 0.3;
+    style = 0x100;
+    font = "Zeppelin32";
+    SizeEx = 0.03921;
+    colorText[] = {1,1,1,1};
+    colorBackground[] = {0, 0, 0, 0};
+    linespacing = 1;
+    shadow = 0;
+};
+class RscShortcutButton {
+      type = 16;
+      idc = -1;
+      style = 0;
+      default = 0;
+      w = 0.183825;
+      h = 0.104575;
+      color[] = {0.543, 0.5742, 0.4102, 1.0};
+      color2[] = {0.95, 0.95, 0.95, 1};
+      colorBackground[] = {1, 1, 1, 1};
+      colorbackground2[] = {1, 1, 1, 0.4};
+      colorDisabled[] = {1, 1, 1, 0.25};
+      periodFocus = 1.2;
+      periodOver = 0.8;
+      class HitZone {
+             left = 0.004;
+             top = 0.029;
+             right = 0.004;
+             bottom = 0.029;
+      };
+      class ShortcutPos {
+             left = 0.004;
+             top = 0.026;
+             w = 0.0392157;
+             h = 0.0522876;
+      };
+      class TextPos {
+             left = 0.05;
+             top = 0.034;
+             right = 0.005;
+             bottom = 0.005;
+      };
+      animTextureNormal = "\ca\ui\data\ui_button_normal_ca.paa";
+      animTextureDisabled = "\ca\ui\data\ui_button_disabled_ca.paa";
+      animTextureOver = "\ca\ui\data\ui_button_over_ca.paa";
+      animTextureFocused = "\ca\ui\data\ui_button_focus_ca.paa";
+      animTexturePressed = "\ca\ui\data\ui_button_down_ca.paa";
+      animTextureDefault = "\ca\ui\data\ui_button_default_ca.paa";
+      textureNoShortcut = "";
+      period = 0.4;
+      font = "Zeppelin32";
+      size = 0.03521;
+      sizeEx = 0.03521;
+      text = "";
+      soundEnter[] = {"\ca\ui\data\sound\mouse2", 0.09, 1};
+      soundPush[] = {"\ca\ui\data\sound\new1", 0.09, 1};
+      soundClick[] = {"\ca\ui\data\sound\mouse3", 0.07, 1};
+      soundEscape[] = {"\ca\ui\data\sound\mouse1", 0.09, 1};
+      action = "";
+      class Attributes {
+             font = "Zeppelin32";
+             color = "#E5E5E5";
+             align = "left";
+             shadow = "true";
+      };
+      class AttributesImage {
+             font = "Zeppelin32";
+             color = "#E5E5E5";
+             align = "left";
+      };
+};
+
+//-------------------------------------
+class _flexiMenu_RscShortcutButton: RscShortcutButton {
+class HitZone {
+left = 0.002;
+top = 0.003;
+right = 0.002;
+bottom = 0.003; //0.016;
+};
+class ShortcutPos {
+left = -0.006;
+top = -0.007;
+w = 0.0392157;
+h = 2*(safeZoneH/36); //0.0522876;
+};
+class TextPos {
+left = 0.01; // indent
+top = 0.002;
+right = 0.01;
+bottom = 0.002; //0.016;
+};
+};
+//-----------------------------------------------------------------------------
+#include "flexiMenu\data\menu_rose.hpp"
+#include "flexiMenu\data\menu_arma2.hpp"
+#include "flexiMenu\data\menu_buttonList.hpp"
+#include "flexiMenu\data\menu_iconRow.hpp"
+#include "flexiMenu\data\menu_popup.hpp"
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_add.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_add.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_add.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_add.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,51 @@
+//#define DEBUG_MODE_FULL
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private ["_msg", "_exit", "_list", "_i", "_key"];
+// _this = ["player", [DIK_LSHIFT], -3, ["mission\weapon_menuDef.sqf", ["main"]]]
+// Note: calling script may require this file for dik codes: #include "\ca\editor\Data\Scripts\dikCodes.h"
+
+TRACE_1("",_this);
+
+// validate params_msg = format ["Error: invalid params. %1 (%2)", _this, __FILE__];
+if (isNil QUOTE(GVAR(typeMenuSources))) exitWith {diag_log _msg};
+if (typeName _this != typeName []) exitWith {diag_log _msg};
+if (count _this < 4 || count _this > 5) exitWith {diag_log _msg};
+if !(toLower typeName (_this select _flexiMenu_typeMenuSources_ID_type) in [toLower typeName "", toLower typeName []]) exitWith {diag_log _msg};
+if (typeName (_this select _flexiMenu_typeMenuSources_ID_DIKCodes) != typeName []) exitWith {diag_log _msg};
+if (typeName (_this select _flexiMenu_typeMenuSources_ID_priority) != typeName 2) exitWith {diag_log _msg};
+if !(typeName (_this select _flexiMenu_typeMenuSources_ID_menuSource) in [typeName [], typeName ""]) exitWith {diag_log _msg};
+
+// common bug: invalid DIK code (type any) when missing #include "dikCodes.h"
+
+//TODO: still not detecting nil?
+if (({isNil "_x"} count (_this select _flexiMenu_typeMenuSources_ID_DIKCodes)) > 0) exitWith {diag_log _msg};
+
+if (count _this == 4) then {_this set [count _this, true]};
+
+// convert any single key items (eg: DIK_A) into a key array [key, [shift,ctrl,alt]]
+for "_i" from 0 to (count (_this select _flexiMenu_typeMenuSources_ID_DIKCodes) - 1) do {
+	_key = (_this select _flexiMenu_typeMenuSources_ID_DIKCodes) select _i;
+	// if not an already an array (eg: simple DIK integer)
+	if (typeName _key != typeName []) then {
+		_key = [_key, [false,false,false]];
+		(_this select _flexiMenu_typeMenuSources_ID_DIKCodes) set [_i, _key];
+	};
+};
+
+// Check for duplicate record and then warn and ignore.
+if (({str _x == str _this} count (_this select _flexiMenu_typeMenuSources_ID_DIKCodes)) > 0) exitWith {
+	diag_log format ["Warning: duplicate record, ignoring. %1 (%2)", _this, __FILE__];
+};
+
+GVAR(typeMenuSources) set [count GVAR(typeMenuSources), _this];
+[GVAR(typeMenuSources), _flexiMenu_typeMenuSources_ID_priority] call CBA_fnc_sortNestedArray;
+
+// reverse the order of sorting, so highest priority is at the top
+_list = [];
+for "_e" from (count GVAR(typeMenuSources) - 1) to 0 step -1 do {
+	_list set [count _list, GVAR(typeMenuSources) select _e];
+};
+GVAR(typeMenuSources) = _list;
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_execute.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_execute.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_execute.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_execute.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,58 @@
+// TODO: Find a way to reset the caption text after each button click (when _multiReselect is used), to allow caption to update with new status, etc.
+
+// Perform menu action execution along with related menu behaviour changes.
+//-----------------------------------------------------------------------------
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private["_action", "_subMenu", "_multiReselect", "_useListBox", "_subMenuSource", "_params", "_pathName"];
+
+_action = _this select 0;
+_subMenu = _this select 1;
+_multiReselect = _this select 2;
+//-----------------------------------------------------------------------------
+// indicates an option/button was selected, (to allow menu to close upon release of interact key), except if _multiReselect enabled.
+if (_multiReselect == 0) then {
+	GVAR(optionSelected) = true;
+};
+
+// determine optional sub menu source
+_subMenuSource = "";
+_params = ["?"];
+_useListBox = 0;
+if (typeName _subMenu == typeName []) then {
+	IfCountDefault(_subMenuSource,_subMenu,0,"");
+	IfCountDefault(_params,_subMenu,1,[]);
+	IfCountDefault(_useListBox,_subMenu,2,0);
+} else { // else (assume?) it was a string
+	_subMenuSource = _subMenu;
+};
+
+// close menu if needed
+if (_useListBox == 0 && _multiReselect == 0) then { // if using embedded listBox && normal close upon selection
+	closeDialog 0;
+
+	// to prevent any successive user dialogs (activated via menu) from being inadvertantly closed by keyUp EH, set _display to null quickly here.
+	uiNamespace setVariable [QUOTE(GVAR(display)), displayNull]; // manually set here, since onUnload takes too long to complete.
+};
+//-----------------------------------------------------------------------------
+// execute main menu action (unless submenu)
+if (typeName _action == "CODE") then {
+	call _action
+} else {
+	if (_action != "") then {
+		call compile _action;
+	};
+};
+
+// show sub menu
+if (_subMenuSource != "") then {
+	// TODO: Find a way to combine the menu and list scripts together.
+	_pathName = QUOTE(PATHTO_SUB(PREFIX,COMPONENT_F,flexiMenu,%1));
+	_pathName = format [_pathName, if (_useListBox == 0) then {'fnc_menu'} else {'fnc_list'}];
+
+	[GVAR(target), [[_subMenuSource, _params]]] call compile preprocessFileLineNumbers _pathName;
+};
+
+false
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_getMenuDef.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_getMenuDef.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_getMenuDef.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_getMenuDef.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,62 @@
+// Desc: determine menuDef to use, based on variable param variations
+//-----------------------------------------------------------------------------
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private ["_menuDefs", "_target", "_menuSources"];
+
+_target = _this select 0;
+_menuSources = _this select 1; // [_target, _menuSources];
+
+_menuDefs = [];
+
+{ // forEach
+	private ["_params", "_menuSource", "_menuParams", "_array", "_menuDef"]; // declare locally to safe guard variables after _menuSource call, which is beyond our control of correctness.
+
+	_params = _x;
+
+	_menuSource = "";
+	_menuParams = [_target];
+	// Syntax 1
+	if (typeName _params == typeName "") then {
+		_menuSource = _params;
+	};
+	// Syntax 2
+	if (typeName _params == typeName []) then {
+		if (count _params > 0) then {
+			_menuSource = _params select 0;
+			if (typeName _menuSource == typeName "") then {// check for syntax: function, code string or sqf filename
+				_menuParams = if (count _params > 1) then {[_target, _params select 1]};
+			} else {
+				_menuSource = _params;
+			};
+		};
+	};
+	//-----------------------------------------------------------------------------
+	// determine if string represents an executable statement or actual data (via variable).
+	if (typeName _menuSource == typeName []) then {
+		// _menuSource is _menuDefs. a single menuDef array
+		_menuDef = _menuSource;
+	} else {
+		// check which string syntax was used: function, code string or sqf filename
+		_array = toArray _menuSource;
+		_menuDef = if (_array find 46 >= 0 && _array find 34 < 0 && _array find 39 < 0) then { // 46='.',34=("),39=(') (eg: as in 'path\file.sqf')
+			// sqf filename. Eg: 'path\file.sqf'
+			_menuParams call compile preprocessFileLineNumbers _menuSource;
+		} else { // code string. Eg: '_this call someFunction' or '_this call compile preprocessFileLineNumbers "file.sqf"'
+			_menuParams call compile _menuSource;
+		};
+	};
+
+	// merge menuDef's - keeping original header array [0] and merging data array [1]
+	if (count _menuDefs == 0) then {
+		_menuDefs = _menuDef;
+	} else {
+		if (count _menuDef > 0) then {
+			_menuDefs set [1, (_menuDefs select 1) + (_menuDef select 1)];
+		};
+	};
+} forEach _menuSources;
+
+_menuDefs
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_getMenuOption.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_getMenuOption.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_getMenuOption.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_getMenuOption.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,167 @@
+// Desc: parse and set menu option record values
+// _this = [_menuDefs select 0, _menuDefs select 1 select N] (header & one menu def)
+//-----------------------------------------------------------------------------
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "\ca\editor\Data\Scripts\dikCodes.h"
+#include "DIKASCIIMap.hpp"
+
+#define _flexiMenuSeparatorLine "<img image='x\cba\addons\flexiMenu\data\popup\separator.paa'/>"//<t size='1'> </t>  <t underline='true'>a    c</t>
+
+private["_menuDefs0", "_menuDef", "_fastPartialResult",
+	"_result", "_caption", "_action", "_actionOptions", "_icon", "_tooltip", "_subMenu", "_shortcut_DIK", "_visible", "_enabled",
+	"_array", "_index", "_containCaret", "_asciiKey", "_iconFolder", "_multiReselect",
+	"_keyName", "_offset"];
+
+_menuDefs0 = _this select 0;
+_menuDef = _this select 1;
+IfCountDefault(_fastPartialResult,_this,2,false); // return a faster partial result, which ignores CPU intensive code like highlightCaretKey.
+
+IfCountDefault(_iconFolder,_menuDefs0,_flexiMenu_menuProperty_ID_iconFolder,""); // base icon folder (eg: "\ca\ui\data\")
+IfCountDefault(_multiReselect,_menuDefs0,_flexiMenu_menuProperty_ID_multiReselect,0); // menuStayOpenUponSelect: 0/1 type boolean
+if (typeName _multiReselect == typeName true) then {_multiReselect = if (_multiReselect) then {1}else{0}}; // convert boolean to integer
+
+_caption = "";
+IfCountDefault(_action,_menuDef,_flexiMenu_menuDef_ID_action,"");
+_icon = "";
+_tooltip = "";
+IfCountDefault(_subMenu,_menuDef,_flexiMenu_menuDef_ID_subMenuSource,"");
+_shortcut_DIK = -1;
+_enabled = 0;
+_visible = 0;
+//-----------------------------------------------------------------------------
+_caption = _menuDef select _flexiMenu_menuDef_ID_caption;
+IfCountDefault(_shortcut_DIK,_menuDef,_flexiMenu_menuDef_ID_shortcut,-1);
+IfCountDefault(_tooltip,_menuDef,_flexiMenu_menuDef_ID_tooltip,"");
+
+// enabled
+IfCountDefault(_enabled,_menuDef,_flexiMenu_menuDef_ID_enabled,1);
+if (isNil "_enabled") then {
+	hint ("Error logged: 'enabled' menu property returned nil.\n\n" + format["Source data: %1", _this]);
+	ERROR_WITH_TITLE("'enabled' menu property returned nil.", str _this);
+	_enabled = 0;
+	_caption = "Error: " + _caption;
+};
+if (typeName _enabled != typeName 2) then {
+	if (typeName _enabled == typeName "") then {_enabled = parseNumber _enabled}; // allow "0"/"1" like BIS does
+	if (typeName _enabled == typeName true) then {_enabled = if (_enabled) then {1} else {0}}; // convert boolean to number
+};
+
+// visible
+IfCountDefault(_visible,_menuDef,_flexiMenu_menuDef_ID_visible,1);
+if (isNil "_visible") then {
+	hint ("Error logged: 'visible' menu property returned nil.\n\n" + format["Source data: %1", _this]);
+	ERROR_WITH_TITLE("'visible' menu property returned nil.", str _this);
+	_visible = 0;
+	_caption = "Error: " + _caption;
+};
+if (typeName _visible != typeName 2) then {
+	if (typeName _visible == typeName "") then {_visible = parseNumber _visible}; // allow "0"/"1"/"2" like BIS does
+	if (typeName _visible == typeName true) then {_visible = if (_visible) then {1}else{0}}; // convert boolean to number
+};
+
+if (_caption == "-") then {
+	_caption = _flexiMenuSeparatorLine;
+	_enabled = 0;
+};
+//-----------------------------------------------------------------------------
+// search for "^" embedded caption shortcut
+_array = toArray /* toUpper */ _caption;
+
+// find hot key marker char "^"
+_index = _array find 94; // "^"
+_containCaret = (_index >= 0 && _index < (count _array) - 1);
+// ensure a char follows eg: "^S" (i.e. "^" is not last char)
+_asciiKey = -1;
+if (_containCaret) then {
+	_shortcut_DIK = -1; // caret shortcut overrides DIK shortcut, so remove any DIK shortcut (if any)
+	_asciiKey = (toArray toUpper toString [_array select (_index + 1)]) select 0;
+};
+
+if (_enabled != 0 && _visible > 0) then {
+	if (_shortcut_DIK == -1 && _asciiKey != -1) then {
+		// find DIK code based on asciiKey ('Z'->DIK_Z)
+		{
+			if (_x select 0 == _asciiKey) exitWith {_shortcut_DIK = _x select 1}
+		} forEach ICE_DIKASCIIMap;
+	};
+	// mark coloured shortcut letter
+	if (_shortcut_DIK != -1 && !_containCaret) then {
+		// find asciiKey based on DIK code (DIK_Z->'Z')
+		{
+			if (_x select 1 == _shortcut_DIK) exitWith {_asciiKey = _x select 0}
+		} forEach ICE_DIKASCIIMap;
+
+		_index = _array find _asciiKey; // uppercase key
+		if (_index < 0) then {
+			_index = _array find (_asciiKey + 32); // lowercase key
+		};
+	};
+} else {
+	_shortcut_DIK = -1; // disable shortcut for disabled menu options
+	if (_shortcut_DIK != -1) then {player sidechat str [_caption, _shortcut_DIK, _enabled, _visible]};
+};
+
+// remove "^" from caption and substitute coloured shortcut letter if enabled.
+if (_index >= 0) then {
+	if (_enabled != 0) then {
+		private ["_offset"];
+
+#define _ST_highlightKey_attribute "<t color='#f07EB27E'>"
+
+// TODO: Read an appropriate color from the menu class.
+
+		_offset = (if (_containCaret) then {1} else {0});
+		if (!_fastPartialResult) then {
+			_caption = [_array, _index, _offset, _ST_highlightKey_attribute] call FUNC(highlightCaretKey);
+		};
+	} else {
+		_array = _array - [94]; // "^"
+		_caption = toString _array;
+	};
+} else {
+	// map menu shortcut DIK code
+	// Note: don't append shortcut to empty caption, which is usually an "icon only" menu, without text captions.
+	if (_shortcut_DIK != -1 && _caption != "") then {
+		private ["_keyName"];
+		_keyName = keyName _shortcut_DIK;
+		_array = toArray _keyName;
+		if (count _array > 2) then {
+			_array = _array - [34]; // 34=("). Strip off leading and trailing quotes.
+		};
+		_keyName = toString _array;
+
+		// append shortcut key name to caption. Eg: "Option (F9)".
+		_caption = _caption+format[" (%1%2</t>)", _ST_highlightKey_attribute, _keyName];
+	};
+};
+//-----------------------------------------------------------------------------
+IfCountDefault(_icon,_menuDef,_flexiMenu_menuDef_ID_icon,"");
+if (_icon != "" && !_fastPartialResult) then {
+	_array = toArray _icon;
+	// if pathname does not already contain a folder path
+	if (_iconFolder != "" && _array find 92 < 0 && _array find 47 < 0) then { // 92='\', 47='/'
+		_icon = _iconFolder + _icon;
+	};
+	_caption = format ["<img image='%2'/> %1", _caption, _icon];
+};
+//-----------------------------------------------------------------------------
+if (_caption != "") then {
+	_actionOptions = [_action, _subMenu, _multiReselect];
+
+	// TODO: Consider changing _action array item from string to type code.
+	_action = format ["%1 call %2", _actionOptions, QUOTE(FUNC(execute))];
+};
+//-----------------------------------------------------------------------------
+_result = [];
+_result resize _flexiMenu_menuDef_ID_totalIDs;
+_result set [_flexiMenu_menuDef_ID_caption, _caption];
+_result set [_flexiMenu_menuDef_ID_action, _action];
+_result set [_flexiMenu_menuDef_ID_icon, _icon];
+_result set [_flexiMenu_menuDef_ID_tooltip, _tooltip];
+_result set [_flexiMenu_menuDef_ID_subMenuSource, _subMenu];
+_result set [_flexiMenu_menuDef_ID_shortcut, _shortcut_DIK];
+_result set [_flexiMenu_menuDef_ID_enabled, _enabled];
+_result set [_flexiMenu_menuDef_ID_visible, _visible];
+_result
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_highlightCaretKey.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_highlightCaretKey.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_highlightCaretKey.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_highlightCaretKey.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,54 @@
+/*
+This simply performs the equivalent of:
+		_caption =
+			([_caption, _index, _index+_offset] call KRON_StrLeft)+
+			format["%1%2</t>", _ST_highlightKey_attribute, [_caption, _index+_offset, 1] call KRON_StrMid]+
+			([_caption, _index+_offset+1] call KRON_StrMid);
+
+in order to avoid the millions of Deprecated function warnings:
+	WARNING: Deprecated function used: KRON_StrToArray (new: cba_fnc_split) in cba_common
+*/
+
+private ['_array', '_index', '_offset', '_ST_highlightKey_attribute',
+	'_captionArray', '_i', '_len', '_array2'];
+
+_array = _this select 0;
+_index = _this select 1;
+_offset = _this select 2;
+_ST_highlightKey_attribute = _this select 3;
+
+_captionArray = [];
+
+_len = 0;
+
+// ([_caption, _index] call KRON_StrLeft)+
+for "_i" from 0 to (_index - 1) do {
+	_captionArray set [_len, _array select _i];
+	_len = _len + 1;
+};
+
+// format["%1%2</t>", _ST_highlightKey_attribute, [_caption, _index+_offset, 1] call KRON_StrMid]+
+_array2 = toArray _ST_highlightKey_attribute;
+for "_i" from 0 to (count _array2 - 1) do {
+	_captionArray set [_len, _array2 select _i];
+	_len = _len + 1;
+};
+
+for "_i" from (_index + _offset) to (_index + _offset) do {
+	_captionArray set [_len, _array select _i];
+	_len = _len + 1;
+};
+
+_array2 = toArray "</t>";
+for "_i" from 0 to (count _array2 - 1) do {
+	_captionArray set [_len, _array2 select _i];
+	_len = _len + 1;
+};
+
+// ([_caption, _index+_offset+1] call KRON_StrMid);
+for "_i" from (_index + _offset + 1) to (count _array - 1) do {
+	_captionArray set [_len, _array select _i];
+	_len = _len + 1;
+};
+
+(toString _captionArray)
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_keyDown.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_keyDown.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_keyDown.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_keyDown.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,139 @@
+//#define DEBUG_MODE_FULL
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "\ca\editor\Data\Scripts\dikCodes.h"
+
+#define _minObjDist(_var) (if (_var isKindOf "CAManBase") then {3} else {(2 max (1.4+(sizeOf typeOf _var)/2))}) // minimum object interaction distance: arbitrary distance. Might not work with very long/large vehicles. TODO: Find a very fast way to determine vehicle size.
+
+private["_handled", /* "_ctrl", */ "_dikCode", "_shift", "_ctrlKey", "_alt",
+	"_target", "_menuSource", "_active", "_potentialTarget", "_isTypeTarget",
+	"_potentialKeyMatch", "_potentialMenuSources", "_vehicleTarget", "_typesList",
+	"_keys", "_settings"];
+PARAMS_5(_ctrl,_dikCode,_shift,_ctrlKey,_alt);
+
+_handled = false;
+
+// prevent unneeded cpu usage due to key down causing repeated event trigger
+if (time-(GVAR(lastAccessCheck) select 0) < 0.220 && (GVAR(lastAccessCheck) select 1) == _dikCode) exitWith {_handled};
+GVAR(lastAccessCheck) = [time, _dikCode];
+
+TRACE_1("",GVAR(lastAccessCheck));
+
+// scan typeMenuSources key list (optimise overhead)
+_potentialKeyMatch = false;
+{
+	// syntax of _keys: [[_dikCode1, [_shift, _ctrlKey, _alt]], [_dikCode2, [...]], ...]
+	_keys = _x select 1;
+	TRACE_2("",_flexiMenu_typeMenuSources_ID_DIKCodes,_x);
+	{
+		TRACE_5("",_x,_dikCode,_shift,_ctrlKey,_alt);
+		_settings = _x select 1;
+		if ((_x select 0 == _dikCode) &&
+			((!(_settings select 0) && !_shift) || ((_settings select 0) && _shift)) &&
+			((!(_settings select 1) && !_ctrlKey) || ((_settings select 1) && _ctrlKey)) &&
+			((!(_settings select 2) && !_alt) || ((_settings select 2) && _alt))
+		) exitWith {
+			_potentialKeyMatch = true;
+			TRACE_1("",_potentialKeyMatch);
+		};
+	} forEach _keys;
+	TRACE_1("",_potentialKeyMatch);
+	if (_potentialKeyMatch) exitWith {};
+} forEach GVAR(typeMenuSources);
+
+TRACE_1("",_potentialKeyMatch);
+
+// check if interaction key used
+if !(_potentialKeyMatch) exitWith {
+	TRACE_1("No potential keymatch",nil);
+	_handled
+};
+//-----------------------------------------------------------------------------
+if (!GVAR(optionSelected) || !GVAR(holdKeyDown)) then {
+	// check if menu already open
+	_active = (!isNil {uiNamespace getVariable QUOTE(GVAR(display))});
+	if (_active) then {
+		_active = (!isNull (uiNamespace getVariable QUOTE(GVAR(display))));
+	};
+	if (_active) then {
+		if (!GVAR(holdKeyDown)) then {
+			closeDialog 0;
+		};
+	} else {
+		// examine cursor object for relevant menu def variable
+		_target = objNull;
+		_isTypeTarget = false;
+
+		// check for [cursorTarget or "player" or "vehicle"] types in typeMenuSources list
+		_objects = nearestObjects [player, [], 1.5];
+		{
+			(group player) reveal _x;
+		} forEach _objects;
+		_potentialTarget = cursorTarget;
+		if (!isNull _potentialTarget) then {
+			if (_potentialTarget distance player > _minObjDist(_potentialTarget)) then {_potentialTarget = objNull};
+		};
+		_vehicleTarget = vehicle player;
+		
+		if (_vehicleTarget == player) then {_vehicleTarget = objNull};
+
+		_potentialMenuSources = [];
+
+		{ // forEach
+			_potentialKeyMatch = false; // "_actualKeyMatchFound"
+			_keys = _x select 1;
+			{
+				_settings = _x select 1;
+				if ((_x select 0 == _dikCode) &&
+					((!(_settings select 0) && !_shift) || ((_settings select 0) && _shift)) &&
+					((!(_settings select 1) && !_ctrlKey) || ((_settings select 1) && _ctrlKey)) &&
+					((!(_settings select 2) && !_alt) || ((_settings select 2) && _alt)) ) exitWith
+				{
+					_potentialKeyMatch = true;
+				};
+			} forEach _keys;
+
+			if (_potentialKeyMatch) then {
+				if (!alive player && (_x select 4)) exitWith {};
+				_typesList = _x select _flexiMenu_typeMenuSources_ID_type;
+				if (typeName _typesList == "String") then {_typesList = [_typesList]}; // single string type
+
+				if (({_potentialTarget isKindOf _x} count _typesList > 0) || ({_vehicleTarget isKindOf _x} count _typesList > 0) || ("player" in _typesList)) then {
+					if (count _potentialMenuSources == 0) then {
+						_isTypeTarget = true;
+						_target = if ((_vehicleTarget != player) &&
+							({_vehicleTarget isKindOf _x} count _typesList > 0)) then {_vehicleTarget} else {_potentialTarget};
+						if ("player" in _typesList) then {
+							_target = player;
+						};
+					};
+					_potentialMenuSources set [count _potentialMenuSources, _x select _flexiMenu_typeMenuSources_ID_menuSource];
+				};
+			};
+		} forEach GVAR(typeMenuSources);
+
+		if (!isNull _target) then {
+			private ["_menuSources", "_menuSource"]; // sometimes nil
+			_menuSources = [];
+			_menuSource = _target getVariable QUOTE(GVAR(flexiMenu_source));
+			if (isNil "_menuSource") then {_menuSource = []} else {_menuSources set [count _menuSources, _menuSource]};
+
+			{
+				_menuSources set [count _menuSources, _x];
+			} forEach _potentialMenuSources;
+
+			if (count _menuSources > 0) then {
+				// show menu dialog and load menu data
+				GVAR(target) = _target; // global variable used since passing an object as a string is too difficult.
+				[_target, _menuSources] call FUNC(menu);
+				_handled = true;
+			};
+		};
+	};
+} else {
+	TRACE_1("xxx",nil);
+};
+
+TRACE_1("",_handled);
+_handled
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_keyUp.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_keyUp.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_keyUp.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_keyUp.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,51 @@
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "\ca\editor\Data\Scripts\dikCodes.h"
+
+private["_handled", /* "_ctrl", */ "_dikCode", "_shift", "_ctrlKey", "_alt",
+	"_active", "_potentialKeyMatch"];
+
+_dikCode = _this select 1;
+_shift = _this select 2;
+_ctrlKey = _this select 3;
+_alt = _this select 4;
+
+_handled = false;
+
+if (!GVAR(holdKeyDown)) exitWith {_handled}; // key release monitoring not required.
+
+// scan typeMenuSources key list (optimise overhead)
+_potentialKeyMatch = false;
+{
+	// syntax of _keys: [[_dikCode1, [_shift, _ctrlKey, _alt]], [_dikCode2, [...]], ...]
+	_keys = (_x select _flexiMenu_typeMenuSources_ID_DIKCodes);
+	{
+		_settings = _x select 1;
+		if ((_x select 0 == _dikCode) &&
+			((!(_settings select 0) && !_shift) || ((_settings select 0) && _shift)) &&
+			((!(_settings select 1) && !_ctrlKey) || ((_settings select 1) && _ctrlKey)) &&
+			((!(_settings select 2) && !_alt) || ((_settings select 2) && _alt)) ) exitWith
+		{
+			_potentialKeyMatch = true;
+		};
+	} forEach _keys;
+	if (_potentialKeyMatch) exitWith {};
+} forEach GVAR(typeMenuSources);
+
+// check if interaction key used
+if !(_potentialKeyMatch) exitWith {
+	_handled
+};
+//-----------------------------------------------------------------------------
+_active = (!isNil {uiNamespace getVariable QUOTE(GVAR(display))});
+if (_active) then {
+	_active = (!isNull (uiNamespace getVariable QUOTE(GVAR(display))));
+};
+if (_active) then {
+	closeDialog 0;
+	_handled = true;
+};
+GVAR(optionSelected) = false;
+
+_handled
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_list.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_list.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_list.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_list.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,115 @@
+disableSerialization;
+// Desc: Fill and show an embedded listbox on dialog menu.
+//-----------------------------------------------------------------------------
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private ["_menuSources", "_menuDefs", "_idc", "_iconFolder"];
+private["_menuOption", "_caption", "_action", "_icon", "_tooltip", "_shortcut_DIK", "_visible", "_enabled", "_array"];
+
+_menuDefs = _this call FUNC(getMenuDef);
+//-----------------------------------------------------------------------------
+// replace primary menu's key EH and menuDefs with same key EH but using secondary menu's menuDefs
+private "_disp";
+_disp = uiNamespace getVariable QUOTE(GVAR(display));
+_disp displayRemoveEventHandler ["keyDown", GVAR(keyDownEHID)];
+_menuSources = _this select 1;
+GVAR(keyDownEHID) = _disp displayAddEventHandler ["keyDown",
+	format ["[_this, [%1, %2]] call %3", QUOTE(GVAR(target)), _menuSources, QUOTE(FUNC(menuShortcut))]];
+
+_caption = if (count (_menuDefs select 0) > _flexiMenu_menuProperty_ID_menuDesc) then {_menuDefs select 0 select _flexiMenu_menuProperty_ID_menuDesc} else {""};
+(_disp displayCtrl _flexiMenu_IDC_listMenuDesc) ctrlSetText _caption;
+
+_iconFolder = if (count (_menuDefs select 0) > _flexiMenu_menuProperty_ID_iconFolder) then {_menuDefs select 0 select _flexiMenu_menuProperty_ID_iconFolder} else {""}; // base icon folder (eg: "\ca\ui\data\")
+//-----------------------------------------------------------------------------
+_menuRsc = _menuDefs select 0 select _flexiMenu_menuProperty_ID_menuResource;
+if (typeName _menuRsc != typeName "") exitWith {diag_log format ["%1: Invalid params c4: %2", __FILE__, _this]};
+if (!isClass (configFile >> _menuRsc)) then { // if not a full class name
+	if (!isClass (missionConfigFile >> _menuRsc)) then { // if not a full class name
+		_menuRsc = _menuRscPrefix + _menuRsc; // attach standard flexi menu prefix
+	};
+};
+
+// TODO: Support missionConfigFile too
+_width = getNumber(ConfigFile >> _menuRsc >> "flexiMenu_subMenuCaptionWidth");
+if (_width == 0) then {
+	player sideChat format ["Error: missing flexiMenu_subMenuCaptionWidth: %1", _menuRsc];
+	_width = _SMW;
+};
+
+_idc = _flexiMenu_IDC_listMenuDesc;
+_ctrl = _disp displayCtrl _idc;
+_array = ctrlPosition _ctrl;
+if ({_x == 0} count _array != 4) then {
+	if (_array select 2 == 0) then {
+		_array = [_array select 0, _array select 1, _width, _array select 3];
+		_ctrl ctrlSetPosition _array;
+
+		_ctrl ctrlCommit 0; // commit pos/size before showing
+	};
+};
+_ctrl ctrlShow true;
+
+// TODO: For merged menus, _menuRsc must come from the first merged menu, not secondary.
+_width = getNumber(configFile >> _menuRsc >> "flexiMenu_subMenuControlWidth");
+if (_width == 0) then {
+	_width = getNumber(missionConfigFile >> _menuRsc >> "flexiMenu_subMenuControlWidth");
+	if (_width == 0) then {
+		player sideChat format ["Error: missing flexiMenu_subMenuControlWidth: %1", _menuRsc];
+		_width = _SMW;
+	};
+};
+
+_idc = _flexiMenu_baseIDC_listButton;
+//-----------------------------------------------------------------------------
+{ // forEach
+	_menuOption = [_menuDefs select 0, _x] call FUNC(getMenuOption);
+
+	_caption = _menuOption select _flexiMenu_menuDef_ID_caption;
+	_action = _menuOption select _flexiMenu_menuDef_ID_action;
+	_icon = _menuOption select _flexiMenu_menuDef_ID_icon;
+	_tooltip = _menuOption select _flexiMenu_menuDef_ID_tooltip;
+	_subMenu = _menuOption select _flexiMenu_menuDef_ID_subMenuSource;
+	_shortcut_DIK = _menuOption select _flexiMenu_menuDef_ID_shortcut;
+	_enabled = _menuOption select _flexiMenu_menuDef_ID_enabled;
+	_visible = _menuOption select _flexiMenu_menuDef_ID_visible;
+
+	_ctrl = _disp displayCtrl _idc;
+	_array = ctrlPosition _ctrl;
+
+	if ({_x == 0} count _array == 4) then {
+		if (!isNull _disp) exitWith {
+			diag_log format ["Warning: Too many menu items or missing List button control: %1",
+				[_menuRsc, _idc, _caption]]
+		};
+	} else {
+		if (_array select 2 == 0) then {
+			_array = [_array select 0, _array select 1, _width, _array select 3];
+			_ctrl ctrlSetPosition _array;
+		};
+	};
+
+	_ctrl ctrlSetStructuredText parseText _caption;
+	_ctrl ctrlSetToolTip _tooltip;
+	_ctrl buttonSetAction _action;
+
+	_ctrl ctrlCommit 0; // commit pos/size before showing
+
+	_ctrl ctrlShow (_visible > 0);
+	_ctrl ctrlEnable (_enabled != 0);
+
+	if (_visible != 0) then { // i.e. in [-1,1]
+		_idc = _idc + 1;
+	}; // else if (_visible == 0) then {re-use hidden button idc}
+} forEach (_menuDefs select 1);
+//-----------------------------------------------------------------------------
+// hide and disable unused list buttons
+for "_i" from _idc to (_flexiMenu_baseIDC_listButton + _flexiMenu_maxButtons - 1) do {
+	_ctrl = _disp displayCtrl _i;
+	_ctrl ctrlShow false;
+	_ctrl ctrlEnable false;
+};
+//-----------------------------------------------------------------------------
+_idc = _flexiMenu_baseIDC_listButton;
+ctrlSetFocus (_disp displayCtrl _idc);
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_menu.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_menu.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_menu.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_menu.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,229 @@
+disableSerialization;
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+//-----------------------------------------------------------------------------
+// TODO: Menu string parameter substitutions. Eg: _action="[%ID%] call func". Eg: %ID%,<ID>
+// TODO: Consider adding: a base IDC override value.
+// TODO: Consider adding: a max buttons override value.
+// TODO: Consider adding: x,y menu offsets override values.
+// TODO: Consider adding: auto centering x,y menu offsets. Each menu dialog may need it's own center.sqf script.
+// TODO: Consider adding: menu properties source value.
+// TODO: Consider adding: "stay open" menu or menu option property (see menuStayOpenUponSelect), eg: for NV adjustment or VD adjustment, etc. TODO: Clarify: presumably upon releasing interact key. Close with right click.
+// TODO: Consider adding: pass parameters [object, caller] to action
+// TODO: Consider adding: object menu interaction radius (similar to userAction class). (Specify where?)
+// TODO: Bug: the rsc of curr menu is not properly passed on to list menu, whereby default menu param gets used instead (if different).
+// TODO (half done): Refactor: the dialog display speed has deteriorated with the inclusion of shortcut handling and 'clean drawing'. Investigate possible performance improvements. Replace KRON string functions maybe.
+// TODO high: Consider adding: "default menu source" in first array of menu def (same as "optional icon folder") to allow nominated (usually same) menu file to be re-used for same section of menu tree.
+// TODO: how to distinguish external/internal vehicle actions
+// TODO medium/easy: Support missionConfigFile too
+// TODO high: add in menu priority, similar to addAction
+// TODO: if using multiple merged _menuSources, then it may need a "doMerge" or "priorityOne" option(s) to avoid merging in special cases.
+// TODO: _minObjectInteractionDistance: Find a very fast way to determine vehicle size and orientation to calc suitable dist.
+
+// Desc: Determine which menu resource to display. Create and init the menu using menu def's param.
+// Pass optional paramters (if used) to determine which menu to use and/or alter it's properties.
+
+// Note: Side effect of merging menus is that only the header of the first menu is retained.
+// TODO: Losing secondary headers will lose things like iconFolder. Perhaps auto merge into menuOptions in advance.
+// TODO: Somehow handle shortcut clashes between merged menus. Currently it will simply use first found entry.
+//-----------------------------------------------------------------------------
+// See http://dev-heaven.net/projects/cca/wiki/FlexiMenu for array syntax info.
+
+// Notes: CBA_UI_fnc_setObjectMenuSource allows you to assign a menu source to a particular object. It will add an object variable called QUOTE(GVAR(flexiMenu_source)) containing the menu source.
+//-----------------------------------------------------------------------------
+// Syntax 1: _source
+//   _this = menu definition source string
+//   Eg 1.1: sqf filename. Eg: 'path\file.sqf'
+//   Eg 1.2: 'call function' code string. Eg: '_this call someFunction'
+//   Eg 1.3: 'call compile' code string. Eg: '_this call compile preprocessFileLineNumbers "file.sqf"'
+// Syntax 2: globalSingleMenuDef array
+// ToDo: Consider deleting this syntax.
+//   _this = single menu definition array
+//   Eg 2: array. Eg: [["menu properties...", ...], [["", "", "", "", "", -1, 1, 1], ...]]
+// Syntax 3: [_source, _params]
+//   _this select 0 = menu definition source string
+//   _this select 1 = optional menu script parameters (type: any, syntax: any). Eg: ['menu name', 'menu resource name']
+//   Eg 3: array: [menu definition source string, paramters]. Eg: ["mission\ammoCrate_menuDef.sqf", ["main", _menuRsc]]
+//-----------------------------------------------------------------------------
+/* submenu is either:
+	a menuDef array variable, - typeName "array"
+	"_this call function", - typeName "string" - space but no dot, nor quotes
+	"_this call compile preprocessFileLineNumbers 'mission\sys_crewserved_menuDef.sqf'" - typeName "string" - dot and space and embedded quotes
+	"mission\sys_crewserved_subMenu1.sqf" - typeName "string" - dot and no space, nor quotes
+*/
+// General menu definition syntax:
+// Note: subMenu follows the _source syntax above
+/*
+[
+	["Menu Caption", "flexiMenu resource dialog", "optional icon folder", menuStayOpenUponSelect],
+	[
+		[
+			"caption",
+			"action",
+			"icon",
+			"tooltip",
+			{"submenu"|["menuName", "", {0/1} (optional - use embedded list menu)]},
+			-1 (shortcut DIK code), // TODO: Allow string ("Z") type shortcut designation
+			{0|1/"0"|"1"/false|true} (enabled),
+			{-1|0|1/"-1"|"0"|"1"/false|true} (visible, -1 is special case for reserved hidden button)]
+	]
+]
+Note: visible allows value -1 (instead of 0) to make the current button be re-used for the next menu item, rather than hidden and left as a gap. It is dependent on the design of the menu dialog used.
+*/
+
+// For each menu option, only the caption and action are required paramters. The other parameters are optional.
+/*
+[
+	["Menu Name": type Any, "Menu Caption": string, "menu dialog class or suffix id": string, "\ca\ui\data\": string, "menuStayOpenUponSelect": boolean],
+	[
+		["caption 1", "player sideChat 'selected option 1'", "iconplane_ca.paa", "hint 1", "", -1, 1, 1],
+		...
+	]
+]
+*/
+//-----------------------------------------------------------------------------
+private ["_valid", "_menuSources", "_menuDefs", "_menuParams", "_menuRsc", "_array", "_i", 	"_t", "_w", "_idcIndex", "_idc"];
+private ["_caption", "_action", "_icon", "_subMenu", "_tooltip", "_shortcut_DIK", "_visible", "_enabled"];
+private ["_params", "_useListBox", "_menuOption", "_commitList", "_menuRscPrefix", "_source", "_width", "_list"];
+
+#define _MenuOption_NoOptions ["No options", "<No options>", "", "", "", -1, 0, 1]
+
+//-----------------------------------------------------------------------------
+if !(typeName _this in [typeName [], typeName ""]) exitWith {diag_log format ["%1: Invalid params type: %2", __FILE__, _this]};
+
+_menuDefs = _this call FUNC(getMenuDef);
+//-----------------------------------------------------------------------------
+if (typeName _menuDefs != typeName []) exitWith {diag_log format ["%1: Invalid params c5: %2", __FILE__, _this]};
+if (count _menuDefs == 0) exitWith {diag_log format ["%1: Invalid params c1: %2", __FILE__, _this]};
+if (count _menuDefs < 2) exitWith {diag_log format ["%1: Invalid params c2: %2", __FILE__, _this]};
+if (count (_menuDefs select 0) <= _flexiMenu_menuProperty_ID_menuResource) exitWith {diag_log format ["%1: Invalid params c3: %2", __FILE__, _this]};
+_menuRsc = _menuDefs select 0 select _flexiMenu_menuProperty_ID_menuResource; // determine which dialog to show
+
+if (typeName _menuRsc != typeName "") exitWith {diag_log format ["%1: Invalid params c4: %2", __FILE__, _this]};
+if (!isClass (configFile >> _menuRsc)) then { // if not a full class name
+	if (!isClass (missionConfigFile >> _menuRsc)) then { // if not a full class name
+		_menuRsc = _menuRscPrefix+_menuRsc; // attach standard flexi menu prefix
+	};
+};
+if (!createDialog _menuRsc) exitWith {hint format ["%1: createDialog failed: %2", __FILE__, _menuRsc]};
+setMousePosition [0.5, 0.5];
+
+private "_disp";
+_disp = uiNamespace getVariable QUOTE(GVAR(display));
+
+IfCountDefault(_caption,(_menuDefs select 0),_flexiMenu_menuProperty_ID_menuDesc,"");
+(_disp displayCtrl _flexiMenu_IDC_menuDesc) ctrlSetText _caption;
+
+// initially list caption
+(_disp displayCtrl _flexiMenu_IDC_listMenuDesc) ctrlShow false;
+
+_menuSources = _this select 1;
+GVAR(keyDownEHID) = _disp displayAddEventHandler ["keyDown", format ["[_this, [%1, %2]] call %3", QUOTE(GVAR(target)), _menuSources, QUOTE(FUNC(menuShortcut))]];
+
+_disp displayAddEventHandler ["mouseButtonDown", format ["_this call %1", QUOTE(FUNC(mouseButtonDown))]];
+
+_idcIndex = 0;
+
+_width = getNumber(configFile >> _menuRsc >> "flexiMenu_primaryMenuControlWidth");
+if (_width == 0) then {
+	_width = getNumber(missionConfigFile >> _menuRsc >> "flexiMenu_primaryMenuControlWidth");
+	if (_width == 0) then {
+		player sideChat format ["Error: missing flexiMenu_primaryMenuControlWidth: %1", _menuRsc];
+		_width = _SMW;
+	};
+};
+
+//-----------------------------------------------------------------------------
+_commitList = [];
+{ // forEach
+	if (count _x >= 2) then { // all essential array items exist
+		_idc = _flexiMenu_baseIDC_button + _idcIndex;
+		_menuOption = [_menuDefs select 0, _x] call FUNC(getMenuOption);
+
+		_caption = _menuOption select _flexiMenu_menuDef_ID_caption;
+		_action = _menuOption select _flexiMenu_menuDef_ID_action;
+		_icon = _menuOption select _flexiMenu_menuDef_ID_icon;
+		_tooltip = _menuOption select _flexiMenu_menuDef_ID_tooltip;
+		_subMenu = _menuOption select _flexiMenu_menuDef_ID_subMenuSource;
+		_shortcut_DIK = _menuOption select _flexiMenu_menuDef_ID_shortcut;
+		_enabled = _menuOption select _flexiMenu_menuDef_ID_enabled;
+		_visible = _menuOption select _flexiMenu_menuDef_ID_visible;
+
+		if (_caption != "" && (_caption != "No options" || _idcIndex == 0)) then {
+			_ctrl = _disp displayCtrl _idc;
+			_array = ctrlPosition _ctrl;
+			if ({_x == 0} count _array == 4) then {
+				if (!isNull _disp) exitWith {
+					diag_log format ["Warning: Too many menu items or missing Menu button control: %1", [_menuRsc, _idc, _caption]]
+				};
+			} else {
+				if (_array select 2 == 0) then {
+					_array = [_array select 0, _array select 1, _width, _array select 3];
+					_ctrl ctrlSetPosition _array;
+				};
+			};
+
+			_ctrl ctrlCommit 0; // commit pos/size before showing
+
+			_ctrl ctrlSetStructuredText parseText _caption;
+			_ctrl ctrlSetToolTip _tooltip;
+			buttonSetAction [_idc, _action];
+
+			_commitList set [count _commitList, [_idc, _enabled, _visible]];
+
+			// _visible==1 means: button used, go to next button.
+			// _visible==0 means: button hidden and unused, so re-use this idc for next menu option.
+			// _visible==-1 means: button hidden but reserved, so skip this idc and use next idc for next menu option.
+			if (_visible != 0) then { // i.e. in [-1,1]
+				_idcIndex = _idcIndex + 1;
+			};
+		};
+	};
+} forEach (_menuDefs select 1) + [_MenuOption_NoOptions];
+//-----------------------------------------------------------------------------
+// if no menu options are shown/applicable
+if (_idcIndex == 0) then {
+	// TODO: This block is duplicate code from above. Find a tidy way to merge this back with code above, by adding fake "No options" menu option.
+	_idc = _flexiMenu_baseIDC_button + _idcIndex;
+	_ctrl = _disp displayCtrl _idc;
+	_array = ctrlPosition _ctrl;
+	if (_array select 2 == 0) then {
+		_array = [_array select 0, _array select 1, _width, _array select 3];
+		_ctrl ctrlSetPosition _array;
+	};
+	_ctrl ctrlCommit 0; // commit pos/size before showing
+	_ctrl ctrlSetStructuredText parseText "No options";
+	_commitList set [count _commitList, [_idc, 0, 1]];
+	_idcIndex = _idcIndex + 1;
+};
+
+// handle odd case where uncommitted controls are not shown
+{
+	_t = time;
+	_idc = _x select 0;
+	if (!ctrlCommitted (_disp displayCtrl _idc)) then {
+		waitUntil {ctrlCommitted (_disp displayCtrl _idc) || time > _t + 1.9};
+	};
+	_enabled = _x select 1;
+	_visible = _x select 2;
+	ctrlShow [_idc, (_visible > 0)];
+	ctrlEnable [_idc, (_enabled != 0)];
+} forEach _commitList;
+
+// hide and disable unused buttons
+// Note: BIS bug: you still need to disable hidden RscShortcutButton(s) because you can tab to them otherwise!
+for "_i" from _idcIndex to (_flexiMenu_maxButtons - 1) do {
+	_idc = _flexiMenu_baseIDC_button + _i;
+	_ctrl = _disp displayCtrl _idc;
+	_ctrl ctrlShow false;
+	_ctrl ctrlEnable false;
+};
+
+// hide and disable unused list buttons
+for "_i" from 0 to (_flexiMenu_maxButtons - 1) do {
+	_idc = _flexiMenu_baseIDC_listButton + _i;
+	_ctrl = _disp displayCtrl _idc;
+	_ctrl ctrlShow false;
+	_ctrl ctrlEnable false;
+};
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_menuShortcut.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_menuShortcut.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_menuShortcut.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_menuShortcut.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,56 @@
+// Desc: "keyDown" EH for menu dialog
+//-----------------------------------------------------------------------------
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#include "\ca\editor\Data\Scripts\dikCodes.h"
+
+if (isDedicated || !dialog) exitWith {};
+
+private['_handled', '_EHParams', '_control', '_dikCode', '_shiftKey', '_ctrlKey', '_altKey'];
+private['_menuDefs', "_caption", "_action", "_icon", "_tooltip", "_subMenu", "_shortcut", "_visible", "_enabled"];
+_EHParams = _this select 0;
+
+_control = _EHParams select 0;
+_dikCode = _EHParams select 1;
+_shiftKey = _EHParams select 2;
+_ctrlKey = _EHParams select 3;
+_altKey = _EHParams select 4;
+
+_handled = false;
+
+// prevent unneeded cpu usage due to key down causing repeated event trigger
+if (GVAR(holdKeyDown)) then {
+	if (time - (GVAR(lastAccessCheck) select 0) < 0.220 && (GVAR(lastAccessCheck) select 1) == _dikCode) exitWith {_handled};
+	GVAR(lastAccessCheck) = [time, _dikCode];
+};
+
+if (!GVAR(holdKeyDown) && (_dikCode in (actionKeys "menuBack"))) exitWith {
+	closeDialog 0;
+	true
+};
+
+_menuDefs = (_this select 1) call FUNC(getMenuDef);
+//-----------------------------------------------------------------------------
+{ // forEach
+	_menuOption = [_menuDefs select 0, _x, true] call FUNC(getMenuOption); // get fast partial record
+
+	//_caption = _menuOption select _flexiMenu_menuDef_ID_caption;
+	//_action = _menuOption select _flexiMenu_menuDef_ID_action;
+	//_icon = _menuOption select _flexiMenu_menuDef_ID_icon;
+	//_tooltip = _menuOption select _flexiMenu_menuDef_ID_tooltip;
+	//_subMenu = _menuOption select _flexiMenu_menuDef_ID_subMenuSource;
+	_shortcut = _menuOption select _flexiMenu_menuDef_ID_shortcut;
+	_enabled = _menuOption select _flexiMenu_menuDef_ID_enabled;
+	_visible = _menuOption select _flexiMenu_menuDef_ID_visible;
+
+	if (_dikCode == _shortcut && _enabled != 0 && _visible > 0) exitWith {
+		_menuOption = [_menuDefs select 0, _x, false] call FUNC(getMenuOption); // get complete same record
+		_action = _menuOption select _flexiMenu_menuDef_ID_action;
+
+		if (typeName _action == "CODE") then {call _action} else {call compile _action};
+		_handled = true;
+	};
+} forEach (_menuDefs select 1);
+
+_handled
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_mouseButtonDown.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_mouseButtonDown.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_mouseButtonDown.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_mouseButtonDown.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,37 @@
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+#define _rightMouseButton 1
+
+//private["_display", "_button", "_x", "_y", "_shiftKey", "_ctrlKey", "_altKey"]; // event params
+private["_button", "_shiftKey"]; // event params
+
+//_display = _this select 0;
+_button = _this select 1;
+//_x = _this select 2;
+//_y = _this select 3;
+_shiftKey = _this select 4;
+//_ctrlKey = _this select 5;
+//_altKey = _this select 6;
+
+_handled = false;
+
+// right click to close menu
+if (!GVAR(holdKeyDown) && _button == _rightMouseButton && !_shiftKey) then {
+	if (dialog) then {
+		closeDialog 0;
+		_handled = true;
+	};
+};
+
+// [interactKey]+shift+right click to toggle menu lock
+if (_button == _rightMouseButton && _shiftKey) then {
+	GVAR(holdKeyDown) = !GVAR(holdKeyDown);
+	hint format["Menu lock toggled %1", (if (GVAR(holdKeyDown)) then {"off"} else {"on"})];
+	if (dialog) then {
+		closeDialog 0;
+	};
+	_handled = true;
+};
+
+_handled // result
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_remove.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_remove.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_remove.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_remove.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,28 @@
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private ['_msg', '_i'];
+
+// _this = ["player", [DIK_LSHIFT], -3, ["mission\weapon_menuDef.sqf", ["main"]]]
+
+// validate params
+_msg = format ["Error: invalid params. %1 (%2)", _this, __FILE__];
+if (isNil QUOTE(GVAR(typeMenuSources))) exitWith {diag_log _msg};
+if (typeName _this != typeName []) exitWith {diag_log _msg};
+if (count _this != 4) exitWith {diag_log _msg};
+if !(toLower typeName (_this select _flexiMenu_typeMenuSources_ID_type) in [toLower typeName "", toLower typeName []]) exitWith {diag_log _msg};
+if (typeName (_this select _flexiMenu_typeMenuSources_ID_DIKCodes) != typeName []) exitWith {diag_log _msg};
+if (typeName (_this select _flexiMenu_typeMenuSources_ID_priority) != typeName 2) exitWith {diag_log _msg};
+if !(typeName (_this select _flexiMenu_typeMenuSources_ID_menuSource) in [typeName [], typeName ""]) exitWith {diag_log _msg};
+
+_i = 0;
+{
+	if (str _x == str _this) then {
+		GVAR(typeMenuSources) set [_i, -1];
+		_x = -1;
+	};
+	_i = _i + 1;
+} forEach GVAR(typeMenuSources);
+
+GVAR(typeMenuSources) = GVAR(typeMenuSources) - [-1];
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_setObjectMenuSource.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_setObjectMenuSource.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_fnc_setObjectMenuSource.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_fnc_setObjectMenuSource.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,6 @@
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+// params: [_object, menuSource]
+(_this select 0) setVariable [QUOTE(GVAR(flexiMenu_source)), (_this select 1)];
diff -rupN BASE_MISSION/x/cba/addons/ui_flexiMenu_init.sqf BASE_A2Free/x/cba/addons/ui_flexiMenu_init.sqf
--- BASE_MISSION/x/cba/addons/ui_flexiMenu_init.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_flexiMenu_init.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,44 @@
+#include "ui_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+if (isDedicated) exitWith {false};
+
+// list of all menu activation keys and associated types
+GVAR(typeMenuSources) = []; // types, keys and menu sources data
+GVAR(target) = objNull; // current object for interaction
+GVAR(holdKeyDown) = false; // default global behaviour of requiring holding key down. Can be overriden by menus.
+
+PREP_SUB(flexiMenu,keyDown);
+PREP_SUB(flexiMenu,keyUp);
+PREP_SUB(flexiMenu,menu);
+PREP_SUB(flexiMenu,list);
+PREP_SUB(flexiMenu,getMenuDef);
+PREP_SUB(flexiMenu,getMenuOption);
+PREP_SUB(flexiMenu,menuShortcut);
+PREP_SUB(flexiMenu,mouseButtonDown);
+PREP_SUB(flexiMenu,highlightCaretKey);
+PREP_SUB(flexiMenu,execute);
+
+// TODO: move these to public CfgFunctions soon.
+PREP_SUB(flexiMenu,add);
+PREP_SUB(flexiMenu,remove);
+PREP_SUB(flexiMenu,setObjectMenuSource);
+
+// prevent instant reactivation of menu after selection was made, while key still held down. Value is reset upon key release.
+GVAR(optionSelected) = false;
+// prevent multiple activations of menu due to key press via keyDown. onLoad can sometimes take a few milliseconds to init.
+GVAR(lastAccessCheck) = [0, -1];
+
+[] spawn {
+	// !isDedicated checked at top
+	waitUntil {!isNull (findDisplay 46)}; // CBA_fnc_addDisplayHandler is still dodgy
+
+	GVAR(keyDown_EHID) = ["keyDown", QUOTE(_this call FUNC(keyDown))] call CBA_fnc_addDisplayHandler;
+	GVAR(keyUp_EHID) = ["keyUp", QUOTE(_this call FUNC(keyUp))] call CBA_fnc_addDisplayHandler;
+};
+
+//GVAR(keyDown_EHID) = ["keyDown", QUOTE(_this call FUNC(keyDown))] call CBA_fnc_addDisplayHandler;
+//GVAR(keyUp_EHID) = ["keyUp", QUOTE(_this call FUNC(keyUp))] call CBA_fnc_addDisplayHandler;
+
+true;
diff -rupN BASE_MISSION/x/cba/addons/ui_script_component.hpp BASE_A2Free/x/cba/addons/ui_script_component.hpp
--- BASE_MISSION/x/cba/addons/ui_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/ui_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,77 @@
+#define COMPONENT ui
+#include "script_mod.hpp"
+
+//#define DEBUG_ENABLED_UI
+
+#ifdef DEBUG_ENABLED_UI
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_UI
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_UI
+#endif
+
+#include "script_macros.hpp"
+
+// #include "\x\cba\addons\ui\flexiMenu\data\common.hpp"
+
+// this is a duplicate #define which should match the one in script_component.hpp
+#define _flexiMenu_useSlowCleanDrawMode
+
+//#define _flexiMenu_IDD 406
+
+#define _flexiMenu_maxButtons 30
+#define _flexiMenu_maxListButtons 30
+
+#define _flexiMenu_IDC_menuDesc 230
+#define _flexiMenu_IDC_listMenuDesc 231
+
+// Base IDC value of first button.
+#define _flexiMenu_baseIDC_button 240
+// Successive buttons are numbered in sequence from base IDC value.
+// _flexiMenu_maxButtons represents theoretical maximum IDC value. Each dialog determines this upper limit itself.
+// The reserved range of IDC's is from: _flexiMenu_baseIDC_button to (_flexiMenu_baseIDC_button+_flexiMenu_maxButtons-1).
+
+// Base IDC value of first list button.
+#define _flexiMenu_baseIDC_listButton 340
+
+#define _flexiMenu_typeMenuSources_ID_type 0
+#define _flexiMenu_typeMenuSources_ID_DIKCodes 1
+#define _flexiMenu_typeMenuSources_ID_priority 2
+#define _flexiMenu_typeMenuSources_ID_menuSource 3
+
+#define _flexiMenu_menuProperty_ID_menuName 0
+#define _flexiMenu_menuProperty_ID_menuDesc 1
+#define _flexiMenu_menuProperty_ID_menuResource 2
+#define _flexiMenu_menuProperty_ID_iconFolder 3
+#define _flexiMenu_menuProperty_ID_multiReselect 4
+
+#define _flexiMenu_menuDef_ID_caption 0
+#define _flexiMenu_menuDef_ID_action 1
+#define _flexiMenu_menuDef_ID_icon 2
+#define _flexiMenu_menuDef_ID_tooltip 3
+#define _flexiMenu_menuDef_ID_subMenuSource 4
+#define _flexiMenu_menuDef_ID_shortcut 5
+#define _flexiMenu_menuDef_ID_enabled 6
+#define _flexiMenu_menuDef_ID_visible 7
+#define _flexiMenu_menuDef_ID_totalIDs 8
+
+#define _menuRscPrefix "CBA_flexiMenu_rsc"
+
+#define _flexiMenu_path QUOTE(PATHTOF(flexiMenu))
+//#define _eval_action(_param) __EVAL(format ["[%2] execVM '%1\action.sqf'", _flexiMenu_path, ##_param])
+
+#define _SMW 0.15*safeZoneW // common sub-menu width
+
+#define _LBH 0.033*safeZoneH // list button height
+
+
+// additional "_SUB" macros to handle sub folders
+#define PATHTO_SUB(var1,var2,var3,var4) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3##_##var4.sqf
+#define COMPILE_FILE_SUB(var1,var2,var3,var4) compile preProcessFileLineNumbers 'PATHTO_SUB(var1,var2,var3,var4)'
+#define PREP_SYS_SUB(var1,var2,var3,var4) ##var1##_##var2##_fnc_##var4 = COMPILE_FILE_SUB(var1,var2,var3,DOUBLES(fnc,var4))
+#define PREP_SUB(var1,var2) PREP_SYS_SUB(PREFIX,COMPONENT_F,var1,var2)
+
+// array select with bounds check (for optional parameters)
+#define IfCountDefault(var1,array2,index3,default4) ##var1 = if (count ##array2 > ##index3) then { ##array2 select ##index3 } else { ##default4 };
+
diff -rupN BASE_MISSION/x/cba/addons/vectors_XEH_preInit.sqf BASE_A2Free/x/cba/addons/vectors_XEH_preInit.sqf
--- BASE_MISSION/x/cba/addons/vectors_XEH_preInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_XEH_preInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,16 @@
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(XEH_preInit);
+
+ADDON = false;
+
+DEPRECATE_SYS(DOUBLES(PREFIX,fnc_vectSubtract),BIS_fnc_vectorDiff);
+DEPRECATE_SYS(DOUBLES(PREFIX,fnc_vectCross),BIS_fnc_crossProduct);
+DEPRECATE_SYS(DOUBLES(PREFIX,fnc_vectDot),BIS_fnc_dotProduct);
+DEPRECATE_SYS(DOUBLES(PREFIX,fnc_vectMagn2D),BIS_fnc_magnitude);
+DEPRECATE_SYS(DOUBLES(PREFIX,fnc_vectMagn),BIS_fnc_magnitude);
+DEPRECATE_SYS(DOUBLES(PREFIX,fnc_vectAdd),BIS_fnc_vectorAdd);
+
+// Announce initialization complete
+ADDON = true;
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_polar2vect.sqf BASE_A2Free/x/cba/addons/vectors_fnc_polar2vect.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_polar2vect.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_polar2vect.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,41 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_polar2vect
+
+Description:
+ Creates a vector based on a inputted magnitude, direction and elevation
+
+Parameters:
+ _mag the magnitude of the vector to create
+ _dir the direction of the vector to create
+ _elev the elevation of the vector to create
+
+Returns:
+ a vector in the form [x,z,y].
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_polar2vect.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(polar2vect);
+
+
+ private ["_mag", "_dir", "_elev", "_magCosElev", "_vx", "_vy", "_vz"];
+
+PARAMS_3(_mag,_dir,_elev);
+
+_magCosElev = _mag * cos(_elev);
+
+_vx = _magCosElev * sin(_dir);
+_vz = _magCosElev * cos(_dir);
+_vy = _mag * sin(_elev);
+
+[_vx, _vz, _vy];
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_scaleVect.sqf BASE_A2Free/x/cba/addons/vectors_fnc_scaleVect.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_scaleVect.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_scaleVect.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,38 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_scaleVect
+
+Description:
+ scales a specified vector by a specified factor.
+
+Parameters:
+ _vect the vector to scale.
+ _factor the scale factor.
+
+Returns:
+ a vector in the form [x, z, y] which represents the scaled initial vector.
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_scaleVect.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(scaleVect);
+
+
+ private ["_vect","_factor","_i","_k", "_j"];
+
+PARAMS_2(_vect,_factor);
+
+_i = _factor * (_vect select 0);
+_k = _factor * (_vect select 1);
+_j = _factor * (_vect select 2);
+
+[_i, _k, _j];
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_scaleVectTo.sqf BASE_A2Free/x/cba/addons/vectors_fnc_scaleVectTo.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_scaleVectTo.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_scaleVectTo.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,39 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_scaleVectTo
+
+Description:
+ scales a vector so that its new Magnitude is equivalent to a specified value.
+
+Parameters:
+ _vect the vector to scale.
+ _newMagVal the value of the magnitude of the new scaled vector.
+
+Returns:
+ a vector which has the same direction and elevation as the original vector, but which has a specified magnitude.
+
+Examples:
+	(begin example)
+
+	(end)
+
+*  @[not needed yet]*  @call sct_simplifyAngle.sqf
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_scaleVectTo.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(scaleVectTo);
+
+
+ private ["_vect", "_newMagn", "_magn", "_scaleFactor", "_outVect"];
+
+PARAMS_2(_vect,_newMagn);
+
+_magn = _vect call BIS_fnc_magnitude;
+_scaleFactor = _newMagn / _magn;
+_outVect = [_vect, _scaleFactor] call CBA_fnc_scaleVect;
+_outVect;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_simplifyAngle.sqf BASE_A2Free/x/cba/addons/vectors_fnc_simplifyAngle.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_simplifyAngle.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_simplifyAngle.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,44 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_simplifyAngle
+
+Description:
+ Returns an equivalent angle to the specified angle in the range 0 to 360.
+ This allows adjustment from negative angles and angles equal or greater to 360.
+ If the inputted angle is in the range 0 - 360, it will be returned unchanged.
+
+Parameters:
+ _angle the un-adjusted angle.
+
+Returns:
+ the equivalent angle in range 0 to 360.
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_simplifyAngle.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(simplifyAngle);
+
+PARAMS_1(_angle);
+
+while {_angle < 0} do
+{
+      // Angle is negative, so convert it to the equivalent positive angle.
+      _angle = _angle + 360;
+};
+
+// Make sure it is within the range [0,360].
+if (_angle > 360) then {
+	_angle = _angle mod 360;
+};
+
+// return value
+_angle;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_simplifyAngle180.sqf BASE_A2Free/x/cba/addons/vectors_fnc_simplifyAngle180.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_simplifyAngle180.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_simplifyAngle180.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,46 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_simplifyAngle180
+
+Description:
+ Returns an equivalent angle to the specified angle in the range -180 to 180.
+ If the inputted angle is in the range -180 to 180, it will be returned unchanged.
+
+Parameters:
+ _angle the un-adjusted angle.
+
+Returns:
+ the equivalent angle in range -180 to 180.
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_simplifyAngle180.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(simplifyAngle180);
+
+
+ private ["_angle"];
+
+PARAMS_1(_angle);
+
+while {_angle <= -180} do
+{
+      // Angle is too negative.
+      _angle = _angle + 360;
+};
+while {_angle > 180} do
+{
+      // Angle is too positive.
+      _angle = _angle - 360;
+};
+
+// return value
+_angle
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vect2polar.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vect2polar.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vect2polar.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vect2polar.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,34 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vect2Polar
+
+Description:
+
+Parameters:
+
+Returns:
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_vect2Polar.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(vect2Polar);
+
+
+ private ["_mag", "_dir", "_elev", "_vx", "_vy", "_vz"];
+
+PARAMS_3(_vx,_vy,_vz);
+
+_mag = _this call BIS_fnc_magnitude;
+_elev = asin (_vz / _mag);
+_dir = _this call CBA_fnc_vectDir;
+
+[_mag, _dir, _elev];
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectAdd.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectAdd.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectAdd.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectAdd.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,24 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectAdd
+
+Description:
+ Returns the sum of two vectors.  Vectors can be 2D or 3D
+
+Parameters:
+ _u the the first vector
+ _v the the first vector
+
+Returns:
+ the sum of the two vectors.
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+
+//Function is complete replica, deprecated
+_this call BIS_fnc_vectorAdd
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectCross.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectCross.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectCross.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectCross.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,24 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectCross
+
+Description:
+ Returns the cross product vector of two vectors.  Vectors must both be three dimensional.
+
+Parameters:
+ _u the first vector.
+ _v the second vector.
+
+Returns:
+ the cross product (vector) of the two vectors.
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric,
+---------------------------------------------------------------------------- */
+
+//Function is complete replica, deprecated
+_this call BIS_fnc_crossProduct
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectCross2D.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectCross2D.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectCross2D.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectCross2D.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,31 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectCross2D
+
+Description:
+ Returns the cross product vector of two 2D vectors. The result is an integer value (positive or negative), representing the magnitude of the height component.
+
+Parameters:
+ _u the first vector.
+ _v the second vector.
+
+Returns:
+ the cross product (scalar magnitude) of the two vectors.
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_vectCross2D.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(vectCross2D);
+
+PARAMS_2(_u,_v);
+
+((_u select 0) * (_v select 1)) - ((_u select 1) * (_v select 0));
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectDir.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectDir.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectDir.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectDir.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,29 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectDir
+
+Description:
+ Returns the angle of a vector with the given i and k coordinates in the range 0 to 360.
+
+Parameters:
+ _vect the 2D vector array in the form [x,z] or [x,z,y] (y value is ignored).
+
+Returns:
+ the corresponding angle in range 0 to 360.
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_vectDir.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(vectDir);
+
+
+[((_this select 0) atan2 (_this select 1))] call CBA_fnc_simplifyAngle;
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectDot.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectDot.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectDot.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectDot.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,24 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectDot
+
+Description:
+ Returns the dot product of two vectors.  Vectors can be either two or three dimesions, but they must be the same dimension.
+
+Parameters:
+ _u the first vector.
+ _v the second vector.
+
+Returns:
+ the dot product (scalar) of the two vectors.
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+
+//Function is complete replica, deprecated
+_this call BIS_fnc_dotProduct
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectElev.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectElev.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectElev.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectElev.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,37 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectElev
+
+Description:
+ Returns the angle of elevation of a 3D vector with the given i, j and k coordinates in the range -90 to 90.
+
+Parameters:
+ _vect the 3D vector in the form [i,k,j].
+
+Returns:
+ the corresponding angle of elevation in range -90 to 90.
+
+Examples:
+	(begin example)
+
+	(end)
+
+*  @[not needed yet]call CBA_fnc_simplifyElev.sqf
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_vectElev.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(vectElev);
+
+
+private ["_dist2D"];
+
+PARAMS_2(_pos1,_pos2);
+
+_dist2D = (_this) call CBA_fnc_vectMag2D;
+
+(_this select 2) atan2 _dist2D;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectMagn.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectMagn.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectMagn.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectMagn.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,29 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectMagn
+
+Description:
+ Returns the magnitude of a 3D vector with the given i, j and k coordinates.
+
+Parameters:
+ _vect a 3D vector [i,k,j]
+
+Returns:
+ the magnitude of the vector.
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_vectMagn.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(vectMagn);
+
+
+(sqrt((_this select 0)^2 + (_this select 1)^2 + (_this select 2)^2)) call CBA_fnc_simplifyAngle;
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectMagn2D.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectMagn2D.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectMagn2D.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectMagn2D.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,29 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectMagn2D
+
+Description:
+ Returns the magnitude of a vector with the given i and k coordinates or the magnitude of the i and k components of a 3D vector.
+
+Parameters:
+ _vect the 2D vector in the form [i,k] or a 3D vector in the form [i,k,j] (j is ignored).
+
+Returns:
+ the magnitude of the i,k components of the vector.
+
+Examples:
+	(begin example)
+
+	(end)
+*  @call sct_simplifyAngle.sqf
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_vectMagn2D.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(vectMagn2D);
+
+(sqrt((_this select 0)^2 + (_this select 1)^2)) call simplifyAngle;
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectRotate2D.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectRotate2D.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectRotate2D.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectRotate2D.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,31 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectRotate2D
+
+Description:
+	Rotates a 2D vector around a given center, for rotating of a vector from its origin, use BIS_fnc_rotateVector2D
+
+Parameters:
+	Center, Vector, Angle
+
+Returns:
+	The rotated vector
+
+Author:
+	Rommel
+---------------------------------------------------------------------------- */
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+PARAMS_3(_center,_vector,_angle);
+EXPLODE_2(_center,_x,_y);
+
+private ["_dx","_dy"];
+_dx = _x - (_vector select 0);
+_dy = _y - (_vector select 1);
+
+[
+	_x - ((_dx* cos(_angle)) - (_dy* sin(_angle))),
+	_y - ((_dx* sin(_angle)) + (_dy* cos(_angle)))
+]
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_fnc_vectSubtract.sqf BASE_A2Free/x/cba/addons/vectors_fnc_vectSubtract.sqf
--- BASE_MISSION/x/cba/addons/vectors_fnc_vectSubtract.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_fnc_vectSubtract.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,38 @@
+/* ----------------------------------------------------------------------------
+Function: CBA_fnc_vectSubtract
+
+Description:
+ Returns the difference of two vectors.  Vectors can be 2D or 3D.
+
+Parameters:
+ _u the first vector.
+ _v the second vector.
+
+Returns:
+ the sum of the two vectors (u - v).
+
+Examples:
+	(begin example)
+
+	(end)
+
+Author:
+	Vigilante, courtesy by -=ACE=- of Simcentric
+---------------------------------------------------------------------------- */
+scriptName "fnc_vectSubtract.sqf";
+
+#include "vectors_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(vectSubtract);
+
+
+ private ["_u","_v","_i","_k", "_j"];
+
+PARAMS_2(_u,_v);
+
+_i = (_u select 0) - (_v select 0);
+_k = (_u select 1) - (_v select 1);
+_j = (_u select 2) - (_v select 2);
+
+[_i, _k, _j];
\ No newline at end of file
diff -rupN BASE_MISSION/x/cba/addons/vectors_script_component.hpp BASE_A2Free/x/cba/addons/vectors_script_component.hpp
--- BASE_MISSION/x/cba/addons/vectors_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/vectors_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,13 @@
+#define COMPONENT vectors
+#include "script_mod.hpp"
+
+
+#ifdef DEBUG_ENABLED_VECTORS
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_VECTORS
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_VECTORS
+#endif
+
+#include "script_macros.hpp"
diff -rupN BASE_MISSION/x/cba/addons/versioning_XEH_postInit.sqf BASE_A2Free/x/cba/addons/versioning_XEH_postInit.sqf
--- BASE_MISSION/x/cba/addons/versioning_XEH_postInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/versioning_XEH_postInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,41 @@
+#include "versioning_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(XEH_postInit);
+
+/*
+	Basic, Generic Version Checking System - By Sickboy <sb_at_dev-heaven.net>
+*/
+
+if (!SLX_XEH_DisableLogging) then
+{
+	diag_log [diag_frameNo, diag_tickTime, time, "CBA_VERSIONING", GVAR(versions)];
+};
+
+// Depency check and warn
+[GVAR(dependencies), {
+	private ["_mod", "_data", "_class", "_f"];
+	_f = {
+		diag_log text _this;
+		sleep 1;
+		CBA_logic globalChat _this;
+	};
+	{
+		_mod = _x select 0;
+		_data = _x select 1;
+		_class = (configFile >> "CfgPatches" >> (_data select 0));
+		if (call compile(_data select 2)) then {
+			if !(isClass(_class)) then {
+				format["WARNING: %1 requires %2 (@%3) at version %4 (or higher). You have none.", _key, _data select 0, _mod, _data select 1] spawn _f;
+			} else {
+				if !(isArray(_class >> "versionAr")) then {
+					format["WARNING: %1 requires %2 (@%3) at version %4 (or higher). No valid version info found.", _key, _data select 0, _mod, _data select 1] spawn _f;
+				} else {
+					if ([_data select 1, getArray(_class >> "versionAr")] call FUNC(version_compare)) then {
+						format["WARNING: %1 requires %2 (@%3) at version %4 (or higher). You have: %5", _key, _data select 0, _mod, _data select 1, getArray(_class >> "versionAr")] spawn _f;
+					};
+				};
+			};
+		};
+	} forEach _value;
+}] call CBA_fnc_hashEachPair;
diff -rupN BASE_MISSION/x/cba/addons/versioning_XEH_postInitClient.sqf BASE_A2Free/x/cba/addons/versioning_XEH_postInitClient.sqf
--- BASE_MISSION/x/cba/addons/versioning_XEH_postInitClient.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/versioning_XEH_postInitClient.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,12 @@
+#include "versioning_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+[] spawn {
+	waitUntil {!(isNil QUOTE(GVAR(versions_serv)))};
+	if (!SLX_XEH_DisableLogging) then
+	{
+		diag_log [diag_frameNo, diag_tickTime, time, "CBA_VERSIONING_SERVER", GVAR(versions_serv)];
+	};
+	[GVAR(versions_serv), {call FUNC(version_check)}] call CBA_fnc_hashEachPair;
+};
diff -rupN BASE_MISSION/x/cba/addons/versioning_XEH_postInitServer.sqf BASE_A2Free/x/cba/addons/versioning_XEH_postInitServer.sqf
--- BASE_MISSION/x/cba/addons/versioning_XEH_postInitServer.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/versioning_XEH_postInitServer.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,40 @@
+#include "versioning_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+if (SLX_XEH_MACHINE select 1) exitWith { LOG("WARNING: YOUR MACHINE WAS DETECTED AS SERVER INSTEAD OF CLIENT!") };
+
+GVAR(versions_serv) = + GVAR(versions); // For latest versions
+GVAR(versions_server) = + GVAR(versions); // For legacy versions
+
+publicVariable QUOTE(GVAR(versions_serv));
+publicVariable QUOTE(GVAR(versions_server)); // TODO: Deprecate?
+
+// Paranoid; yet pretty annoying gamebreaking issue :-)
+QUOTE(GVAR(versions_serv)) addPublicVariableEventHandler
+{
+	private ["_params"];
+	_params = _this select 1;
+	diag_log [diag_frameNo, diag_tickTime, time, _params, "WARNING: Some client seems to have overriden the versions array; please report to CBA devs!"];
+	diag_log [GVAR(versions), GVAR(version_serv)];
+	if (isServer && isDedicated) then {
+		GVAR(versions_serv) = GVAR(versions);
+		publicVariable QUOTE(GVAR(versions_serv));
+	};
+};
+
+QUOTE(GVAR(mismatch)) addPublicVariableEventHandler
+{
+	private ["_params"];
+	_params = _this select 1;
+	[format["%1 - Not running! (Machine: %2)", _params select 1, _params select 0], QUOTE(COMPONENT), [CBA_display_ingame_warnings, true, true]] call CBA_fnc_debug;
+};
+
+private ["_str"];
+_str = 'if(isServer)exitWith{};0 = [] spawn { sleep 1; sleep 1; _func={GVAR(mismatch)=[format["%2 (%1)",name player, player],_this];publicVariable QUOTE(GVAR(mismatch));_this spawn{_t=format["You are missing the following mod: %1",_this];diag_log text _t;sleep 2;player globalChat _t}};';
+[GVAR(versions_serv), {_str = _str + format['if !(isClass(configFile >> "CfgPatches" >> "%1_main"))exitWith{"%1_main" call _func};', _key]}] call CBA_fnc_hashEachPair;
+ADD(_str,"};");
+// Actually disconnect em?
+// endMission "END1"
+CBA_logic setVehicleInit _str;
+processInitCommands;
diff -rupN BASE_MISSION/x/cba/addons/versioning_XEH_preInit.sqf BASE_A2Free/x/cba/addons/versioning_XEH_preInit.sqf
--- BASE_MISSION/x/cba/addons/versioning_XEH_preInit.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/versioning_XEH_preInit.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,58 @@
+#include "versioning_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+SCRIPT(XEH_preInit);
+/*
+	Basic, Generic Version Checking System - By Sickboy <sb_at_dev-heaven.net>
+
+*/
+LOG(MSG_INIT);
+ADDON = false;
+
+if (isNil "CBA_display_ingame_warnings") then { CBA_display_ingame_warnings = true };
+if (isNil QUOTE(GVAR(mismatch))) then { GVAR(mismatch) = [] };
+
+// Build versions hashes
+GVAR(versions) = [[], [[0, 0, 0], 0]] call CBA_fnc_hashCreate;
+GVAR(dependencies) = [[], ["", [0, 0, 0], "true"]] call CBA_fnc_hashCreate;
+private ["_prefix", "_version", "_verCfg", "_level", "_deps", "_dependencies", "_entry"];
+#define DATA configName _entry,(getArray(_entry))
+for "_i" from 0 to (count (CFGSETTINGS) - 1) do
+{
+	_prefix = (CFGSETTINGS) select _i;
+	if (isClass _prefix) then
+	{
+		_verCfg = (configFile >> "CfgPatches" >> format["%1_main", configName _prefix] >> "versionAr");
+		_level = if (isNumber(_prefix >> "level")) then { getNumber(_prefix >> "level") } else { -1 };
+		_version = if (isArray(_verCfg)) then { [getArray(_verCfg), _level] } else { [[0, 0, 0], 0] };
+		[GVAR(versions), toLower(configName _prefix), _version] call CBA_fnc_hashSet;
+		_deps = (_prefix >> "dependencies");
+		if (isClass(_deps)) then {
+			_dependencies = [];
+			for "_j" from 0 to ((count _deps) - 1) do {
+				_entry = _deps select _j;
+				if (isArray(_entry)) then {
+					PUSH(_dependencies,[DATA]);
+				};
+			};
+			[GVAR(dependencies), toLower(configName _prefix), _dependencies] call CBA_fnc_hashSet;
+		};
+	};
+};
+
+PREP(version_check);
+FUNC(version_compare) = {
+	private ["_failed", "_c"];
+	PARAMS_2(_value,_localValue);
+	_failed = false;
+	_c = count _localValue;
+
+	for "_i" from 0 to ((count _value) - 1) do {
+		if (_i == _c) exitWith { _failed = true}; // Woobs
+		if ((_localValue select _i) > (_value select _i)) exitWith {}; // All good
+		if ((_localValue select _i) < (_value select _i)) exitWith {_failed = true}; // Woobs
+	};
+	_failed;
+};
+
+ADDON = true;
diff -rupN BASE_MISSION/x/cba/addons/versioning_fnc_version_check.sqf BASE_A2Free/x/cba/addons/versioning_fnc_version_check.sqf
--- BASE_MISSION/x/cba/addons/versioning_fnc_version_check.sqf	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/versioning_fnc_version_check.sqf	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,43 @@
+#include "versioning_script_component.hpp"
+
+#define PATHTO_SYS(var1,var2,var3) MAINPREFIX\##var1\SUBPREFIX\##var2##_##var3.sqf
+
+private ["_localValue", "_remoteVersion", "_localVersion", "_lc", "_rc", "_level", "_local", "_remote", "_failed"]; // _key, _value  are injected by the CBA_fnc_hashEachPair
+
+_localValue = [GVAR(versions), _key] call CBA_fnc_hashGet;
+TRACE_3("Version Check",_key,_value,_localValue);
+
+_failed = false;
+_localVersion = _localValue select 0;
+_remoteVersion = _value select 0;
+_level = _value select 1;
+_lc = count _localVersion; _rc = count _remoteVersion;
+if (_level == -1) then { _level = _rc };
+if (_level == 0) exitWith {};
+
+if (_level > _rc) then { _level = _rc };
+if (_lc >= _level) then
+{
+	for "_i" from 0 to (_level - 1) do
+	{
+		_local = _localVersion select _i;
+		_remote = _remoteVersion select _i;
+		if (_local != _remote) exitWith { _failed = true; };
+	};
+} else {
+	_failed = true;
+};
+
+if !(_failed) exitWith {};
+
+// Default version mismatch handling, broadcast to all!
+[format["%1 - Version Mismatch! (Machine: %2 (%6) version: %4, serverVersion: %3, Level: %5)", _key, player, _value, _localValue, _level, name player], QUOTE(ADDON), [CBA_display_ingame_warnings, true, true]] call CBA_fnc_debug;
+
+// Allow custom handler
+if (isText ((CFGSETTINGS) >> _key >> "handler")) then
+{
+	// TODO: PreCompile and spawn from Hash or so?
+	[_remoteVersion, _localVersion, player, _level] spawn (call compile getText((CFGSETTINGS) >> _key >> "handler"));
+};
+// Actually disconnect em?
+// endMission "END1"
diff -rupN BASE_MISSION/x/cba/addons/versioning_script_component.hpp BASE_A2Free/x/cba/addons/versioning_script_component.hpp
--- BASE_MISSION/x/cba/addons/versioning_script_component.hpp	Thu Jan  1 10:00:00 1970
+++ BASE_A2Free/x/cba/addons/versioning_script_component.hpp	Wed Jan  4 23:08:03 2012
@@ -0,0 +1,13 @@
+#define COMPONENT versioning
+#include "script_mod.hpp"
+
+
+#ifdef DEBUG_ENABLED_VERSIONING
+	#define DEBUG_MODE_FULL
+#endif
+
+#ifdef DEBUG_SETTINGS_VERSIONING
+	#define DEBUG_SETTINGS DEBUG_SETTINGS_VERSIONING
+#endif
+
+#include "script_macros.hpp"
